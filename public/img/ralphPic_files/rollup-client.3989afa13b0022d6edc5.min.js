webpackJsonp([3,46,52,54,344,237,241,249,250,254,66,44],{0:function(e,t){e.exports=function(e){"undefined"!=typeof execScript?execScript(e):eval.call(null,e)}},1013:function(e,t){e.exports="/**\n * Requires JQueryUI widget factory\n */\n/*jslint regexp: true, todo: true, vars: true, white: true, nomen: true, plusplus: true */\n/*global jQuery, console, DATA */\n(function($) {\n\n\t\"use strict\";\n\n\tvar MENU_TYPES = {\n\t\thistory: 'history',\n\t\tmodifier: 'modifier',\n\t\tuser: 'user',\n\t\tgroup: 'group',\n\t\tchannel: 'channel',\n\t\tconversation: 'conversation',\n\t\ttime_range: 'time-range',\n\t\tdate: 'date',\n\t\thas: 'has' // star, link, reaction?\n\t};\n\n\tvar SECTION_RESULT_LIMIT = 5;\n\tvar USER_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar CHANNEL_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar GROUP_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar HISTORY_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar PROFILE_RESULT_LIMIT = SECTION_RESULT_LIMIT;\n\tvar LIMIT_DEFAULT = 100;\n\n\tvar REPLACEMENT_ATTR = 'data-replacement';\n\tvar MATCHING_KEYWORD_ATTR = 'data-matching-keyword';\n\n\tvar SELECTED_CLASS = null;\n\t// maybe should add this class programatically instead? Since I depend on it\n\t// for _isModifierItemElement(). No biggie, though.\n\tvar MODIFIERS_LIST_CLASS = 'modifiers';\n\tvar HISTORY_LIST_CLASS = 'history';\n\tvar PROFILE_LIST_CLASS = 'profiles';\n\n\tvar ITEM_WRAPPER_SEL = 'li';\n\tvar ITEM_GROUP_WRAPPER_SEL = 'ol';\n\n\tvar CALENDAR_CLASS = 'autocomplete_calendar';\n\tvar CALENDAR_VISIBLE_CLASS = 'calendar_visible';\n\tvar CALENDAR_FORMAT = 'Y-m-d';\n\n\tvar DEFAULT_CONVERSATION_MODIFIER = null;\n\n\tvar DEFAULT_MENU_HEIGHT = 534;\n\n\tvar _last_key_code = 0;\n\n\tvar has_token_regex = /\\{(.+)\\}/i;\n\tvar might_be_modifier_regex = /^[^:]+:([^:]+)?$/i;\n\n\t$.widget('TS.autocomplete', {\n\n\t\t// defaults\n\t\toptions: {\n\t\t\thidden_class: 'hidden',\n\t\t\tselected_class: 'selected',\n\t\t\tappend_to: 'body',\n\t\t\tdisabled: false,\n\t\t\tdata: null\n\t\t},\n\n\t\t_$popover: null,\n\t\t_$menu: null,\n\t\t_$menu_items: null,\n\t\t_$calendar: null,\n\t\t_$ac_menu: null,\n\t\t_$scrollable: null,\n\n\t\t_menu_index: null,\n\t\t_calendar_modifier: '',\n\t\t_render_data: {},\n\t\t_last_query: null,\n\t\t_recalc_height: true,\n\t\t_open_menu_on_focus: true,\n\t\t_hide_timer: null,\n\t\t_mouse_in_menu: false,\n\t\t_input_has_focus: false,\n\t\t_block_menu: false,\n\t\t_caret_position: null,\n\n\t\t_current_history_query: null,\n\t\t_current_history_items: [],\n\n\t\t_search_promises: [],\n\t\t_search_pending: false,\n\n\t\t// init/constructor\n\t\t_create: function() {\n\t\t\tif (!TS.boot_data.feature_texty_search && !this.element.is('input[type=\"text\"]')) {\n\t\t\t\tthrow this.widgetName + ': Element is not a text input.';\n\t\t\t}\n\n\t\t\tthis.options.selected_class = 'highlighted';\n\n\t\t\t// TODO: Warn when changing this after intantiaion\n\t\t\tSELECTED_CLASS = this.options.selected_class;\n\t\t\tDEFAULT_CONVERSATION_MODIFIER = TS.i18n.t('in:', 'search_menu')();\n\n\t\t\tthis._renderUI();\n\n\t\t\tvar input_events = {\n\t\t\t\t'keydown': this._onTextInputKeydown.bind(this),\n\t\t\t\t'keyup': this._onTextInputKeyup.bind(this),\n\t\t\t\t'mousedown': this._onTextInputMouseDown.bind(this),\n\t\t\t\t'mouseup': this._onTextInputMouseUp.bind(this),\n\t\t\t\t'focus': this._onTextInputFocus.bind(this),\n\t\t\t\t'blur': this._onTextInputBlur.bind(this),\n\t\t\t\t'cut': this._onTextInput.bind(this),\n\t\t\t\t'paste': this._onTextInput.bind(this),\n\t\t\t\t'input': this._onTextInput.bind(this),\n\t\t\t\t// Texty\n\t\t\t\t'on-enter': this._handleEnterKey.bind(this),\n\t\t\t\t'on-escape': this._handleEscKey.bind(this),\n\t\t\t\t'on-tab': this._handleTabKey.bind(this),\n\t\t\t};\n\n\t\t\t// bind ui events\n\t\t\tif (TS.boot_data.feature_texty_search) {\n\t\t\t\tif (this.options.registerInputEvents) {\n\t\t\t\t\tthis.options.registerInputEvents(input_events);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis._on(this.element, input_events);\n\t\t\t}\n\n\t\t\tthis._on(this._$menu, {\n\t\t\t\t'click li': this._onMenuClick,\n\t\t\t\t'click .delete_history_item_target_area': this._onClickDeleteHistoryItem,\n\t\t\t\t'click .footer_tip_action': this._onClickFooterTipAction,\n\t\t\t\t'mouseenter': this._onMouseEnter,\n\t\t\t\t'mouseleave': this._onMouseLeave,\n\t\t\t\t'mousedown': this._onMouseDownMenu\n\t\t\t});\n\n\t\t\tthis.options.data = this.options.data || window.DATA;\n\n\t\t\t$(window).bind('resize.recalc_autocomplete_height', $.proxy(function() {\n\t\t\t\tthis._recalc_height = true;\n\t\t\t}, this));\n\t\t},\n\n\t\t_destroy: function() {\n\t\t\t$(window).unbind('resize.recalc_autocomplete_height');\n\t\t},\n\n\t\t// TODO: Implement JQuery standard show http://api.jqueryui.com/jquery.widget/#method-_show\n\t\t_show: function() {\n\t\t\tthis._$popover.removeClass(this.options.hidden_class);\n\n\t\t\tif (this._recalc_height) {\n\t\t\t\t// see if we need to limit the height of the menu\n\t\t\t\tthis._recalc_height = false;\n\t\t\t\tvar window_height = $(window).height();\n\t\t\t\tvar menu_top = this._$menu.offset().top;\n\t\t\t\tvar available_space = window_height - menu_top - 25;\n\t\t\t\tvar max_height = Math.min(available_space, DEFAULT_MENU_HEIGHT);\n\t\t\t\tthis._$menu.css('max-height', max_height);\n\t\t\t}\n\n\t\t\t$(window).unbind('mousedown.close_autocomplete').bind('mousedown.close_autocomplete', $.proxy(this._onMouseDownOutsideAutocomplete, this));\n\n\t\t\tTS.ui.utility.updateClosestMonkeyScroller(this._$scrollable);\n\t\t},\n\t\tshow: function() {\n\t\t\tthis._show();\n\t\t},\n\n\t\t// TODO: Implement JQuery standard hide http://api.jqueryui.com/jquery.widget/#method-_hide\n\t\t_hide: function() {\n\t\t\t$(ITEM_WRAPPER_SEL, this._$menu).removeClass(this.options.selected_class);\n\t\t\tthis._$popover.addClass(this.options.hidden_class);\n\t\t\tthis._mouse_in_menu = false;\n\t\t\tthis._resetMenuIndex();\n\t\t\tthis._clearGhostText();\n\t\t\t$(window).unbind('mousedown.close_autocomplete');\n\n\t\t\tTS.kb_nav.end();\n\t\t},\n\t\thide: function() {\n\t\t\tthis._hide();\n\t\t},\n\n\t\t// hide, but allow it to be canceled on re-focus\n\t\t_requestHide: function() {\n\t\t\tthis._cancelHide();\n\t\t\tthis._hide_timer = setTimeout($.proxy(this._hide, this), 0);\n\t\t},\n\n\t\t_cancelHide: function() {\n\t\t\tclearTimeout(this._hide_timer);\n\t\t},\n\n\t\t_resetMenuIndex: function() {\n\t\t\tthis._menu_index = null;\n\t\t},\n\n\t\t_renderUI: function() {\n\t\t\tthis._$popover = $('<div/>').addClass('popover_menu popover_search_menu').attr('id', 'search_autocomplete_popover');\n\t\t\tthis._$popover.append('<span class=\"arrow\"></span><span class=\"arrow_shadow\"></span>');\n\t\t\t// We'll just create a wrapper div and rerender the html inside to show results\n\t\t\tif (this._$menu) {\n\t\t\t\tthis._$menu.empty();\n\t\t\t}\n\t\t\t// things have to be nested a bit to accommodate monkeyScroll\n\t\t\tthis._$ac_menu = $('<div id=\"autocomplete_menu\" class=\"content\"/>').appendTo(this._$popover);\n\t\t\tthis._$scrollable = $('<div class=\"autocomplete_menu_scrollable\"/>').appendTo(this._$ac_menu);\n\t\t\tthis._$menu = $('<div/>').appendTo(this._$scrollable);\n\t\t\tthis._initCalendar();\n\t\t\tthis._hide();\n\t\t\tthis._$scrollable.append(this._$menu);\n\t\t\t$(this.options.append_to).append(this._$popover);\n\n\t\t\tif (!TS.environment.supports_custom_scrollbar) {\n\t\t\t\tthis._$scrollable.monkeyScroll();\n\t\t\t}\n\n\t\t\tthis._$ac_menu.addClass('search_menu');\n\t\t},\n\n\t\t// Rerender this thing's innards according to the latest _render_data\n\t\t_syncUI: function() {\n\t\t\tTS.kb_nav.end();\n\n\t\t\tif (this._render_data.header) {\n\t\t\t\tthis._$popover.addClass('showing_header');\n\t\t\t} else {\n\t\t\t\tthis._$popover.removeClass('showing_header');\n\t\t\t}\n\t\t\tthis._render_data.conversations_html = new Handlebars.SafeString(this._conversationsHTML());\n\n\t\t\tthis._$menu.html(TS.templates.search_menu(this._render_data));\n\n\t\t\tthis._$menu_items = $(ITEM_WRAPPER_SEL, this._$menu);\n\t\t\tif (this._render_data.show_calendar) {\n\t\t\t\tthis._$calendar.removeClass(this.options.hidden_class);\n\t\t\t\tthis._$ac_menu.addClass(CALENDAR_VISIBLE_CLASS);\n\t\t\t\t// unhighlight previous selection\n\t\t\t\tthis._$calendar.find('.pmu-selected').removeClass('pmu-selected');\n\t\t\t} else {\n\t\t\t\tthis._$calendar.addClass(this.options.hidden_class);\n\t\t\t\tthis._$ac_menu.removeClass(CALENDAR_VISIBLE_CLASS);\n\t\t\t}\n\t\t\tif (this._render_data.footer && this._render_data.footer.tips) {\n\t\t\t\tthis._$popover.attr('data-qa', 'search_modifier_tips');\n\t\t\t} else {\n\t\t\t\tthis._$popover.removeAttr('data-qa');\n\t\t\t}\n\t\t\tthis._resetMenuIndex();\n\n\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\tthis._updateGhostText();\n\t\t\t}\n\n\t\t\t// the menu is forced to be thinner while the calendar is visible. this stops monkeyscroll from updating until it's gone.\n\t\t\tthis._$scrollable.data('disable-scroll', !!this._render_data.show_calendar);\n\t\t\tTS.ui.utility.updateClosestMonkeyScroller(this._$scrollable);\n\n\t\t\tTS.kb_nav.start(this._$menu.find('.results'), 'li', '.search_menu', {\n\t\t\t\tonMoveHighlight: _.bind(function() {\n\t\t\t\t\tthis._highlightModifierAndKeywordInSearchField();\n\t\t\t\t}, this),\n\t\t\t});\n\t\t\tTS.kb_nav.setAllowHighlightWithoutBlurringInput(true);\n\t\t},\n\n\t\t// the ordering of the `in:` items varies\n\t\t_conversationsHTML: function() {\n\t\t\tthis._combineChannelsAndGroups();\n\n\t\t\tvar data = this._render_data;\n\n\t\t\tvar channels_html, dms_html, groups_html;\n\n\t\t\tchannels_html = TS.templates.search_menu_channels(data);\n\t\t\tdms_html = TS.templates.search_menu_dms(data);\n\t\t\tgroups_html = TS.templates.search_menu_groups(data);\n\n\t\t\tvar regular_matches = [];\n\t\t\tvar archived_matches = [];\n\n\t\t\t// https://bugs.tinyspeck.com/7432\n\t\t\t// if the only matches in channels are for archived channels\n\t\t\t// but there are matches for non-archived groups\n\t\t\t// put the groups first\n\n\t\t\tif (data.channels && data.channels.length) {\n\t\t\t\tregular_matches.push(channels_html);\n\t\t\t} else {\n\t\t\t\tarchived_matches.push(channels_html);\n\t\t\t}\n\n\t\t\tif (data.dms && data.dms.length) {\n\t\t\t\tregular_matches.push(dms_html);\n\t\t\t} else {\n\t\t\t\tarchived_matches.push(dms_html);\n\t\t\t}\n\n\t\t\tif (data.groups && data.groups.length) {\n\t\t\t\tregular_matches.push(groups_html);\n\t\t\t} else {\n\t\t\t\tarchived_matches.push(groups_html);\n\t\t\t}\n\n\t\t\treturn regular_matches.join('') + archived_matches.join('');\n\t\t},\n\n\t\t_combineChannelsAndGroups: function() {\n\t\t\tvar all_channels = [];\n\t\t\tif ($.isArray(this._render_data.channels)) {\n\t\t\t\tall_channels = this._render_data.channels;\n\t\t\t}\n\t\t\tif ($.isArray(this._render_data.groups)) {\n\t\t\t\tall_channels = all_channels.concat(this._render_data.groups);\n\t\t\t}\n\n\t\t\tvar all_archived = [];\n\t\t\tif ($.isArray(this._render_data.channels_archived)) {\n\t\t\t\tall_archived = this._render_data.channels_archived;\n\t\t\t}\n\t\t\tif ($.isArray(this._render_data.groups_archived)) {\n\t\t\t\tall_archived = all_archived.concat(this._render_data.groups_archived);\n\t\t\t}\n\n\t\t\tall_channels.sort(function(a, b) { return b._score - a._score; });\n\t\t\tall_archived.sort(function(a, b) { return b._score - a._score; });\n\n\t\t\tthis._render_data.channels = all_channels;\n\t\t\tthis._render_data.channels_archived = all_archived;\n\n\t\t\t// if there are only archived channels to display, set `channels` to true\n\t\t\tif (all_archived.length > 0 && all_channels.length === 0) this._render_data.channels = true;\n\n\t\t\tdelete this._render_data.groups;\n\t\t\tdelete this._render_data.groups_archived;\n\t\t},\n\n\t\t// (re-)creates the calendar div and initializes the calendar plugin\n\t\t// need to re-init sometimes because the max date could change\n\t\t_initCalendar: function() {\n\t\t\tif (this._$calendar) this._$calendar.pickmeup('destroy').remove();\n\n\t\t\tthis._$calendar = $('<div/>').addClass(CALENDAR_CLASS).addClass(this.options.hidden_class).prependTo(this._$ac_menu);\n\n\t\t\tthis._$calendar.pickmeup({\n\t\t\t\tflat: true,\n\t\t\t\tfirst_day: TS.i18n.start_of_the_week[TS.i18n.locale()] || 0,\n\t\t\t\tformat: CALENDAR_FORMAT,\n\t\t\t\tchange: $.proxy(this._onCalendarChange, this),\n\t\t\t\tmax: Date.now(),\n\t\t\t\tlocale: {\n\t\t\t\t\tdays: TS.utility.date.day_names,\n\t\t\t\t\tdaysShort: TS.utility.date.short_day_names,\n\t\t\t\t\tdaysMin: TS.utility.date.really_short_day_names,\n\t\t\t\t\tmonths: TS.utility.date.month_names,\n\t\t\t\t\tmonthsShort: TS.utility.date.short_month_names\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t_setCalendarModifier: function(modifier) {\n\t\t\tthis._calendar_modifier = modifier;\n\t\t},\n\n\t\t_onTextInputMouseDown: function(e) {\n\t\t\tif (this._input_has_focus) {\n\t\t\t\tif (this._hideMenuIfTextSelected()) return;\n\n\t\t\t\t// this is a proxy for moving the cursor with the mouse\n\t\t\t\tsetTimeout($.proxy(function() {\n\t\t\t\t\tthis._saveCaretPosition();\n\t\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\t}, this), 0);\n\t\t\t}\n\t\t},\n\n\t\t_onTextInputMouseUp: function() {\n\t\t\tthis._saveCaretPosition();\n\t\t\tthis._hideMenuIfTextSelected();\n\t\t},\n\n\t\t_onMenuClick: function(e) {\n\t\t\tvar $clicked_item = $(e.target).closest(ITEM_WRAPPER_SEL);\n\n\t\t\tif (!$clicked_item.length) {\n\t\t\t\treturn this._hide();\n\t\t\t}\n\n\t\t\tvar replacement;\n\n\t\t\tif (TS.boot_data.feature_more_texty_search) {\n\t\t\t\treplacement = [];\n\n\t\t\t\tvar member_id = $clicked_item.attr('data-member-id');\n\t\t\t\tvar member = TS.members.getMemberById(member_id);\n\n\t\t\t\tif (member) {\n\t\t\t\t\tvar mention = TS.format.texty.memberToSlug(member);\n\t\t\t\t\treplacement.push(mention);\n\t\t\t\t}\n\n\t\t\t\tif (!replacement.length) {\n\t\t\t\t\tvar replacement_str = $clicked_item.attr(REPLACEMENT_ATTR);\n\n\t\t\t\t\tvar value = TS.utility.contenteditable.value(this.element);\n\t\t\t\t\tvar before_text = value.slice(0, this._getCaretPosition());\n\n\t\t\t\t\tif (!_.endsWith(before_text, replacement_str)) {\n\t\t\t\t\t\treplacement.push({ insert: replacement_str });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treplacement = $clicked_item.attr(REPLACEMENT_ATTR);\n\t\t\t}\n\n\t\t\tif (this._isProfileItemElement($clicked_item)) {\n\t\t\t\tthis._handleProfileItem($clicked_item);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._isRevealHiddenElement($clicked_item)) {\n\t\t\t\tthis._revealHiddenItems($clicked_item);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._shouldAppendSpaceToItem($clicked_item)) {\n\t\t\t\tif (TS.boot_data.feature_texty_search) {\n\t\t\t\t\t/*\n\t\t\t\t\t * Don't allow the only replacement to be a space. This is helpful\n\t\t\t\t\t * because we'll sometimes choose _not_ to replace text if it's\n\t\t\t\t\t * already in the input\n\t\t\t\t\t *\n\t\t\t\t\t * i.e., relacement is \"me\" and text is \"from:me\"\n\t\t\t\t\t */\n\t\t\t\t\tif (replacement.length) {\n\t\t\t\t\t\treplacement.push({ insert: ' ' });\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treplacement += ' ';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._open_menu_on_focus = false;\n\n\t\t\tif (this._isHistoryItemElement($clicked_item)) {\n\t\t\t\tthis._replaceEntireInput(replacement);\n\t\t\t} else {\n\t\t\t\tthis._replaceCurrentWord(replacement);\n\t\t\t}\n\n\t\t\tthis._cancelDelayedSearch();\n\n\t\t\tif (this._isModifierItemElement($clicked_item)) {\n\t\t\t\tif (this._isModifierItemElementWithoutKeyword($clicked_item)) {\n\t\t\t\t\tthis._showKeywordAutocompleteMenu();\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\t// we end up here if the user clicks on one of the modifier:keyword pairs, like 'on:yesterday'\n\t\t\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\t\tif (!this._isHistoryItemElement($clicked_item)) {\n\t\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._hide();\n\t\t},\n\n\t\t_onClickDeleteHistoryItem: function(e) {\n\t\t\te.stopPropagation();\n\n\t\t\tvar $target = $(e.target).closest('li');\n\t\t\tvar query = $target.attr(REPLACEMENT_ATTR);\n\n\t\t\t// calls search.delete\n\t\t\tif (this.options.data.deleteHistoryItem) this.options.data.deleteHistoryItem(query);\n\n\t\t\t// remove local reference\n\t\t\tthis._current_history_items = this._current_history_items.filter(function(item) {\n\t\t\t\treturn item.text !== query;\n\t\t\t});\n\t\t\tthis._render_data.history = this._current_history_items;\n\n\t\t\t// refresh the menu\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t// this is for clicks on the highlighted suggestions in the footer tip\n\t\t_onClickFooterTipAction: function(e) {\n\t\t\tvar $target = $(e.target).closest('.footer_tip_action');\n\t\t\tvar replacement = $target.data('replacement');\n\t\t\tif (!replacement) return;\n\n\t\t\tthis._replaceCurrentWord(replacement);\n\t\t\tthis._showAutocompleteSuggestions();\n\t\t},\n\n\t\t_onMouseDownOutsideAutocomplete: function(e) {\n\t\t\t// check if the click was on the menu or the input\n\t\t\t// then close the menu\n\t\t\tif (!$.contains(this.element[0], e.target) && !$.contains(this._$popover[0], e.target) && this.element[0] !== e.target && this._$popover[0] !== e.target) {\n\t\t\t\tthis._hide();\n\t\t\t}\n\t\t},\n\n\t\t_onMouseDownMenu: function(e) {\n\t\t\t// prevent blur when clicking on the menu\n\t\t\te.preventDefault();\n\t\t},\n\n\t\t_onMouseEnter: function() {\n\t\t\tthis._mouse_in_menu = true;\n\t\t},\n\n\t\t_onMouseLeave: function() {\n\t\t\tthis._mouse_in_menu = false;\n\t\t},\n\n\t\tpreventMenuOnNextFocus: function() {\n\t\t\tthis._open_menu_on_focus = false;\n\t\t},\n\n\t\t_onTextInputFocus: function() {\n\t\t\tthis._block_menu = false;\n\t\t\tthis._cancelHide();\n\t\t\tsetTimeout($.proxy(function() {\n\t\t\t\tthis._input_has_focus = true;\n\t\t\t\tthis._saveCaretPosition();\n\n\t\t\t\tif (this._open_menu_on_focus) this._showAutocompleteSuggestions(true);\n\n\t\t\t\t// set to false when clicking on menu items and we need to refocus.\n\t\t\t\tthis._open_menu_on_focus = true;\n\t\t\t}, this), 0);\n\t\t},\n\n\t\t_onTextInputBlur: function() {\n\t\t\tthis._input_has_focus = false;\n\t\t\tif (!this._mouse_in_menu) {\n\t\t\t\tthis._requestHide();\n\t\t\t}\n\t\t},\n\n\t\t_onCalendarChange: function(formatted_date) {\n\t\t\tvar modifier_and_keyword = this._calendar_modifier + formatted_date + ' ';\n\t\t\tthis._open_menu_on_focus = false;\n\t\t\tthis._replaceCurrentWord(modifier_and_keyword);\n\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\tthis._hide();\n\t\t},\n\n\t\t_onTextInputKeydown: function(e) {\n\n\t\t\t_last_key_code = e.which;\n\n\t\t\t// don't want history results once the search is submitted\n\t\t\tif (e.keyCode === _key_codes.enter) {\n\t\t\t\tthis._handleEnterKey();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._block_menu = false;\n\n\t\t\tif (!this._menuShowing()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.keyCode === _key_codes.escape) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis._handleEscKey();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (e.keyCode === _key_codes.tab) {\n\t\t\t\tthis._handleTabKey();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Autocomplete on right arrow if the caret is at the end of the string\n\t\t\tif (e.keyCode === _key_codes.right && TS.utility.contenteditable.getLength(this.element) === this._getCaretPosition() && !TS.kb_nav.getHighlightedItem()) {\n\t\t\t\tsetTimeout(_.bind(function() {\n\t\t\t\t\t// kb_nav will not highlight on right arrow since it does not track caret position\n\t\t\t\t\tTS.kb_nav.highlightFirstItem();\n\t\t\t\t\tthis._highlightModifierAndKeywordInSearchField();\n\t\t\t\t}, this), 0);\n\t\t\t}\n\t\t},\n\n\t\t_handleTabKey: function() {\n\t\t\t// special case tabbing to the only item\n\t\t\t// this hack will be made unnecessary when we implement tab completions with ghost text\n\t\t\tif (this._menuShowing() && this._$menu_items.length === 1) {\n\t\t\t\tthis._selectFirstItem();\n\t\t\t}\n\t\t},\n\n\t\t_onTextInput: function(e) {\n\t\t\t// fixes an issue in IE where pressing tab in an empty textbox will fire an input event. No other\n\t\t\t// browser has this behavior, so this is required to fix a bug where pressing tab in the search box\n\t\t\t// would not move focus to the next element as expected with keyboard navigation.\n\t\t\tif (_last_key_code == 9) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._saveCaretPosition();\n\t\t\tthis._last_query = TS.utility.contenteditable.value(this.element);\n\n\t\t\tif (this._prevent_next_input_event) {\n\t\t\t\tthis._prevent_next_input_event = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._showAutocompleteSuggestions();\n\t\t},\n\n\t\t_onTextInputKeyup: function(e) {\n\t\t\tif (e.keyCode === _key_codes.escape) return;\n\t\t\tif (this._block_menu) return;\n\t\t\tif (this._hideMenuIfTextSelected()) return;\n\t\t},\n\n\t\t_selectFirstItem: function() {\n\t\t\tsetTimeout(_.bind(function() {\n\t\t\t\tthis._highlightModifierAndKeywordInSearchField();\n\n\t\t\t\t// submit the item\n\t\t\t\tthis._selectItem();\n\t\t\t}, this), 0);\n\t\t},\n\n\t\t_handleEnterKey: function() {\n\t\t\tthis._cancelCurrentHistoryQuery();\n\t\t\tthis._block_menu = true;\n\n\t\t\tif (this._menuShowing()) {\n\t\t\t\tvar fake_event = $.Event('keydown', {\n\t\t\t\t\ttarget: $('.' + this.options.selected_class, this._$menu),\n\t\t\t\t});\n\t\t\t\tthis._onMenuClick(fake_event);\n\t\t\t}\n\t\t},\n\n\t\t_handleEscKey: function() {\n\t\t\tif (this._menuShowing()) {\n\t\t\t\tthis._hide();\n\t\t\t}\n\t\t},\n\n\t\t_selectItem: function() {\n\t\t\tvar $selected_item = $('.' + this.options.selected_class, this._$menu);\n\t\t\tif (this._menuShowing()) {\n\t\t\t\tif ($selected_item.length > 0) {\n\t\t\t\t\tif (this._isProfileItemElement($selected_item)) {\n\t\t\t\t\t\tthis._handleProfileItem($selected_item);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._isRevealHiddenElement($selected_item)) {\n\t\t\t\t\t\tthis._revealHiddenItems($selected_item);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._shouldAppendSpaceToItem($selected_item)) {\n\t\t\t\t\t\t// insert space, move cursor forward one column\n\t\t\t\t\t\tvar query = TS.utility.contenteditable.value(this.element);\n\t\t\t\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\t\t\t\tquery = query.substring(0, caret_pos) + ' ' + query.substring(caret_pos);\n\t\t\t\t\t\tTS.utility.contenteditable.value(this.element, query);\n\t\t\t\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\t\t\t\tthis.element.trigger('change');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tTS.utility.contenteditable.cursorPosition(this.element, caret_pos + 1);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._modifierAutocompleteShowing() || this._isModifierItemElementWithoutKeyword($selected_item)) {\n\t\t\t\t\t\tthis._showKeywordAutocompleteMenu();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (this.options.data.triggerSearch) this.options.data.triggerSearch();\n\t\t\t\t\tthis._hide();\n\t\t\t\t} else {\n\t\t\t\t\t// enter kicks off a search, so hide the menu\n\t\t\t\t\tthis._hide();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_handleBackspaceKey: function(e) {\n\t\t\tvar mod_str_info = this._getCurrentModifyingStrDetails();\n\t\t\tif (mod_str_info) {\n\t\t\t\tvar text = TS.utility.contenteditable.value(this.element);\n\n\t\t\t\t// this is either the modifier (e.g. 'in:') or the keyword (e.g. '#general')\n\t\t\t\tvar slug_to_delete = null;\n\n\t\t\t\tif (mod_str_info.caret_in_keyword && this._keywordIsValid(mod_str_info.keyword.keyword, mod_str_info.modifier.modifier)) {\n\t\t\t\t\tslug_to_delete = mod_str_info.keyword;\n\t\t\t\t} else if (!mod_str_info.caret_in_keyword && this._modifierIsValid(mod_str_info.modifier.modifier)) {\n\t\t\t\t\tslug_to_delete = mod_str_info.modifier;\n\t\t\t\t}\n\n\t\t\t\tif (slug_to_delete) {\n\t\t\t\t\tvar new_val = this._replaceRange(text, slug_to_delete.start, slug_to_delete.start + slug_to_delete.length, '');\n\t\t\t\t\t// remove the whole word\n\t\t\t\t\tTS.utility.contenteditable.value(this.element, new_val);\n\t\t\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\t\t\tthis.element.trigger('change');\n\t\t\t\t\t}\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t// put the cursor where the beginning of the slug used to be\n\t\t\t\t\tthis.element.setCursorPosition(slug_to_delete.start);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_modifierIsValid: function(modifier) {\n\t\t\treturn !!modifier && this.options.data.modifiers_by_name[modifier];\n\t\t},\n\n\t\t_keywordIsValid: function(keyword, modifier) {\n\t\t\tvar modifier_details = this.options.data.modifiers_by_name[modifier];\n\t\t\tif (!modifier_details) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// use the same code that checks if the keyword should be highlighted\n\t\t\tfor (var i = 0; i < modifier_details.keyword_testers.length; i++) {\n\t\t\t\tif (modifier_details.keyword_testers[i](keyword)) return true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_showAutocompleteSuggestions: function(from_focus) {\n\t\t\tvar query = TS.utility.contenteditable.value(this.element);\n\n\t\t\tthis._cancelDelayedSearch();\n\n\t\t\t// re-init the calendar when the input is cleared\n\t\t\tif (!query) this._initCalendar();\n\n\t\t\tif (query && this._hasNonWhiteSpace(query)) {\n\t\t\t\tvar current_word = this._getWordAtCaretPosition();\n\t\t\t\tvar current_word_up_to_caret = this._getCurrentWordUpToCaret();\n\n\t\t\t\tif (current_word_up_to_caret && this._startsWith(current_word_up_to_caret, '+')) {\n\t\t\t\t\tthis._showModifierAutocompleteMenu(current_word_up_to_caret);\n\n\t\t\t\t} else if (current_word_up_to_caret && might_be_modifier_regex.test(current_word)) {\n\t\t\t\t\t// Might end up needing to confirm that it is actually a modifier here\n\t\t\t\t\t// and not just something that looks like it (x:x)\n\n\t\t\t\t\t// Need to determine if caret is on the modifier side or the keyword\n\t\t\t\t\t// side. i.e. \"from:@poo|pers\" or \"fro|m:@poopers\", where \"|\" is caret\n\n\t\t\t\t\tvar mod_str_info = this._getCurrentModifyingStrDetails();\n\t\t\t\t\tvar modifier = mod_str_info.modifier.modifier;\n\n\t\t\t\t\tif (mod_str_info.caret_in_keyword || mod_str_info.caret_is_modifier_adjacent) {\n\t\t\t\t\t\tthis._showKeywordAutocompleteMenu();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._showModifierAutocompleteMenu(modifier);\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tthis._getResultsForQueryObj({\n\t\t\t\t\t\tcurrent_word_up_to_caret: current_word_up_to_caret,\n\t\t\t\t\t\tcurrent_word: current_word,\n\t\t\t\t\t\tquery: query,\n\t\t\t\t\t}).then(function(results) {\n\t\t\t\t\t\tthis._render_data = results;\n\n\t\t\t\t\t\tthis._$popover.addClass('showing_query_header');\n\t\t\t\t\t\tthis._render_data.header = {\n\t\t\t\t\t\t\tquery: query,\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tthis._render_data.show_modifier = true;\n\n\t\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\t\tthis._show();\n\t\t\t\t\t\t}\n\t\t\t\t\t}.bind(this));\n\t\t\t\t}\n\n\t\t\t\t// only decide whether to show/hide if there's no pending search\n\t\t\t\tif (!this._search_pending) {\n\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\tthis._show();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (this._menuShowing() || from_focus) {\n\t\t\t\tthis._$popover.removeClass('showing_query_header');\n\t\t\t\t// The user hasn't typed anything yet, show them the modifier list menu\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmodifier_groups: true,\n\t\t\t\t\theader: true\n\t\t\t\t};\n\n\t\t\t\tthis._syncUI();\n\t\t\t\tthis._show();\n\t\t\t}\n\t\t},\n\n\t\t_showKeywordAutocompleteMenu: function() {\n\t\t\tvar mod_str_info = this._getCurrentModifyingStrDetails();\n\t\t\tvar modifier = this.options.data.modifiers_by_name[mod_str_info.modifier.modifier];\n\n\t\t\tif (!mod_str_info) {\n\t\t\t\tthrow this.widgetName + ': Lawdy how did you get here?';\n\t\t\t}\n\n\t\t\tvar keyword = mod_str_info.keyword.keyword;\n\n\t\t\t// show possible keywords if '+' follows the colon, e.g. 'during:+'\n\t\t\tif (this._startsWith(keyword, '+')) {\n\t\t\t\tthis._showSpecialKeywordsAutocompleteMenu(keyword, mod_str_info);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!modifier) return;\n\n\t\t\t// There's probably a better way? Are more automated way defined by the\n\t\t\t// set of modifiers itself? That way it can plug in to 3rd party things.\n\t\t\t// There should probably we a way to infer what autocomplete menu should\n\t\t\t// be showing based on the information we get from the server about the\n\t\t\t// modifiers.\n\t\t\tswitch (modifier.modifier) {\n\t\t\t\tcase 'from:':\n\t\t\t\t\tthis._showUserAutocompleteMenu(keyword);\n\t\t\t\t\tbreak;\n\n\t\t\t\t// case 'group:':\n\t\t\t\t// \tthis._showGroupAutocompleteMenu(keyword);\n\t\t\t\t// \tbreak;\n\n\t\t\t\t// case 'channel:':\n\t\t\t\t// \tthis._showChannelAutocompleteMenu(keyword);\n\t\t\t\t// \tbreak;\n\n\t\t\t\tcase 'to:':\n\t\t\t\t\tthis._showConversationAutocompleteMenu(keyword, TS.i18n.t('to:', 'search_menu')());\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'in:':\n\t\t\t\t\tthis._showConversationAutocompleteMenu(keyword, TS.i18n.t('in:', 'search_menu')());\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'during:':\n\t\t\t\tcase 'on:':\n\t\t\t\t\tthis._showDateAutocompleteMenu(keyword, mod_str_info.modifier.modifier);\n\t\t\t\t\tthis._setCalendarModifier(mod_str_info.modifier.modifier);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'after:':\n\t\t\t\tcase 'before:':\n\t\t\t\t\tthis._showDateAutocompleteMenu(keyword, mod_str_info.modifier.modifier);\n\t\t\t\t\tthis._setCalendarModifier(mod_str_info.modifier.modifier);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'has:':\n\t\t\t\t\tthis._showHasAutocompleteMenu(keyword);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t// show the default, no results footer/display\n\t\t\t\t\tthis._render_data = {\n\t\t\t\t\t\tfooter: true\n\t\t\t\t\t};\n\t\t\t\t\tthis._syncUI();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t},\n\n\t\t_showSpecialKeywordsAutocompleteMenu: function(query, mod_str_info) {\n\t\t\tvar modifier = this.options.data.modifiers_by_name[mod_str_info.modifier.modifier];\n\t\t\tvar rest_of_query = query.substring(1);\n\t\t\tvar exact_match;\n\t\t\tvar keywords = modifier.keywords.filter(function(keyword) {\n\t\t\t\tif (keyword === rest_of_query) exact_match = keyword;\n\t\t\t\treturn query === '+' || this._startsWith(keyword, rest_of_query);\n\t\t\t}, this);\n\n\t\t\t// for an exact match, remove the plus and start over\n\t\t\tif (exact_match) {\n\t\t\t\tthis._replaceCurrentWord(mod_str_info.modifier.modifier + exact_match);\n\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// list possible keywords\n\t\t\tthis._render_data = {};\n\t\t\tthis._render_data.modifiers = keywords.map(function(keyword) {\n\t\t\t\treturn $.extend({}, modifier, {\n\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t});\n\t\t\t});\n\t\t\treturn;\n\t\t},\n\n\t\t_showConversationAutocompleteMenu: function(query, modifier) {\n\t\t\tif (!query) {\n\t\t\t\t// Same as channel pane\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.conversation,\n\t\t\t\t\tconversation_modifier: modifier,\n\t\t\t\t\tspecial: this.options.data.conversationsStarred(),\n\t\t\t\t\tspecial_section_header: TS.i18n.t('Starred', 'search_menu')(),\n\t\t\t\t\tchannels: this.options.data.channelsOpen(),\n\t\t\t\t\tdms: this.options.data.usersOpen(),\n\t\t\t\t\tgroups: this.options.data.groupsOpen(),\n\t\t\t\t};\n\t\t\t\tthis._syncUI();\n\t\t\t} else {\n\t\t\t\tvar exclude_self = false;\n\t\t\t\tvar promises = [];\n\t\t\t\tvar _render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.conversation,\n\t\t\t\t\tconversation_modifier: modifier,\n\t\t\t\t};\n\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null, exclude_self).then(function(results) {\n\t\t\t\t\t_render_data.dms = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null, exclude_self, true).then(function(results) {\n\t\t\t\t\t_render_data.dms_deleted = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getChannelsForQuery(query, null).then(function(results) {\n\t\t\t\t\t_render_data.channels = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getChannelsForQuery(query, null, true).then(function(results) {\n\t\t\t\t\t_render_data.channels_archived = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getGroupsForQuery(query, null).then(function(results) {\n\t\t\t\t\t_render_data.groups = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getGroupsForQuery(query, null, true).then(function(results) {\n\t\t\t\t\t_render_data.groups_archived = results;\n\t\t\t\t}));\n\n\t\t\t\tvar search_p = Promise.all(promises);\n\t\t\t\tsearch_p.then(function() {\n\t\t\t\t\tif (_render_data.dms.length === 0 && _render_data.dms_deleted.length > 0) {\n\t\t\t\t\t\t_render_data.dms = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_render_data.channels.length === 0 && _render_data.channels_archived.length > 0) {\n\t\t\t\t\t\t_render_data.channels = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_render_data.groups.length === 0 && _render_data.groups_archived.length > 0) {\n\t\t\t\t\t\t_render_data.groups = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._render_data = _render_data;\n\t\t\t\t\tthis._search_pending = false;\n\n\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\tthis._show();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\n\t\t\t\tthis._search_promises.push(search_p);\n\t\t\t\tthis._search_pending = true;\n\t\t\t}\n\t\t},\n\n\t\t_showDateAutocompleteMenu: function(query, modifier_str) {\n\t\t\t// for empty queries and queries that start with a number, show the calendar\n\t\t\t// for everything else, suggest matching keywords\n\n\t\t\tvar not_number = query.length > 0 && /^\\D/.test(query);\n\t\t\tvar modifier = this.options.data.modifiers_by_name[modifier_str];\n\t\t\tvar keywords;\n\n\t\t\tif (not_number) {\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tshow_calendar: false\n\t\t\t\t};\n\t\t\t\tkeywords = modifier.keywords.filter(function(keyword) {\n\t\t\t\t\treturn this._startsWith(keyword, query);\n\t\t\t\t}, this);\n\t\t\t\tthis._render_data.modifiers = keywords.map(function(keyword) {\n\t\t\t\t\treturn $.extend({}, modifier, {\n\t\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.date,\n\t\t\t\t\tshow_calendar: true,\n\t\t\t\t\tfooter: {\n\t\t\t\t\t\tcalendar_tip: true\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t_showChannelAutocompleteMenu: function(query) {\n\t\t\t// NOTE: Deprecated\n\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.channel,\n\t\t\t\tconversation_modifier: DEFAULT_CONVERSATION_MODIFIER,\n\t\t\t\tchannels: _getChannelsForQuery(query, CHANNEL_RESULT_LIMIT)\n\t\t\t};\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t_showGroupAutocompleteMenu: function(query) {\n\t\t\t// NOTE: Deprecated\n\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.group,\n\t\t\t\tconversation_modifier: DEFAULT_CONVERSATION_MODIFIER,\n\t\t\t\tgroups: _getGroupsForQuery(query, GROUP_RESULT_LIMIT)\n\t\t\t};\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t_showUserAutocompleteMenu: function(query) {\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.user\n\t\t\t};\n\n\t\t\tif (!query || (query.length === 1 && query.charAt(0) === '@')) {\n\t\t\t\t// show open and starred DMs\n\t\t\t\tthis._render_data.conversation_modifier = TS.i18n.t('from:', 'search_menu')();\n\t\t\t\tthis._render_data.special = this.options.data.usersStarred().concat(this.options.data.usersOpen());\n\t\t\t\tthis._render_data.special_section_header = TS.i18n.t('Starred and recent', 'search_menu')();\n\t\t\t\t// adds from:me to the list of suggestions\n\t\t\t\tvar modifier = this.options.data.modifiers_by_name['from:'];\n\t\t\t\tthis._render_data.modifiers = modifier.keywords.map(function(keyword) {\n\t\t\t\t\treturn $.extend({}, modifier, {\n\t\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tthis._syncUI();\n\t\t\t} else {\n\t\t\t\tvar promises = [];\n\t\t\t\tvar _render_data = {\n\t\t\t\t\tmenu_type: MENU_TYPES.user,\n\t\t\t\t};\n\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null).then(function(results) {\n\t\t\t\t\t_render_data.users = results;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getUsersForQuery(query, null, false, true).then(function(results) {\n\t\t\t\t\t_render_data.users_deleted = results;\n\t\t\t\t}));\n\n\t\t\t\tvar search_p = Promise.all(promises);\n\t\t\t\tsearch_p.then(function() {\n\t\t\t\t\tif (_render_data.users.length === 0 && _render_data.users_deleted.length > 0) {\n\t\t\t\t\t\t_render_data.users = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._render_data = _render_data;\n\t\t\t\t\tthis._search_pending = false;\n\n\t\t\t\t\tif (this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\t\t\tthis._hide();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._syncUI();\n\t\t\t\t\t\tthis._show();\n\t\t\t\t\t}\n\t\t\t\t}.bind(this));\n\n\t\t\t\tthis._search_promises.push(search_p);\n\t\t\t\tthis._search_pending = true;\n\t\t\t}\n\t\t},\n\n\t\t_showHasAutocompleteMenu: function(query) {\n\t\t\tthis._render_data = {\n\t\t\t\tmenu_type: MENU_TYPES.has,\n\t\t\t\thas: []\n\t\t\t};\n\t\t\tthis.options.data.modifiers_by_name['has:'].keywords.forEach($.proxy(function(keyword) {\n\t\t\t\tif (query === '' || this._startsWith(keyword, query)) {\n\t\t\t\t\tthis._render_data.has.push({\n\t\t\t\t\t\tname: keyword\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, this));\n\t\t\tthis._syncUI();\n\t\t},\n\n\n\t\t_showModifierAutocompleteMenu: function(query) {\n\t\t\tvar by_name = this.options.data.modifiers_by_name;\n\t\t\tif (query && this._startsWith(query, '+')) {\n\t\t\t\tquery = query.substring(1);\n\t\t\t\tif (by_name[query]) {\n\t\t\t\t\t// starts with + and is an exact match, e.g. +has:\n\t\t\t\t\t// remove the plus and start over\n\t\t\t\t\tthis._replaceCurrentWord(query);\n\t\t\t\t\tthis._showAutocompleteSuggestions();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!query) {\n\t\t\t\t// the full list is hard-coded in the template to preserve my sanity.\n\n\t\t\t\tthis._$popover.removeClass('showing_query_header');\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmodifier_groups: true,\n\t\t\t\t\theader: true\n\t\t\t\t};\n\n\t\t\t} else {\n\t\t\t\tthis._render_data = {\n\t\t\t\t\tmodifiers: this._getModifiersForQuery(query, true),\n\t\t\t\t\tmenu_type: MENU_TYPES.modifier\n\t\t\t\t};\n\t\t\t}\n\t\t\tthis._syncUI();\n\t\t},\n\n\t\t// Fetch all the information you need about the current modifier-keyword pair\n\t\t// and the caret's position inside it.\n\t\t_getCurrentModifyingStrDetails: function() {\n\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\tvar modifying_str_range = this._getWordRangeAtCaretPosition(caret_pos);\n\n\t\t\tif (!modifying_str_range || modifying_str_range.length === 0) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tvar modifying_str = this._getWordAtCaretPosition(); // i.e. x:x\n\t\t\tvar word_colon_index = modifying_str.indexOf(':'); // index of colon in current x:x\n\t\t\tvar query_colon_index = TS.utility.contenteditable.value(this.element).indexOf(':', modifying_str_range.start); // index of same colon in the whole query\n\t\t\tvar modifier_str = modifying_str.slice(0, word_colon_index + 1);\n\n\t\t\treturn {\n\t\t\t\tmodifier: {\n\t\t\t\t\tstart: modifying_str_range.start,\n\t\t\t\t\tlength: word_colon_index + 1,\n\t\t\t\t\tmodifier: modifier_str\n\t\t\t\t},\n\t\t\t\tkeyword: {\n\t\t\t\t\tstart: modifying_str_range.start + word_colon_index + 1,\n\t\t\t\t\tlength: modifying_str.length - modifier_str.length,\n\t\t\t\t\tkeyword: modifying_str.slice(word_colon_index + 1)\n\t\t\t\t},\n\t\t\t\tcaret_in_keyword: caret_pos > query_colon_index + 1,\n\t\t\t\tcaret_is_modifier_adjacent: caret_pos === query_colon_index + 1\n\t\t\t};\n\t\t},\n\n\t\t_highlightModifierAndKeywordInSearchField: function() {\n\t\t\tvar $highlighted_item = TS.kb_nav.getHighlightedItem();\n\n\t\t\tif (!$highlighted_item || !$highlighted_item.length) return;\n\n\t\t\tvar replacement = $highlighted_item.attr(REPLACEMENT_ATTR);\n\n\t\t\tif (replacement) {\n\t\t\t\tthis._prevent_next_input_event = true;\n\t\t\t\tthis._replaceCurrentWord(replacement);\n\t\t\t}\n\t\t},\n\n\t\t// open member preview in the flexpane\n\t\t_handleProfileItem: function($item) {\n\t\t\tvar id = $item.data('member-id');\n\t\t\tvar bot_id = $item.data('bot-id');\n\t\t\tTS.search.autocomplete.clearInput();\n\n\t\t\tif(bot_id) {\n\t\t\t\tthis.options.data.openBotProfile(bot_id);\n\t\t\t} else {\n\t\t\t\tthis.options.data.openProfile(id);\n\t\t\t}\n\t\t\tthis._hide();\n\t\t},\n\n\t\t_revealHiddenItems: function($item) {\n\t\t\tvar $to_reveal = $item.nextAll('.'+this.options.hidden_class);\n\t\t\t$item.addClass(this.options.hidden_class);\n\t\t\t$to_reveal.removeClass(this.options.hidden_class);\n\t\t},\n\n\t\t_deduplicateModifiers: function(modifiers) {\n\t\t\tvar deduped_modifiers = [];\n\t\t\tvar unique_modifier_names = [];\n\t\t\tmodifiers.forEach(function(modifier_details) {\n\t\t\t\tif (unique_modifier_names.indexOf(modifier_details.modifier) === -1) {\n\t\t\t\t\tdeduped_modifiers.push(modifier_details);\n\t\t\t\t\tunique_modifier_names.push(modifier_details.modifier);\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn deduped_modifiers;\n\t\t},\n\n\t\t_getUsersForQuery: function(query, limit, exclude_self, just_deleted) {\n\t\t\tif (TS.boot_data.feature_more_texty_search) {\n\t\t\t\t// We'll rely on TabComplete's members under Texty search\n\t\t\t\treturn Promise.resolve([]);\n\t\t\t}\n\n\t\t\treturn TS.searcher.search(query, {\n\t\t\t\tmembers: {\n\t\t\t\t\tinclude_slackbot: true,\n\t\t\t\t\tinclude_self: !exclude_self,\n\t\t\t\t\tinclude_deleted: true,\n\t\t\t\t},\n\t\t\t\tlimit: limit,\n\t\t\t\tsort: { allow_empty_query: true },\n\t\t\t}).then(function(results) {\n\t\t\t\tvar models = _.map(results, 'model_ob');\n\t\t\t\tif (just_deleted) {\n\t\t\t\t\tmodels = _.filter(models, 'deleted');\n\t\t\t\t} else {\n\t\t\t\t\tmodels = _.filter(models, function(m) {\n\t\t\t\t\t\treturn !m.deleted;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn models;\n\t\t\t});\n\t\t},\n\n\t\t_getModifiersForQuery: function(query, exclude_keywords) {\n\t\t\tvar results = [];\n\t\t\t// find matching modifiers first because they should be at the top of the list\n\n\t\t\tthis.options.data.modifiers.forEach(function(modifier) {\n\t\t\t\t// matching modifiers\n\t\t\t\tif (this._startsWith(modifier.modifier, query) || this._startsWith(modifier.name, query)) {\n\t\t\t\t\tresults.push($.extend({}, modifier));\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tthis.options.data.modifiers.forEach(function(modifier) {\n\t\t\t\t// *and* modifier keywords!\n\t\t\t\tif (!exclude_keywords) {\n\t\t\t\t\tmodifier.keywords.forEach(function(keyword) {\n\t\t\t\t\t\tif (this._startsWith(keyword, query)) {\n\t\t\t\t\t\t\tresults.push($.extend({}, modifier, {\n\t\t\t\t\t\t\t\tmatching_keyword: keyword\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\n\t\t\t\t\tif (modifier.dynamic_keywords && modifier.dynamic_keywords.length > 0) {\n\t\t\t\t\t\tmodifier.dynamic_keywords.forEach(function(dynamic_keyword) {\n\t\t\t\t\t\t\tif (dynamic_keyword(query)) {\n\t\t\t\t\t\t\t\tresults.push($.extend({}, modifier, {\n\t\t\t\t\t\t\t\t\tmatching_keyword: query\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tresults = this._deduplicateModifiers(results);\n\t\t\treturn results;\n\t\t},\n\n\t\t_getChannelsForQuery: function(query, limit, just_archived) {\n\t\t\treturn TS.searcher.search(query, {\n\t\t\t\tchannels: {\n\t\t\t\t\tinclude_archived: true,\n\t\t\t\t},\n\t\t\t\tlimit: limit,\n\t\t\t\tsort: { allow_empty_query: true },\n\t\t\t}).then(function(results) {\n\t\t\t\tvar models = _.map(results, function(result) {\n\t\t\t\t\tvar model_ob = result.model_ob;\n\t\t\t\t\tmodel_ob._score = result.score;\n\t\t\t\t\treturn model_ob;\n\t\t\t\t});\n\t\t\t\tif (just_archived) {\n\t\t\t\t\tmodels = _.filter(models, 'is_archived');\n\t\t\t\t} else {\n\t\t\t\t\tmodels = _.filter(models, function(m) {\n\t\t\t\t\t\treturn !m.is_archived;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn models;\n\t\t\t});\n\t\t},\n\n\t\t_getGroupsForQuery: function(query, limit, just_archived) {\n\t\t\treturn TS.searcher.search(query, {\n\t\t\t\tgroups: true,\n\t\t\t\tlimit: limit,\n\t\t\t\tsort: { allow_empty_query: true },\n\t\t\t}).then(function(results) {\n\t\t\t\tvar models = _.map(results, function(result) {\n\t\t\t\t\tvar model_ob = result.model_ob;\n\t\t\t\t\tmodel_ob._score = result.score;\n\t\t\t\t\treturn model_ob;\n\t\t\t\t});\n\t\t\t\tif (just_archived) {\n\t\t\t\t\tmodels = _.filter(models, 'is_archived');\n\t\t\t\t} else {\n\t\t\t\t\tmodels = _.filter(models, function(m) {\n\t\t\t\t\t\treturn !m.is_archived;\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn models;\n\t\t\t});\n\t\t},\n\n\t\t_getHistoryForQuery: function(query) {\n\t\t\t// same query, same result:\n\t\t\tif (query === this._current_history_query) return this._current_history_items;\n\n\t\t\t// new query, clear out current history data:\n\t\t\tthis._current_history_query = query;\n\t\t\tthis._current_history_items = [];\n\n\t\t\t// make api request\n\t\t\t// when it returns the ui will update\n\t\t\tthis.options.data.history(query, $.proxy(this._historyFetched, this));\n\n\t\t\treturn this._current_history_items;\n\t\t},\n\n\t\t_getResultsForQueryObj: function(query_obj) {\n\t\t\tvar results = {\n\t\t\t\tconversation_modifier: DEFAULT_CONVERSATION_MODIFIER,\n\t\t\t\tquery: query,\n\t\t\t};\n\n\t\t\tvar is_at = false;\n\t\t\tvar is_hash = false;\n\n\t\t\tif (!query_obj) {\n\t\t\t\treturn results;\n\t\t\t}\n\n\n\t\t\tvar promises = [];\n\n\t\t\tif (query_obj.current_word_up_to_caret) {\n\t\t\t\tvar query = query_obj.current_word_up_to_caret.toLowerCase();\n\t\t\t\tis_hash = query === '#';\n\t\t\t\tis_at = query === '@';\n\n\t\t\t\tresults.modifiers = this._getModifiersForQuery(query);\n\n\t\t\t\tpromises.push(this._getUsersForQuery(query, is_at ? null : USER_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.users = r;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getChannelsForQuery(query, is_hash ? null : CHANNEL_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.channels = r;\n\t\t\t\t}));\n\t\t\t\tpromises.push(this._getGroupsForQuery(query, GROUP_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.groups = r;\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tif (!is_at) {\n\t\t\t\tpromises.push(this._getUsersForQuery(query_obj.query, PROFILE_RESULT_LIMIT).then(function(r) {\n\t\t\t\t\tresults.profiles = r;\n\t\t\t\t\tTS.presence_manager.queryMemberPresence(_.map(r, 'id'));\n\t\t\t\t\treturn null;\n\t\t\t\t}));\n\t\t\t}\n\t\t\tif (!is_at && !is_hash) results.history = this._getHistoryForQuery(query_obj.query);\n\n\t\t\tvar models_p = Promise.all(promises).then(function() {\n\t\t\t\tthis._search_pending = false;\n\t\t\t\treturn results;\n\t\t\t}.bind(this));\n\n\t\t\tthis._search_promises.push(models_p);\n\t\t\tthis._search_pending = true;\n\n\t\t\treturn models_p;\n\t\t},\n\n\t\t_getCurrentWordUpToCaret: function() {\n\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\tvar text = TS.utility.contenteditable.value(this.element);\n\t\t\tvar pre_caret_text = text.substring(0, caret_pos);\n\t\t\tvar wurds = pre_caret_text.split(' ');\n\t\t\tvar current_word = wurds[wurds.length - 1];\n\n\t\t\tif (current_word) {\n\t\t\t\treturn current_word;\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\t_getCaretPosition: function() {\n\t\t\treturn this._caret_position;\n\t\t},\n\n\t\t_getRealCaretPosition: function() {\n\t\t\t// we can swap this with whatever method we use to get cursor position index,\n\t\t\t// provided that for the string \"0123|45\" it would return 4, if \"|\" is the caret\n\t\t\treturn TS.utility.contenteditable.cursorPosition(this.element).start;\n\t\t},\n\n\t\t_saveCaretPosition: function() {\n\t\t\t// save the last known value because clicking on menu items causes the element to lose focus\n\t\t\tthis._caret_position = this._getRealCaretPosition();\n\t\t},\n\n\t\t_replaceCurrentWord: function(word) {\n\t\t\tif (!word) {\n\t\t\t\tthrow this.widgetName + ': A replacement word must be provided.';\n\t\t\t}\n\n\t\t\tvar word_range = this._getWordRangeAtCaretPosition();\n\t\t\tvar text = TS.utility.contenteditable.value(this.element);\n\n\t\t\tif (Array.isArray(word)) {\n\t\t\t\tif (!word.length) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tTS.utility.contenteditable.cursorPosition(this.element, word_range.start, word_range.length);\n\t\t\t\tTS.utility.contenteditable.insertContentsAtCursor(this.element, { contents: word });\n\t\t\t} else {\n\t\t\t\tvar new_text = this._replaceRange(text, word_range.start, word_range.start + word_range.length, word);\n\n\t\t\t\tTS.utility.contenteditable.value(this.element, new_text);\n\t\t\t\tTS.utility.contenteditable.cursorPosition(this.element, word_range.start + word.length);\n\t\t\t}\n\n\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\tthis.element\n\t\t\t\t\t.trigger('change')\n\t\t\t\t\t// scroll all the way to the right (good enough for now)\n\t\t\t\t\t.scrollLeft(10000);\n\t\t\t}\n\n\t\t\tthis._saveCaretPosition();\n\t\t},\n\n\t\t_replaceEntireInput: function(str) {\n\t\t\tTS.utility.contenteditable.value(this.element, str);\n\t\t\tTS.utility.contenteditable.cursorPosition(this.element, str.length);\n\n\t\t\tif (!TS.boot_data.feature_texty_search) {\n\t\t\t\tthis.element\n\t\t\t\t\t.trigger('change')\n\t\t\t\t\t// scroll all the way to the right\n\t\t\t\t\t.scrollLeft(10000);\n\t\t\t}\n\n\t\t\tthis._saveCaretPosition();\n\t\t},\n\n\t\t_startsWith: function(str, prefix) {\n\t\t\tif (!str ||\n\t\t\t\t!prefix ||\n\t\t\t\tstr.length < prefix.length\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t//return str.slice(0, prefix.length) === prefix; // faster with long strings\n\t\t\treturn str.indexOf(prefix) === 0; // faster with shorter strings\n\t\t},\n\n\t\t_getWordAtCaretPosition: function(caret_pos) {\n\t\t\tif (typeof caret_pos === 'undefined') {\n\t\t\t\tcaret_pos = this._getCaretPosition();\n\t\t\t}\n\n\t\t\tvar range = this._getWordRangeAtCaretPosition(caret_pos);\n\t\t\tvar word = TS.utility.contenteditable.value(this.element).slice(range.start, range.start + range.length);\n\t\t\treturn word || null;\n\t\t},\n\n\t\t// Get the start and length of the word the caret is in or immediately adjacent to\n\t\t_getWordRangeAtCaretPosition: function(caret_pos) {\n\t\t\tif (typeof caret_pos === 'undefined') {\n\t\t\t\tcaret_pos = this._getCaretPosition();\n\t\t\t}\n\n\t\t\tvar preceeding_char_index = caret_pos - 1;\n\t\t\tvar words = TS.utility.contenteditable.value(this.element).split(' ');\n\n\t\t\tvar range = {\n\t\t\t\tstart: 0,\n\t\t\t\tlength: words[0].length || 0\n\t\t\t};\n\n\t\t\tvar caret_pos_in_word_range = words.some(function(word, index) {\n\t\t\t\tif (preceeding_char_index >= range.start && preceeding_char_index < range.start + range.length) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (preceeding_char_index === range.start - 1) {\n\t\t\t\t\trange.start = caret_pos;\n\t\t\t\t\trange.length = 0;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (index + 1 < words.length) {\n\t\t\t\t\trange.start = range.start + word.length + 1;\n\t\t\t\t\trange.length = words[index + 1].length;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t\tif (caret_pos_in_word_range) {\n\t\t\t\treturn range;\n\t\t\t}\n\t\t\trange.start = caret_pos;\n\t\t\trange.length = 0;\n\t\t\treturn range;\n\t\t},\n\n\t\t// takes a string of text and replaces the text between two indices\n\t\t_replaceRange: function(str, start, end, what) {\n\t\t\tvar prefix = str.substring(0, start);\n\t\t\tvar suffix = str.substring(end);\n\n\t\t\tvar new_str;\n\n\t\t\tif (suffix === str) {\n\t\t\t\tnew_str = what;\n\t\t\t} else {\n\t\t\t\tnew_str = prefix + what + suffix;\n\t\t\t}\n\t\t\treturn new_str;\n\t\t},\n\n\t\t_menuShowing: function() {\n\t\t\treturn this._$menu.is(':visible');\n\t\t},\n\n\t\t_hasNonWhiteSpace: function(str) {\n\t\t\treturn str && /\\S/.test(str);\n\t\t},\n\n\t\t_modifierAutocompleteShowing: function() {\n\t\t\treturn this._render_data.menu_type === MENU_TYPES.modifier;\n\t\t},\n\n\t\t// this function is called after we've collected some results for the autocomplete and we want to determine\n\t\t// if we'll show it.\n\t\t_resultSetIsEmpty: function(results) {\n\t\t\tif (results.show_calendar) return false;\n\t\t\tif (results.modifier_groups) return false;\n\n\t\t\t// all this is to handle the case where this only one item but the\n\t\t\t// input already contains it\n\n\t\t\tvar replacements = null;\n\n\t\t\tif (results.modifiers) {\n\t\t\t\tif (results.modifiers.length > 1) return false;\n\t\t\t\tif (results.modifiers.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.modifiers[0].modifier + results.modifiers[0].matching_keyword];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.has) {\n\t\t\t\tif (results.has.length > 1) return false;\n\t\t\t\tif (results.has.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = ['has:' + results.has[0].name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.users) {\n\t\t\t\tif (results.users.length > 1) return false;\n\t\t\t\tif (results.users.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\t'from:' + results.users[0].name,\n\t\t\t\t\t\t'from:@' + results.users[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.users_deleted) {\n\t\t\t\tif (results.users_deleted.length > 1) return false;\n\t\t\t\tif (results.users_deleted.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\t'from:' + results.users_deleted[0].name,\n\t\t\t\t\t\t'from:@' + results.users_deleted[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.dms) {\n\t\t\t\tif (results.dms.length > 1) return false;\n\t\t\t\tif (results.dms.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.dms[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '@' + results.dms[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.dms_deleted) {\n\t\t\t\tif (results.dms_deleted.length > 1) return false;\n\t\t\t\tif (results.dms_deleted.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.dms_deleted[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '@' + results.dms_deleted[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.channels) {\n\t\t\t\tif (results.channels.length > 1) return false;\n\t\t\t\tif (results.channels.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.channels[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '#' + results.channels[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.channels_archived) {\n\t\t\t\tif (results.channels_archived.length > 1) return false;\n\t\t\t\tif (results.channels_archived.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [\n\t\t\t\t\t\tresults.conversation_modifier + results.channels_archived[0].name,\n\t\t\t\t\t\tresults.conversation_modifier + '#' + results.channels_archived[0].name\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.groups) {\n\t\t\t\tif (results.groups.length > 1) return false;\n\t\t\t\tif (results.groups.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.conversation_modifier + results.groups[0].name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.groups_archived) {\n\t\t\t\tif (results.groups_archived.length > 1) return false;\n\t\t\t\tif (results.groups_archived.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.conversation_modifier + results.groups_archived[0].name];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (results.history) {\n\t\t\t\tif (results.history.length > 1) return false;\n\t\t\t\tif (results.history.length === 1) {\n\t\t\t\t\tif (replacements) return false;\n\t\t\t\t\treplacements = [results.history[0].text];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (replacements) {\n\t\t\t\tvar current_word = this._getWordAtCaretPosition();\n\t\t\t\tvar any = replacements.some(function(r) {\n\t\t\t\t\treturn r === current_word;\n\t\t\t\t});\n\t\t\t\treturn any;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\t_isHistoryItemElement: function(element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\t// Cuz in the HTML the modifiers ol has this class\n\t\t\treturn element && $(element).closest(ITEM_GROUP_WRAPPER_SEL).hasClass(HISTORY_LIST_CLASS);\n\t\t},\n\n\t\t_isModifierItemElement: function(element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\t// Cuz in the HTML the modifiers ol has this class\n\t\t\treturn element && $(element).closest(ITEM_GROUP_WRAPPER_SEL).hasClass(MODIFIERS_LIST_CLASS);\n\t\t},\n\n\t\t_isProfileItemElement: function($element) {\n\t\t\tif (!$element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\treturn $element.closest(ITEM_GROUP_WRAPPER_SEL).hasClass(PROFILE_LIST_CLASS);\n\t\t},\n\n\t\t_isRevealHiddenElement: function($element) {\n\t\t\treturn $element.hasClass('reveal_hidden_items');\n\t\t},\n\n\t\t_modifierItemElementHasKeyword: function (element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\t\t\treturn !!$(element).attr(MATCHING_KEYWORD_ATTR);\n\t\t},\n\n\t\t_isModifierItemElementWithoutKeyword: function (element) {\n\t\t\treturn this._isModifierItemElement(element) && !this._modifierItemElementHasKeyword(element);\n\t\t},\n\n\t\t_shouldAppendSpaceToItem: function (element) {\n\t\t\tif (!element) {\n\t\t\t\tthrow this.widgetName + ': You must pass an AC result list item element to test.';\n\t\t\t}\n\n\t\t\tif (this._modifierAutocompleteShowing()) return false;\n\t\t\tif (this._isModifierItemElement(element)) return this._modifierItemElementHasKeyword(element);\n\t\t\tif (this._isHistoryItemElement(element)) return false;\n\n\t\t\treturn true;\n\t\t},\n\n\t\t// callback for search.autocomplete api calls\n\t\t_historyFetched: function(query, suggestions) {\n\t\t\tif (this._block_menu) return;\n\t\t\t// a newer request has been submitted:\n\t\t\tif (query !== this._current_history_query) return;\n\t\t\t// input has changed:\n\t\t\tif (query !== TS.utility.contenteditable.value(this.element)) return;\n\t\t\t// user has started selecting things, don't change the dom:\n\t\t\tif (this._menu_index) return;\n\t\t\t// if only one suggestion and it's an exact match, don't suggest it\n\t\t\tif (suggestions.length === 1 && suggestions[0] === query) return;\n\n\t\t\tvar highlighter_plugin = this.element.data('TS-highlighter');\n\t\t\tthis._current_history_items = suggestions.map(function(history_str) {\n\t\t\t\treturn {\n\t\t\t\t\ttext: history_str,\n\t\t\t\t\thtml: new Handlebars.SafeString(highlighter_plugin ? highlighter_plugin.highlightStr(history_str, true) : history_str)\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tthis._render_data.history = this._current_history_items;\n\n\t\t\tif (!this._resultSetIsEmpty(this._render_data)) {\n\t\t\t\tthis._render_data.noResults = false;\n\t\t\t\tthis._syncUI();\n\t\t\t\tthis._show();\n\t\t\t}\n\n\t\t},\n\n\t\t_cancelCurrentHistoryQuery: function() {\n\t\t\t// this will cause the response to be ignored\n\t\t\tthis._current_history_query = null;\n\t\t},\n\n\t\t// if text is selected in the input, hide the autocomplete menu\n\t\t// returns true if it was hidden\n\t\t_hideMenuIfTextSelected: function() {\n\t\t\tvar range = TS.utility.contenteditable.cursorPosition(this.element);\n\n\t\t\tif (range.start !== range.end) {\n\t\t\t\tthis._hide();\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t},\n\n\t\t_cancelDelayedSearch: function() {\n\t\t\t_.each(this._search_promises, function(promise) {\n\t\t\t\tpromise.cancel();\n\t\t\t});\n\t\t\tthis._search_promises = [];\n\t\t\tthis._search_pending = false;\n\n\t\t\tthis.options.data.cancelSearch();\n\t\t},\n\n\t\t_updateGhostText: function() {\n\t\t\tvar val = TS.utility.contenteditable.value(this.element);\n\t\t\tvar last_char = val.charAt(val.length-1);\n\t\t\tvar caret_pos = this._getCaretPosition();\n\t\t\tvar highlighter_plugin = this.element.data('TS-highlighter');\n\t\t\tvar current_word = this._getCurrentWordUpToCaret();\n\t\t\tvar modifier = this.options.data.modifiers_by_name[current_word];\n\n\t\t\tif (!highlighter_plugin) return this._clearGhostText();\n\n\t\t\t// caret must be at the end of the input\n\t\t\tif (caret_pos !== val.length) return this._clearGhostText();\n\n\t\t\t// if it matches a modifer, show the modifier's descriptive text\n\t\t\tif (modifier) {\n\t\t\t\t// special case for `in:` & `to:` since their descriptive text is too long\n\t\t\t\tvar keyword_placeholder = modifier.keyword_placeholder;\n\t\t\t\tif ((modifier.modifier === 'in:' || modifier.modifier === 'to:') && $(window).width() < 1368) keyword_placeholder = 'channel or DM';\n\t\t\t\thighlighter_plugin.setGhostText(keyword_placeholder, last_char);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// otherwise try to match it with the first autocomplete suggestion\n\n\t\t\tif (this._$menu_items.length === 0) return this._clearGhostText();\n\n\t\t\tvar first = this._$menu_items[0];\n\t\t\tvar replacement = $(first).data('replacement');\n\n\t\t\tif (!current_word || !replacement) return this._clearGhostText();\n\t\t\tif (current_word === replacement) return this._clearGhostText();\n\n\t\t\t// special case for '+'\n\t\t\tif (val === '+') {\n\t\t\t\thighlighter_plugin.setGhostText(replacement);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar current_word_suffix = _getSuffix(replacement, current_word);\n\t\t\tif (current_word_suffix) {\n\t\t\t\thighlighter_plugin.setGhostText(current_word_suffix, last_char);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// history items start from the beginning\n\t\t\tvar entire_input_suffix =_getSuffix(replacement, val);\n\t\t\tif (entire_input_suffix) {\n\t\t\t\thighlighter_plugin.setGhostText(entire_input_suffix, last_char);\n\t\t\t\treturn;\n\t\t\t}\n\t\t},\n\n\t\t_clearGhostText: function() {\n\t\t\tvar highlighter_plugin = this.element.data('TS-highlighter');\n\t\t\tif (!highlighter_plugin) return;\n\n\t\t\thighlighter_plugin.setGhostText('');\n\t\t}\n\t});\n\n// private\nvar _key_codes = {\n\tbackspace: 8,\n\ttab: 9,\n\tenter: 13,\n\tshift: 16,\n\tescape: 27,\n\tup: 38,\n\tright: 39,\n\tdown: 40\n}\n\nvar _regexpEscape = function(text) {\n\ttext = text || '';\n\tif (text.length > 50) {\n\t\ttext = text.substring(0, 50);\n\t}\n\treturn text.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\");\n}\n\n// returns the part of str after prefix, ignoring @ and #\nvar _getSuffix = function(str, prefix) {\n\tprefix = _regexpEscape(prefix);\n\t// ignoring # and @...\n\tvar fuzzy_prefix = prefix.replace(/:/g, ':(@|#)?');\n\tvar starts_with = new RegExp('^'+fuzzy_prefix+'(.+)', 'i');\n\tvar match = starts_with.exec(str);\n\tif (match && match.length > 0) return match[match.length-1];\n\treturn false;\n}\n\n}(jQuery));\n"},142:function(e,t){e.exports="/*\ncolpick Color Picker\nCopyright 2013 Jose Vargas. Licensed under GPL license. Based on Stefan Petre's Color Picker www.eyecon.ro, dual licensed under the MIT and GPL licenses\n\nFor usage and examples: colpick.com/plugin\n */\n\n(function ($) {\n\tvar colpick = function () {\n\t\tvar tpl = '<div class=\"colpick\"><div class=\"colpick_color\"><div class=\"colpick_color_overlay1\"><div class=\"colpick_color_overlay2\"><div class=\"colpick_selector_outer\"></div></div></div></div><div class=\"colpick_hue\"><div class=\"colpick_hue_arrs\"><div class=\"colpick_hue_larr\"></div><div class=\"colpick_hue_rarr\"></div></div></div><div class=\"colpick_controls\"><div class=\"colpick_color_state\"><div class=\"colpick_new_color\"></div><div class=\"colpick_current_color\"></div></div><div class=\"colpick_color_fields\"><div class=\"colpick_rgb_hsb\"><div class=\"colpick_rgb\"><div class=\"colpick_rgb_r colpick_field\"><div class=\"colpick_field_letter\">R</div><input type=\"text\" maxlength=\"3\" size=\"3\" /><div class=\"colpick_field_arrs\"><div class=\"colpick_field_uarr\"></div><div class=\"colpick_field_darr\"></div></div></div><div class=\"colpick_rgb_g colpick_field\"><div class=\"colpick_field_letter\">G</div><input type=\"text\" maxlength=\"3\" size=\"3\" /><div class=\"colpick_field_arrs\"><div class=\"colpick_field_uarr\"></div><div class=\"colpick_field_darr\"></div></div></div><div class=\"colpick_rgb_b colpick_field\"><div class=\"colpick_field_letter\">B</div><input type=\"text\" maxlength=\"3\" size=\"3\" /><div class=\"colpick_field_arrs\"><div class=\"colpick_field_uarr\"></div><div class=\"colpick_field_darr\"></div></div></div></div><div class=\"colpick_hsb\"><div class=\"colpick_hsb_h colpick_field\"><div class=\"colpick_field_letter\">H</div><input type=\"text\" maxlength=\"3\" size=\"3\" /><div class=\"colpick_field_arrs\"><div class=\"colpick_field_uarr\"></div><div class=\"colpick_field_darr\"></div></div></div><div class=\"colpick_hsb_s colpick_field\"><div class=\"colpick_field_letter\">S</div><input type=\"text\" maxlength=\"3\" size=\"3\" /><div class=\"colpick_field_arrs\"><div class=\"colpick_field_uarr\"></div><div class=\"colpick_field_darr\"></div></div></div><div class=\"colpick_hsb_b colpick_field\"><div class=\"colpick_field_letter\">B</div><input type=\"text\" maxlength=\"3\" size=\"3\" /><div class=\"colpick_field_arrs\"><div class=\"colpick_field_uarr\"></div><div class=\"colpick_field_darr\"></div></div></div></div></div><div class=\"colpick_hex_submit\"><div class=\"colpick_hex_field\"><div class=\"colpick_field_letter\">#</div><input type=\"text\" maxlength=\"6\" size=\"6\" /></div><div class=\"colpick_submit\"></div></div></div></div></div>',\n\t\t\tdefaults = {\n\t\t\t\tshowEvent: 'click',\n\t\t\t\tonShow: function () {},\n\t\t\t\tonBeforeShow: function(){},\n\t\t\t\tonHide: function () {},\n\t\t\t\tonChange: function () {},\n\t\t\t\tonSubmit: function () {},\n\t\t\t\tcolorScheme: 'light',\n\t\t\t\tcolor: '3289c7',\n\t\t\t\tlivePreview: true,\n\t\t\t\tflat: false,\n\t\t\t\tlayout: 'full',\n\t\t\t\tsubmit: 1,\n\t\t\t\tsubmitText: 'OK',\n\t\t\t\theight: 156\n\t\t\t},\n\t\t\t//Fill the inputs of the plugin\n\t\t\tfillRGBFields = function  (hsb, cal) {\n\t\t\t\tvar rgb = hsbToRgb(hsb),\n\t\t\t\t\tfieldIndex = 0;\n\n\t\t\t\t$(cal).data('colpick').fields\n\t\t\t\t\t.eq(fieldIndex).val(rgb.r).end()\n\t\t\t\t\t.eq(fieldIndex+1).val(rgb.g).end()\n\t\t\t\t\t.eq(fieldIndex+2).val(rgb.b).end();\n\n\t\t\t},\n\t\t\tfillHSBFields = function  (hsb, cal) {\n\t\t\t\tvar fieldIndex = 3;\n\n\t\t\t\t$(cal).data('colpick').fields\n\t\t\t\t\t.eq(fieldIndex).val(Math.round(hsb.h)).end()\n\t\t\t\t\t.eq(fieldIndex+1).val(Math.round(hsb.s)).end()\n\t\t\t\t\t.eq(fieldIndex+2).val(Math.round(hsb.b)).end();\n\t\t\t},\n\t\t\tfillHexFields = function (hsb, cal) {\n\t\t\t\t$(cal).data('colpick').fields.eq(6).val(hsbToHex(hsb));\n\t\t\t},\n\t\t\t//Set the round selector position\n\t\t\tsetSelector = function (hsb, cal) {\n\t\t\t\t$(cal).data('colpick').selector.css('backgroundColor', '#' + hsbToHex({h: hsb.h, s: 100, b: 100}));\n\t\t\t\t$(cal).data('colpick').selectorIndic.css({\n\t\t\t\t\tleft: parseInt($(cal).data('colpick').height * hsb.s/100, 10),\n\t\t\t\t\ttop: parseInt($(cal).data('colpick').height * (100-hsb.b)/100, 10)\n\t\t\t\t});\n\t\t\t},\n\t\t\t//Set the hue selector position\n\t\t\tsetHue = function (hsb, cal) {\n\t\t\t\t$(cal).data('colpick').hue.css('top', parseInt($(cal).data('colpick').height - $(cal).data('colpick').height * hsb.h/360, 10));\n\t\t\t},\n\t\t\t//Set current and new colors\n\t\t\tsetCurrentColor = function (hsb, cal) {\n\t\t\t\t$(cal).data('colpick').currentColor.css('backgroundColor', '#' + hsbToHex(hsb));\n\t\t\t},\n\t\t\tsetNewColor = function (hsb, cal) {\n\t\t\t\t$(cal).data('colpick').newColor.css('backgroundColor', '#' + hsbToHex(hsb));\n\t\t\t},\n\t\t\t//Called when the new color is changed\n\t\t\tchange = function (ev) {\n\t\t\t\tvar cal = $(this).parents('.colpick'),\n\t\t\t\t\tcol,\n\t\t\t\t\tfieldIndex = 0;\n\n\t\t\t\tif (this.parentNode.className.indexOf('_swatches') > 0) {\n\t\t\t\t\tcol = hexToHsb($(ev.target).data('swatch-color'));\n\n\t\t\t\t\tfillHexFields(col, cal.get(0));\n\t\t\t\t\tfillRGBFields(col, cal.get(0));\n\t\t\t\t\tfillHSBFields(col, cal.get(0));\n\t\t\t\t} else if (this.parentNode.className.indexOf('_hex') > 0) {\n\t\t\t\t\tcal.data('colpick').color = col = hexToHsb(fixHex(this.value));\n\t\t\t\t\tfillRGBFields(col, cal.get(0));\n\t\t\t\t\tfillHSBFields(col, cal.get(0));\n\t\t\t\t} else if (this.parentNode.className.indexOf('_hsb') > 0) {\n\t\t\t\t\tcal.data('colpick').color = col = fixHSB({\n\t\t\t\t\t\th: parseInt(cal.data('colpick').fields.eq(fieldIndex+3).val(), 10),\n\t\t\t\t\t\ts: parseInt(cal.data('colpick').fields.eq(fieldIndex+4).val(), 10),\n\t\t\t\t\t\tb: parseInt(cal.data('colpick').fields.eq(fieldIndex+5).val(), 10)\n\t\t\t\t\t});\n\t\t\t\t\tfillRGBFields(col, cal.get(0));\n\t\t\t\t\tfillHexFields(col, cal.get(0));\n\t\t\t\t} else {\n\t\t\t\t\tcal.data('colpick').color = col = rgbToHsb(fixRGB({\n\t\t\t\t\t\tr: parseInt(cal.data('colpick').fields.eq(fieldIndex).val(), 10),\n\t\t\t\t\t\tg: parseInt(cal.data('colpick').fields.eq(fieldIndex+1).val(), 10),\n\t\t\t\t\t\tb: parseInt(cal.data('colpick').fields.eq(fieldIndex+2).val(), 10)\n\t\t\t\t\t}));\n\t\t\t\t\tfillHexFields(col, cal.get(0));\n\t\t\t\t\tfillHSBFields(col, cal.get(0));\n\t\t\t\t}\n\t\t\t\tsetSelector(col, cal.get(0));\n\t\t\t\tsetHue(col, cal.get(0));\n\t\t\t\tsetNewColor(col, cal.get(0));\n\t\t\t\tcal.data('colpick').onChange.apply(cal.parent(), [col, hsbToHex(col), hsbToRgb(col), cal.data('colpick').el, 0]);\n\t\t\t},\n\t\t\t//Change style on blur and on focus of inputs\n\t\t\tblur = function (ev) {\n\t\t\t\t$(this).parent().removeClass('colpick_focus');\n\t\t\t},\n\t\t\tfocus = function () {\n\t\t\t\tvar cal = $(this).parents('.colpick');\n\n\t\t\t\tcal.data('colpick').fields.parent().removeClass('colpick_focus');\n\t\t\t\t$(this).parent().addClass('colpick_focus');\n\t\t\t},\n\t\t\t//Increment/decrement arrows functions\n\t\t\tdownIncrement = function (ev) {\n\t\t\t\tev.preventDefault ? ev.preventDefault() : ev.returnValue = false;\n\n\t\t\t\tvar field = $(this).parent().find('input').focus(),\n\t\t\t\t\tcal = $(this).parents('.colpick'),\n\t\t\t\t\tcurrent = {\n\t\t\t\t\t\tel: $(this).parent().addClass('colpick_slider'),\n\t\t\t\t\t\tmax: this.parentNode.className.indexOf('_hsb_h') > 0 ? 360 : (this.parentNode.className.indexOf('_hsb') > 0 ? 100 : 255),\n\t\t\t\t\t\ty: ev.pageY,\n\t\t\t\t\t\tfield: field,\n\t\t\t\t\t\tval: parseInt(field.val(), 10),\n\t\t\t\t\t\tpreview: cal.data('colpick').livePreview\n\t\t\t\t\t};\n\n\t\t\t\t$(document).mouseup(current, upIncrement);\n\t\t\t\t$(document).mousemove(current, moveIncrement);\n\t\t\t},\n\t\t\tmoveIncrement = function (ev) {\n\t\t\t\tev.data.field.val(Math.max(0, Math.min(ev.data.max, parseInt(ev.data.val - ev.pageY + ev.data.y, 10))));\n\t\t\t\tif (ev.data.preview) {\n\t\t\t\t\tchange.apply(ev.data.field.get(0), [true]);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tupIncrement = function (ev) {\n\t\t\t\tchange.apply(ev.data.field.get(0), [true]);\n\t\t\t\tev.data.el.removeClass('colpick_slider').find('input').focus();\n\t\t\t\t$(document).off('mouseup', upIncrement);\n\t\t\t\t$(document).off('mousemove', moveIncrement);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t//Hue slider functions\n\t\t\tdownHue = function (ev) {\n\t\t\t\tev.preventDefault ? ev.preventDefault() : ev.returnValue = false;\n\t\t\t\tvar current = {\n\t\t\t\t\tcal: $(this).parent(),\n\t\t\t\t\ty: $(this).offset().top\n\t\t\t\t};\n\t\t\t\t$(document).on('mouseup touchend',current,upHue);\n\t\t\t\t$(document).on('mousemove touchmove',current,moveHue);\n\t\t\t\t\n\t\t\t\tvar pageY = ((ev.type == 'touchstart') ? ev.originalEvent.changedTouches[0].pageY : ev.pageY );\n\t\t\t\tchange.apply(\n\t\t\t\t\tcurrent.cal.data('colpick')\n\t\t\t\t\t.fields.eq(3).val(parseInt(360*(current.cal.data('colpick').height - (pageY - current.y))/current.cal.data('colpick').height, 10))\n\t\t\t\t\t\t.get(0),\n\t\t\t\t\t[current.cal.data('colpick').livePreview]\n\t\t\t\t);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tmoveHue = function (ev) {\n\t\t\t\tvar pageY = ((ev.type == 'touchmove') ? ev.originalEvent.changedTouches[0].pageY : ev.pageY );\n\t\t\t\tchange.apply(\n\t\t\t\t\tev.data.cal.data('colpick')\n\t\t\t\t\t.fields.eq(3).val(parseInt(360*(ev.data.cal.data('colpick').height - Math.max(0,Math.min(ev.data.cal.data('colpick').height,(pageY - ev.data.y))))/ev.data.cal.data('colpick').height, 10))\n\t\t\t\t\t\t.get(0),\n\t\t\t\t\t[ev.data.preview]\n\t\t\t\t);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tupHue = function (ev) {\n\t\t\t\tfillRGBFields(ev.data.cal.data('colpick').color, ev.data.cal.get(0));\n\t\t\t\tfillHexFields(ev.data.cal.data('colpick').color, ev.data.cal.get(0));\n\t\t\t\t$(document).off('mouseup touchend',upHue);\n\t\t\t\t$(document).off('mousemove touchmove',moveHue);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t//Color selector functions\n\t\t\tdownSelector = function (ev) {\n\t\t\t\tev.preventDefault ? ev.preventDefault() : ev.returnValue = false;\n\t\t\t\tvar current = {\n\t\t\t\t\tcal: $(this).parent(),\n\t\t\t\t\tpos: $(this).offset()\n\t\t\t\t};\n\t\t\t\tcurrent.preview = current.cal.data('colpick').livePreview;\n\t\t\t\t\n\t\t\t\t$(document).on('mouseup touchend',current,upSelector);\n\t\t\t\t$(document).on('mousemove touchmove',current,moveSelector);\n\n\t\t\t\tvar payeX,pageY;\n\t\t\t\tif(ev.type == 'touchstart') {\n\t\t\t\t\tpageX = ev.originalEvent.changedTouches[0].pageX,\n\t\t\t\t\tpageY = ev.originalEvent.changedTouches[0].pageY;\n\t\t\t\t} else {\n\t\t\t\t\tpageX = ev.pageX;\n\t\t\t\t\tpageY = ev.pageY;\n\t\t\t\t}\n\n\t\t\t\tvar fieldIndex = 4;\n\t\t\t\tchange.apply(\n\t\t\t\t\tcurrent.cal.data('colpick').fields\n\t\t\t\t\t.eq(fieldIndex+1).val(parseInt(100*(current.cal.data('colpick').height - (pageY - current.pos.top))/current.cal.data('colpick').height, 10)).end()\n\t\t\t\t\t.eq(fieldIndex).val(parseInt(100*(pageX - current.pos.left)/current.cal.data('colpick').height, 10))\n\t\t\t\t\t.get(0),\n\t\t\t\t\t[current.preview]\n\t\t\t\t);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tmoveSelector = function (ev) {\n\t\t\t\tvar payeX,pageY;\n\t\t\t\tif(ev.type == 'touchmove') {\n\t\t\t\t\tpageX = ev.originalEvent.changedTouches[0].pageX,\n\t\t\t\t\tpageY = ev.originalEvent.changedTouches[0].pageY;\n\t\t\t\t} else {\n\t\t\t\t\tpageX = ev.pageX;\n\t\t\t\t\tpageY = ev.pageY;\n\t\t\t\t}\n\n\t\t\t\tvar fieldIndex = 4;\n\t\t\t\tchange.apply(\n\t\t\t\t\tev.data.cal.data('colpick').fields\n\t\t\t\t\t.eq(fieldIndex+1).val(parseInt(100*(ev.data.cal.data('colpick').height - Math.max(0,Math.min(ev.data.cal.data('colpick').height,(pageY - ev.data.pos.top))))/ev.data.cal.data('colpick').height, 10)).end()\n\t\t\t\t\t.eq(fieldIndex).val(parseInt(100*(Math.max(0,Math.min(ev.data.cal.data('colpick').height,(pageX - ev.data.pos.left))))/ev.data.cal.data('colpick').height, 10))\n\t\t\t\t\t.get(0),\n\t\t\t\t\t[ev.data.preview]\n\t\t\t\t);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tupSelector = function (ev) {\n\t\t\t\tfillRGBFields(ev.data.cal.data('colpick').color, ev.data.cal.get(0));\n\t\t\t\tfillHexFields(ev.data.cal.data('colpick').color, ev.data.cal.get(0));\n\t\t\t\t$(document).off('mouseup touchend',upSelector);\n\t\t\t\t$(document).off('mousemove touchmove',moveSelector);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t//Submit button\n\t\t\tclickSubmit = function (ev) {\n\t\t\t\tvar cal = $(this).parents('.colpick');\n\t\t\t\tvar col = cal.data('colpick').color;\n\t\t\t\tcal.data('colpick').origColor = col;\n\t\t\t\tsetCurrentColor(col, cal.get(0));\n\t\t\t\tcal.data('colpick').onSubmit(col, hsbToHex(col), hsbToRgb(col), cal.data('colpick').el);\n\t\t\t},\n\t\t\t//Show/hide the color picker\n\t\t\tshow = function (ev) {\n\t\t\t\t// Prevent the trigger of any direct parent\n\t\t\t\tif (ev) {\n\t\t\t\t\t// this is sometimes null: https://github.com/josedvq/colpick-jQuery-Color-Picker/pull/18\n\t\t\t\t\tev.stopPropagation();\n\t\t\t\t}\t\t\t\t\n\t\t\t\tvar cal = $('#' + $(this).data('colpickId'));\n\t\t\t\tcal.data('colpick').onBeforeShow.apply(this, [cal.get(0)]);\n\t\t\t\tvar pos = $(this).offset();\n\t\t\t\tvar top = pos.top + this.offsetHeight;\n\t\t\t\tvar left = pos.left;\n\t\t\t\tvar viewPort = getViewport();\n\t\t\t\tvar calW = cal.width();\n\t\t\t\tif (left + calW > viewPort.l + viewPort.w) {\n\t\t\t\t\tleft -= calW;\n\t\t\t\t}\n\t\t\t\tcal.css({left: left + 'px', top: top + 'px'});\n\t\t\t\tif (cal.data('colpick').onShow.apply(this, [cal.get(0)]) != false) {\n\t\t\t\t\tcal.addClass('visible');\n\t\t\t\t}\n\t\t\t\t//Hide when user clicks outside\n\t\t\t\t$('html').mousedown({cal:cal}, hide);\n\t\t\t\tcal.mousedown(function(ev){ev.stopPropagation();})\n\t\t\t},\n\t\t\thide = function (ev) {\n\t\t\t\tif (ev.data.cal.data('colpick').onHide.apply(this, [ev.data.cal.get(0)]) != false) {\n\t\t\t\t\tev.data.cal.removeClass('visible');\n\t\t\t\t}\n\t\t\t\t$('html').off('mousedown', hide);\n\t\t\t},\n\t\t\tgetViewport = function () {\n\t\t\t\tvar m = document.compatMode == 'CSS1Compat';\n\t\t\t\treturn {\n\t\t\t\t\tl : window.pageXOffset || (m ? document.documentElement.scrollLeft : document.body.scrollLeft),\n\t\t\t\t\tw : window.innerWidth || (m ? document.documentElement.clientWidth : document.body.clientWidth)\n\t\t\t\t};\n\t\t\t},\n\t\t\t//Fix the values if the user enters a negative or high value\n\t\t\tfixHSB = function (hsb) {\n\t\t\t\treturn {\n\t\t\t\t\th: Math.min(360, Math.max(0, hsb.h)),\n\t\t\t\t\ts: Math.min(100, Math.max(0, hsb.s)),\n\t\t\t\t\tb: Math.min(100, Math.max(0, hsb.b))\n\t\t\t\t};\n\t\t\t}, \n\t\t\tfixRGB = function (rgb) {\n\t\t\t\treturn {\n\t\t\t\t\tr: Math.min(255, Math.max(0, rgb.r)),\n\t\t\t\t\tg: Math.min(255, Math.max(0, rgb.g)),\n\t\t\t\t\tb: Math.min(255, Math.max(0, rgb.b))\n\t\t\t\t};\n\t\t\t},\n\t\t\tfixHex = function (hex) {\n\t\t\t\tvar len = 6 - hex.length;\n\t\t\t\tif (len > 0) {\n\t\t\t\t\tvar o = [];\n\t\t\t\t\tfor (var i=0; i<len; i++) {\n\t\t\t\t\t\to.push('0');\n\t\t\t\t\t}\n\t\t\t\t\to.push(hex);\n\t\t\t\t\thex = o.join('');\n\t\t\t\t}\n\t\t\t\treturn hex;\n\t\t\t},\n\t\t\trestoreOriginal = function () {\n\t\t\t\tvar cal = $(this).parent();\n\t\t\t\tvar col = cal.data('colpick').origColor;\n\t\t\t\tcal.data('colpick').color = col;\n\t\t\t\tfillRGBFields(col, cal.get(0));\n\t\t\t\tfillHexFields(col, cal.get(0));\n\t\t\t\tfillHSBFields(col, cal.get(0));\n\t\t\t\tsetSelector(col, cal.get(0));\n\t\t\t\tsetHue(col, cal.get(0));\n\t\t\t\tsetNewColor(col, cal.get(0));\n\t\t\t};\n\t\treturn {\n\t\t\tinit: function (opt) {\n\t\t\t\topt = $.extend({}, defaults, opt||{});\n\t\t\t\t//Set color\n\t\t\t\tif (typeof opt.color == 'string') {\n\t\t\t\t\topt.color = hexToHsb(opt.color);\n\t\t\t\t} else if (opt.color.r != undefined && opt.color.g != undefined && opt.color.b != undefined) {\n\t\t\t\t\topt.color = rgbToHsb(opt.color);\n\t\t\t\t} else if (opt.color.h != undefined && opt.color.s != undefined && opt.color.b != undefined) {\n\t\t\t\t\topt.color = fixHSB(opt.color);\n\t\t\t\t} else {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tvar template = tpl;\n\t\t\t\tif (opt.swatches && Array.isArray(opt.swatches)) {\n\t\t\t\t\tvar swatchesTpl = '',\n\t\t\t\t\t\tswatchColor;\n\n\t\t\t\t\tfor (i = 0; i < opt.swatches.length; i++) {\n\t\t\t\t\t\tswatchColor = opt.swatches[i];\n\n\t\t\t\t\t\t//Make sure swatch color is a valid hex color\n\t\t\t\t\t\tif (/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(swatchColor)) {\n\t\t\t\t\t\t\tswatchesTpl += '<div class=\"colpick_swatch\" style=\"background-color: ' + swatchColor + ';\" data-swatch-color=\"' + swatchColor + '\"></div>'\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (swatchesTpl) {\n\t\t\t\t\t\tswatchesTpl = '<div class=\"colpick_swatches\">' + swatchesTpl +  '</div>';\n\t\t\t\t\t\ttemplate = tpl.slice(0, -6) + swatchesTpl + '</div>';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t//For each selected DOM element\n\t\t\t\treturn this.each(function () {\n\t\t\t\t\t//If the element does not have an ID\n\t\t\t\t\tif (!$(this).data('colpickId')) {\n\t\t\t\t\t\tvar options = $.extend({}, opt);\n\t\t\t\t\t\toptions.origColor = opt.color;\n\t\t\t\t\t\t//Generate and assign a random ID\n\t\t\t\t\t\tvar id = 'collorpicker_' + parseInt(Math.random() * 1000);\n\t\t\t\t\t\t$(this).data('colpickId', id);\n\t\t\t\t\t\t//Set the template's ID and get the HTML\n\t\t\t\t\t\tvar cal = $(template).attr('id', id);\n\t\t\t\t\t\t//Add class according to layout\n\t\t\t\t\t\tcal.addClass('colpick_'+options.layout+(options.submit?'':' colpick_'+options.layout+'_ns'));\n\t\t\t\t\t\t//Add class if the color scheme is not default\n\t\t\t\t\t\tif(options.colorScheme != 'light') {\n\t\t\t\t\t\t\tcal.addClass('colpick_'+options.colorScheme);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//Setup submit button\n\t\t\t\t\t\tcal.find('div.colpick_submit').html(options.submitText).click(clickSubmit);\n\t\t\t\t\t\t//Setup input fields\n\t\t\t\t\t\toptions.fields = cal.find('input').change(change).blur(blur).focus(focus);\n\t\t\t\t\t\tcal.find('div.colpick_field_arrs').mousedown(downIncrement).end().find('div.colpick_current_color').click(restoreOriginal);\n\n\t\t\t\t\t\t//Setup swatches\n\t\t\t\t\t\toptions.swatches = cal.find('.colpick_swatch').click(change);\n\n\t\t\t\t\t\t//Setup hue selector\n\t\t\t\t\t\toptions.selector = cal.find('div.colpick_color').on('mousedown touchstart',downSelector);\n\t\t\t\t\t\toptions.selectorIndic = options.selector.find('div.colpick_selector_outer');\n\t\t\t\t\t\t//Store parts of the plugin\n\t\t\t\t\t\toptions.el = this;\n\t\t\t\t\t\toptions.hue = cal.find('div.colpick_hue_arrs');\n\t\t\t\t\t\thuebar = options.hue.parent();\n\t\t\t\t\t\t//Paint the hue bar\n\t\t\t\t\t\tvar UA = navigator.userAgent.toLowerCase();\n\t\t\t\t\t\tvar isIE = navigator.appName === 'Microsoft Internet Explorer';\n\t\t\t\t\t\tvar IEver = isIE ? parseFloat( UA.match( /msie ([0-9]{1,}[\\.0-9]{0,})/ )[1] ) : 0;\n\t\t\t\t\t\tvar ngIE = ( isIE && IEver < 10 );\n\t\t\t\t\t\tvar stops = ['#ff0000','#ff0080','#ff00ff','#8000ff','#0000ff','#0080ff','#00ffff','#00ff80','#00ff00','#80ff00','#ffff00','#ff8000','#ff0000'];\n\t\t\t\t\t\tif(ngIE) {\n\t\t\t\t\t\t\tvar i, div;\n\t\t\t\t\t\t\tfor(i=0; i<=11; i++) {\n\t\t\t\t\t\t\t\tdiv = $('<div></div>').attr('style','height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+stops[i]+', endColorstr='+stops[i+1]+'); -ms-filter: \"progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+stops[i]+', endColorstr='+stops[i+1]+')\";');\n\t\t\t\t\t\t\t\thuebar.append(div);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tstopList = stops.join(',');\n\t\t\t\t\t\t\thuebar.attr('style','background:-webkit-linear-gradient(top,'+stopList+'); background: -o-linear-gradient(top,'+stopList+'); background: -ms-linear-gradient(top,'+stopList+'); background:-moz-linear-gradient(top,'+stopList+'); -webkit-linear-gradient(top,'+stopList+'); background:linear-gradient(to bottom,'+stopList+'); ');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcal.find('div.colpick_hue').on('mousedown touchstart',downHue);\n\t\t\t\t\t\toptions.newColor = cal.find('div.colpick_new_color');\n\t\t\t\t\t\toptions.currentColor = cal.find('div.colpick_current_color');\n\t\t\t\t\t\t//Store options and fill with default color\n\t\t\t\t\t\tcal.data('colpick', options);\n\t\t\t\t\t\tfillRGBFields(options.color, cal.get(0));\n\t\t\t\t\t\tfillHSBFields(options.color, cal.get(0));\n\t\t\t\t\t\tfillHexFields(options.color, cal.get(0));\n\t\t\t\t\t\tsetHue(options.color, cal.get(0));\n\t\t\t\t\t\tsetSelector(options.color, cal.get(0));\n\t\t\t\t\t\tsetCurrentColor(options.color, cal.get(0));\n\t\t\t\t\t\tsetNewColor(options.color, cal.get(0));\n\t\t\t\t\t\t//Append to body if flat=false, else show in place\n\t\t\t\t\t\tif (options.flat) {\n\t\t\t\t\t\t\tcal.appendTo(this).show();\n\t\t\t\t\t\t\tvar css = { position: 'relative' };\n\t\t\t\t\t\t\tcss.display = 'flex';\n\t\t\t\t\t\t\tcal.css(css);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcal.appendTo(document.body);\n\t\t\t\t\t\t\t$(this).on(options.showEvent, show);\n\t\t\t\t\t\t\tcal.css({\n\t\t\t\t\t\t\t\tposition:'absolute'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t//Shows the picker\n\t\t\tshowPicker: function() {\n\t\t\t\treturn this.each( function () {\n\t\t\t\t\tif ($(this).data('colpickId')) {\n\t\t\t\t\t\tshow.apply(this);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t//Hides the picker\n\t\t\thidePicker: function() {\n\t\t\t\treturn this.each( function () {\n\t\t\t\t\tif ($(this).data('colpickId')) {\n\t\t\t\t\t\t$('#' + $(this).data('colpickId')).hide();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t//Sets a color as new and current (default)\n\t\t\tsetColor: function(col, setCurrent) {\n\t\t\t\tsetCurrent = (typeof setCurrent === \"undefined\") ? 1 : setCurrent;\n\t\t\t\tif (typeof col == 'string') {\n\t\t\t\t\tcol = hexToHsb(col);\n\t\t\t\t} else if (col.r != undefined && col.g != undefined && col.b != undefined) {\n\t\t\t\t\tcol = rgbToHsb(col);\n\t\t\t\t} else if (col.h != undefined && col.s != undefined && col.b != undefined) {\n\t\t\t\t\tcol = fixHSB(col);\n\t\t\t\t} else {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t\treturn this.each(function(){\n\t\t\t\t\tif ($(this).data('colpickId')) {\n\t\t\t\t\t\tvar cal = $('#' + $(this).data('colpickId'));\n\t\t\t\t\t\tcal.data('colpick').color = col;\n\t\t\t\t\t\tcal.data('colpick').origColor = col;\n\t\t\t\t\t\tfillRGBFields(col, cal.get(0));\n\t\t\t\t\t\tfillHSBFields(col, cal.get(0));\n\t\t\t\t\t\tfillHexFields(col, cal.get(0));\n\t\t\t\t\t\tsetHue(col, cal.get(0));\n\t\t\t\t\t\tsetSelector(col, cal.get(0));\n\t\t\t\t\t\t\n\t\t\t\t\t\tsetNewColor(col, cal.get(0));\n\t\t\t\t\t\tcal.data('colpick').onChange.apply(cal.parent(), [col, hsbToHex(col), hsbToRgb(col), cal.data('colpick').el, 1]);\n\t\t\t\t\t\tif(setCurrent) {\n\t\t\t\t\t\t\tsetCurrentColor(col, cal.get(0));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}();\n\t//Color space convertions\n\tvar hexToRgb = function (hex) {\n\t\tvar hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1) : hex), 16);\n\t\treturn {r: hex >> 16, g: (hex & 0x00FF00) >> 8, b: (hex & 0x0000FF)};\n\t};\n\tvar hexToHsb = function (hex) {\n\t\treturn rgbToHsb(hexToRgb(hex));\n\t};\n\tvar rgbToHsb = function (rgb) {\n\t\tvar hsb = {h: 0, s: 0, b: 0};\n\t\tvar min = Math.min(rgb.r, rgb.g, rgb.b);\n\t\tvar max = Math.max(rgb.r, rgb.g, rgb.b);\n\t\tvar delta = max - min;\n\t\thsb.b = max;\n\t\thsb.s = max != 0 ? 255 * delta / max : 0;\n\t\tif (hsb.s != 0) {\n\t\t\tif (rgb.r == max) hsb.h = (rgb.g - rgb.b) / delta;\n\t\t\telse if (rgb.g == max) hsb.h = 2 + (rgb.b - rgb.r) / delta;\n\t\t\telse hsb.h = 4 + (rgb.r - rgb.g) / delta;\n\t\t} else hsb.h = -1;\n\t\thsb.h *= 60;\n\t\tif (hsb.h < 0) hsb.h += 360;\n\t\thsb.s *= 100/255;\n\t\thsb.b *= 100/255;\n\t\treturn hsb;\n\t};\n\tvar hsbToRgb = function (hsb) {\n\t\tvar rgb = {};\n\t\tvar h = hsb.h;\n\t\tvar s = hsb.s*255/100;\n\t\tvar v = hsb.b*255/100;\n\t\tif(s == 0) {\n\t\t\trgb.r = rgb.g = rgb.b = v;\n\t\t} else {\n\t\t\tvar t1 = v;\n\t\t\tvar t2 = (255-s)*v/255;\n\t\t\tvar t3 = (t1-t2)*(h%60)/60;\n\t\t\tif(h==360) h = 0;\n\t\t\tif(h<60) {rgb.r=t1;\trgb.b=t2; rgb.g=t2+t3}\n\t\t\telse if(h<120) {rgb.g=t1; rgb.b=t2;\trgb.r=t1-t3}\n\t\t\telse if(h<180) {rgb.g=t1; rgb.r=t2;\trgb.b=t2+t3}\n\t\t\telse if(h<240) {rgb.b=t1; rgb.r=t2;\trgb.g=t1-t3}\n\t\t\telse if(h<300) {rgb.b=t1; rgb.g=t2;\trgb.r=t2+t3}\n\t\t\telse if(h<360) {rgb.r=t1; rgb.g=t2;\trgb.b=t1-t3}\n\t\t\telse {rgb.r=0; rgb.g=0;\trgb.b=0}\n\t\t}\n\t\treturn {r:Math.round(rgb.r), g:Math.round(rgb.g), b:Math.round(rgb.b)};\n\t};\n\tvar rgbToHex = function (rgb) {\n\t\tvar hex = [\n\t\t\trgb.r.toString(16),\n\t\t\trgb.g.toString(16),\n\t\t\trgb.b.toString(16)\n\t\t];\n\t\t$.each(hex, function (nr, val) {\n\t\t\tif (val.length == 1) {\n\t\t\t\thex[nr] = '0' + val;\n\t\t\t}\n\t\t});\n\t\treturn hex.join('');\n\t};\n\tvar hsbToHex = function (hsb) {\n\t\treturn rgbToHex(hsbToRgb(hsb));\n\t};\n\t$.fn.extend({\n\t\tcolpick: colpick.init,\n\t\tcolpickHide: colpick.hidePicker,\n\t\tcolpickShow: colpick.showPicker,\n\t\tcolpickSetColor: colpick.setColor\n\t});\n\t$.extend({\n\t\tcolpick:{ \n\t\t\trgbToHex: rgbToHex,\n\t\t\trgbToHsb: rgbToHsb,\n\t\t\thsbToHex: hsbToHex,\n\t\t\thsbToRgb: hsbToRgb,\n\t\t\thexToHsb: hexToHsb,\n\t\t\thexToRgb: hexToRgb\n\t\t}\n\t});\n})(jQuery);\n"},143:function(e,t){e.exports="/**\n * @package\t\tPickMeUp - jQuery datepicker plugin\n * @author\t\tNazar Mokrynskyi <nazar@mokrynskyi.com>\n * @author\t\tStefan Petre <www.eyecon.ro>\n * @copyright\tCopyright (c) 2013-2014, Nazar Mokrynskyi\n * @copyright\tCopyright (c) 2008-2009, Stefan Petre\n * @license\t\tMIT License, see license.txt\n */\n(function (d) {\n\tfunction getMaxDays () {\n\t\tvar tmpDate\t= new Date(this.toString()),\n\t\t\td\t\t= 28,\n\t\t\tm\t\t= tmpDate.getMonth();\n\t\twhile (tmpDate.getMonth() == m) {\n\t\t\t++d;\n\t\t\ttmpDate.setDate(d);\n\t\t}\n\t\treturn d - 1;\n\t}\n\td.addDays\t\t= function (n) {\n\t\tthis.setDate(this.getDate() + n);\n\t};\n\td.addMonths\t= function (n) {\n\t\tvar day\t= this.getDate();\n\t\tthis.setDate(1);\n\t\tthis.setMonth(this.getMonth() + n);\n\t\tthis.setDate(Math.min(day, getMaxDays.apply(this)));\n\t};\n\td.addYears\t\t= function (n) {\n\t\tvar day\t= this.getDate();\n\t\tthis.setDate(1);\n\t\tthis.setFullYear(this.getFullYear() + n);\n\t\tthis.setDate(Math.min(day, getMaxDays.apply(this)));\n\t};\n\td.getDayOfYear\t= function() {\n\t\tvar now\t\t= new Date(this.getFullYear(), this.getMonth(), this.getDate(), 0, 0, 0);\n\t\tvar then\t= new Date(this.getFullYear(), 0, 0, 0, 0, 0);\n\t\tvar time\t= now - then;\n\t\treturn Math.floor(time / 24*60*60*1000);\n\t};\n})(Date.prototype);\n(function ($) {\n\tvar instances_count\t= 0;\n\t$.pickmeup = $.extend($.pickmeup || {}, {\n\t\tdate\t\t\t: new Date,\n\t\tflat\t\t\t: false,\n\t\tfirst_day\t\t: 1,\n\t\tdefault_date\t\t: true,\n\t\tprev\t\t\t: '&#9664;',\n\t\tnext\t\t\t: '&#9654;',\n\t\tmode\t\t\t: 'single',\n\t\tselect_year\t\t: true,\n\t\tselect_month\t: true,\n\t\tselect_day\t\t: true,\n\t\tview\t\t\t: 'days',\n\t\tcalendars\t\t: 1,\n\t\tformat\t\t\t: 'd-m-Y',\n\t\tposition\t\t: 'bottom',\n\t\ttrigger_event\t: 'click touchstart',\n\t\tclass_name\t\t: '',\n\t\tseparator\t\t: ' - ',\n\t\thide_on_select\t: false,\n\t\tmin\t\t\t\t: null,\n\t\tmax\t\t\t\t: null,\n\t\trender\t\t\t: function () {},\n\t\tchange\t\t\t: function () {return true;},\n\t\tbefore_show\t\t: function () {return true;},\n\t\tshow\t\t\t: function () {return true;},\n\t\thide\t\t\t: function () {return true;},\n\t\tfill\t\t\t: function () {return true;},\n\t\tlocale\t\t\t: {\n\t\t\tdays\t\t: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'],\n\t\t\tdaysShort\t: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],\n\t\t\tdaysMin\t\t: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa', 'Su'],\n\t\t\tmonths\t\t: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n\t\t\tmonthsShort\t: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']\n\t\t}\n\t});\n\tvar\tviews\t= {\n\t\t\tyears\t: 'pmu-view-years',\n\t\t\tmonths\t: 'pmu-view-months',\n\t\t\tdays\t: 'pmu-view-days'\n\t\t},\n\t\ttpl\t\t= {\n\t\t\twrapper\t: '<div class=\"pickmeup\" />',\n\t\t\thead\t: function (d) {\n\t\t\t\tvar result\t= '';\n\t\t\t\tfor (var i = 0; i < 7; ++i) {\n\t\t\t\t\tresult\t+= '<div>' + d.day[i] + '</div>'\n\t\t\t\t}\n\t\t\t\treturn '<div class=\"pmu-instance\">' +\n\t\t\t\t\t'<nav>' +\n\t\t\t\t\t\t'<div class=\"pmu-prev pmu-button\">' + d.prev + '</div>' +\n\t\t\t\t\t\t'<div class=\"pmu-month pmu-button\" />' +\n\t\t\t\t\t\t'<div class=\"pmu-next pmu-button\">' + d.next + '</div>' +\n\t\t\t\t\t'</nav>' +\n\t\t\t\t\t'<nav class=\"pmu-day-of-week\">' + result + '</nav>' +\n\t\t\t\t'</div>';\n\t\t\t},\n\t\t\tbody\t: function (elements, container_class_name) {\n\t\t\t\tvar result\t= '';\n\t\t\t\tfor (var i = 0; i < elements.length; ++i) {\n\t\t\t\t\tresult += '<div class=\"' + elements[i].class_name + ' pmu-button\">';\n\t\t\t\t\tif (elements[i].class_name.indexOf('pmu-today') != -1) {\n\t\t\t\t\t\tresult += '<span class=\"pmu-today-border\">' + elements[i].text + '</span>';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult += elements[i].text\n\t\t\t\t\t}\n\t\t\t\t\tresult += '</div>';\n\t\t\t\t}\n\t\t\t\treturn '<div class=\"' + container_class_name + '\">' + result + '</div>';\n\t\t\t}\n\t\t};\n\tfunction fill () {\n\t\tvar options\t\t\t= $(this).data('pickmeup-options'),\n\t\t\tpickmeup\t\t= this.pickmeup,\n\t\t\tcurrent_cal\t\t= Math.floor(options.calendars / 2),\n\t\t\tactual_date\t\t= options.date,\n\t\t\tcurrent_date\t= options.current,\n\t\t\tlocal_date,\n\t\t\theader,\n\t\t\thtml,\n\t\t\tinstance,\n\t\t\ttoday\t\t= (new Date).setHours(0,0,0,0).valueOf(),\n\t\t\tshown_date_from,\n\t\t\tshown_date_to,\n\t\t\ttmp_date;\n\t\t/**\n\t\t * Remove old content except header navigation\n\t\t */\n\t\tpickmeup.find('.pmu-instance > :not(nav)').remove();\n\t\t/**\n\t\t * If several calendars should be shown\n\t\t */\n\t\tfor (var i = 0; i < options.calendars; i++) {\n\t\t\tlocal_date\t\t= new Date(current_date);\n\t\t\tinstance\t= pickmeup.find('.pmu-instance').eq(i);\n\t\t\tif (pickmeup.hasClass('pmu-view-years')) {\n\t\t\t\tlocal_date.addYears((i - current_cal) * 12);\n\t\t\t\theader = (local_date.getFullYear() - 6) + ' - ' + (local_date.getFullYear()+5);\n\t\t\t} else if (pickmeup.hasClass('pmu-view-months')) {\n\t\t\t\tlocal_date.addYears(i - current_cal);\n\t\t\t\theader = local_date.getFullYear();\n\t\t\t} else if (pickmeup.hasClass('pmu-view-days')) {\n\t\t\t\tlocal_date.addMonths(i - current_cal);\n\t\t\t\theader = formatDate(local_date, 'B Y', options.locale);\n\t\t\t}\n\t\t\tif (!shown_date_to) {\n\t\t\t\tif (options.max) {\n\t\t\t\t\t// If all dates in this month (months in year or years in years block) are after max option - set next month as current\n\t\t\t\t\t// in order not to show calendar with all disabled dates\n\t\t\t\t\ttmp_date\t= new Date(local_date);\n\t\t\t\t\tif (options.select_day) {\n\t\t\t\t\t\ttmp_date.addMonths(options.calendars - 1);\n\t\t\t\t\t} else if (options.select_month) {\n\t\t\t\t\t\ttmp_date.addYears(options.calendars - 1);\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttmp_date.addYears((options.calendars - 1) * 12);\n\t\t\t\t\t}\n\t\t\t\t\tif (tmp_date > options.max) {\n\t\t\t\t\t\t--i;\n\t\t\t\t\t\tcurrent_date.addMonths(-1);\n\t\t\t\t\t\tshown_date_to\t= undefined;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tshown_date_to\t= new Date(local_date);\n\t\t\tif (!shown_date_from) {\n\t\t\t\tshown_date_from = new Date(local_date);\n\t\t\t\t// If all dates in this month are before min option - set next month as current in order not to show calendar with all disabled dates\n\t\t\t\tshown_date_from.setDate(1);\n\t\t\t\tshown_date_from.addMonths(1);\n\t\t\t\tshown_date_from.addDays(-1);\n\t\t\t\tif (options.min && options.min > shown_date_from) {\n\t\t\t\t\t--i;\n\t\t\t\t\tcurrent_date.addMonths(1);\n\t\t\t\t\tshown_date_from\t= undefined;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tinstance\n\t\t\t\t.find('.pmu-month')\n\t\t\t\t.text(header);\n\t\t\thtml\t\t\t= '';\n\t\t\tvar is_year_selected\t= function (year) {\n\t\t\t\treturn\t(\n\t\t\t\t\t\t\toptions.mode == 'range' &&\n\t\t\t\t\t\t\tyear >= new Date(actual_date[0]).getFullYear() &&\n\t\t\t\t\t\t\tyear <= new Date(actual_date[1]).getFullYear()\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.mode == 'multiple' &&\n\t\t\t\t\t\t\tactual_date.reduce(function (prev, current) {\n\t\t\t\t\t\t\t\tprev.push(new Date(current).getFullYear());\n\t\t\t\t\t\t\t\treturn prev;\n\t\t\t\t\t\t\t}, []).indexOf(year) !== -1\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\tnew Date(actual_date).getFullYear() == year;\n\t\t\t};\n\t\t\tvar is_months_selected\t= function (year, month) {\n\t\t\t\tvar first_year\t= new Date(actual_date[0]).getFullYear(),\n\t\t\t\t\tlastyear\t= new Date(actual_date[1]).getFullYear(),\n\t\t\t\t\tfirst_month\t= new Date(actual_date[0]).getMonth(),\n\t\t\t\t\tlast_month\t= new Date(actual_date[1]).getMonth();\n\t\t\t\treturn\t(\n\t\t\t\t\t\t\toptions.mode == 'range' &&\n\t\t\t\t\t\t\tyear > first_year &&\n\t\t\t\t\t\t\tyear < lastyear\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.mode == 'range' &&\n\t\t\t\t\t\t\tyear == first_year &&\n\t\t\t\t\t\t\tyear < lastyear &&\n\t\t\t\t\t\t\tmonth >= first_month\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.mode == 'range' &&\n\t\t\t\t\t\t\tyear > first_year &&\n\t\t\t\t\t\t\tyear == lastyear &&\n\t\t\t\t\t\t\tmonth <= last_month\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.mode == 'range' &&\n\t\t\t\t\t\t\tyear == first_year &&\n\t\t\t\t\t\t\tyear == lastyear &&\n\t\t\t\t\t\t\tmonth >= first_month &&\n\t\t\t\t\t\t\tmonth <= last_month\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.mode == 'multiple' &&\n\t\t\t\t\t\t\tactual_date.reduce(function (prev, current) {\n\t\t\t\t\t\t\t\tcurrent\t= new Date(current);\n\t\t\t\t\t\t\t\tprev.push(current.getFullYear() + '-' + current.getMonth());\n\t\t\t\t\t\t\t\treturn prev;\n\t\t\t\t\t\t\t}, []).indexOf(year + '-' + month) !== -1\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tnew Date(actual_date).getFullYear() == year &&\n\t\t\t\t\t\t\tnew Date(actual_date).getMonth() == month\n\t\t\t\t\t\t)\n\t\t\t};\n\t\t\t(function () {\n\t\t\t\tvar years\t\t\t= [],\n\t\t\t\t\tstart_from_year\t= local_date.getFullYear() - 6,\n\t\t\t\t\tmin_year\t\t= new Date(options.min).getFullYear(),\n\t\t\t\t\tmax_year\t\t= new Date(options.max).getFullYear(),\n\t\t\t\t\tyear;\n\t\t\t\tfor (var j = 0; j < 12; ++j) {\n\t\t\t\t\tyear\t= {\n\t\t\t\t\t\ttext\t\t: start_from_year + j,\n\t\t\t\t\t\tclass_name\t: []\n\t\t\t\t\t};\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.min && year.text < min_year\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.max && year.text > max_year\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tyear.class_name.push('pmu-disabled');\n\t\t\t\t\t} else if (is_year_selected(year.text)) {\n\t\t\t\t\t\tyear.class_name.push('pmu-selected');\n\t\t\t\t\t}\n\t\t\t\t\tyear.class_name\t= year.class_name.join(' ');\n\t\t\t\t\tyears.push(year);\n\t\t\t\t}\n\t\t\t\thtml\t+= tpl.body(years, 'pmu-years');\n\t\t\t})();\n\t\t\t(function () {\n\t\t\t\tvar months\t\t\t= [],\n\t\t\t\t\tcurrent_year\t= local_date.getFullYear(),\n\t\t\t\t\tmin_year\t\t= new Date(options.min).getFullYear(),\n\t\t\t\t\tmin_month\t\t= new Date(options.min).getMonth(),\n\t\t\t\t\tmax_year\t\t= new Date(options.max).getFullYear(),\n\t\t\t\t\tmax_month\t\t= new Date(options.max).getMonth(),\n\t\t\t\t\tmonth;\n\t\t\t\tfor (var j = 0; j < 12; ++j) {\n\t\t\t\t\tmonth\t= {\n\t\t\t\t\t\ttext\t\t: options.locale.monthsShort[j],\n\t\t\t\t\t\tclass_name\t: []\n\t\t\t\t\t};\n\t\t\t\t\tif (\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.min &&\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tcurrent_year < min_year ||\n\t\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t\tj < min_month && current_year == min_year\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.max &&\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tcurrent_year > max_year ||\n\t\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\t\tj > max_month && current_year >= max_year\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tmonth.class_name.push('pmu-disabled');\n\t\t\t\t\t} else if (is_months_selected(current_year, j)) {\n\t\t\t\t\t\tmonth.class_name.push('pmu-selected');\n\t\t\t\t\t}\n\t\t\t\t\tmonth.class_name\t= month.class_name.join(' ');\n\t\t\t\t\tmonths.push(month);\n\t\t\t\t}\n\t\t\t\thtml\t+= tpl.body(months, 'pmu-months');\n\t\t\t})();\n\t\t\t(function () {\n\t\t\t\tvar days\t\t\t= [],\n\t\t\t\t\tcurrent_month\t= local_date.getMonth(),\n\t\t\t\t\tday;\n\t\t\t\t// Correct first day in calendar taking into account first day of week (Sunday or Monday)\n\t\t\t\t(function () {\n\t\t\t\t\tlocal_date.setDate(1);\n\t\t\t\t\tvar day = (local_date.getDay() - options.first_day) % 7;\n\t\t\t\t\tlocal_date.addDays(-(day + (day < 0 ? 7 : 0)));\n\t\t\t\t})();\n\t\t\t\tfor (var j = 0; j < 42; ++j) {\n\t\t\t\t\tday\t= {\n\t\t\t\t\t\ttext\t\t: local_date.getDate(),\n\t\t\t\t\t\tclass_name\t: []\n\t\t\t\t\t};\n\t\t\t\t\tif (current_month != local_date.getMonth()) {\n\t\t\t\t\t\tday.class_name.push('pmu-not-in-month');\n\t\t\t\t\t}\n\t\t\t\t\tif (local_date.getDay() == 0) {\n\t\t\t\t\t\tday.class_name.push('pmu-sunday');\n\t\t\t\t\t} else if (local_date.getDay() == 6) {\n\t\t\t\t\t\tday.class_name.push('pmu-saturday');\n\t\t\t\t\t}\n\t\t\t\t\tvar from_user\t= options.render(local_date) || {},\n\t\t\t\t\t\tval\t\t\t= local_date.valueOf(),\n\t\t\t\t\t\tdisabled\t= (options.min && options.min > local_date) || (options.max && options.max < local_date);\n\t\t\t\t\tif (from_user.disabled || disabled) {\n\t\t\t\t\t\tday.class_name.push('pmu-disabled');\n\t\t\t\t\t} else if (\n\t\t\t\t\t\tfrom_user.selected ||\n\t\t\t\t\t\toptions.date == val ||\n\t\t\t\t\t\t$.inArray(val, options.date) !== -1 ||\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\toptions.mode == 'range' && val >= options.date[0] && val <= options.date[1]\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tday.class_name.push('pmu-selected');\n\t\t\t\t\t}\n\t\t\t\t\tif (val == today) {\n\t\t\t\t\t\tday.class_name.push('pmu-today');\n\t\t\t\t\t}\n\t\t\t\t\tif (from_user.class_name) {\n\t\t\t\t\t\tday.class_name.push(from_user.class_name);\n\t\t\t\t\t}\n\t\t\t\t\tday.class_name = day.class_name.join(' ');\n\t\t\t\t\tdays.push(day);\n\t\t\t\t\t// Move to next day\n\t\t\t\t\tlocal_date.addDays(1);\n\t\t\t\t}\n\t\t\t\thtml\t+= tpl.body(days, 'pmu-days');\n\t\t\t})();\n\t\t\tinstance.append(html);\n\t\t}\n\t\tshown_date_from.setDate(1);\n\t\tshown_date_to.setDate(1);\n\t\tshown_date_to.addMonths(1);\n\t\tshown_date_to.addDays(-1);\n\t\tpickmeup.find('.pmu-prev').css(\n\t\t\t'visibility',\n\t\t\toptions.min && options.min >= shown_date_from ? 'hidden' : 'visible'\n\t\t);\n\t\tpickmeup.find('.pmu-next').css(\n\t\t\t'visibility',\n\t\t\toptions.max && options.max <= shown_date_to ? 'hidden' : 'visible'\n\t\t);\n\t\toptions.fill.apply(this);\n\t}\n\tfunction parseDate (date, format, separator, locale) {\n\t\tif (date.constructor == Date) {\n\t\t\treturn date;\n\t\t} else if (!date) {\n\t\t\treturn new Date;\n\t\t}\n\t\tvar splitted_date\t= date.split(separator);\n\t\tif (splitted_date.length > 1) {\n\t\t\tsplitted_date.forEach(function (element, index, array) {\n\t\t\t\tarray[index]\t= parseDate($.trim(element), format, separator, locale);\n\t\t\t});\n\t\t\treturn splitted_date;\n\t\t}\n\t\tvar months_text\t= locale.monthsShort.join(')(') + ')(' + locale.months.join(')('),\n\t\t\tseparator\t= new RegExp('[^0-9a-zA-Z(' + months_text + ')]+'),\n\t\t\tparts\t\t= date.split(separator),\n\t\t\tagainst\t\t= format.split(separator),\n\t\t\td,\n\t\t\tm,\n\t\t\ty,\n\t\t\th,\n\t\t\tmin,\n\t\t\tnow = new Date();\n\t\tfor (var i = 0; i < parts.length; i++) {\n\t\t\tswitch (against[i]) {\n\t\t\t\tcase 'b':\n\t\t\t\t\tm = locale.monthsShort.indexOf(parts[i]);\n\t\t\t\tbreak;\n\t\t\t\tcase 'B':\n\t\t\t\t\tm = locale.months.indexOf(parts[i]);\n\t\t\t\tbreak;\n\t\t\t\tcase 'd':\n\t\t\t\tcase 'e':\n\t\t\t\t\td = parseInt(parts[i],10);\n\t\t\t\tbreak;\n\t\t\t\tcase 'm':\n\t\t\t\t\tm = parseInt(parts[i], 10)-1;\n\t\t\t\tbreak;\n\t\t\t\tcase 'Y':\n\t\t\t\tcase 'y':\n\t\t\t\t\ty = parseInt(parts[i], 10);\n\t\t\t\t\ty += y > 100 ? 0 : (y < 29 ? 2000 : 1900);\n\t\t\t\tbreak;\n\t\t\t\tcase 'H':\n\t\t\t\tcase 'I':\n\t\t\t\tcase 'k':\n\t\t\t\tcase 'l':\n\t\t\t\t\th = parseInt(parts[i], 10);\n\t\t\t\tbreak;\n\t\t\t\tcase 'P':\n\t\t\t\tcase 'p':\n\t\t\t\t\tif (/pm/i.test(parts[i]) && h < 12) {\n\t\t\t\t\t\th += 12;\n\t\t\t\t\t} else if (/am/i.test(parts[i]) && h >= 12) {\n\t\t\t\t\t\th -= 12;\n\t\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t\tcase 'M':\n\t\t\t\t\tmin = parseInt(parts[i], 10);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar parsed_date = new Date(\n\t\t\ty === undefined ? now.getFullYear() : y,\n\t\t\tm === undefined ? now.getMonth() : m,\n\t\t\td === undefined ? now.getDate() : d,\n\t\t\th === undefined ? now.getHours() : h,\n\t\t\tmin === undefined ? now.getMinutes() : min,\n\t\t\t0\n\t\t);\n\t\tif (isNaN(parsed_date * 1)) {\n\t\t\tparsed_date = new Date;\n\t\t}\n\t\treturn parsed_date;\n\t}\n\tfunction formatDate (date, format, locale) {\n\t\tvar m = date.getMonth();\n\t\tvar d = date.getDate();\n\t\tvar y = date.getFullYear();\n\t\tvar w = date.getDay();\n\t\tvar s = {};\n\t\tvar hr = date.getHours();\n\t\tvar pm = (hr >= 12);\n\t\tvar ir = (pm) ? (hr - 12) : hr;\n\t\tvar dy = date.getDayOfYear();\n\t\tif (ir == 0) {\n\t\t\tir = 12;\n\t\t}\n\t\tvar min = date.getMinutes();\n\t\tvar sec = date.getSeconds();\n\t\tvar parts = format.split(''), part;\n\t\tfor (var i = 0; i < parts.length; i++) {\n\t\t\tpart = parts[i];\n\t\t\tswitch (part) {\n\t\t\t\tcase 'a':\n\t\t\t\t\tpart = locale.daysShort[w];\n\t\t\t\tbreak;\n\t\t\t\tcase 'A':\n\t\t\t\t\tpart = locale.days[w];\n\t\t\t\tbreak;\n\t\t\t\tcase 'b':\n\t\t\t\t\tpart = locale.monthsShort[m];\n\t\t\t\tbreak;\n\t\t\t\tcase 'B':\n\t\t\t\t\tpart = locale.months[m];\n\t\t\t\tbreak;\n\t\t\t\tcase 'C':\n\t\t\t\t\tpart = 1 + Math.floor(y / 100);\n\t\t\t\tbreak;\n\t\t\t\tcase 'd':\n\t\t\t\t\tpart = (d < 10) ? (\"0\" + d) : d;\n\t\t\t\tbreak;\n\t\t\t\tcase 'e':\n\t\t\t\t\tpart = d;\n\t\t\t\tbreak;\n\t\t\t\tcase 'H':\n\t\t\t\t\tpart = (hr < 10) ? (\"0\" + hr) : hr;\n\t\t\t\tbreak;\n\t\t\t\tcase 'I':\n\t\t\t\t\tpart = (ir < 10) ? (\"0\" + ir) : ir;\n\t\t\t\tbreak;\n\t\t\t\tcase 'j':\n\t\t\t\t\tpart = (dy < 100) ? ((dy < 10) ? (\"00\" + dy) : (\"0\" + dy)) : dy;\n\t\t\t\tbreak;\n\t\t\t\tcase 'k':\n\t\t\t\t\tpart = hr;\n\t\t\t\tbreak;\n\t\t\t\tcase 'l':\n\t\t\t\t\tpart = ir;\n\t\t\t\tbreak;\n\t\t\t\tcase 'm':\n\t\t\t\t\tpart = (m < 9) ? (\"0\" + (1+m)) : (1+m);\n\t\t\t\tbreak;\n\t\t\t\tcase 'M':\n\t\t\t\t\tpart = (min < 10) ? (\"0\" + min) : min;\n\t\t\t\tbreak;\n\t\t\t\tcase 'p':\n\t\t\t\tcase 'P':\n\t\t\t\t\tpart = pm ? \"PM\" : \"AM\";\n\t\t\t\tbreak;\n\t\t\t\tcase 's':\n\t\t\t\t\tpart = Math.floor(date.getTime() / 1000);\n\t\t\t\tbreak;\n\t\t\t\tcase 'S':\n\t\t\t\t\tpart = (sec < 10) ? (\"0\" + sec) : sec;\n\t\t\t\tbreak;\n\t\t\t\tcase 'u':\n\t\t\t\t\tpart = w + 1;\n\t\t\t\tbreak;\n\t\t\t\tcase 'w':\n\t\t\t\t\tpart = w;\n\t\t\t\tbreak;\n\t\t\t\tcase 'y':\n\t\t\t\t\tpart = ('' + y).substr(2, 2);\n\t\t\t\tbreak;\n\t\t\t\tcase 'Y':\n\t\t\t\t\tpart = y;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tparts[i] = part;\n\t\t}\n\t\treturn parts.join('');\n\t}\n\tfunction update_date () {\n\t\tvar\t$this\t\t\t= $(this),\n\t\t\toptions\t\t\t= $this.data('pickmeup-options'),\n\t\t\tcurrent_date\t= options.current,\n\t\t\tnew_value;\n\t\tswitch (options.mode) {\n\t\t\tcase 'multiple':\n\t\t\t\tnew_value = current_date.setHours(0,0,0,0).valueOf();\n\t\t\t\tif ($.inArray(new_value, options.date) !== -1) {\n\t\t\t\t\t$.each(options.date, function (index, value){\n\t\t\t\t\t\tif (value == new_value) {\n\t\t\t\t\t\t\toptions.date.splice(index,1);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toptions.date.push(new_value);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'range':\n\t\t\t\tif (!options.lastSel) {\n\t\t\t\t\toptions.date[0]\t= current_date.setHours(0,0,0,0).valueOf();\n\t\t\t\t}\n\t\t\t\tnew_value\t= current_date.setHours(0,0,0,0).valueOf();\n\t\t\t\tif (new_value <= options.date[0]) {\n\t\t\t\t\toptions.date[1]\t= options.date[0];\n\t\t\t\t\toptions.date[0]\t= new_value;\n\t\t\t\t} else {\n\t\t\t\t\toptions.date[1]\t= new_value;\n\t\t\t\t}\n\t\t\t\toptions.lastSel\t= !options.lastSel;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\toptions.date\t= current_date.valueOf();\n\t\t\t\tbreak;\n\t\t}\n\t\tvar prepared_date\t= prepareDate(options);\n\t\tif ($this.is('input')) {\n\t\t\t$this.val(options.mode == 'single' ? prepared_date[0] : prepared_date[0].join(options.separator));\n\t\t}\n\t\toptions.change.apply(this, prepared_date);\n\t\tif (\n\t\t\toptions.hide_on_select &&\n\t\t\t(\n\t\t\t\toptions.mode != 'range' ||\n\t\t\t\t!options.lastSel\n\t\t\t)\n\t\t) {\n\t\t\toptions.binded.hide();\n\t\t\treturn false;\n\t\t}\n\t}\n\tfunction click (e) {\n\t\tvar el\t= $(e.target);\n\t\tif (!el.hasClass('pmu-button')) {\n\t\t\tel\t= el.closest('.pmu-button');\n\t\t}\n\t\tif (el.length) {\n\t\t\tif (el.hasClass('pmu-disabled')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tvar\t$this\t\t\t= $(this),\n\t\t\t\toptions\t\t\t= $this.data('pickmeup-options'),\n\t\t\t\tinstance\t\t= el.parents('.pmu-instance').eq(0),\n\t\t\t\troot\t\t\t= instance.parent(),\n\t\t\t\tinstance_index\t= $('.pmu-instance', root).index(instance);\n\t\t\tif (el.parent().is('nav')) {\n\t\t\t\tif (el.hasClass('pmu-month')) {\n\t\t\t\t\toptions.current.addMonths(instance_index - Math.floor(options.calendars / 2));\n\t\t\t\t\tif (root.hasClass('pmu-view-years')) {\n\t\t\t\t\t\t// Shift back to current date, otherwise with min value specified may jump on few (tens) years forward\n\t\t\t\t\t\tif (options.mode != 'single') {\n\t\t\t\t\t\t\toptions.current\t= new Date(options.date[options.date.length - 1]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\toptions.current\t= new Date(options.date);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (options.select_day) {\n\t\t\t\t\t\t\troot.removeClass('pmu-view-years').addClass('pmu-view-days');\n\t\t\t\t\t\t} else if (options.select_month) {\n\t\t\t\t\t\t\troot.removeClass('pmu-view-years').addClass('pmu-view-months');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (root.hasClass('pmu-view-months')) {\n\t\t\t\t\t\tif (options.select_year) {\n\t\t\t\t\t\t\troot.removeClass('pmu-view-months').addClass('pmu-view-years');\n\t\t\t\t\t\t} else if (options.select_day) {\n\t\t\t\t\t\t\troot.removeClass('pmu-view-months').addClass('pmu-view-days');\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (root.hasClass('pmu-view-days')) {\n\t\t\t\t\t\tif (options.select_month) {\n\t\t\t\t\t\t\troot.removeClass('pmu-view-days').addClass('pmu-view-months');\n\t\t\t\t\t\t} else if (options.select_year) {\n\t\t\t\t\t\t\troot.removeClass('pmu-view-days').addClass('pmu-view-years');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (el.hasClass('pmu-prev')) {\n\t\t\t\t\t\toptions.binded.prev(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions.binded.next(false);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (!el.hasClass('pmu-disabled')) {\n\t\t\t\tif (root.hasClass('pmu-view-years')) {\n\t\t\t\t\toptions.current.setFullYear(parseInt(el.text(), 10));\n\t\t\t\t\tif (options.select_month) {\n\t\t\t\t\t\troot.removeClass('pmu-view-years').addClass('pmu-view-months');\n\t\t\t\t\t} else if (options.select_day) {\n\t\t\t\t\t\troot.removeClass('pmu-view-years').addClass('pmu-view-days');\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions.binded.update_date();\n\t\t\t\t\t}\n\t\t\t\t} else if (root.hasClass('pmu-view-months')) {\n\t\t\t\t\toptions.current.setMonth(instance.find('.pmu-months .pmu-button').index(el));\n\t\t\t\t\toptions.current.setFullYear(parseInt(instance.find('.pmu-month').text(), 10));\n\t\t\t\t\tif (options.select_day) {\n\t\t\t\t\t\troot.removeClass('pmu-view-months').addClass('pmu-view-days');\n\t\t\t\t\t} else {\n\t\t\t\t\t\toptions.binded.update_date();\n\t\t\t\t\t}\n\t\t\t\t\t// Move current month to the first place\n\t\t\t\t\toptions.current.addMonths(Math.floor(options.calendars / 2) - instance_index);\n\t\t\t\t} else {\n\t\t\t\t\tvar val\t= parseInt(el.text(), 10);\n\t\t\t\t\toptions.current.addMonths(instance_index - Math.floor(options.calendars / 2));\n\t\t\t\t\tif (el.hasClass('pmu-not-in-month')) {\n\t\t\t\t\t\toptions.current.addMonths(val > 15 ? -1 : 1);\n\t\t\t\t\t}\n\t\t\t\t\toptions.current.setDate(val);\n\t\t\t\t\toptions.binded.update_date();\n\t\t\t\t}\n\t\t\t}\n\t\t\toptions.binded.fill();\n\t\t}\n\t\treturn false;\n\t}\n\tfunction prepareDate (options) {\n\t\tvar result;\n\t\tif (options.mode == 'single') {\n\t\t\tresult = new Date(options.date);\n\t\t\treturn [formatDate(result, options.format, options.locale), result];\n\t\t} else {\n\t\t\tresult = [[],[]];\n\t\t\t$.each(options.date, function(nr, val){\n\t\t\t\tvar date = new Date(val);\n\t\t\t\tresult[0].push(formatDate(date, options.format, options.locale));\n\t\t\t\tresult[1].push(date);\n\t\t\t});\n\t\t\treturn result;\n\t\t}\n\t}\n\tfunction show (force) {\n\t\tvar pickmeup\t= this.pickmeup;\n\t\tif (force || !pickmeup.is(':visible')) {\n\t\t\tvar $this\t\t= $(this),\n\t\t\t\toptions\t\t= $this.data('pickmeup-options'),\n\t\t\t\tpos\t\t\t= $this.offset(),\n\t\t\t\tviewport\t= {\n\t\t\t\t\tl : document.documentElement.scrollLeft,\n\t\t\t\t\tt : document.documentElement.scrollTop,\n\t\t\t\t\tw : document.documentElement.clientWidth,\n\t\t\t\t\th : document.documentElement.clientHeight\n\t\t\t\t},\n\t\t\t\ttop\t\t\t= pos.top,\n\t\t\t\tleft\t\t= pos.left;\n\t\t\toptions.binded.fill();\n\t\t\tif ($this.is('input')) {\n\t\t\t\t$this\n\t\t\t\t\t.pickmeup('set_date', parseDate($this.val(), options.format, options.separator, options.locale))\n\t\t\t\t\t.keydown(function (e) {\n\t\t\t\t\t\tif (e.which == 9) {\n\t\t\t\t\t\t\t$this.pickmeup('hide');\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t\toptions.before_show();\n\t\t\tswitch (options.position){\n\t\t\t\tcase 'top':\n\t\t\t\t\ttop -= pickmeup.outerHeight();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'left':\n\t\t\t\t\tleft -= pickmeup.outerWidth();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'right':\n\t\t\t\t\tleft += this.offsetWidth;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'bottom':\n\t\t\t\t\ttop += this.offsetHeight;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (top + pickmeup.offsetHeight > viewport.t + viewport.h) {\n\t\t\t\ttop = pos.top  - pickmeup.offsetHeight;\n\t\t\t}\n\t\t\tif (top < viewport.t) {\n\t\t\t\ttop = pos.top + this.offsetHeight + pickmeup.offsetHeight;\n\t\t\t}\n\t\t\tif (left + pickmeup.offsetWidth > viewport.l + viewport.w) {\n\t\t\t\tleft = pos.left - pickmeup.offsetWidth;\n\t\t\t}\n\t\t\tif (left < viewport.l) {\n\t\t\t\tleft = pos.left + this.offsetWidth\n\t\t\t}\n\t\t\tif (options.show() == false) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpickmeup.css({\n\t\t\t\tdisplay\t: 'inline-block',\n\t\t\t\ttop\t\t: top + 'px',\n\t\t\t\tleft\t: left + 'px'\n\t\t\t});\n\t\t\t$(document)\n\t\t\t\t.on(\n\t\t\t\t\t'mousedown' + options.events_namespace,\n\t\t\t\t\toptions.binded.hide\n\t\t\t\t)\n\t\t\t\t.on(\n\t\t\t\t\t'resize' + options.events_namespace,\n\t\t\t\t\t[\n\t\t\t\t\t\ttrue\n\t\t\t\t\t],\n\t\t\t\t\toptions.binded.forced_show\n\t\t\t\t);\n\t\t}\n\t}\n\tfunction forced_show () {\n\t\tshow.call(this, true);\n\t}\n\tfunction hide (e) {\n\t\tif (\n\t\t\t!e ||\n\t\t\t!e.target ||\t\t\t\t\t\t\t\t\t\t\t\t\t\t//Called directly\n\t\t\t(\n\t\t\t\te.target != this &&\t\t\t\t\t\t\t\t\t\t\t\t//Clicked not on element itself\n\t\t\t\t!(this.pickmeup.get(0).compareDocumentPosition(e.target) & 16)\t//And not o its children\n\t\t\t)\n\t\t) {\n\t\t\tvar pickmeup\t= this.pickmeup,\n\t\t\t\toptions\t\t= $(this).data('pickmeup-options');\n\t\t\tif (options.hide() != false) {\n\t\t\t\tpickmeup.hide();\n\t\t\t\t$(document)\n\t\t\t\t\t.off('mousedown', options.binded.hide)\n\t\t\t\t\t.off('resize', options.binded.forced_show);\n\t\t\t\toptions.date[1]\t= options.date[0];\n\t\t\t\toptions.lastSel\t= false;\n\t\t\t}\n\t\t}\n\t}\n\tfunction update () {\n\t\tvar\toptions\t= $(this).data('pickmeup-options');\n\t\t$(document)\n\t\t\t.off('mousedown', options.binded.hide)\n\t\t\t.off('resize', options.binded.forced_show);\n\t\toptions.binded.forced_show();\n\t}\n\tfunction clear () {\n\t\tvar options = $(this).data('pickmeup-options');\n\t\tif (options.mode != 'single') {\n\t\t\toptions.date\t= [];\n\t\t\toptions.lastSel\t= false;\n\t\t\toptions.binded.fill();\n\t\t}\n\t}\n\tfunction prev (fill) {\n\t\tif (typeof fill == 'undefined') {\n\t\t\tfill = true;\n\t\t}\n\t\tvar root\t= this.pickmeup;\n\t\tvar options\t= $(this).data('pickmeup-options');\n\t\tif (root.hasClass('pmu-view-years')) {\n\t\t\toptions.current.addYears(-12);\n\t\t} else if (root.hasClass('pmu-view-months')) {\n\t\t\toptions.current.addYears(-1);\n\t\t} else if (root.hasClass('pmu-view-days')) {\n\t\t\toptions.current.addMonths(-1);\n\t\t}\n\t\tif (fill) {\n\t\t\toptions.binded.fill();\n\t\t}\n\t}\n\tfunction next (fill) {\n\t\tif (typeof fill == 'undefined') {\n\t\t\tfill = true;\n\t\t}\n\t\tvar root\t= this.pickmeup;\n\t\tvar options\t= $(this).data('pickmeup-options');\n\t\tif (root.hasClass('pmu-view-years')) {\n\t\t\toptions.current.addYears(12);\n\t\t} else if (root.hasClass('pmu-view-months')) {\n\t\t\toptions.current.addYears(1);\n\t\t} else if (root.hasClass('pmu-view-days')) {\n\t\t\toptions.current.addMonths(1);\n\t\t}\n\t\tif (fill) {\n\t\t\toptions.binded.fill();\n\t\t}\n\t}\n\tfunction get_date (formatted) {\n\t\tvar options\t\t\t= $(this).data('pickmeup-options'),\n\t\t\tprepared_date\t= prepareDate(options);\n\t\tif (typeof formatted === 'string') {\n\t\t\tvar date = prepared_date[1];\n\t\t\tif (date.constructor == Date) {\n\t\t\t\treturn formatDate(date, formatted, options.locale)\n\t\t\t} else {\n\t\t\t\treturn date.map(function (value) {\n\t\t\t\t\treturn formatDate(value, formatted, options.locale);\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\treturn prepared_date[formatted ? 0 : 1];\n\t\t}\n\t}\n\tfunction set_date (date) {\n\t\tvar options = $(this).data('pickmeup-options');\n\t\toptions.date = date;\n\t\tif (typeof options.date === 'string') {\n\t\t\toptions.date = parseDate(options.date, options.format, options.separator, options.locale).setHours(0,0,0,0);\n\t\t} else if (options.date.constructor == Date) {\n\t\t\toptions.date.setHours(0,0,0,0);\n\t\t}\n\t\tif (!options.date) {\n\t\t\toptions.date = new Date;\n\t\t\toptions.date.setHours(0,0,0,0);\n\t\t}\n\t\tif (options.mode != 'single') {\n\t\t\tif (options.date.constructor != Array) {\n\t\t\t\toptions.date = [options.date.valueOf()];\n\t\t\t\tif (options.mode == 'range' && options.default_date ) {\n\t\t\t\t\toptions.date.push(((new Date(options.date[0])).setHours(0,0,0,0)).valueOf());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (var i = 0; i < options.date.length; i++) {\n\t\t\t\t\toptions.date[i] = (parseDate(options.date[i], options.format, options.separator, options.locale).setHours(0,0,0,0)).valueOf();\n\t\t\t\t}\n\t\t\t\tif (options.mode == 'range') {\n\t\t\t\t\toptions.date[1] = ((new Date(options.date[1])).setHours(0,0,0,0)).valueOf();\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\toptions.date = options.date.constructor == Array ? options.date[0].valueOf() : options.date.valueOf();\n\t\t}\n\t\toptions.current = new Date (options.mode != 'single' ? options.date[0] : options.date);\n\t\toptions.binded.fill();\n\t}\n\tfunction destroy () {\n\t\tvar\t$this\t= $(this),\n\t\t\toptions\t= $this.data('pickmeup-options');\n\t\t$this.removeData('pickmeup-options');\n\t\t$this.off(options.events_namespace);\n\t\t$(document).off(options.events_namespace);\n\t\t$(this.pickmeup).remove();\n\t}\n\t$.fn.pickmeup\t= function (initial_options) {\n\t\tif (typeof initial_options === 'string') {\n\t\t\tvar data,\n\t\t\t\tparameters\t= Array.prototype.slice.call(arguments, 1);\n\t\t\tswitch (initial_options) {\n\t\t\t\tcase 'hide':\n\t\t\t\tcase 'show':\n\t\t\t\tcase 'clear':\n\t\t\t\tcase 'update':\n\t\t\t\tcase 'prev':\n\t\t\t\tcase 'next':\n\t\t\t\tcase 'destroy':\n\t\t\t\t\tthis.each(function () {\n\t\t\t\t\t\tdata\t= $(this).data('pickmeup-options');\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tdata.binded[initial_options]();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t\tcase 'get_date':\n\t\t\t\t\tdata\t= this.data('pickmeup-options');\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\treturn data.binded.get_date(parameters[0]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t\tcase 'set_date':\n\t\t\t\t\tthis.each(function () {\n\t\t\t\t\t\tdata\t= $(this).data('pickmeup-options');\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tdata.binded[initial_options].apply(this, parameters);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t}\n\t\t\treturn this;\n\t\t}\n\t\treturn this.each(function () {\n\t\t\tvar\t$this\t\t\t= $(this);\n\t\t\tif ($this.data('pickmeup-options')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar i,\n\t\t\t\toption,\n\t\t\t\toptions\t= $.extend({}, $.pickmeup, initial_options || {});\n\t\t\tfor (i in options) {\n\t\t\t\toption\t= $this.data('pmu-' + i);\n\t\t\t\tif (typeof option !== 'undefined') {\n\t\t\t\t\toptions[i]\t= option;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// 4 conditional statements in order to account all cases\n\t\t\tif (options.view == 'days' && !options.select_day) {\n\t\t\t\toptions.view\t= 'months';\n\t\t\t}\n\t\t\tif (options.view == 'months' && !options.select_month) {\n\t\t\t\toptions.view\t= 'years';\n\t\t\t}\n\t\t\tif (options.view == 'years' && !options.select_year) {\n\t\t\t\toptions.view\t= 'days';\n\t\t\t}\n\t\t\tif (options.view == 'days' && !options.select_day) {\n\t\t\t\toptions.view\t= 'months';\n\t\t\t}\n\t\t\toptions.calendars\t= Math.max(1, parseInt(options.calendars, 10) || 1);\n\t\t\toptions.mode\t\t= /single|multiple|range/.test(options.mode) ? options.mode : 'single';\n\t\t\tif (typeof options.min === 'string') {\n\t\t\t\toptions.min = parseDate(options.min, options.format, options.separator, options.locale).setHours(0,0,0,0);\n\t\t\t} else if (options.min && options.min.constructor == Date) {\n\t\t\t\toptions.min.setHours(0,0,0,0);\n\t\t\t}\n\t\t\tif (typeof options.max === 'string') {\n\t\t\t\toptions.max = parseDate(options.max, options.format, options.separator, options.locale).setHours(0,0,0,0);\n\t\t\t} else if (options.max && options.max.constructor == Date) {\n\t\t\t\toptions.max.setHours(0,0,0,0);\n\t\t\t}\n\t\t\tif (!options.select_day) {\n\t\t\t\tif (options.min) {\n\t\t\t\t\toptions.min\t= new Date(options.min);\n\t\t\t\t\toptions.min\t= options.min.valueOf();\n\t\t\t\t}\n\t\t\t\tif (options.max) {\n\t\t\t\t\toptions.max\t= new Date(options.max);\n\t\t\t\t\toptions.max\t= options.max.valueOf();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (typeof options.date === 'string') {\n\t\t\t\toptions.date = parseDate(options.date, options.format, options.separator, options.locale).setHours(0,0,0,0);\n\t\t\t} else if (options.date.constructor == Date) {\n\t\t\t\toptions.date.setHours(0,0,0,0);\n\t\t\t}\n\t\t\tif (!options.date) {\n\t\t\t\toptions.date = new Date;\n\t\t\t\toptions.date.setHours(0,0,0,0);\n\t\t\t}\n\t\t\tif (options.mode != 'single') {\n\t\t\t\tif (options.date.constructor != Array) {\n\t\t\t\t\toptions.date = [options.date.valueOf()];\n\t\t\t\t\tif (options.mode == 'range' && options.default_date) {\n\t\t\t\t\t\toptions.date.push(((new Date(options.date[0])).setHours(0,0,0,0)).valueOf());\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor (i = 0; i < options.date.length; i++) {\n\t\t\t\t\t\toptions.date[i] = (parseDate(options.date[i], options.format, options.separator, options.locale).setHours(0,0,0,0)).valueOf();\n\t\t\t\t\t}\n\t\t\t\t\tif (options.mode == 'range') {\n\t\t\t\t\t\toptions.date[1] = ((new Date(options.date[1])).setHours(0,0,0,0)).valueOf();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\toptions.current\t= new Date(options.date[0]);\n\t\t\t\t// Set days to 1 in order to handle them consistently\n\t\t\t\tif (!options.select_day) {\n\t\t\t\t\tfor (i = 0; i < options.date.length; ++i) {\n\t\t\t\t\t\toptions.date[i]\t= new Date(options.date[i]);\n\t\t\t\t\t\toptions.date[i].setDate(1);\n\t\t\t\t\t\toptions.date[i]\t= options.date[i].valueOf();\n\t\t\t\t\t\t// Remove duplicates\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\toptions.mode != 'range' &&\n\t\t\t\t\t\t\toptions.date.indexOf(options.date[i]) !== i\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tdelete options.date.splice(i, 1);\n\t\t\t\t\t\t\t--i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toptions.date\t= options.date.valueOf();\n\t\t\t\toptions.current\t= new Date(options.date);\n\t\t\t\tif (!options.select_day) {\n\t\t\t\t\toptions.date\t= new Date(options.date);\n\t\t\t\t\toptions.date.setDate(1);\n\t\t\t\t\toptions.date\t= options.date.valueOf();\n\t\t\t\t}\n\t\t\t}\n\t\t\toptions.current.setDate(1);\n\t\t\toptions.current.setHours(0,0,0,0);\n\t\t\tvar cnt,\n\t\t\t\tpickmeup = $(tpl.wrapper);\n\t\t\tthis.pickmeup\t= pickmeup;\n\t\t\tif (options.class_name) {\n\t\t\t\tpickmeup.addClass(options.class_name);\n\t\t\t}\n\t\t\tvar html = '';\n\t\t\tfor (i = 0; i < options.calendars; i++) {\n\t\t\t\tcnt\t\t= options.first_day;\n\t\t\t\thtml\t+= tpl.head({\n\t\t\t\t\tprev\t: options.prev,\n\t\t\t\t\tnext\t: options.next,\n\t\t\t\t\tday\t\t: [\n\t\t\t\t\t\toptions.locale.daysMin[(cnt++) % 7],\n\t\t\t\t\t\toptions.locale.daysMin[(cnt++) % 7],\n\t\t\t\t\t\toptions.locale.daysMin[(cnt++) % 7],\n\t\t\t\t\t\toptions.locale.daysMin[(cnt++) % 7],\n\t\t\t\t\t\toptions.locale.daysMin[(cnt++) % 7],\n\t\t\t\t\t\toptions.locale.daysMin[(cnt++) % 7],\n\t\t\t\t\t\toptions.locale.daysMin[(cnt++) % 7]\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t\t$this.data('pickmeup-options', options);\n\t\t\tfor (i in options) {\n\t\t\t\tif (['render', 'change', 'before_show', 'show', 'hide'].indexOf(i) != -1) {\n\t\t\t\t\toptions[i]\t= options[i].bind(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\toptions.binded\t= {\n\t\t\t\tfill\t\t: fill.bind(this),\n\t\t\t\tupdate_date\t: update_date.bind(this),\n\t\t\t\tclick\t\t: click.bind(this),\n\t\t\t\tshow\t\t: show.bind(this),\n\t\t\t\tforced_show\t: forced_show.bind(this),\n\t\t\t\thide\t\t: hide.bind(this),\n\t\t\t\tupdate\t\t: update.bind(this),\n\t\t\t\tclear\t\t: clear.bind(this),\n\t\t\t\tprev\t\t: prev.bind(this),\n\t\t\t\tnext\t\t: next.bind(this),\n\t\t\t\tget_date\t: get_date.bind(this),\n\t\t\t\tset_date\t: set_date.bind(this),\n\t\t\t\tdestroy\t\t: destroy.bind(this)\n\t\t\t};\n\t\t\toptions.events_namespace\t= '.pickmeup-' + (++instances_count);\n\t\t\tpickmeup\n\t\t\t\t.on('click touchstart', options.binded.click)\n\t\t\t\t.addClass(views[options.view])\n\t\t\t\t.append(html)\n\t\t\t\t.on(\n\t\t\t\t\t$.support.selectstart ? 'selectstart' : 'mousedown',\n\t\t\t\t\tfunction(e){\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\toptions.binded.fill();\n\t\t\tif (options.flat) {\n\t\t\t\tpickmeup.appendTo(this).css({\n\t\t\t\t\tposition\t: 'relative',\n\t\t\t\t\tdisplay\t\t: 'inline-block'\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tpickmeup.appendTo(document.body);\n\t\t\t\t// Multiple events support\n\t\t\t\tvar trigger_event\t= options.trigger_event.split(' ');\n\t\t\t\tfor (i = 0; i < trigger_event.length; ++i) {\n\t\t\t\t\ttrigger_event[i]\t+= options.events_namespace;\n\t\t\t\t}\n\t\t\t\ttrigger_event\t= trigger_event.join(' ');\n\t\t\t\t$this.on(trigger_event, options.binded.show);\n\t\t\t}\n\t\t});\n\t};\n})(jQuery);\n"},146:function(e,t){e.exports='/*\n\nIMPORTANT: Do not edit this file directly. Apply your patch upstream at https://github.com/iamcal/lib_timezones\nSee: https://slack-github.com/slack/docs/blob/master/appeng/howto_time_zones.md\n\n*/\n\n"use strict";\n\nwindow.timezones_list = function(){\n\tvar tz = new TimezoneDetector();\n\treturn tz.getList();\n}\n\nwindow.timezones_guess = function(){\n\tvar tz = new TimezoneDetector();\n\tvar opts = {};\n\tif (arguments.length > 0) opts.default = arguments[0];\n\tvar ret = tz.detect(opts);\n\treturn ret.zoneId;\n}\n\n;(function() {\n\n\tvar root = this;\n\tvar previous_detector = root.TimezoneDetector;\n\n\tvar tz = function(){\n\n\t\tvar self = this;\n\n\t\tself.getList = function(){\n\n\t\t\treturn _list;\n\t\t}\n\n\t\tself.detect = function(opts){\n\n\t\t\tvar out = {\n\t\t\t\t\'zoneId\' : \'America/Los_Angeles\',\n\t\t\t\t\'method\' : \'gave_up\',\n\t\t\t};\n\n\t\t\tif (opts && opts.default){\n\t\t\t\tout.zoneId = opts.default;\n\t\t\t\tout.method = \'default\';\n\t\t\t}\n\n\n\t\t\tout.intl = _try_using_api();\n\t\t\tvar api_guess = out.intl.zoneId;\n\n\t\t\tif (api_guess){\n\t\t\t\t// is this one of our choices?\n\t\t\t\tfor (var i=0; i<_list.length; i++){\n\t\t\t\t\tif (_list[i][1] == api_guess){\n\t\t\t\t\t\tout.zoneId = api_guess;\n\t\t\t\t\t\tout.method = \'intlapi_exact\';\n\t\t\t\t\t\treturn out;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t// does it map to a manual equivalent?\n\t\t\t\tif (_manual_alts[api_guess]){\n\t\t\t\t\tout.zoneId = _manual_alts[api_guess];\n\t\t\t\t\tout.method = \'intl_api_manual\';\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t\t// does it map to an automatic equivalent?\n\t\t\t\tif (_auto_alts[api_guess]){\n\t\t\t\t\tout.zoneId = _auto_alts[api_guess];\n\t\t\t\t\tout.method = \'intl_api_equivalent\';\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t\t// does it map to a fallback equivalent?\n\t\t\t\tif (_fallback_alts[api_guess]){\n\t\t\t\t\tout.zoneId = _fallback_alts[api_guess];\n\t\t\t\t\tout.method = \'intl_api_fallback\';\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// use auto-detection via probe dates\n\t\t\tout.probe = _try_using_probe();\n\n\t\t\tif (out.probe.zoneId){\n\t\t\t\tout.zoneId = out.probe.zoneId;\n\t\t\t\tout.method = \'date_probe\';\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\t//console.log(\'no match for TZ on key \'+key);\n\n\t\t\treturn out;\n\t\t}\n\n\t\tvar _try_using_api = function(){\n\n\t\t\tvar out = {\n\t\t\t\t\'zoneId\'\t: null,\n\t\t\t\t\'hasIntl\'\t: false,\n\t\t\t\t\'hasDateTime\'\t: false,\n\t\t\t\t\'hasOptions\'\t: false,\n\t\t\t};\n\n\t\t\ttry {\n\t\t\t\tif (typeof Intl === "undefined") return out;\n\n\t\t\t\tout.hasIntl = true;\n\n\t\t\t\tif (typeof Intl.DateTimeFormat === "undefined") return out;\n\t\t\t\tvar format = Intl.DateTimeFormat();\n\t\t\t\tif (typeof format === "undefined") return out;\n\n\t\t\t\tout.hasDateTime = true;\n\n\t\t\t\tif (typeof format.resolvedOptions === "undefined") return out;\n\n\t\t\t\tout.hasOptions = true;\n\t\t\t\tout.zoneId = format.resolvedOptions().timeZone;\n\n\t\t\t}catch (e){\n\t\t\t\treturn out;\n\t\t\t}\n\n\t\t\treturn out;\n\t\t};\n\n\t\tvar _try_using_probe = function(){\n\n\t\t\tvar key_parts = [];\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2008, 10, 27, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2010, 4, 30, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2001, 10, 28, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2002, 4, 7, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2004, 10, 3, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2011, 11, 7, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2012, 11, 10, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2015, 9, 22, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2015, 11, 2, 0, 0, 0, 0)).getTimezoneOffset());\n\t\t\tkey_parts.push(-1 * new Date(Date.UTC(2016, 3, 27, 0, 0, 0, 0)).getTimezoneOffset());\n\n\n\t\t\tfor (var i=1; i<=key_parts.length; i++){\n\n\t\t\t\tvar key = key_parts.slice(0,i).join(\':\');\n\t\t\t\tif (_map[key]){\n\t\t\t\t\treturn {\n\t\t\t\t\t\t\'zoneId\'\t: _map[key],\n\t\t\t\t\t\t\'probeKey\'\t: key,\n\t\t\t\t\t\t\'fullKey\'\t: key_parts.join(\':\')\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\t\'zoneId\'\t: null,\n\t\t\t\t\'fullKey\'\t: key_parts.join(\':\')\n\t\t\t};\n\t\t}\n\n\n\t\tvar _map = {\n\t\t\t\'-660:-660:-660:-660:-660:-660\':\t\'Pacific/Midway\',\n\t\t\t\'-540\':\t\'America/Adak\',\n\t\t\t\'-600\':\t\'Pacific/Honolulu\',\n\t\t\t\'-570\':\t\'Pacific/Marquesas\',\n\t\t\t\'-480:-480\':\t\'America/Anchorage\',\n\t\t\t\'-480:-420\':\t\'America/Tijuana\',\n\t\t\t\'-420:-420:-420:-480\':\t\'America/Los_Angeles\',\n\t\t\t\'-420:-420:-420:-420\':\t\'America/Phoenix\',\n\t\t\t\'-420:-360\':\t\'America/Chihuahua\',\n\t\t\t\'-360:-360:-360:-420\':\t\'America/Denver\',\n\t\t\t\'-360:-360:-360:-360\':\t\'America/Regina\',\n\t\t\t\'-300:-300:-300:-360\':\t\'America/Chicago\',\n\t\t\t\'-300:-360\':\t\'Pacific/Easter\',\n\t\t\t\'-360:-300:-360:-360:-300:-360:-360:-300:-360\':\t\'America/Mexico_City\',\n\t\t\t\'-300:-300:-300:-300:-300:-300:-300:-300\':\t\'America/Bogota\',\n\t\t\t\'-360:-300:-360:-360:-300:-360:-360:-300:-300\':\t\'America/Cancun\',\n\t\t\t\'-240:-240:-240:-300:-240:-300:-300:-240:-300\':\t\'America/New_York\',\n\t\t\t\'-300:-300:-300:-300:-300:-300:-300:-240\':\t\'America/Port-au-Prince\',\n\t\t\t\'-300:-240\':\t\'America/Havana\',\n\t\t\t\'-240:-240:-300\':\t\'America/Indiana/Indianapolis\',\n\t\t\t\'-180:-240:-180:-180\':\t\'America/Asuncion\',\n\t\t\t\'-180:-180:-180:-240\':\t\'America/Halifax\',\n\t\t\t\'-270\':\t\'America/Caracas\',\n\t\t\t\'-180:-240:-180:-240:-240:-180:-180:-240\':\t\'America/Cuiaba\',\n\t\t\t\'-240:-240:-240:-240\':\t\'America/Manaus\',\n\t\t\t\'-180:-240:-180:-240:-240:-180:-180:-180\':\t\'America/Santiago\',\n\t\t\t\'-240:-240:-240:-300:-240:-300:-300:-240:-240\':\t\'America/Grand_Turk\',\n\t\t\t\'-150\':\t\'America/St_Johns\',\n\t\t\t\'-180:-180:-120:-180:-180:-180\':\t\'America/Fortaleza\',\n\t\t\t\'-120:-180:-120\':\t\'America/Sao_Paulo\',\n\t\t\t\'-180:-180:-180:-180\':\t\'America/Cayenne\',\n\t\t\t\'-120:-180:-180:-180:-180\':\t\'America/Buenos_Aires\',\n\t\t\t\'-180:-120\':\t\'America/Godthab\',\n\t\t\t\'-120:-180:-180:-180:-120\':\t\'America/Montevideo\',\n\t\t\t\'-120:-120:-120\':\t\'America/Miquelon\',\n\t\t\t\'-180:-180:-120:-180:-180:-120\':\t\'America/Bahia\',\n\t\t\t\'-120:-120:-60\':\t\'America/Noronha\',\n\t\t\t\'-60:0\':\t\'Atlantic/Azores\',\n\t\t\t\'-60:-60\':\t\'Atlantic/Cape_Verde\',\n\t\t\t\'0:0:0:0:0:0:0:60\':\t\'Africa/Casablanca\',\n\t\t\t\'0:60\':\t\'Europe/London\',\n\t\t\t\'0:0:0:0:0:0:0:0\':\t\'Africa/Monrovia\',\n\t\t\t\'60:120\':\t\'Europe/Amsterdam\',\n\t\t\t\'60:60\':\t\'Africa/Algiers\',\n\t\t\t\'120:60\':\t\'Africa/Windhoek\',\n\t\t\t\'180:180:120:180:180\':\t\'Asia/Amman\',\n\t\t\t\'120:180:180\':\t\'Europe/Athens\',\n\t\t\t\'120:180:120:180:180:120:120:180:120\':\t\'Asia/Beirut\',\n\t\t\t\'120:180:120:120:120:120:120:120\':\t\'Africa/Cairo\',\n\t\t\t\'180:180:120:180:120\':\t\'Asia/Damascus\',\n\t\t\t\'120:180:120:120:120:120:120:180\':\t\'Asia/Gaza\',\n\t\t\t\'120:120:120:120:120:120:120\':\t\'Africa/Harare\',\n\t\t\t\'120:180:120:180:120\':\t\'Asia/Jerusalem\',\n\t\t\t\'120:180:120:180:180:180:180:120\':\t\'Europe/Kaliningrad\',\n\t\t\t\'120:120:120:120:120:120:60\':\t\'Africa/Tripoli\',\n\t\t\t\'180:180:180:240\':\t\'Asia/Baghdad\',\n\t\t\t\'120:180:120:180:180:120:120:180:180\':\t\'Asia/Istanbul\',\n\t\t\t\'180:180:180:180\':\t\'Asia/Kuwait\',\n\t\t\t\'120:180:120:180:180:180:180:180\':\t\'Europe/Minsk\',\n\t\t\t\'180:240:180:240:240:240:240:180:180:180\':\t\'Europe/Moscow\',\n\t\t\t\'210\':\t\'Asia/Tehran\',\n\t\t\t\'240:240:240:240\':\t\'Asia/Muscat\',\n\t\t\t\'180:240:180:240:240:240:240:180:180:240\':\t\'Europe/Astrakhan\',\n\t\t\t\'240:300:240:300:300:240:240:300\':\t\'Asia/Baku\',\n\t\t\t\'240:240:240:300:300\':\t\'Europe/Samara\',\n\t\t\t\'300:240\':\t\'Indian/Mauritius\',\n\t\t\t\'240:240:240:300:240\':\t\'Asia/Tbilisi\',\n\t\t\t\'240:300:240:300:300:240:240:240\':\t\'Asia/Yerevan\',\n\t\t\t\'270\':\t\'Asia/Kabul\',\n\t\t\t\'300:300\':\t\'Asia/Tashkent\',\n\t\t\t\'300:360\':\t\'Asia/Yekaterinburg\',\n\t\t\t\'360:300\':\t\'Asia/Karachi\',\n\t\t\t\'330:330:330\':\t\'Asia/Kolkata\',\n\t\t\t\'330:330:360\':\t\'Asia/Colombo\',\n\t\t\t\'345\':\t\'Asia/Katmandu\',\n\t\t\t\'360:360:360:420\':\t\'Asia/Almaty\',\n\t\t\t\'360:360:360:360\':\t\'Asia/Dhaka\',\n\t\t\t\'390\':\t\'Asia/Rangoon\',\n\t\t\t\'360:420:360:420:420:420:420:360:360:360\':\t\'Asia/Novosibirsk\',\n\t\t\t\'420:420:420:420\':\t\'Asia/Bangkok\',\n\t\t\t\'360:420:360:420:420:420:420:360:360:420\':\t\'Asia/Barnaul\',\n\t\t\t\'420:420:420:480\':\t\'Asia/Hovd\',\n\t\t\t\'420:480\':\t\'Asia/Krasnoyarsk\',\n\t\t\t\'360:420:420\':\t\'Asia/Tomsk\',\n\t\t\t\'480:480:480:480\':\t\'Asia/Chongqing\',\n\t\t\t\'480:540\':\t\'Asia/Irkutsk\',\n\t\t\t\'540:480\':\t\'Australia/Perth\',\n\t\t\t\'480:480:480:540\':\t\'Asia/Ulaanbaatar\',\n\t\t\t\'540:540:540:540:540:540:540:510\':\t\'Asia/Pyongyang\',\n\t\t\t\'585\':\t\'Australia/Eucla\',\n\t\t\t\'540:600:540:600:600:600:600:480\':\t\'Asia/Chita\',\n\t\t\t\'540:540:540:540:540:540:540:540\':\t\'Asia/Tokyo\',\n\t\t\t\'540:600:540:600:600:600:600:540\':\t\'Asia/Yakutsk\',\n\t\t\t\'630\':\t\'Australia/Adelaide\',\n\t\t\t\'570\':\t\'Australia/Darwin\',\n\t\t\t\'600:600:600:600:600:600:600:600\':\t\'Australia/Brisbane\',\n\t\t\t\'660:600:660:600:600\':\t\'Australia/Canberra\',\n\t\t\t\'660:600:660:600:660\':\t\'Australia/Hobart\',\n\t\t\t\'600:660:600:660:660:660:660:600:600:600\':\t\'Asia/Vladivostok\',\n\t\t\t\'660:630\':\t\'Australia/Lord_Howe\',\n\t\t\t\'600:600:600:600:600:600:600:660\':\t\'Pacific/Bougainville\',\n\t\t\t\'660:720:660:720:720:720:720:660\':\t\'Asia/Srednekolymsk\',\n\t\t\t\'660:720:660:720:720:720:720:600\':\t\'Asia/Magadan\',\n\t\t\t\'690\':\t\'Pacific/Norfolk\',\n\t\t\t\'600:660:600:660:660:660:660:600:600:660\':\t\'Asia/Sakhalin\',\n\t\t\t\'660:660\':\t\'Pacific/Guadalcanal\',\n\t\t\t\'720:720:720:780\':\t\'Asia/Anadyr\',\n\t\t\t\'780:720\':\t\'Pacific/Auckland\',\n\t\t\t\'720:720:720:720\':\t\'Pacific/Fiji\',\n\t\t\t\'825\':\t\'Pacific/Chatham\',\n\t\t\t\'780:780\':\t\'Pacific/Tongatapu\',\n\t\t\t\'-660:-660:-660:-660:-660:-600\':\t\'Pacific/Apia\',\n\t\t\t\'840\':\t\'Pacific/Kiritimati\'\n\t\t};\n\n\t\tvar _list = [\n\t\t\t["(UTC-11:00) Midway Island, American Samoa", \'Pacific/Midway\'],\n\t\t\t["(UTC-10:00) Aleutian Islands", \'America/Adak\'],\n\t\t\t["(UTC-10:00) Hawaii", \'Pacific/Honolulu\'],\n\t\t\t["(UTC-09:30) Marquesas Islands", \'Pacific/Marquesas\'],\n\t\t\t["(UTC-09:00) Alaska", \'America/Anchorage\'],\n\t\t\t["(UTC-08:00) Baja California", \'America/Tijuana\'],\n\t\t\t["(UTC-08:00) Pacific Time (US and Canada)", \'America/Los_Angeles\'],\n\t\t\t["(UTC-07:00) Arizona", \'America/Phoenix\'],\n\t\t\t["(UTC-07:00) Chihuahua, La Paz, Mazatlan", \'America/Chihuahua\'],\n\t\t\t["(UTC-07:00) Mountain Time (US and Canada)", \'America/Denver\'],\n\t\t\t["(UTC-06:00) Central America", \'America/Belize\'],\n\t\t\t["(UTC-06:00) Central Time (US and Canada)\t", \'America/Chicago\'],\n\t\t\t["(UTC-06:00) Easter Island", \'Pacific/Easter\'],\n\t\t\t["(UTC-06:00) Guadalajara, Mexico City, Monterrey", \'America/Mexico_City\'],\n\t\t\t["(UTC-06:00) Saskatchewan", \'America/Regina\'],\n\t\t\t["(UTC-05:00) Bogota, Lima, Quito", \'America/Bogota\'],\n\t\t\t["(UTC-05:00) Chetumal", \'America/Cancun\'],\n\t\t\t["(UTC-05:00) Eastern Time (US and Canada)", \'America/New_York\'],\n\t\t\t["(UTC-05:00) Haiti", \'America/Port-au-Prince\'],\n\t\t\t["(UTC-05:00) Havana", \'America/Havana\'],\n\t\t\t["(UTC-05:00) Indiana (East)", \'America/Indiana/Indianapolis\'],\n\t\t\t["(UTC-04:00) Asuncion", \'America/Asuncion\'],\n\t\t\t["(UTC-04:00) Atlantic Time (Canada)", \'America/Halifax\'],\n\t\t\t["(UTC-04:00) Caracas", \'America/Caracas\'],\n\t\t\t["(UTC-04:00) Cuiaba", \'America/Cuiaba\'],\n\t\t\t["(UTC-04:00) Georgetown, La Paz, Manaus, San Juan", \'America/Manaus\'],\n\t\t\t["(UTC-04:00) Santiago", \'America/Santiago\'],\n\t\t\t["(UTC-04:00) Turks and Caicos", \'America/Grand_Turk\'],\n\t\t\t["(UTC-03:30) Newfoundland", \'America/St_Johns\'],\n\t\t\t["(UTC-03:00) Araguaina", \'America/Fortaleza\'],\n\t\t\t["(UTC-03:00) Brasilia", \'America/Sao_Paulo\'],\n\t\t\t["(UTC-03:00) Cayenne, Fortaleza", \'America/Cayenne\'],\n\t\t\t["(UTC-03:00) City of Buenos Aires", \'America/Buenos_Aires\'],\n\t\t\t["(UTC-03:00) Greenland", \'America/Godthab\'],\n\t\t\t["(UTC-03:00) Montevideo", \'America/Montevideo\'],\n\t\t\t["(UTC-03:00) Saint Pierre and Miquelon", \'America/Miquelon\'],\n\t\t\t["(UTC-03:00) Salvador", \'America/Bahia\'],\n\t\t\t["(UTC-02:00) Fernando de Noronha", \'America/Noronha\'],\n\t\t\t["(UTC-01:00) Azores", \'Atlantic/Azores\'],\n\t\t\t["(UTC-01:00) Cabo Verde Islands", \'Atlantic/Cape_Verde\'],\n\t\t\t["(UTC) Casablanca", \'Africa/Casablanca\'],\n\t\t\t["(UTC) Dublin, Edinburgh, Lisbon, London", \'Europe/London\'],\n\t\t\t["(UTC) Monrovia, Reykjavik", \'Africa/Monrovia\'],\n\t\t\t["(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna", \'Europe/Amsterdam\'],\n\t\t\t["(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague", \'Europe/Belgrade\'],\n\t\t\t["(UTC+01:00) Brussels, Copenhagen, Madrid, Paris", \'Europe/Brussels\'],\n\t\t\t["(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb", \'Europe/Warsaw\'],\n\t\t\t["(UTC+01:00) West Central Africa", \'Africa/Algiers\'],\n\t\t\t["(UTC+01:00) Windhoek", \'Africa/Windhoek\'],\n\t\t\t["(UTC+02:00) Amman", \'Asia/Amman\'],\n\t\t\t["(UTC+02:00) Athens, Bucharest", \'Europe/Athens\'],\n\t\t\t["(UTC+02:00) Beirut", \'Asia/Beirut\'],\n\t\t\t["(UTC+02:00) Cairo", \'Africa/Cairo\'],\n\t\t\t["(UTC+02:00) Damascus", \'Asia/Damascus\'],\n\t\t\t["(UTC+02:00) Gaza, Hebron", \'Asia/Gaza\'],\n\t\t\t["(UTC+02:00) Harare, Pretoria", \'Africa/Harare\'],\n\t\t\t["(UTC+02:00) Helsinki, Kiev, Riga, Sofia, Tallinn, Vilnius", \'Europe/Helsinki\'],\n\t\t\t["(UTC+02:00) Jerusalem", \'Asia/Jerusalem\'],\n\t\t\t["(UTC+02:00) Kaliningrad", \'Europe/Kaliningrad\'],\n\t\t\t["(UTC+02:00) Tripoli", \'Africa/Tripoli\'],\n\t\t\t["(UTC+03:00) Baghdad", \'Asia/Baghdad\'],\n\t\t\t["(UTC+03:00) Istanbul", \'Asia/Istanbul\'],\n\t\t\t["(UTC+03:00) Kuwait, Riyadh", \'Asia/Kuwait\'],\n\t\t\t["(UTC+03:00) Minsk", \'Europe/Minsk\'],\n\t\t\t["(UTC+03:00) Moscow, St. Petersburg, Volgograd", \'Europe/Moscow\'],\n\t\t\t["(UTC+03:00) Nairobi", \'Africa/Nairobi\'],\n\t\t\t["(UTC+03:30) Tehran", \'Asia/Tehran\'],\n\t\t\t["(UTC+04:00) Abu Dhabi, Muscat", \'Asia/Muscat\'],\n\t\t\t["(UTC+04:00) Astrakhan, Ulyanovsk", \'Europe/Astrakhan\'],\n\t\t\t["(UTC+04:00) Baku", \'Asia/Baku\'],\n\t\t\t["(UTC+04:00) Izhevsk, Samara", \'Europe/Samara\'],\n\t\t\t["(UTC+04:00) Port Louis", \'Indian/Mauritius\'],\n\t\t\t["(UTC+04:00) Tbilisi", \'Asia/Tbilisi\'],\n\t\t\t["(UTC+04:00) Yerevan", \'Asia/Yerevan\'],\n\t\t\t["(UTC+04:30) Kabul", \'Asia/Kabul\'],\n\t\t\t["(UTC+05:00) Tashkent, Ashgabat", \'Asia/Tashkent\'],\n\t\t\t["(UTC+05:00) Ekaterinburg", \'Asia/Yekaterinburg\'],\n\t\t\t["(UTC+05:00) Islamabad, Karachi", \'Asia/Karachi\'],\n\t\t\t["(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi", \'Asia/Kolkata\'],\n\t\t\t["(UTC+05:30) Sri Jayawardenepura", \'Asia/Colombo\'],\n\t\t\t["(UTC+05:45) Kathmandu", \'Asia/Katmandu\'],\n\t\t\t["(UTC+06:00) Astana", \'Asia/Almaty\'],\n\t\t\t["(UTC+06:00) Dhaka", \'Asia/Dhaka\'],\n\t\t\t["(UTC+06:30) Yangon (Rangoon)", \'Asia/Rangoon\'],\n\t\t\t["(UTC+07:00) Novosibirsk", \'Asia/Novosibirsk\'],\n\t\t\t["(UTC+07:00) Bangkok, Hanoi, Jakarta", \'Asia/Bangkok\'],\n\t\t\t["(UTC+07:00) Barnaul, Gorno-Altaysk", \'Asia/Barnaul\'],\n\t\t\t["(UTC+07:00) Hovd", \'Asia/Hovd\'],\n\t\t\t["(UTC+07:00) Krasnoyarsk", \'Asia/Krasnoyarsk\'],\n\t\t\t["(UTC+07:00) Tomsk", \'Asia/Tomsk\'],\n\t\t\t["(UTC+08:00) Beijing, Chongqing, Hong Kong SAR, Urumqi", \'Asia/Chongqing\'],\n\t\t\t["(UTC+08:00) Irkutsk", \'Asia/Irkutsk\'],\n\t\t\t["(UTC+08:00) Kuala Lumpur, Singapore", \'Asia/Kuala_Lumpur\'],\n\t\t\t["(UTC+08:00) Perth", \'Australia/Perth\'],\n\t\t\t["(UTC+08:00) Taipei", \'Asia/Taipei\'],\n\t\t\t["(UTC+08:00) Ulaanbaatar", \'Asia/Ulaanbaatar\'],\n\t\t\t["(UTC+08:30) Pyongyang", \'Asia/Pyongyang\'],\n\t\t\t["(UTC+08:45) Eucla", \'Australia/Eucla\'],\n\t\t\t["(UTC+09:00) Chita", \'Asia/Chita\'],\n\t\t\t["(UTC+09:00) Osaka, Sapporo, Tokyo", \'Asia/Tokyo\'],\n\t\t\t["(UTC+09:00) Seoul", \'Asia/Seoul\'],\n\t\t\t["(UTC+09:00) Yakutsk", \'Asia/Yakutsk\'],\n\t\t\t["(UTC+09:30) Adelaide", \'Australia/Adelaide\'],\n\t\t\t["(UTC+09:30) Darwin", \'Australia/Darwin\'],\n\t\t\t["(UTC+10:00) Brisbane", \'Australia/Brisbane\'],\n\t\t\t["(UTC+10:00) Canberra, Melbourne, Sydney", \'Australia/Canberra\'],\n\t\t\t["(UTC+10:00) Guam, Port Moresby", \'Pacific/Guam\'],\n\t\t\t["(UTC+10:00) Hobart", \'Australia/Hobart\'],\n\t\t\t["(UTC+10:00) Vladivostok", \'Asia/Vladivostok\'],\n\t\t\t["(UTC+10:30) Lord Howe Island", \'Australia/Lord_Howe\'],\n\t\t\t["(UTC+11:00) Bougainville Island", \'Pacific/Bougainville\'],\n\t\t\t["(UTC+11:00) Chokirdakh", \'Asia/Srednekolymsk\'],\n\t\t\t["(UTC+11:00) Magadan", \'Asia/Magadan\'],\n\t\t\t["(UTC+11:00) Norfolk Island", \'Pacific/Norfolk\'],\n\t\t\t["(UTC+11:00) Sakhalin", \'Asia/Sakhalin\'],\n\t\t\t["(UTC+11:00) Solomon Islands, New Caledonia", \'Pacific/Guadalcanal\'],\n\t\t\t["(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky", \'Asia/Anadyr\'],\n\t\t\t["(UTC+12:00) Auckland, Wellington", \'Pacific/Auckland\'],\n\t\t\t["(UTC+12:00) Fiji Islands", \'Pacific/Fiji\'],\n\t\t\t["(UTC+12:45) Chatham Islands", \'Pacific/Chatham\'],\n\t\t\t["(UTC+13:00) Nuku\'alofa", \'Pacific/Tongatapu\'],\n\t\t\t["(UTC+13:00) Samoa", \'Pacific/Apia\'],\n\t\t\t["(UTC+14:00) Kiritimati Island", \'Pacific/Kiritimati\']\n\t\t];\n\n\t\tvar _manual_alts = {\n\t\t\t"America\\/Guatemala": "America\\/Belize",\n\t\t\t"America\\/Indianapolis": "America\\/Indiana\\/Indianapolis",\n\t\t\t"America\\/La_Paz": "America\\/Manaus",\n\t\t\t"UTC": "Africa\\/Monrovia",\n\t\t\t"Atlantic\\/Reykjavik": "Africa\\/Monrovia",\n\t\t\t"Europe\\/Berlin": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Budapest": "Europe\\/Belgrade",\n\t\t\t"Europe\\/Paris": "Europe\\/Brussels",\n\t\t\t"Africa\\/Lagos": "Africa\\/Algiers",\n\t\t\t"Europe\\/Bucharest": "Europe\\/Athens",\n\t\t\t"Africa\\/Johannesburg": "Africa\\/Harare",\n\t\t\t"Europe\\/Kiev": "Europe\\/Helsinki",\n\t\t\t"Europe\\/Istanbul": "Asia\\/Istanbul",\n\t\t\t"Asia\\/Riyadh": "Asia\\/Kuwait",\n\t\t\t"Asia\\/Dubai": "Asia\\/Muscat",\n\t\t\t"Asia\\/Calcutta": "Asia\\/Kolkata",\n\t\t\t"Asia\\/Shanghai": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Singapore": "Asia\\/Kuala_Lumpur",\n\t\t\t"Australia\\/Sydney": "Australia\\/Canberra",\n\t\t\t"Pacific\\/Port_Moresby": "Pacific\\/Guam",\n\t\t\t"Asia\\/Kamchatka": "Asia\\/Anadyr"\n\t\t}\n\t\tvar _auto_alts = {\n\t\t\t"Africa\\/Abidjan": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Accra": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Addis_Ababa": "Europe\\/Moscow",\n\t\t\t"Africa\\/Asmara": "Europe\\/Moscow",\n\t\t\t"Africa\\/Asmera": "Europe\\/Moscow",\n\t\t\t"Africa\\/Bamako": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Bangui": "Africa\\/Algiers",\n\t\t\t"Africa\\/Banjul": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Bissau": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Blantyre": "Africa\\/Harare",\n\t\t\t"Africa\\/Brazzaville": "Africa\\/Algiers",\n\t\t\t"Africa\\/Bujumbura": "Africa\\/Harare",\n\t\t\t"Africa\\/Ceuta": "Europe\\/Amsterdam",\n\t\t\t"Africa\\/Conakry": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Dakar": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Dar_es_Salaam": "Europe\\/Moscow",\n\t\t\t"Africa\\/Djibouti": "Europe\\/Moscow",\n\t\t\t"Africa\\/Douala": "Africa\\/Algiers",\n\t\t\t"Africa\\/El_Aaiun": "Africa\\/Casablanca",\n\t\t\t"Africa\\/Freetown": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Gaborone": "Africa\\/Harare",\n\t\t\t"Africa\\/Johannesburg": "Africa\\/Harare",\n\t\t\t"Africa\\/Juba": "Europe\\/Moscow",\n\t\t\t"Africa\\/Kampala": "Europe\\/Moscow",\n\t\t\t"Africa\\/Khartoum": "Europe\\/Moscow",\n\t\t\t"Africa\\/Kigali": "Africa\\/Harare",\n\t\t\t"Africa\\/Kinshasa": "Africa\\/Algiers",\n\t\t\t"Africa\\/Lagos": "Africa\\/Algiers",\n\t\t\t"Africa\\/Libreville": "Africa\\/Algiers",\n\t\t\t"Africa\\/Lome": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Luanda": "Africa\\/Algiers",\n\t\t\t"Africa\\/Lubumbashi": "Africa\\/Harare",\n\t\t\t"Africa\\/Lusaka": "Africa\\/Harare",\n\t\t\t"Africa\\/Malabo": "Africa\\/Algiers",\n\t\t\t"Africa\\/Maputo": "Africa\\/Harare",\n\t\t\t"Africa\\/Maseru": "Africa\\/Harare",\n\t\t\t"Africa\\/Mbabane": "Africa\\/Harare",\n\t\t\t"Africa\\/Mogadishu": "Europe\\/Moscow",\n\t\t\t"Africa\\/Ndjamena": "Africa\\/Algiers",\n\t\t\t"Africa\\/Niamey": "Africa\\/Algiers",\n\t\t\t"Africa\\/Nouakchott": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Ouagadougou": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Porto-Novo": "Africa\\/Algiers",\n\t\t\t"Africa\\/Sao_Tome": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Timbuktu": "Africa\\/Monrovia",\n\t\t\t"Africa\\/Tunis": "Africa\\/Algiers",\n\t\t\t"America\\/Anguilla": "America\\/Manaus",\n\t\t\t"America\\/Antigua": "America\\/Manaus",\n\t\t\t"America\\/Araguaina": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Buenos_Aires": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Catamarca": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/ComodRivadavia": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Cordoba": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Jujuy": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/La_Rioja": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Mendoza": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Rio_Gallegos": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Salta": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/San_Juan": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/San_Luis": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Tucuman": "America\\/Buenos_Aires",\n\t\t\t"America\\/Argentina\\/Ushuaia": "America\\/Buenos_Aires",\n\t\t\t"America\\/Aruba": "America\\/Manaus",\n\t\t\t"America\\/Atikokan": "America\\/Bogota",\n\t\t\t"America\\/Atka": "America\\/Adak",\n\t\t\t"America\\/Bahia_Banderas": "America\\/Mexico_City",\n\t\t\t"America\\/Barbados": "America\\/Manaus",\n\t\t\t"America\\/Belem": "America\\/Buenos_Aires",\n\t\t\t"America\\/Blanc-Sablon": "America\\/Manaus",\n\t\t\t"America\\/Boa_Vista": "America\\/Manaus",\n\t\t\t"America\\/Boise": "America\\/Denver",\n\t\t\t"America\\/Cambridge_Bay": "America\\/Denver",\n\t\t\t"America\\/Campo_Grande": "America\\/Cuiaba",\n\t\t\t"America\\/Catamarca": "America\\/Buenos_Aires",\n\t\t\t"America\\/Cayman": "America\\/Bogota",\n\t\t\t"America\\/Coral_Harbour": "America\\/Bogota",\n\t\t\t"America\\/Cordoba": "America\\/Buenos_Aires",\n\t\t\t"America\\/Costa_Rica": "America\\/Regina",\n\t\t\t"America\\/Creston": "America\\/Phoenix",\n\t\t\t"America\\/Curacao": "America\\/Manaus",\n\t\t\t"America\\/Danmarkshavn": "Africa\\/Monrovia",\n\t\t\t"America\\/Dawson": "America\\/Los_Angeles",\n\t\t\t"America\\/Dawson_Creek": "America\\/Phoenix",\n\t\t\t"America\\/Detroit": "America\\/New_York",\n\t\t\t"America\\/Dominica": "America\\/Manaus",\n\t\t\t"America\\/Edmonton": "America\\/Denver",\n\t\t\t"America\\/Eirunepe": "America\\/Bogota",\n\t\t\t"America\\/El_Salvador": "America\\/Regina",\n\t\t\t"America\\/Ensenada": "America\\/Los_Angeles",\n\t\t\t"America\\/Fort_Wayne": "America\\/New_York",\n\t\t\t"America\\/Glace_Bay": "America\\/Halifax",\n\t\t\t"America\\/Goose_Bay": "America\\/Halifax",\n\t\t\t"America\\/Grenada": "America\\/Manaus",\n\t\t\t"America\\/Guadeloupe": "America\\/Manaus",\n\t\t\t"America\\/Guatemala": "America\\/Regina",\n\t\t\t"America\\/Guayaquil": "America\\/Bogota",\n\t\t\t"America\\/Guyana": "America\\/Manaus",\n\t\t\t"America\\/Hermosillo": "America\\/Phoenix",\n\t\t\t"America\\/Indiana\\/Knox": "America\\/Chicago",\n\t\t\t"America\\/Indiana\\/Marengo": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Petersburg": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Tell_City": "America\\/Chicago",\n\t\t\t"America\\/Indiana\\/Vevay": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Vincennes": "America\\/New_York",\n\t\t\t"America\\/Indiana\\/Winamac": "America\\/New_York",\n\t\t\t"America\\/Indianapolis": "America\\/New_York",\n\t\t\t"America\\/Inuvik": "America\\/Denver",\n\t\t\t"America\\/Iqaluit": "America\\/New_York",\n\t\t\t"America\\/Jamaica": "America\\/Bogota",\n\t\t\t"America\\/Jujuy": "America\\/Buenos_Aires",\n\t\t\t"America\\/Juneau": "America\\/Anchorage",\n\t\t\t"America\\/Kentucky\\/Louisville": "America\\/New_York",\n\t\t\t"America\\/Kentucky\\/Monticello": "America\\/New_York",\n\t\t\t"America\\/Knox_IN": "America\\/Chicago",\n\t\t\t"America\\/Kralendijk": "America\\/Manaus",\n\t\t\t"America\\/La_Paz": "America\\/Manaus",\n\t\t\t"America\\/Lima": "America\\/Bogota",\n\t\t\t"America\\/Louisville": "America\\/New_York",\n\t\t\t"America\\/Lower_Princes": "America\\/Manaus",\n\t\t\t"America\\/Maceio": "America\\/Buenos_Aires",\n\t\t\t"America\\/Managua": "America\\/Regina",\n\t\t\t"America\\/Marigot": "America\\/Manaus",\n\t\t\t"America\\/Martinique": "America\\/Manaus",\n\t\t\t"America\\/Matamoros": "America\\/Chicago",\n\t\t\t"America\\/Mazatlan": "America\\/Chihuahua",\n\t\t\t"America\\/Mendoza": "America\\/Buenos_Aires",\n\t\t\t"America\\/Menominee": "America\\/Chicago",\n\t\t\t"America\\/Merida": "America\\/Mexico_City",\n\t\t\t"America\\/Moncton": "America\\/Halifax",\n\t\t\t"America\\/Monterrey": "America\\/Mexico_City",\n\t\t\t"America\\/Montreal": "America\\/New_York",\n\t\t\t"America\\/Montserrat": "America\\/Manaus",\n\t\t\t"America\\/Nassau": "America\\/New_York",\n\t\t\t"America\\/Nipigon": "America\\/New_York",\n\t\t\t"America\\/Nome": "America\\/Anchorage",\n\t\t\t"America\\/North_Dakota\\/Beulah": "America\\/Chicago",\n\t\t\t"America\\/North_Dakota\\/Center": "America\\/Chicago",\n\t\t\t"America\\/North_Dakota\\/New_Salem": "America\\/Chicago",\n\t\t\t"America\\/Ojinaga": "America\\/Denver",\n\t\t\t"America\\/Panama": "America\\/Bogota",\n\t\t\t"America\\/Pangnirtung": "America\\/New_York",\n\t\t\t"America\\/Paramaribo": "America\\/Buenos_Aires",\n\t\t\t"America\\/Port_of_Spain": "America\\/Manaus",\n\t\t\t"America\\/Porto_Acre": "America\\/Bogota",\n\t\t\t"America\\/Porto_Velho": "America\\/Manaus",\n\t\t\t"America\\/Puerto_Rico": "America\\/Manaus",\n\t\t\t"America\\/Rainy_River": "America\\/Chicago",\n\t\t\t"America\\/Rankin_Inlet": "America\\/Chicago",\n\t\t\t"America\\/Recife": "America\\/Buenos_Aires",\n\t\t\t"America\\/Resolute": "America\\/Chicago",\n\t\t\t"America\\/Rio_Branco": "America\\/Bogota",\n\t\t\t"America\\/Rosario": "America\\/Buenos_Aires",\n\t\t\t"America\\/Santa_Isabel": "America\\/Los_Angeles",\n\t\t\t"America\\/Santarem": "America\\/Buenos_Aires",\n\t\t\t"America\\/Santo_Domingo": "America\\/Manaus",\n\t\t\t"America\\/Scoresbysund": "Atlantic\\/Azores",\n\t\t\t"America\\/Shiprock": "America\\/Denver",\n\t\t\t"America\\/Sitka": "America\\/Anchorage",\n\t\t\t"America\\/St_Barthelemy": "America\\/Manaus",\n\t\t\t"America\\/St_Kitts": "America\\/Manaus",\n\t\t\t"America\\/St_Lucia": "America\\/Manaus",\n\t\t\t"America\\/St_Thomas": "America\\/Manaus",\n\t\t\t"America\\/St_Vincent": "America\\/Manaus",\n\t\t\t"America\\/Swift_Current": "America\\/Regina",\n\t\t\t"America\\/Tegucigalpa": "America\\/Regina",\n\t\t\t"America\\/Thule": "America\\/Halifax",\n\t\t\t"America\\/Thunder_Bay": "America\\/New_York",\n\t\t\t"America\\/Toronto": "America\\/New_York",\n\t\t\t"America\\/Tortola": "America\\/Manaus",\n\t\t\t"America\\/Vancouver": "America\\/Los_Angeles",\n\t\t\t"America\\/Virgin": "America\\/Manaus",\n\t\t\t"America\\/Whitehorse": "America\\/Los_Angeles",\n\t\t\t"America\\/Winnipeg": "America\\/Chicago",\n\t\t\t"America\\/Yakutat": "America\\/Anchorage",\n\t\t\t"America\\/Yellowknife": "America\\/Denver",\n\t\t\t"Antarctica\\/Casey": "Asia\\/Chongqing",\n\t\t\t"Antarctica\\/Davis": "Asia\\/Bangkok",\n\t\t\t"Antarctica\\/DumontDUrville": "Australia\\/Brisbane",\n\t\t\t"Antarctica\\/Macquarie": "Pacific\\/Bougainville",\n\t\t\t"Antarctica\\/Mawson": "Asia\\/Tashkent",\n\t\t\t"Antarctica\\/McMurdo": "Pacific\\/Auckland",\n\t\t\t"Antarctica\\/Palmer": "America\\/Santiago",\n\t\t\t"Antarctica\\/Rothera": "America\\/Buenos_Aires",\n\t\t\t"Antarctica\\/South_Pole": "Pacific\\/Auckland",\n\t\t\t"Antarctica\\/Syowa": "Europe\\/Moscow",\n\t\t\t"Antarctica\\/Vostok": "Asia\\/Dhaka",\n\t\t\t"Arctic\\/Longyearbyen": "Europe\\/Amsterdam",\n\t\t\t"Asia\\/Aden": "Europe\\/Moscow",\n\t\t\t"Asia\\/Aqtau": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Aqtobe": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Ashgabat": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Ashkhabad": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Bahrain": "Europe\\/Moscow",\n\t\t\t"Asia\\/Bishkek": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Brunei": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Calcutta": "Asia\\/Kolkata",\n\t\t\t"Asia\\/Choibalsan": "Asia\\/Ulaanbaatar",\n\t\t\t"Asia\\/Chungking": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Dacca": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Dili": "Asia\\/Tokyo",\n\t\t\t"Asia\\/Dubai": "Asia\\/Muscat",\n\t\t\t"Asia\\/Dushanbe": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Harbin": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Hebron": "Asia\\/Gaza",\n\t\t\t"Asia\\/Ho_Chi_Minh": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Hong_Kong": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Jakarta": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Jayapura": "Asia\\/Tokyo",\n\t\t\t"Asia\\/Kamchatka": "Asia\\/Anadyr",\n\t\t\t"Asia\\/Kashgar": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Kathmandu": "Asia\\/Katmandu",\n\t\t\t"Asia\\/Khandyga": "Asia\\/Tokyo",\n\t\t\t"Asia\\/Kuching": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Macao": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Macau": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Makassar": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Manila": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Nicosia": "Europe\\/Athens",\n\t\t\t"Asia\\/Novokuznetsk": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Omsk": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Oral": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Phnom_Penh": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Pontianak": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Qatar": "Europe\\/Moscow",\n\t\t\t"Asia\\/Qyzylorda": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Riyadh": "Europe\\/Moscow",\n\t\t\t"Asia\\/Saigon": "Asia\\/Bangkok",\n\t\t\t"Asia\\/Samarkand": "Asia\\/Tashkent",\n\t\t\t"Asia\\/Shanghai": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Singapore": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Tel_Aviv": "Asia\\/Jerusalem",\n\t\t\t"Asia\\/Thimbu": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Thimphu": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Ujung_Pandang": "Asia\\/Chongqing",\n\t\t\t"Asia\\/Ulan_Bator": "Asia\\/Ulaanbaatar",\n\t\t\t"Asia\\/Urumqi": "Asia\\/Dhaka",\n\t\t\t"Asia\\/Ust-Nera": "Australia\\/Brisbane",\n\t\t\t"Asia\\/Vientiane": "Asia\\/Bangkok",\n\t\t\t"Atlantic\\/Bermuda": "America\\/Halifax",\n\t\t\t"Atlantic\\/Canary": "Europe\\/London",\n\t\t\t"Atlantic\\/Faeroe": "Europe\\/London",\n\t\t\t"Atlantic\\/Faroe": "Europe\\/London",\n\t\t\t"Atlantic\\/Jan_Mayen": "Europe\\/Amsterdam",\n\t\t\t"Atlantic\\/Madeira": "Europe\\/London",\n\t\t\t"Atlantic\\/Reykjavik": "Africa\\/Monrovia",\n\t\t\t"Atlantic\\/South_Georgia": "America\\/Noronha",\n\t\t\t"Atlantic\\/St_Helena": "Africa\\/Monrovia",\n\t\t\t"Atlantic\\/Stanley": "America\\/Buenos_Aires",\n\t\t\t"Australia\\/ACT": "Australia\\/Canberra",\n\t\t\t"Australia\\/Broken_Hill": "Australia\\/Adelaide",\n\t\t\t"Australia\\/Currie": "Australia\\/Canberra",\n\t\t\t"Australia\\/LHI": "Australia\\/Lord_Howe",\n\t\t\t"Australia\\/Lindeman": "Australia\\/Brisbane",\n\t\t\t"Australia\\/Melbourne": "Australia\\/Canberra",\n\t\t\t"Australia\\/NSW": "Australia\\/Canberra",\n\t\t\t"Australia\\/North": "Australia\\/Darwin",\n\t\t\t"Australia\\/Queensland": "Australia\\/Brisbane",\n\t\t\t"Australia\\/South": "Australia\\/Adelaide",\n\t\t\t"Australia\\/Sydney": "Australia\\/Canberra",\n\t\t\t"Australia\\/Tasmania": "Australia\\/Canberra",\n\t\t\t"Australia\\/Victoria": "Australia\\/Canberra",\n\t\t\t"Australia\\/West": "Asia\\/Chongqing",\n\t\t\t"Australia\\/Yancowinna": "Australia\\/Adelaide",\n\t\t\t"Brazil\\/Acre": "America\\/Bogota",\n\t\t\t"Brazil\\/DeNoronha": "America\\/Noronha",\n\t\t\t"Brazil\\/East": "America\\/Sao_Paulo",\n\t\t\t"Brazil\\/West": "America\\/Manaus",\n\t\t\t"CET": "Europe\\/Amsterdam",\n\t\t\t"CST6CDT": "America\\/Chicago",\n\t\t\t"Canada\\/Atlantic": "America\\/Halifax",\n\t\t\t"Canada\\/Central": "America\\/Chicago",\n\t\t\t"Canada\\/East-Saskatchewan": "America\\/Regina",\n\t\t\t"Canada\\/Eastern": "America\\/New_York",\n\t\t\t"Canada\\/Mountain": "America\\/Denver",\n\t\t\t"Canada\\/Newfoundland": "America\\/St_Johns",\n\t\t\t"Canada\\/Pacific": "America\\/Los_Angeles",\n\t\t\t"Canada\\/Saskatchewan": "America\\/Regina",\n\t\t\t"Canada\\/Yukon": "America\\/Los_Angeles",\n\t\t\t"Chile\\/Continental": "America\\/Santiago",\n\t\t\t"Chile\\/EasterIsland": "Pacific\\/Easter",\n\t\t\t"Cuba": "America\\/Havana",\n\t\t\t"EET": "Europe\\/Athens",\n\t\t\t"EST": "America\\/New_York",\n\t\t\t"EST5EDT": "America\\/New_York",\n\t\t\t"Egypt": "Africa\\/Cairo",\n\t\t\t"Eire": "Europe\\/London",\n\t\t\t"Etc\\/GMT": "Africa\\/Monrovia",\n\t\t\t"Etc\\/GMT+0": "Africa\\/Monrovia",\n\t\t\t"Etc\\/GMT+1": "Atlantic\\/Cape_Verde",\n\t\t\t"Etc\\/GMT+10": "Pacific\\/Honolulu",\n\t\t\t"Etc\\/GMT+11": "Pacific\\/Midway",\n\t\t\t"Etc\\/GMT+2": "America\\/Noronha",\n\t\t\t"Etc\\/GMT+3": "America\\/Buenos_Aires",\n\t\t\t"Etc\\/GMT+4": "America\\/Manaus",\n\t\t\t"Etc\\/GMT+5": "America\\/Bogota",\n\t\t\t"Etc\\/GMT+6": "America\\/Regina",\n\t\t\t"Etc\\/GMT+7": "America\\/Phoenix",\n\t\t\t"Etc\\/GMT-0": "Africa\\/Monrovia",\n\t\t\t"Etc\\/GMT-1": "Africa\\/Algiers",\n\t\t\t"Etc\\/GMT-10": "Australia\\/Brisbane",\n\t\t\t"Etc\\/GMT-11": "Pacific\\/Bougainville",\n\t\t\t"Etc\\/GMT-12": "Asia\\/Anadyr",\n\t\t\t"Etc\\/GMT-13": "Pacific\\/Tongatapu",\n\t\t\t"Etc\\/GMT-14": "Pacific\\/Kiritimati",\n\t\t\t"Etc\\/GMT-2": "Africa\\/Harare",\n\t\t\t"Etc\\/GMT-3": "Europe\\/Moscow",\n\t\t\t"Etc\\/GMT-4": "Asia\\/Muscat",\n\t\t\t"Etc\\/GMT-5": "Asia\\/Tashkent",\n\t\t\t"Etc\\/GMT-6": "Asia\\/Dhaka",\n\t\t\t"Etc\\/GMT-7": "Asia\\/Bangkok",\n\t\t\t"Etc\\/GMT-8": "Asia\\/Chongqing",\n\t\t\t"Etc\\/GMT-9": "Asia\\/Tokyo",\n\t\t\t"Etc\\/GMT0": "Africa\\/Monrovia",\n\t\t\t"Etc\\/Greenwich": "Africa\\/Monrovia",\n\t\t\t"Etc\\/UCT": "Africa\\/Monrovia",\n\t\t\t"Etc\\/UTC": "Africa\\/Monrovia",\n\t\t\t"Etc\\/Universal": "Africa\\/Monrovia",\n\t\t\t"Etc\\/Zulu": "Africa\\/Monrovia",\n\t\t\t"Europe\\/Andorra": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Belfast": "Europe\\/London",\n\t\t\t"Europe\\/Berlin": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Bratislava": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Bucharest": "Europe\\/Athens",\n\t\t\t"Europe\\/Budapest": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Busingen": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Copenhagen": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Dublin": "Europe\\/London",\n\t\t\t"Europe\\/Gibraltar": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Guernsey": "Europe\\/London",\n\t\t\t"Europe\\/Isle_of_Man": "Europe\\/London",\n\t\t\t"Europe\\/Istanbul": "Asia\\/Istanbul",\n\t\t\t"Europe\\/Jersey": "Europe\\/London",\n\t\t\t"Europe\\/Kiev": "Europe\\/Athens",\n\t\t\t"Europe\\/Kirov": "Europe\\/Moscow",\n\t\t\t"Europe\\/Lisbon": "Europe\\/London",\n\t\t\t"Europe\\/Ljubljana": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Luxembourg": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Madrid": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Malta": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Mariehamn": "Europe\\/Athens",\n\t\t\t"Europe\\/Monaco": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Nicosia": "Europe\\/Athens",\n\t\t\t"Europe\\/Oslo": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Paris": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Podgorica": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Prague": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Riga": "Europe\\/Athens",\n\t\t\t"Europe\\/Rome": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/San_Marino": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Sarajevo": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Simferopol": "Europe\\/Moscow",\n\t\t\t"Europe\\/Skopje": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Sofia": "Europe\\/Athens",\n\t\t\t"Europe\\/Stockholm": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Tallinn": "Europe\\/Athens",\n\t\t\t"Europe\\/Tirane": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Ulyanovsk": "Europe\\/Astrakhan",\n\t\t\t"Europe\\/Uzhgorod": "Europe\\/Athens",\n\t\t\t"Europe\\/Vaduz": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Vatican": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Vienna": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Vilnius": "Europe\\/Athens",\n\t\t\t"Europe\\/Volgograd": "Europe\\/Moscow",\n\t\t\t"Europe\\/Zagreb": "Europe\\/Amsterdam",\n\t\t\t"Europe\\/Zaporozhye": "Europe\\/Athens",\n\t\t\t"Europe\\/Zurich": "Europe\\/Amsterdam",\n\t\t\t"Factory": "Africa\\/Monrovia",\n\t\t\t"GB": "Europe\\/London",\n\t\t\t"GB-Eire": "Europe\\/London",\n\t\t\t"GMT": "Africa\\/Monrovia",\n\t\t\t"GMT+0": "Africa\\/Monrovia",\n\t\t\t"GMT-0": "Africa\\/Monrovia",\n\t\t\t"GMT0": "Africa\\/Monrovia",\n\t\t\t"Greenwich": "Africa\\/Monrovia",\n\t\t\t"HST": "Pacific\\/Honolulu",\n\t\t\t"Hongkong": "Asia\\/Chongqing",\n\t\t\t"Iceland": "Africa\\/Monrovia",\n\t\t\t"Indian\\/Antananarivo": "Europe\\/Moscow",\n\t\t\t"Indian\\/Chagos": "Asia\\/Dhaka",\n\t\t\t"Indian\\/Christmas": "Asia\\/Bangkok",\n\t\t\t"Indian\\/Cocos": "Asia\\/Rangoon",\n\t\t\t"Indian\\/Comoro": "Europe\\/Moscow",\n\t\t\t"Indian\\/Kerguelen": "Asia\\/Tashkent",\n\t\t\t"Indian\\/Mahe": "Asia\\/Muscat",\n\t\t\t"Indian\\/Maldives": "Asia\\/Tashkent",\n\t\t\t"Indian\\/Mayotte": "Europe\\/Moscow",\n\t\t\t"Indian\\/Reunion": "Asia\\/Muscat",\n\t\t\t"Iran": "Asia\\/Tehran",\n\t\t\t"Israel": "Asia\\/Jerusalem",\n\t\t\t"Jamaica": "America\\/Bogota",\n\t\t\t"Japan": "Asia\\/Tokyo",\n\t\t\t"Kwajalein": "Asia\\/Anadyr",\n\t\t\t"Libya": "Africa\\/Harare",\n\t\t\t"MET": "Europe\\/Amsterdam",\n\t\t\t"MST": "America\\/Denver",\n\t\t\t"MST7MDT": "America\\/Denver",\n\t\t\t"Mexico\\/BajaNorte": "America\\/Los_Angeles",\n\t\t\t"Mexico\\/BajaSur": "America\\/Chihuahua",\n\t\t\t"Mexico\\/General": "America\\/Mexico_City",\n\t\t\t"NZ": "Pacific\\/Auckland",\n\t\t\t"NZ-CHAT": "Pacific\\/Chatham",\n\t\t\t"Navajo": "America\\/Denver",\n\t\t\t"PRC": "Asia\\/Chongqing",\n\t\t\t"PST8PDT": "America\\/Los_Angeles",\n\t\t\t"Pacific\\/Chuuk": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Efate": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Enderbury": "Pacific\\/Tongatapu",\n\t\t\t"Pacific\\/Fakaofo": "Pacific\\/Tongatapu",\n\t\t\t"Pacific\\/Funafuti": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Galapagos": "America\\/Regina",\n\t\t\t"Pacific\\/Johnston": "Pacific\\/Honolulu",\n\t\t\t"Pacific\\/Kosrae": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Kwajalein": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Majuro": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Nauru": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Niue": "Pacific\\/Midway",\n\t\t\t"Pacific\\/Noumea": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Pago_Pago": "Pacific\\/Midway",\n\t\t\t"Pacific\\/Palau": "Asia\\/Tokyo",\n\t\t\t"Pacific\\/Pohnpei": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Ponape": "Pacific\\/Bougainville",\n\t\t\t"Pacific\\/Port_Moresby": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Rarotonga": "Pacific\\/Honolulu",\n\t\t\t"Pacific\\/Saipan": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Samoa": "Pacific\\/Midway",\n\t\t\t"Pacific\\/Tahiti": "Pacific\\/Honolulu",\n\t\t\t"Pacific\\/Tarawa": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Truk": "Australia\\/Brisbane",\n\t\t\t"Pacific\\/Wake": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Wallis": "Asia\\/Anadyr",\n\t\t\t"Pacific\\/Yap": "Australia\\/Brisbane",\n\t\t\t"Poland": "Europe\\/Amsterdam",\n\t\t\t"Portugal": "Europe\\/London",\n\t\t\t"ROC": "Asia\\/Chongqing",\n\t\t\t"ROK": "Asia\\/Tokyo",\n\t\t\t"Singapore": "Asia\\/Chongqing",\n\t\t\t"Turkey": "Asia\\/Istanbul",\n\t\t\t"UCT": "Africa\\/Monrovia",\n\t\t\t"US\\/Alaska": "America\\/Anchorage",\n\t\t\t"US\\/Aleutian": "America\\/Adak",\n\t\t\t"US\\/Arizona": "America\\/Phoenix",\n\t\t\t"US\\/Central": "America\\/Chicago",\n\t\t\t"US\\/East-Indiana": "America\\/New_York",\n\t\t\t"US\\/Eastern": "America\\/New_York",\n\t\t\t"US\\/Hawaii": "Pacific\\/Honolulu",\n\t\t\t"US\\/Indiana-Starke": "America\\/Chicago",\n\t\t\t"US\\/Michigan": "America\\/New_York",\n\t\t\t"US\\/Mountain": "America\\/Denver",\n\t\t\t"US\\/Pacific": "America\\/Los_Angeles",\n\t\t\t"US\\/Pacific-New": "America\\/Los_Angeles",\n\t\t\t"US\\/Samoa": "Pacific\\/Midway",\n\t\t\t"UTC": "Africa\\/Monrovia",\n\t\t\t"Universal": "Africa\\/Monrovia",\n\t\t\t"W-SU": "Europe\\/Moscow",\n\t\t\t"WET": "Europe\\/Amsterdam",\n\t\t\t"Zulu": "Africa\\/Monrovia"\n\t\t};\n\t\tvar _fallback_alts = {\n\t\t\t"America\\/Fort_Nelson": "America\\/Denver"\n\t\t};\n\n\t\t// The follow zone IDs have no mapping to our choice list:\n\t\t// America/Metlakatla\n\t\t// Antarctica/Troll\n\t\t// Europe/Chisinau\n\t\t// Pacific/Gambier\n\t\t// Pacific/Pitcairn\n\t\t// Etc/GMT+12 (Obsolete)\n\t\t// Etc/GMT+8 (Obsolete)\n\t\t// Etc/GMT+9 (Obsolete)\n\t\t// Europe/Tiraspol (Obsolete)\n\n\n\t\treturn self;\n\t}\n\n\t// export\n\tif (typeof exports !== \'undefined\'){\n\t\tif (typeof module !== \'undefined\' && module.exports){\n\t\t\texports = module.exports = tz;\n\t\t}\n\t\texports.TimezoneDetector = tz;\n\t}else if (typeof define === \'function\' && define.amd){\n\t\tdefine(function() { return tz; })\n\t}else{\n\t\troot.TimezoneDetector = tz;\n\t}\n\n}).call(function(){\n\treturn this || (typeof window !== \'undefined\' ? window : global);\n}());\n'},152:function(e,t,n){n(0)(n(142))},153:function(e,t,n){n(0)(n(143))},156:function(e,t,n){n(0)(n(146))},2297:function(e,t){!function(){"use strict";TS.registerModule("files.media",{INLINE_VIDEO_CLASS_NAME:"inline_video",COUNT_LABEL_MOV_CANPLAY:"inline_mov_canplay",COUNT_LABEL_MOV_ERROR:"inline_mov_error",bindVideoElements:function(t){var n=$(_.get(t,"container","body")),i=_.get(t,"onCanplay",_.noop),a=_.get(t,"onError",_.noop);n[0].addEventListener("canplay",function(t){var n=$(t.target);n.hasClass(TS.files.media.INLINE_VIDEO_CLASS_NAME)&&(e(n,TS.files.media.COUNT_LABEL_MOV_CANPLAY),i(n))},!0),n[0].addEventListener("error",function(t){var n=$(t.target);n.hasClass(TS.files.media.INLINE_VIDEO_CLASS_NAME)&&(e(n,TS.files.media.COUNT_LABEL_MOV_ERROR),a(n))},!0),n[0].addEventListener("play",function(e){var t=$(e.target),n=t.closest("ts-message"),i=n.data("ts")+"",a=n.data("model-ob-id"),s=n.data("member-id"),r=n.data("app-id"),o=n.data("bot-id"),l=n.find(".msg_inline_video_new_window_button"),d=l.data("referer-original-href"),c=d||l.attr("href"),_={message_timestamp:i,channel_id:a,channel_type:a?a.charAt(0):"",member_id:s,app_id:r,bot_id:o,url:c||""};TS.clog.track("MSG_VIDEO_PLAY",_)},!0),n.find("."+TS.files.media.INLINE_VIDEO_CLASS_NAME).each(function(){var e=$(this);this.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?i(e):this.error&&a(e)})},test:function(){return{_isSrcMov:t}}});var e=function(e,n){t(e.attr("src"))&&TS.metrics.count(n)},t=function(e){return _.isString(e)&&"mov"===_.last(e.split(".")).toLowerCase()}}()},2299:function(e,t){!function(){"use strict";TS.registerModule("coachmark",{$coachmark:null,context:null,is_showing:!1,is_small:!1,onStart:function(){},start:function(i,a){if(i){TS.coachmark.is_showing&&TS.coachmark.end(),TS.coachmark.$coachmark||t(i,a),n(i);var s=TS.coachmark.$coachmark;if(!$("#"+i.coachmark_el_id).length)return TS.error(["Cannot show coachmark ",i.id," because there is no element ",i.coachmark_el_id,""].join('"')),void s.addClass("hidden");TS.coachmark.clean(),TS.coachmark.context=i,TS.model.coachmark_is_showing=!0,TS.coachmark.is_showing=!0,s.removeClass("hidden"),s.css("left","").css("right","").css("top","").css("bottom","").css("height","auto").css("width","auto"),$("#coachmark_callout").css("left","").css("right","").css("top","").css("bottom",""),s.addClass(i.coachmark_el_id),$("#"+i.coachmark_el_id).removeClass("hidden"),i.reject||$("#coachmark_footer > .coachmark_footer_text").addClass("hidden"),$(window.document).bind("keydown",TS.coachmark.onKeyDown),i.has_close_btn?$("#coachmark_bg").on("click",TS.coachmark.end):$("html").bind("mousedown",TS.coachmark.onMouseDown),i.disable_scrolling&&$("#client-ui").addClass("disable_scrolling"),s.css("opacity",1),i.place&&i.placeSmall&&(s.addClass("small_coachmark"),TS.coachmark.is_small=!0),e(),$(window).on("resize.coachmark_placement",e),TS.coachmark.context.ui_click&&($(".coachmark_got_it").removeClass("hidden"),$(".coachmark_next_tip").addClass("hidden")),TS.coachmark.context.no_bg_on_small||TS.coachmark.context.no_bg||$("#coachmark_bg").removeClass("hidden")}},placeRightOf:function(e,t,n,i,a){if(TS.coachmark.context&&TS.coachmark.$coachmark){t=t||0,n=n||0,i=i||0;var s,r=TS.coachmark.$coachmark;s=a?{top:0,left:0}:e.offset(),r.css("top",s.top+t),r.css("left",s.left+e.width()+n),a||TS.coachmark.keepInBounds();var o=r.dimensions_rect();a?$("#coachmark_callout").css("top",18+i).css("left",-10):$("#coachmark_callout").css("top",Math.round(_.clamp(s.top-o.top+(e.height()-30)/2+i,18,o.height-48))).css("left",-10)}},placeBelowOf:function(e,t,n,i,a){if(TS.coachmark.context&&TS.coachmark.$coachmark){t=t||0,n=n||0,i=i||0;var s,r=TS.coachmark.$coachmark;s=a?{top:0,left:0}:e.offset(),r.css("top",s.top+e.height()+t),r.css("left",s.left+n),a||TS.coachmark.keepInBounds();var o=r.dimensions_rect();a?$("#coachmark_callout").css("left",18+i).css("top",-10):$("#coachmark_callout").css("left",Math.round(_.clamp(s.left-o.left+(e.width()-30)/2+i,18,o.width-48))).css("top",-10)}},placeAboveOf:function(e,t,n,i,a){if(TS.coachmark.context&&TS.coachmark.$coachmark){t=t||0,n=n||0,i=i||0;var s,r=TS.coachmark.$coachmark;s=a?{top:0,left:0}:e.offset(),r.css("top",s.top-30-r.height()+t),r.css("left",s.left+n),a||TS.coachmark.keepInBounds();var o=r.dimensions_rect();a?$("#coachmark_callout").css("left",18+i).css("bottom",-10):$("#coachmark_callout").css("left",Math.round(_.clamp(s.left-o.left+(e.width()-30)/2+i,18,o.width-48))).css("bottom",-10)}},placeLeftOf:function(e,t,n,i,a){if(TS.coachmark.context&&TS.coachmark.$coachmark){t=t||0,n=n||0,i=i||0;var s,r=TS.coachmark.$coachmark;s=a?{top:0,left:0}:e.offset(),r.css("top",s.top+t),r.css("left",s.left-r.width()+n),a||TS.coachmark.keepInBounds();var o=r.dimensions_rect();a?$("#coachmark_callout").css("top",18+i).css("right",-10):$("#coachmark_callout").css("top",Math.round(_.clamp(s.top-o.top+(e.height()-30)/2+i,18,o.height-48))).css("right",-10)}},keepInBounds:function(){if(TS.coachmark.context&&TS.coachmark.$coachmark){var e=TS.coachmark.$coachmark,t=TS.coachmark.context,n=e.dimensions_rect(),i={top:4,right:$(window).width()-4,bottom:$(window).height()-4,left:4};t.place||e.css("left","").css("right","").css("top","").css("bottom",""),TS.utility.doesRectContainRect(i,n)||(n.left<i.left?e.css("left",i.left):n.right>i.right&&e.css("left",Math.max(i.left,i.right-n.width)),n.top<i.top?e.css("top",i.top):n.bottom>i.bottom&&e.css("top",Math.max(i.top,i.bottom-n.height)))}},clean:function(){$("#coachmark_footer > .coachmark_footer_text").removeClass("hidden"),TS.coachmark.context&&TS.coachmark.$coachmark.removeClass(TS.coachmark.context.coachmark_el_id).removeClass("small_coachmark"),TS.coachmark.is_small=!1,TS.coachmark.context=null},reject:function(e){var t=TS.coachmark.context;t&&t.reject&&t.reject(),TS.coachmark.end(),TS.newxp&&TS.clog.track("GROWTH_ONBOARDING",{action:"skip_tutorial_step",step:TS.newxp.getCurrentStepName()}),e&&e.stopPropagation()},resolve:function(e){var t=TS.coachmark.context;t&&t.resolve&&t.resolve(),TS.coachmark.end(),e&&e.stopPropagation()},expand:function(t){var n=TS.coachmark.$coachmark,i=n.find("#coachmark_interior");TS.coachmark.is_small&&(TS.coachmark.is_small=!1,i.css("opacity",0),n.removeClass("small_coachmark"),e(),$("#coachmark_bg").removeClass("hidden"),window.setTimeout(function(){i.css("opacity",1)},100)),t&&t.stopPropagation()},end:function(){TS.model.coachmark_is_showing=!1,TS.coachmark.is_showing=!1;var e=TS.coachmark.$coachmark;e.css("opacity",0),TS.coachmark.$coachmark.find(".coachmark_div").remove(),TS.coachmark.clean(),e.addClass("hidden"),$("#coachmark_bg").addClass("hidden"),$("#client-ui").removeClass("disable_scrolling"),TS.coachmark.$coachmark.remove(),TS.coachmark.$coachmark=null,$(window.document).off("keydown",TS.coachmark.onKeyDown),$("html").off("mousedown",TS.coachmark.onMouseDown),$(window).off("resize.coachmark_placement"),$("#coachmark_bg").off("click",TS.coachmark.end)},onKeyDown:function(e){e.which==TS.utility.keymap.esc?TS.coachmark.reject(e):e.which==TS.utility.keymap.enter&&(TS.coachmark.is_small?TS.coachmark.expand(e):TS.coachmark.resolve(e))},onMouseDown:function(e){TS.coachmark.is_small?TS.coachmark.expand(e):$(e.target).closest("#coachmark").length||TS.coachmark.resolve(e)},onClickInvite:function(e){return!$(".coachmark_invite_people").is(":visible")||$(e.target).is("#coachmark_bg")?TS.coachmark.resolve(e):(TS.ui.admin_invites.canInvite()&&TS.ui.admin_invites.start(),TS.coachmark.resolve(e))}});var e=function(){var e=TS.coachmark.context;e.placeSmall&&TS.coachmark.is_small?e.placeSmall():e.place?e.place():TS.coachmark.keepInBounds()},t=function(e,t){var n;n=t?$("."+e.inline_wrapper_el_class):$("#client-ui"),!n.length&&TS.calls&&(n=$("#calls_conference_content")),n.append(TS.templates.coachmark({can_include_invite_cta:!TS.calls&&TS.newxp&&TS.newxp.canIncludeInviteCTA(),has_close_btn:e.has_close_btn})),TS.coachmark.$coachmark=$("#coachmark");var i=TS.coachmark.$coachmark;i.css("opacity",0),i.on("click",".coachmark_skip_link",TS.coachmark.reject),i.on("click",".coachmark_got_it",TS.coachmark.resolve),i.on("click",".coachmark_next_tip",TS.coachmark.resolve),i.on("click",".coachmark_ok",TS.coachmark.resolve),i.on("click",".coachmark_close_btn",TS.coachmark.reject)},n=function(e){TS.coachmark.$coachmark&&(e.content&&TS.coachmark.$coachmark.find("#coachmark_interior").prepend(e.content()),e.buttonText?TS.coachmark.$coachmark.find(".coachmark_next_tip").text(e.buttonText()):TS.coachmark.$coachmark.find(".coachmark_next_tip").text(TS.i18n.t("Next Tip","coachmarks")()),e.footer&&TS.coachmark.$coachmark.find("#coachmark_footer").html(e.footer()))}}()},2300:function(e,t){!function(){"use strict";TS.registerModule("coachmarks",{coachmarks:{channels:{id:"channels_coachmark",coachmark_el_id:"channels_coachmark_div",place:function(){TS.coachmark.placeRightOf($("#channels_header"),-26,10,5)},content:function(){var e=TS.channels.getChannelsForUser().length,t=TS.groups.getUnarchivedGroups().length,n=TS.groups.getUnarchivedGroups().length?TS.groups.getUnarchivedGroups()[0].name:"",i={channels_count:e,groups_count:t,total_count:e+t,first_group_channel_name:n,in_single_private_channel:!e&&1===t};return TS.templates.channels_coachmark(i)}},invites:{id:"invites_coachmark",coachmark_el_id:"invites_coachmark_div",place:function(){TS.coachmark.placeRightOf($("#channel_list_invites_link"),-26,63,9)},content:function(){return TS.templates.invites_coachmark()}},direct_messages:{id:"direct_messages_coachmark",coachmark_el_id:"direct_messages_coachmark_div",place:function(){TS.coachmark.placeRightOf($("#direct_messages_header"),-26,10,5)},content:function(){var e={channels_count:TS.channels.getChannelsForUser().length,groups_count:TS.groups.getUnarchivedGroups().length};return TS.templates.direct_messages_coachmark(e)}},highlights_feedback:{id:"highlights_feedback_coachmark",coachmark_el_id:"highlights_feedback_coachmark_div",inline_wrapper_el_class:"highlights_feedback_to_coach",no_bg:!0,has_close_btn:!0,place:function(){TS.coachmark.placeBelowOf($(".highlights_feedback_to_coach"),40,-330,340,!0)},content:function(){return TS.templates.highlights_feedback_coachmark()},buttonText:function(){return TS.i18n.t("Got it!","coachmarks")()}},recent_mentions:{id:"recent_mentions_coachmark",coachmark_el_id:"recent_mentions_coachmark_div",no_bg_on_small:!0,place:function(){TS.coachmark.placeBelowOf($("#recent_mentions_toggle"),25,-340,1)},placeSmall:function(){TS.coachmark.placeBelowOf($("#recent_mentions_toggle"),25,-240,1)},content:function(){return TS.templates.recent_mentions_coachmark()}},starred_items:{id:"starred_items_coachmark",coachmark_el_id:"starred_items_coachmark_div",no_bg_on_small:!0,place:function(){TS.coachmark.placeBelowOf($("#stars_toggle"),25,-340,3)},placeSmall:function(){TS.coachmark.placeBelowOf($("#stars_toggle"),25,-220,8)},content:function(){return TS.templates.starred_items_coachmark()}},replies:{id:"replies_coachmark",coachmark_el_id:"replies_coachmark_div",place:function(){TS.coachmark.placeLeftOf($("#convo_tab_header"),-27,-20,6)},content:function(){return TS.templates.replies_coachmark()},buttonText:function(){return TS.i18n.t("Next","coachmarks")()},resolve:function(){TS.ui.replies.focusReplyInput(),_.defer(function(){TS.coachmark.start(TS.coachmarks.coachmarks.replies_2)})}},replies_2:{id:"replies_coachmark",coachmark_el_id:"replies_coachmark_div",place:function(){TS.coachmark.placeLeftOf($("#reply_container"),-75,-20,6)},content:function(){return TS.templates.replies_coachmark_step_two()},buttonText:function(){return TS.i18n.t("Next","coachmarks")()},resolve:function(){_.defer(function(){TS.useReactSidebar()||$("#channels_scroller").scrollTop(0),TS.coachmark.start(TS.coachmarks.coachmarks.replies_3)})}},replies_3:{id:"replies_coachmark",coachmark_el_id:"replies_coachmark_div",place:function(){TS.coachmark.placeRightOf($("#all_threads_nav"),-16)},buttonText:function(){return TS.i18n.t("Got it!","coachmarks")()},content:function(){return TS.templates.replies_coachmark_step_three()}},unread_view:{id:"unread_view_coachmark",coachmark_el_id:"unread_view_coachmark_div",place:function(){TS.coachmark.placeRightOf($("#all-unreads-list"),-16)},content:function(){return TS.templates.unread_view_coachmark()}},calls_video_beta:{id:"calls_video_beta_coachmark",coachmark_el_id:"calls_video_beta_coachmark_div",place:function(){TS.coachmark.placeAboveOf($("#camera"),15,-64,19)},content:function(){return TS.templates.calls_video_beta_coachmark()},ui_click:!0},calls_ss_window:{id:"calls_ss_window_coachmark",coachmark_el_id:"calls_ss_window_coachmark_div",place:function(){TS.coachmark.placeAboveOf($("#screen"),0,-180,12)},buttonText:function(){return TS.i18n.t("Got it!","coachmarks")()},content:function(){return TS.templates.calls_ss_window_coachmark()},ui_click:!0},calls_ss_main:{id:"calls_ss_main_coachmark",coachmark_el_id:"calls_ss_main_coachmark_div",place:function(){TS.coachmark.placeBelowOf($(".call_icon"),17,-25,5)},buttonText:function(){return TS.i18n.t("Got it!","coachmarks")()},content:function(){return TS.templates.calls_ss_main_coachmark()}},calls_video_ga:{id:"calls_video_ga_coachmark",coachmark_el_id:"calls_video_ga_coachmark_div",place:function(){TS.coachmark.placeBelowOf($(".call_icon"),17,-97,5)},content:function(){return TS.templates.calls_video_ga_coachmark()}},gdrive:{id:"gdrive_coachmark",coachmark_el_id:"gdrive_coachmark_div",place:function(){TS.coachmark.placeAboveOf($("#primary_file_button"),13,-6,0)},content:function(){return TS.templates.gdrive_coachmark()}},intl_channel_names:{id:"intl_channel_names_coachmark",coachmark_el_id:"intl_channel_names_coachmark_div",place:function(){TS.coachmark.placeBelowOf($(".title_input"),70,105,20)},buttonText:function(){return TS.i18n.t("Got it!","coachmarks")()},content:function(){return TS.templates.intl_channel_names_coachmark()}},apps:{id:"apps_coachmark",coachmark_el_id:"apps_coachmark_div",place:function(){TS.coachmark.placeRightOf($("#apps_header"),-26,10,5)},buttonText:function(){return TS.i18n.t("Get started","coachmarks")()},content:function(){return TS.templates.apps_coachmark()},resolve:function(){return TS.ui.apps_browser.start()},has_close_btn:!0,disable_scrolling:!0}},onStart:function(){}})}()},2329:function(e,t){!function(){"use strict";TS.registerModule("ui.shortcuts_dialog",{$div:null,showing:!1,is_space:!1,onStart:function(){},onKeydown:function(e){TS.ui.shortcuts_dialog.showing&&(e.which!=TS.utility.keymap.enter&&e.which!=TS.utility.keymap.esc||(TS.ui.shortcuts_dialog.cancel(),e.preventDefault()),70==e.which&&TS.utility.cmdKey(e)&&e.preventDefault())},start:function(){TS.ui.shortcuts_dialog.is_space=TS.web&&TS.web.space,TS.tips.hideAll(),TS.ui.shortcuts_dialog.$div||TS.ui.shortcuts_dialog.build();var e=TS.templates.shortcuts_dialog({meta_key:TS.model.is_mac?TS.i18n.t("Option","keys")():TS.i18n.t("Alt","keys")(),cmd_key:TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")(),cmd_key_label:TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")(),can_show_a11y_keyboard_shortcuts:TS.boot_data.feature_a11y_keyboard_shortcuts,can_show_unread_view:TS.client&&TS.client.unread.isEnabled(),show_browse_dms_shortcut:!0});TS.ui.shortcuts_dialog.is_space&&(e=TS.templates.shortcuts_spaces_dialog({clear_formatting:!TS.model.is_win,meta_key:TS.model.is_mac?TS.i18n.t("Option","keys")():TS.i18n.t("Alt","keys")(),cmd_key:TS.model.is_mac?TS.i18n.t("Cmd","keys")():TS.i18n.t("Ctrl","keys")(),cmd_key_label:TS.model.is_mac?TS.i18n.t("Command","keys")():TS.i18n.t("Control","keys")()}));var t=TS.ui.shortcuts_dialog.$div;t.html(e).modal("show").find(".dialog_cancel").click(TS.ui.shortcuts_dialog.cancel),TS.ui.shortcuts_dialog.is_space||TS.ui.a11y.saveCurrentFocusAndFocusOnElement(t)},cancel:function(){TS.ui.shortcuts_dialog.$div.modal("hide")},end:function(){TS.model.dialog_is_showing=!1,TS.ui.shortcuts_dialog.showing=!1,TS.ui.shortcuts_dialog.$div.empty(),$(window.document).unbind("keydown",TS.ui.shortcuts_dialog.onKeydown),TS.ui.shortcuts_dialog.is_space||TS.ui.a11y.restorePreviousFocusAndCleanUpElement(TS.ui.shortcuts_dialog.$div),TS.tips.unhideAll()},build:function(){var e;TS.ui.shortcuts_dialog.is_space?($("body").append('<div id="shortcuts_spaces_dialog" class="modal hide fade"></div>'),TS.ui.shortcuts_dialog.$div=$("#shortcuts_spaces_dialog"),e=TS.ui.shortcuts_dialog.$div):($("body").append('<div id="shortcuts_dialog" class="modal hide fade"></div>'),TS.ui.shortcuts_dialog.$div=$("#shortcuts_dialog"),e=TS.ui.shortcuts_dialog.$div),e.on("hidden",function(e){e.target==this&&TS.ui.shortcuts_dialog.end()}),e.on("show",function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.shortcuts_dialog.showing=!0)}),e.on("shown",function(t){t.target==this&&($(window.document).bind("keydown",TS.ui.shortcuts_dialog.onKeydown),TS.ui.shortcuts_dialog.height=e.outerHeight()+e.offset().top,TS.ui.shortcuts_dialog.width=e.outerWidth(),TS.ui.shortcuts_dialog.toggleScrollbars(),$(window).on("resize",TS.ui.shortcuts_dialog.toggleScrollbars))})},toggleScrollbars:function(){if(TS.ui.shortcuts_dialog.showing){var e=TS.ui.shortcuts_dialog.width>$(window).width(),t=TS.ui.shortcuts_dialog.height>$(window).height()||e;TS.ui.shortcuts_dialog.$div.toggleClass("single_column",e),TS.ui.shortcuts_dialog.$div.toggleClass("scroll_content",t)}}})}()},2336:function(e,t){!function(){"use strict";TS.registerModule("magic_login",{onStart:function(){},make:function(e,t){i(e,t)},execute:function(e){a(e)}});var e,t,n,i=function(i,a){e=a.app_uri,t=a.browser_uri,n=a.fall_back_to_browser,e?i.attr("href",e):e=i.attr("href"),n&&t&&s(i)},a=function(i){e=i.app_uri,t=i.browser_uri,n=i.fall_back_to_browser,d()},s=function(e){e.on("click",function(e){d(e)})},r=function(){window.navigator.msLaunchUri(e,function(){},function(){window.location.href=t})},o=function(n){n&&n.preventDefault();var i=window.setTimeout(function(){window.location.href=t},1500);window.addEventListener("blur",function(){clearTimeout(i)});var a=document.createElement("iframe");a.className="hidden",a.src=e,document.body.appendChild(a)},l=function(n){n&&n.preventDefault();var i=window.setTimeout(function(){window.location.href=t},1500);window.addEventListener("blur",function(){clearTimeout(i)}),window.location.href=e},d=function(n){bowser&&(bowser.firefox||bowser.safari)?o(n):bowser&&(bowser.msie||bowser.msedge)&&void 0!==window.navigator.msLaunchUri&&e.indexOf("://")>0?r():bowser&&bowser.chromeBook?window.location.href=t:l(n)}}()},2337:function(e,t){!function(){"use strict";TS.registerModule("menu.date",{onStart:function(){},startWithExpirationPresets:function(a){e=a.date_picker_args,t=a.onSelect,i(),n(a)}});var e,t,n=function(e){var t=!!_.isUndefined(e.attach_to_target)||e.attach_to_target;if(TS.menu.start(e.event,!1,{attach_to_target_at_full_width:t,onClose:e.onClose}),t){var n=-1*TS.menu.$menu.outerHeight()-5,i=e.$target.position().left-TS.menu.$menu.outerWidth()/2+e.$target.outerWidth()/2;TS.menu.$menu.css({top:Math.floor(n),left:Math.floor(i)})}else{var a=e.$target.outerWidth()/2*-1,s=e.$target.outerHeight()+5;TS.menu.positionAt(e.$target,Math.floor(a),Math.floor(s))}},i=function(){TS.menu.buildIfNeeded(),TS.menu.clean(),TS.menu.$menu.addClass("expiration_date_picker"),TS.menu.$menu_header.addClass("hidden").empty(),TS.menu.$menu_items.html(TS.templates.menu_expiration_date_items()),TS.menu.$menu_items.on("click.menu","li",r),TS.menu.$menu_footer.removeClass("hidden").html(TS.templates.menu_expiration_context())},a=function(){TS.menu.buildIfNeeded(),TS.menu.clean(),TS.menu.$menu.addClass("date_picker expiration_date_picker"),TS.menu.$menu_header.addClass("hidden").empty(),TS.menu.$menu_footer.addClass("hidden").empty(),TS.menu.$menu_items.html(TS.templates.menu_expiration_date_picker()),TS.menu.$menu_items.on("click.menu","li#date_picker_back_item",function(e){i(),e.stopPropagation()});var t={onChange:s,onHide:o};_.assign(t,e);var n=TS.menu.$menu.find("#date_picker_container");TS.ui.date_picker.startExpirationDatePicker(n,t)},s=function(e){if("string"==typeof e&&(e=parseInt(e,10)),isNaN(e))return void TS.warn("date_ts could not be parsed as a number.");t&&t(e),TS.menu.end()},r=function(e){if(!TS.menu.isRedundantClick(e)){var t=$(this).attr("data-expiration-option");if(!t)return void TS.warn("Selected an invalid expiration date menu item.");var n;switch(t){case"none":s(0);break;case"7days":n=l(7),s(n);break;case"30days":n=l(30),s(n);break;case"60days":n=l(60),s(n);break;case"custom":a()}e.stopPropagation()}},o=function(){var e=$("#date_picker_container");e.pickmeup&&_.defer(function(){e.pickmeup("destroy")})},l=function(e){if(!_.isNumber(e))return void TS.error("num_days must be a number.");var t=new Date;return t.setHours(23,59,59,0),t.setDate(t.getDate()+e),t.getTime()/1e3}}()},2338:function(e,t){!function(){"use strict";TS.registerModule("ui.admin_invites",{invites_sent_sig:new signals.Signal,emails_parsed_sig:new signals.Signal,onStart:function(){TS.ui.admin_invites.invites_sent_sig.add(ne,TS.ui.admin_invites),TS.ui.admin_invites.emails_parsed_sig.add(se,TS.ui.admin_invites),TS.team.team_email_domain_changed_sig.add(b,TS.ui.admin_invites),TS.prefs.team_auth_mode_changed_sig.add(H,TS.ui.admin_invites),TS.prefs.team_sso_auth_restrictions_changed_sig.add(H,TS.ui.admin_invites),TS.prefs.team_invites_only_admins_changed_sig.add(TS.ui.admin_invites.maybeShowInviteLink,TS.ui.admin_invites),TS.web&&TS.web.login_sig.add(TS.ui.admin_invites.onLogin,TS.ui.admin_invites),TS.client&&TS.client.login_sig.add(TS.ui.admin_invites.onLogin,TS.ui.admin_invites),u=TS.storage.fetchInvitesState(),$("body").on("click",'[data-action="admin_invites_modal"]',function(){if(!TS.isPartiallyBooted()){var e={};$(this).data("account-type")&&(e.account_type=$(this).data("account-type")),S(e)}})},onLogin:function(){b()},start:function(e){TS.isPartiallyBooted()||_e()&&S(e)},switchToPicker:function(){_e()&&W()},maybeShowInviteLink:function(){if(TS.client){var e=!1,t=!1;_e()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26&&(e=!0),_e()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length>=2&&(t=!0),$("#channel_list_invites_link").toggleClass("hidden",!e).toggleClass("dim",t)}},populateInvites:function(t){if(_e()&&t){var n=u.reduce(function(e,t){return e[t.email]=!0,e},{});t.forEach(function(e){n[e.email]||(n[e.email]=!0,u.push(e))}),TS.storage.storeInvitesState(u),u.length&&TS.ui.fs_modal.is_showing&&(e.find(".admin_invite_row").remove(),u.forEach(function(e){B(e)}))}},canInvite:function(){return _e()},test:function(){var e={_error_map:f,_getError:me};return Object.defineProperty(e,"_getError",{get:function(){return me},set:function(e){me=e}}),Object.defineProperty(e,"_error_map",{get:function(){return f},set:function(e){f=e}}),e}});var e,t,n,i,a,s,r,o=0,l=0,d=[],c=[],u=[],m=TS.i18n.t("name@example.com","invite")(),h=m,p="",g="",f={url_in_message:TS.i18n.t("Sorry, but URLs are not allowed in the custom message. Please remove it and try again!","invite")(),invalid_email:TS.i18n.t("That doesnt look like a valid email address!","invite")(),already_in_team:TS.i18n.t("This person is already on your team.","invite")(),user_disabled:function(){return TS.i18n.t('This person is already on your team, but their account is deactivated. You can <a href="{url}#disabled">manage</a> their account.',"invite")({url:TS.model.team_url})},already_invited:TS.i18n.t("This person has already been invited to your team.","invite")(),sent_recently:TS.i18n.t("This person was recently invited. No need to invite them again just yet.","invite")(),invite_failed:TS.i18n.t("Something went wrong with this invite :(","invite")(),ura_limit_reached:TS.i18n.t("Youve reached your team limit for Single-channel Guests. You must invite more paid team members first.","invite")(),user_limit_reached:TS.i18n.t("Youve reached the maximum number of users for this team.","invite")(),not_allowed:TS.i18n.t("You cant invite this type of account based on your current SSO settings.","invite")(),custom_message_not_allowed:TS.i18n.t("Sorry, you cant add a custom message to this invite. Please remove it and try again!","invite")(),domain_mismatch:TS.i18n.t("Your SSO settings prevent you from inviting people from this email domain.","invite")(),invite_limit_reached:TS.i18n.t("Your team has exceeded the limit on invitations. After more people have accepted the ones your team has sent, you can send more. Revoking invitations will not lift the limit. Our Help Center has <a href='https://get.slack.help/hc/{locale}/articles/201330256#invitation_limits'>more details on invitation limits</a>.","invite")({locale:TS.i18n.zdLocale()}),too_long:TS.i18n.t("This persons name exceeds the 35-character limit.","invite")(),org_user_is_disabled:TS.i18n.t("This person has a deactivated account for your organization.","invite")(),org_user_is_disabled_but_present:TS.i18n.t("This person is already on your team, but they have been deactivated by your organization. Contact an organization administrator to re-enable their account","invite")(),mismatch_with_pending_team_invite:function(e){var t;switch(e.user_type){case"ultra_restricted":t=TS.i18n.t("Single-Channel Guest","invite")();break;case"restricted":t=TS.i18n.t("Multi-Channel Guest","invite")();break;default:t=TS.i18n.t("full Team Member","invite")()}return TS.i18n.t("This person cant be invited, because they have already been invited as a {account_type} to your organization","invite")({account_type:t})},user_type_mismatch:function(e){var t;switch(e.issue){case"org_user_is_restricted":t=TS.i18n.t("Multi-Channel Guest","invite")();break;case"org_user_is_ultra_restricted":t=TS.i18n.t("Single-Channel Guest","invite")();break;case"org_user_not_restricted":case"org_user_not_ultra_restricted":t=TS.i18n.t("full Team Member","invite")()}return _.isUndefined(t)?TS.i18n.t("This person already has an account for your organization","invite")():TS.i18n.t("This person already has a {account_type} account for your organization, so you can only invite them in that role.","invite")({account_type:t})}},S=function(e){var i;n=null,ue()?e&&e.account_type&&(i=e.account_type):i="full",e&&e.initial_channel_id&&(t=e.initial_channel_id);var a=TS.templates.admin_invite_modal({can_add_ura:TS.model.can_add_ura,team_name:TS.model.team.name,team_in_org:TS.model.team.enterprise_id,hide_full_member_option:TS.utility.invites.hideFullMemberInviteOption(),team_signup_url:"https://"+TS.model.team.domain+".slack.com/signup",invites_limit:""===TS.model.team.plan&&TS.model.team.prefs.invites_limit,show_custom_message:TS.model.team.plan,is_paid_team:TS.model.team.plan,is_our_app:TS.model.is_our_app}),s={body_template_html:a,onShow:T,onCancel:v,clog_name:"INVITEMODAL"};TS.client&&TS.ui.a11y.saveCurrentFocus(),TS.ui.fs_modal.start(s),i&&setTimeout(function(){Y(i)},0)},T=function(){var t=$("#admin_invites_alert");!TS.model.team.plan&&TS.model.user.is_admin?(t.removeClass("hidden"),TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"admin_invites",action:"impression",ui_element:"invite_modal_guest_alert"}}})):t.addClass("hidden");var n;e=$("#admin_invites_container"),e.find("#admin_invites_switcher").on("click",'[data-action="switch_type"]',function(e){var t=$(e.target);t.is("a")||t.closest(".admin_invites_account_type_option").hasClass("disabled")||Y($(this).data("account-type"))}),e.find('[data-action="admin_invites_add_row"]').on("click",B),e.find('a[data-action="admin_invites_switch_view"]').on("click",function(){V($(this).data("view"))}),e.find('button[data-action="api_send_invites"]').on("click",function(e){e.preventDefault(),X(),!TS.model.team.plan&&TS.model.user.is_admin&&t.css("visibility","hidden")}),e.find('button[data-action="api_parse_emails"]').on("click",function(e){e.preventDefault(),ie(),$(this).find(".ladda-label").text(TS.i18n.t("Processing email addresses ...","invite")())}),n=e.find(".admin_invites_custom_message_container"),k(),w(),e.find('a[data-action="admin_invites_show_custom_message"]').on("click",function(){F()}),e.find('[data-action="admin_invites_hide_custom_message"]').on("click",function(){P()}).hover(function(){n.addClass("delete_highlight")},function(){n.removeClass("delete_highlight")}),e.find("#admin_invite_custom_message").on("input",O),e.find("#bulk_emails").css("overflow","hidden").autogrow(),u=TS.storage.fetchInvitesState(),u.length?TS.ui.admin_invites.populateInvites(u):B();var i=e.find(".admin_invite_row").length;if(i<3){var a=3-i;_.times(a,B)}},v=function(){o=0,l=0,u=c.length?[]:Z(),d=[],c=[],Q(),r&&r(),TS.storage.storeInvitesState(u),TS.client&&TS.ui.a11y.restorePreviousFocus()},b=function(){h=m},w=function(){if(!TS.model.team.plan)return y(!1);TS.api.callImmediately("users.admin.canAddUltraRestricted").then(function(e){y(e.data.ok)},function(){y(!1)})},y=function(e){TS.model.can_add_ura=e;var t=$('.admin_invites_account_type_option[data-account-type="ultra_restricted"]');if(t.toggleClass("disabled",!TS.model.can_add_ura),!TS.model.can_add_ura){$(".account_type_disabled_hover",t).removeClass("hidden")}},k=function(){(a=document.getElementById("btn_connect_contacts"))&&(a.addEventListener("click",A),s=TS.model.user.id+Date.now(),TS.google_auth.getAuthLink(s).then(function(){TS.utility.disableElement(a,!1)}))},A=function(){TS.google_auth.getAuthLink(s).then(function(e){var t=window.open(e,"auth_window","menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes,width=600,height=500");C(t)})},C=function(e){r=TS.google_auth.pollForAuthStatus(s,M,e).cancel},M=function(t){if(r=null,t){var n=TS.i18n.t("Google contacts connected","invite")();e.find(".btn_connect_contacts_text").text(n),a.removeEventListener("click",A),TS.clog.track("INVITEMODAL_ACTION",{action:"google_auth_success",trigger:"user_allowed_access"}),x()}},x=function(){var e={page:1,count:1e3};TS.google_auth.getContactList(s,e).then(function(e){0===$("input.email_field").filter(function(){return!this.value}).length&&B(),I(e)})},I=function(e){if(e&&(i=i||e.items,$("input.email_field").lazyFilterSelect({approx_item_height:50,data:i,single:!0,placeholder_text:TS.i18n.t("name@example.com","invite")(),onReady:function(){E(this)},filter:function(e,t){if(t=t.toLowerCase(),e.full_name)var n=e.full_name.toLowerCase();if(e.email)var i=e.email.toLowerCase();return n&&-1!==n.indexOf(t)||i&&-1!==i.indexOf(t)},noResultsTemplate:function(e){return TS.i18n.t("None of your Google contacts match <strong>{query}</strong>","invite")({query:_.escape(e)})},onItemAdded:function(e){E(this,e),TS.clog.track("INVITEMODAL_ACTION",{action:"add_google_email",trigger:"select_google_contact_from_dropdown"})},onInputFocus:function(){$(".ts_tip_tip").remove(),$(".lazy_filter_select").removeClass("ts_tip ts_tip_top ts_tip_float ts_tip_multiline ts_tip_delay_1000")},onInputBlur:function(){E(this)},template:function(e){var t=TS.templates.admin_invite_filter_select_contact({contact:e});return new Handlebars.SafeString(t)}}).addClass("hidden"),void 0!==e.items)){var t=TS.i18n.t("Type here to search your Google contacts","invite")(),n='<span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+t+"</span></span>";$("input.email_field").filter(function(){return!this.value}).first().lazyFilterSelect("container").addClass("ts_tip ts_tip_top ts_tip_float ts_tip_multiline ts_tip_delay_1000").append(n)}},E=function(e,t){var n=e.$container[0],i=$(n).parents(".admin_invite_row");if(t)TS.boot_data.feature_name_tagging_client?$(i).find("input[name*=real_name]").val(t.full_name):($(i).find("input[name*=first_name]").val(t.given_name),$(i).find("input[name*=last_name]").val(t.family_name)),$(i).find("input[name*=email_address]").val(t.email);else{var a=$(i).find("input.lfs_input").val(),s=$(i).find("input[name*=email_address]").val();a?($(i).find("input.email_field").lazyFilterSelect("clearValue"),$(i).find("input[name*=email_address]").val(a)):s&&$(i).find("input.lfs_input").val(s)}},B=function(t){var n=!0;0===e.find(".admin_invite_row").length?n=!1:e.find(".admin_invite_row").first().find(".delete_row").removeClass("hidden"),e.find("#invite_rows").append(TS.templates.admin_invite_row({index:o,show_delete_btn:n,placeholder_email_address:h}));var a=e.find("#invite_"+o);a.find('[data-action="admin_invites_delete_row"]').on("click",function(){U(a)}).hover(function(){a.addClass("delete_highlight")},function(){a.removeClass("delete_highlight")}),a.find('[name="email_address"]').focus(),t&&(a.find('[name="email_address"]').val(t.email),a.find(".lfs_input_container input.lfs_input").val(t.email),TS.boot_data.feature_name_tagging_client?a.find('[name="real_name"]').val(t.real_name):(a.find('[name="first_name"]').val(t.first_name),a.find('[name="last_name"]').val(t.last_name))),TS.google_auth.isAuthed(s)&&i&&I(i),o+=1},D=function(t,n){e.find("#invite_notice").toggleClass("alert_warning","alert_warning"===t).toggleClass("alert_info","alert_info"===t).toggleClass("alert_error","alert_error"===t).html(n).slideDown(100)},F=function(){e.find(".admin_invites_hide_custom_message").addClass("hidden"),e.find(".admin_invites_show_custom_message").removeClass("hidden"),O()},P=function(){e.find(".admin_invites_hide_custom_message").removeClass("hidden"),e.find(".admin_invites_show_custom_message").addClass("hidden"),O()},O=function(){var t=e.find("#admin_invite_custom_message"),n=t.val().trim(),i=e.find(".admin_invites_show_custom_message"),a=!i.hasClass("hidden")&&!!t.data("validation")&&t.data("validation").includes("hasnourl")&&!!TS.utility.findUrls(n).length;R(a)},R=function(t){e.find("#admin_invites_submit_btn").toggleClass("disabled",t)},U=function(t){t&&t.length&&t.slideToggle(100,function(){t.remove();var n=$(".admin_invite_row").length;0===n?B():1===n&&e.find(".admin_invite_row").first().find(".delete_row").addClass("hidden")})},L=function(){var t,n=$("#account_type").val();t="full"===n?TS.i18n.t("Send Invitations","invite")():TS.i18n.t("Invite Guests","invite")(),e.find('button[data-action="api_send_invites"]').find(".ladda-label").text(t)},Q=function(){t=void 0},H=function(){var t=e.find("#account_type").val(),n=!1,i="google"===TS.model.team.prefs.auth_mode||"saml"===TS.model.team.prefs.auth_mode,a=!1,s=TS.boot_data.page_needs_enterprise,r="";if(s&&"full"===t||i&&0===TS.model.team.prefs.sso_auth_restrictions){a=!0;var o=TS.utility.enterprise.getProviderLabel(TS.model.enterprise,_.get(TS.model,"enterprise.sso_provider.label","single sign-on"));r=TS.i18n.t("Only people with {account_type} accounts will be able to accept invitations.","invite")({account_type:o})}if("google"===TS.model.team.prefs.auth_mode)"full"!==t||0!==TS.model.team.prefs.sso_auth_restrictions&&1!==TS.model.team.prefs.sso_auth_restrictions?"restricted"!==t&&"ultra_restricted"!==t||0!==TS.model.team.prefs.sso_auth_restrictions||(n=!0):n=!0;else if("saml"===TS.model.team.prefs.auth_mode&&(0===TS.model.team.prefs.sso_auth_restrictions||1===TS.model.team.prefs.sso_auth_restrictions)&&"full"===t&&!s){var l=TS.templates.admin_invite_switcher({can_add_ura:TS.model.can_add_ura,hide_full_member_option:TS.utility.invites.hideFullMemberInviteOption(),team_signup_url:"https://"+TS.model.team.domain+".slack.com/signup",team_in_org:TS.model.team.enterprise_id});$("#admin_invites_switcher").html(l),W()}$("#google_auth_email_domain_notice").toggleClass("hidden",!n),$("#sso_signup_notice").html(r).toggleClass("hidden",!a)},N=function(t){var n;return e.find('input[name="email_address"]').each(function(){$(this).val()==t&&(n=$(this).closest(".admin_invite_row"))}),n},G=function(e,t){_.isObject(t)||TS.error("_rowError did not receive an error object: ",t);var n=me(t);e&&(e.find("label.email").addClass("error").end().find(".error_msg").removeClass("hidden").html(n),"too_long"===t.error&&e.find("label").addClass("error"),e.find("input").on("keyup.admin_invite_error_fixed",function(){j(e)}))},j=function(e){e&&(e.find("label").removeClass("error").end().find(".error_msg").addClass("hidden"),e.find("input").off(".admin_invite_error_fixed"))},z=function(){setTimeout(function(){Ladda.stopAll(),e.find(".admin_invite_row").remove(),d=[],c=[],n=null,L(),_.times(3,B)},0)},K=function(){setTimeout(function(){Ladda.stopAll(),e.find('button[data-action="api_parse_emails"]').find(".ladda-label").text(TS.i18n.t("Add Invitees","invite")()),e.find("#bulk_emails").prop("disabled",!1)},0)},W=function(){e.find("#admin_invites_header").find(".admin_invites_header_type").removeClass("normal").text("people").end().find(".admin_invites_header_team_name").removeClass("hidden"),e.find("#admin_invites_switcher").removeClass("hidden"),e.find("#admin_invites_workflow").addClass("hidden"),TS.ui.fs_modal.hideBackButton()},V=function(t){if("individual"===t)e.find("#individual_invites").removeClass("hidden"),e.find("#bulk_invites, #bulk_notice").addClass("hidden"),e.find("#bulk_emails").val(""),e.find(".email_field").first().focus(),e.find(".invite_modal_options_container").removeClass("hidden"),K();else if("bulk"===t){e.find("#bulk_invites").removeClass("hidden"),e.find("#individual_invites").addClass("hidden"),e.find(".invite_modal_options_container").addClass("hidden");var n=e.find('button[data-action="api_parse_emails"]');n.hasClass("ladda")||(Ladda.bind('button[data-action="api_parse_emails"]'),n.addClass("ladda")),n.find(".ladda-label").text(TS.i18n.t("Add Invitees","invite")());var i=Z();if(i){var a="";$.each(i,function(e,t){t.first_name&&(a+=t.first_name+" "),t.last_name&&(a+=t.last_name+" "),a+="<"+t.email+">, "}),e.find("#bulk_emails").val(a).autogrow()}e.find("#bulk_emails").focus()}},Y=function(n){var i=[],a=TS.channels.getUnarchivedChannelsForUser();_.isArray(TS.model.team.prefs.default_channels)&&a.forEach(function(e){-1!==TS.model.team.prefs.default_channels.indexOf(e.id)&&(e.is_default=!0,i.push(e))});var s=TS.channels.getGeneralChannel(),r="";s&&(r=s.name,i.length||i.push(s));var o={invite_type:n,channels:a,default_channels:i,general_name:r,groups:TS.groups.getUnarchivedGroups(),email_domains:TS.model.team.email_domain.split(","),is_admin:TS.model.user.is_admin,initial_channel_id:t},l="enterprise"!==TS.model.team.plan,d=TS.templates.admin_invite_channel_picker(o),c=TS.i18n.t("Team Members","invite")();"restricted"===n?c=TS.i18n.t("Multi-Channel Guests","invite")():"ultra_restricted"===n&&(c=TS.i18n.t("Single-Channel Guests","invite")()),e.find("#admin_invites_header").find(".admin_invites_header_type").addClass("normal").text(c).end().find(".admin_invites_header_team_name").addClass("hidden"),e.find("#admin_invites_channel_picker_container").html(d),e.find("#account_type").val(n),e.find("#admin_invites_switcher, #admin_invites_workflow").toggleClass("hidden"),e.find("#admin_invites_billing_notice").toggleClass("hidden",!(l&&"ultra_restricted"!==n)),e.find("#admin_guide_to_billing_at_slack").toggleClass("hidden",!(l&&"ultra_restricted"!==n)),e.find("#ura_warning").toggleClass("hidden","restricted"!==n&&"ultra_restricted"!==n),e.find("#invite_notice").hide(),e.find(".admin_invites_guest_expiration_date_container").toggleClass("hidden","full"===n),e.find("#admin_invites_show_date_picker").on("click",q);var u="";"restricted"===n?u=TS.i18n.t("These guests will only have access to messages and files in specified channels.","invite")():"ultra_restricted"===n&&(u=TS.i18n.t("These guests will only have access to messages and files in a single channel.","invite")()),e.find("#admin_invites_subheader").text(u).toggleClass("hidden","full"===n),e.find("#ultra_restricted_channel_picker").on("change",function(){L(),Q()}),e.find(".email_field").first().focus();var m=e.find('button[data-action="api_send_invites"]');m.hasClass("ladda")||(Ladda.bind('button[data-action="api_send_invites"]'),m.addClass("ladda")),L(),H(),e.find("#defaultchannelsmulti, #ultra_restricted_channel_picker").lazyFilterSelect({onItemRemoved:function(e){e.value==t&&Q()}}).addClass("hidden"),ue()&&(TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker),TS.ui.fs_modal.showBackButton())},q=function(e){var t={event:e,$target:$("#admin_invites_show_date_picker"),onSelect:J,date_picker_args:{}};n&&(t.date_picker_args.selected_expiration_ts=n),TS.menu.date.startWithExpirationPresets(t)},J=function(e){if(_.isNumber(e)&&e!==n){var t,i;0===e?(n=null,t=TS.i18n.t("By default, guest accounts stay active indefinitely.","invite")(),i=TS.i18n.t("Set a time limit","invite")()):(n=e,t=TS.i18n.t("These accounts will be deactivated on <strong>{date} at {time}</strong>.","invite")({date:TS.interop.datetime.formatDate(e,"{date}"),time:TS.interop.datetime.formatDate(e,"{time}")}),i=TS.i18n.t("Change","invite")()),$("#admin_invites_guest_expiration_copy").html(t),$("#admin_invites_show_date_picker").text(i)}},Z=function(){var t,n=[];return e.find(".admin_invite_row").each(function(){if(t=$.trim($(this).find('[name="email_address"]').val()),TS.boot_data.feature_name_tagging_client)var e=$.trim($(this).find('[name="real_name"]').val());else var i=$.trim($(this).find('[name="first_name"]').val()),a=$.trim($(this).find('[name="last_name"]').val());if(t){var s={};s.email=t,TS.boot_data.feature_name_tagging_client&&e&&(s.real_name=e),i&&(s.first_name=i),a&&(s.last_name=a),n.push(s)}else $(".admin_invite_row").length>1&&U($(this))}),u=n,TS.storage.storeInvitesState(u),n},X=function(){var t=!1;if(e.find(".admin_invite_row").each(function(){var e=$.trim($(this).find('[name="email_address"]').val());e?TS.utility.email_regex.test(e)?j($(this)):(G($(this),{error:"invalid_email"}),t=!0):$(".admin_invite_row").length>1&&U($(this))}),t)return void setTimeout(Ladda.stopAll,0);var i=Z();if(i.length){if(i){var a,r=e.find("#account_type").val(),o=e.find(".admin_invites_show_custom_message"),d=e.find("#admin_invite_custom_message"),c=TS.google_auth.isAuthed(s)?"contact":"manual";if("full"===r||"restricted"===r){var _=e.find("#defaultchannelsmulti").val();_&&(a=_.join(","))}else"ultra_restricted"===r&&(a=e.find("#ultra_restricted_channel_picker").val());g=o.hasClass("hidden")?"":d.val(),l=i.length,$.each(i,function(e,t){var i={email:t.email,source:"invite_modal",mode:c};a&&(i.channels=a),g&&(i.extra_message=g),t.real_name&&(i.real_name=t.real_name),t.first_name&&(i.first_name=t.first_name),t.last_name&&(i.last_name=t.last_name),"restricted"!==r&&"ultra_restricted"!==r||!n||(i.expiration_ts=n),"restricted"===r?i.restricted=1:"ultra_restricted"===r&&(i.ultra_restricted=1),TS.api.call("users.admin.invite",i,ee)})}}else{var u='<i class="ts_icon ts_icon_info_circle"></i> '+TS.i18n.t("Add at least one email address before sending invitations.","invite")();D("alert_info",u),setTimeout(Ladda.stopAll,0)}},ee=function(t,n,i){if(t){d.push({email:i.email,real_name:i.real_name,first_name:i.first_name,last_name:i.last_name});var a=N(i.email);U(a)}else{var s;if("requires_channel"===n.error){setTimeout(Ladda.stopAll,0),e.find("#ra_channel_picker_header").highlightText();return s='<i class="ts_icon ts_icon_info_circle"></i> '+TS.i18n.t("Pick at least one channel before inviting Multi-Channel Guests.","invite")(),void D("alert_warning",s)}if("requires_one_channel"===n.error){setTimeout(Ladda.stopAll,0),e.find("#ura_channel_picker_header").highlightText();return s='<i class="ts_icon ts_icon_info_circle"></i> '+TS.i18n.t("Pick a channel before inviting Single-Channel Guests.","invite")(),void D("alert_warning",s)}var r=n.error;if(TS.boot_data.page_needs_enterprise){null!==TS.members.getMemberByEmail(i.email)&&"org_user_is_disabled"===r&&(r="org_user_is_disabled_but_present")}c.push({email:i.email,error:r,error_msg:me(_.extend({},n,{error:r}))})}te()},te=function(){if(0===(l-=1)){u=[],TS.storage.storeInvitesState(u);var e=function(){setTimeout(Ladda.stopAll,0),TS.ui.admin_invites.invites_sent_sig.dispatch()};p=oe(d),p?TS.api.call("team.checkEmailDomains",{email_domains:p}).then(function(e){p=e.data.ok?e.data.email_domains:""},function(){p=""}).finally(e):e()}},ne=function(){function t(){z(),$("#admin_invites_workflow, #admin_invites_success").toggleClass("hidden"),!TS.model.team.plan&&TS.model.user.is_admin&&$("#admin_invites_alert").css("visibility","visible"),$("#admin_invites_header, #admin_invites_subheader").removeClass("hidden"),TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker)}var i,a,s=$("#account_type").val();if("full"===s){i="<strong>"+TS.i18n.t("{invites_length,plural,=1{{invites_length} Team Member}other{{invites_length} Team Members}}","invite")({invites_length:d.length})+"</strong>"}else if("restricted"===s){var r=TS.i18n.t("{invites_length,plural,=1{{invites_length} Multi-Channel Guest}other{{invites_length} Multi-Channel Guests}}","invite")({invites_length:d.length});i="<strong>"+r+"</strong>"}else if("ultra_restricted"===s){var o=TS.i18n.t("{invites_length,plural,=1{{invites_length} Single-Channel Guest}other{{invites_length} Single-Channel Guests}}","invite")({invites_length:d.length});i="<strong>"+o+"</strong>"}!n||"restricted"!==s&&"ultra_restricted"!==s||(a=TS.i18n.t("{invites_length,plural,=1{This account}other{These accounts}} will be deactivated on {date} at {time}.","invite")({invites_length:d.length,date:TS.interop.datetime.formatDate(n,"{date}"),time:TS.interop.datetime.formatDate(n,"{time}")}));var l={success_invites_html:i,success_invites:d,error_invites:c,team_name:TS.model.team.name,domains:p,paid_team:""!==TS.model.team.plan,is_admin:TS.model.user.is_admin,expiration_msg:a};TS.model.team.plan&&(l.custom_message=g);var _=TS.templates.admin_invite_summary(l);if(e.find("#invite_notice").slideUp(100),e.find("#admin_invites_workflow, #admin_invites_header, #admin_invites_subheader").addClass("hidden"),e.find("#admin_invites_success").html(_).removeClass("hidden"),e.find('button[data-action="admin_invites_reset"]').on("click",t),TS.ui.fs_modal.bindBackButton(t),e.find('button[data-action="admin_invites_try_again"]').on("click",function(){$.each(c,function(e,t){var n=N(t.email);G(n,t)}),$("#admin_invites_workflow, #admin_invites_success").toggleClass("hidden"),$("#admin_invites_header, #admin_invites_subheader").removeClass("hidden"),TS.ui.fs_modal.bindBackButton(TS.ui.admin_invites.switchToPicker),d=[],c=[]}),re()){var u=e.find('button[data-action="add_signup_domains"]').on("click",de);e.on("keyup","#invite_signup_domains",TS.ui.resetButtonSpinner.bind(Object.create(null),u.get(0)))}},ie=function(){var t=$.trim($("#bulk_emails").val().replace(/[\u200B-\u200D\uFEFF]/g,""));e.find("#bulk_emails").prop("disabled",!0),TS.api.call("users.admin.parseEmails",{emails:t},ae)},ae=function(t,n){if(!t){TS.error("failed onEmailsParsed");var i=TS.i18n.t("Oops! There was an error processing those emails. Please try again.","invite")();return e.find("#bulk_notice").html('<i class="ts_icon ts_icon_warning"></i> '+i).removeClass("hidden"),void K()}if(0===n.emails.length){var a=TS.i18n.t("We couldnt find any email addresses in that text. Please try again.","invite")();return e.find("#bulk_notice").html('<i class="ts_icon ts_icon_warning"></i> '+a).removeClass("hidden"),void K()}TS.ui.admin_invites.emails_parsed_sig.dispatch(n.emails)},se=function(t){e.find(".admin_invite_row").remove(),V("individual");var n;if(1==t.length){n='<i class="ts_icon ts_icon_check_circle_o_large"></i> '+TS.i18n.t("We found 1 email address to invite. Weve done our best to guess a name. See if it looks right, then press Invite.","invite")()}else{n='<i class="ts_icon ts_icon_check_circle_o_large"></i> '+TS.i18n.t("We found {emails_length} email addresses to invite. Weve done our best to guess a name for each one. See if everything looks right, then press Invite.","invite")({emails_length:t.length})}D("alert_info",n),e.find(".admin_invite_row").each(function(){$.trim($(this).find('[name="email_address"]').val())||U($(this))}),$.each(t,function(e,t){B(t)}),u=t,TS.storage.storeInvitesState(u)},re=function(){return"full"===$("#account_type").val()&&TS.model.user.is_owner&&"normal"===TS.model.team.prefs.auth_mode},oe=function(e){if(!re())return"";var t=e.map(function(e){return e.email.split("@")[1]});if(TS.model.team.email_domain){var n=TS.model.team.email_domain.split(",").reduce(function(e,t){return e[t]=!0,e},{});t=_.uniq(t.filter(function(e){return!n[e]}))}return t.join(", ")},le=function(e){if(!e)return e;var t=e.split(",").reduce(function(e,t){return e[t]=!0,e},{});return Object.keys(t).join(",")},de=function(){TS.ui.startButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0));var t=e.find("#invite_signup_domains").val();TS.model.team.email_domain&&(t=[TS.model.team.email_domain,t].join(",")),t=le(t);var n={prefs:JSON.stringify({signup_mode:"email",signup_domains:t})};TS.api.call("team.prefs.set",n).then(function(t){TS.ui.stopButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0),!0),TS.model.team.email_domain=t.data.prefs.signup_domains},function(t){TS.ui.stopButtonSpinner(e.find('button[data-action="add_signup_domains"]').get(0),!1);var n=TS.i18n.t("Sorry! Something went wrong. Please try again.","invite")();"signup_domains_missing"===t.data.error?n=TS.i18n.t("Please enter a domain","invite")():"bad_domain"===t.data.error?n=TS.i18n.t("Sorry! You cant use {response_data_domain}.","invite")({response_data_domain:t.data.domain}):"invalid_domain"===t.data.error?n=TS.i18n.t("Hmm, this doesnt look like a domain! Check for typos?","invite")():"too_many_domains"===t.data.error&&(n=TS.i18n.t("Sorry! Youve entered too many domains.","invite")()),$("#invite_signup_domains").focus().tooltip({title:n,trigger:"manual"}).tooltip("show").on("blur",function(){$(this).tooltip("destroy")})})},ce=function(){return!TS.model.team.prefs.invites_only_admins&&!TS.model.user.is_restricted},_e=function(){return TS.model.user.is_admin||ce()},ue=function(){return TS.model.user.is_admin&&""!==TS.model.team.plan},me=function(e){if(!e||!e.error||!f[e.error])return"";var t=f[e.error];return _.isFunction(t)?t(e):t}}()},2339:function(e,t){!function(){"use strict";TS.registerModule("ui.date_picker",{onStart:function(){},start:function(e,t){e.pickmeup(t)},startJumpToDatePicker:function(e){var t=$("#channel_actions_toggle").attr("data-oldest-ts");if(t){var n=TS.interop.datetime.toDateObject(t);i(e,n)}else{var a=TS.shared.getActiveModelOb(),s=TS.shared.getHistoryApiMethodForModelOb(a);TS.api.callImmediately(s,{channel:a.id,oldest:283996800,count:1,inclusive:1,include_pin_count:!!TS.boot_data.feature_lazy_pins}).then(function(t){var n;t.data.messages.length<1&&(n=TS.shared.getActiveModelOb().created),n=t.data.messages[0].ts;var a=TS.interop.datetime.toDateObject(n);return i(e,a),!0}).catch(function(){return i(e),TS.warn("couldnt find messages in this channel :"+a.id)})}},startArchiveDatePicker:function(e){var t=TS.shared.getActiveModelOb(),n=TS.interop.datetime.toDateObject(t.created),i=Date.now(),a=i;boot_data.calendar_start&&(a=TS.interop.datetime.toDateObject(boot_data.calendar_start)),boot_data.calendar_oldest&&(n=TS.interop.datetime.toDateObject(boot_data.calendar_oldest)),TS.ui.date_picker.start(e,{first_day:TS.i18n.start_of_the_week[TS.i18n.locale()]||0,hide_on_select:!0,select_year:!0,date:a,min:n,max:i,locale:{days:TS.utility.date.day_names,daysShort:TS.utility.date.short_day_names,daysMin:TS.utility.date.really_short_day_names,months:TS.utility.date.month_names,monthsShort:TS.utility.date.short_month_names},change:function(){a=$(this).pickmeup("get_date");var e=1e3*Date.parse(a),n=t.is_mpim?TS.mpims.getMpimArchivesPath(t):"/archives/"+t.id;window.location=n+"/s"+e}})},startExpirationDatePicker:function(e,t){t=t||{};var n,i,s=new Date,r=s.getTime();t.selected_expiration_ts?i=new Date(1e3*t.selected_expiration_ts):(i=new Date,i.setDate(s.getDate()+a)),i.setHours(0,0,0,0),n=i.getTime();var o={first_day:TS.i18n.start_of_the_week[TS.i18n.locale()]||0,select_year:!1,min:r,date:n,format:"s",position:"top",flat:!0,hide_on_select:!0,locale:{days:TS.utility.date.day_names,daysShort:TS.utility.date.short_day_names,daysMin:TS.utility.date.really_short_day_names,months:TS.utility.date.month_names,monthsShort:TS.utility.date.short_month_names}};t.class_name&&(o.class_name=t.class_name),t.onHide&&(o.hide=t.onHide),t.onChange&&(o.change=function(e){var n=new Date(1e3*e);n.setHours(23,59,59,0);var i=Math.floor(n.getTime()/1e3);t.onChange(i)}),TS.ui.date_picker.start(e,o)},getOldestMsgTs:function(){if(!$("#channel_actions_toggle").attr("data-oldest-ts")){var e=TS.shared.getActiveModelOb(),t=TS.shared.getHistoryApiMethodForModelOb(e);TS.api.callImmediately(t,{channel:e.id,oldest:283996800,count:1,inclusive:1,include_pin_count:!!TS.boot_data.feature_lazy_pins}).then(function(e){var t;if(!(e.data.messages.length<1))return t=e.data.messages[0].ts,$("#channel_actions_toggle").attr("data-oldest-ts",t),!0}).catch(function(){return TS.warn("couldnt find messages in this channel :"+e.id)})}}});var e=function(e){var n=TS.shared.getActiveModelOb();if(n.is_channel&&!n.is_member)n.id==TS.client.archives.current_model_ob.id&&t(n,e);else{if(n.msgs.length<1)return void TS.warn("no messages in this channel: "+n.id);var i=Date.parse(e)/1e3,a=n.msgs[n.msgs.length-1];if(parseFloat(a.ts)<i){TS.model.archive_view_is_showing&&TS.client.archives.cancel();var s=TS.utility.msgs.getDisplayedMsgAfterTS(i,n.msgs);s?TS.client.ui.scrollMsgsSoMsgIsInView(s.ts,!1,!0):!s&&n.msgs.length>0&&(s=TS.utility.msgs.getDisplayedMsgBeforeTS(i,n.msgs),TS.client.ui.scrollMsgsSoMsgIsInView(s.ts,!1,!0))}else t(n,e)}},t=function(e,t){var i=Date.parse(t)/1e3;i=i.toString()+".000000",n(e,i).then(function(t){return TS.utility.msgs.getMsg(t,e.msgs)?(TS.model.archive_view_is_showing&&TS.client.archives.cancel(),TS.client.ui.scrollMsgsSoMsgIsInView(t,!1,!0)):TS.client.archives.start(t),!0}).catch(function(){return TS.warn("couldnt find message for date: "+i+" in channel: "+e.id)})},n=function e(t,n,i){if((i=i||1)>100){if(t._archive_msgs&&t._archive_msgs.length>0)return t._archive_msgs[0];throw new Error("no_visible_message_found")}var a=TS.shared.getHistoryApiMethodForModelOb(t);return new Promise(function(e,s){var r={channel:t.id,oldest:n,count:i,inclusive:1,ignore_replies:!0,include_pin_count:!!TS.boot_data.feature_lazy_pins};TS.api.call(a,r).then(function(n){if(n&&n.data&&0!==n.data.messages.length){for(var i=n.data.messages,a=i.length-1;a>=0;a-=1){var r=i[a];TS.utility.msgs.isMsgReply(r)||"pinned_item"===r.subtype||e(r.ts)}s(new Error("no_visible_message_found"))}else t._archive_msgs&&t._archive_msgs.length>0?e(t._archive_msgs[0]):s(new Error("api_call_failed"))})}).then(function(e){return e},function(a){if("no_visible_message_found"===a.message)return e(t,n,10*i);throw a})},i=function(t,n){n||(n=TS.interop.datetime.toDateObject(TS.shared.getActiveModelOb().created));var i=Date.now(),a=i;TS.ui.date_picker.start(t,{first_day:TS.i18n.start_of_the_week[TS.i18n.locale()]||0,hide_on_select:!0,select_year:!1,flat:!0,date:a,min:n,max:i,locale:{days:TS.utility.date.day_names,daysShort:TS.utility.date.short_day_names,daysMin:TS.utility.date.really_short_day_names,months:TS.utility.date.month_names,monthsShort:TS.utility.date.short_month_names},change:function(){a=$(this).pickmeup("get_date"),e(a),TS.menu.$menu.css("opacity",0),TS.menu.end()},hide:function(){window.setTimeout(function(){$(this).pickmeup&&$(this).pickmeup("destroy")}.bind(this),0)}}),t.pickmeup("show")},a=7}()},2364:function(e,t){!function(){"use strict";var e=10,t=10,n=100;TS.registerComponent("SearchableMemberList",{_constructor:function(e){this.id=e.id,this.triggered_by_user_action=e.triggered_by_user_action,this.$_container=e.$container,this.$_long_list_view,this.$_search_bar,this.$_search_input,this.$_clear_icon,this.$_filter_input,this._current_filter="everyone",this._current_query_for_display="",this._current_query_for_match="",this._next_marker="",this._have_all_members=!1,this._members=[],this._model_ob_id=e.model_ob_id,this._filter_counts={},this._suppress_presence=e.suppress_presence||!1,this._show_filter_bar=_.isUndefined(e.show_filter_bar)?!this._model_ob_id:e.show_filter_bar,this._compact_results=_.isUndefined(e.compact_results)?!!this._model_ob_id:e.compact_results,this._prevent_member_click_handler=e.prevent_member_click_handler||!1,this._approx_item_height=this._compact_results?30:89,this._long_list_view_height=0,this._long_list_view_items_height=0,this._long_list_view_initial_height=null,this._fetch_page_p=null,this._suppress_presence||(this._presence_list=new TS.PresenceList),this._resize_sig_handler=null,this.member_clicked_sig=new signals.Signal},destroy:function(){this._resize_sig_handler&&TS.view.resize_sig.remove(this._resize_sig_handler),this._maybeSetupFilterInputDebounced&&(TS.members.joined_team_sig.remove(this._maybeSetupFilterInputDebounced,this),TS.members.changed_deleted_sig.remove(this._maybeSetupFilterInputDebounced,this)),this.$_container.off(),this.$_long_list_view&&this.$_long_list_view.off(),this.$_search_input&&this.$_search_input.off(),this.$_clear_icon&&this.$_clear_icon.off(),this.$_filter_input&&this.$_filter_input.off(),this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView")&&this.$_long_list_view.longListView("destroy"),this.$_search_bar&&this.$_search_bar.remove(),this._suppress_presence||this._presence_list.clear()},showInitial:function(){var e=this;this._prevent_member_click_handler||this.$_container.delegate(".team_list_item","click",TS.members.view.onTeamDirectoryItemClick),this.$_long_list_view=this.$_container.find(".searchable_member_list_scroller"),this._showLoadingState(),this._fetchPage().then(function(t){return e._hideLoadingState(),e._processPage(t),TS.utility.rAF(function(){e._updatePresenceListForVisibleMembers()}),e._setupLongListView(),e._maybeSetupSearchBar(),null});var t="channel_membership_dialog"===this.id?"channel_membership_dialog_scroller":"team_list_scroller";TS.metrics.count(t+"_initialized")},maybeRerenderLongListView:function(){this.$_long_list_view&&this._members&&this.$_long_list_view.longListView("setItems",this._members,!0,!0)},_fetchPage:function(){if(this._fetch_page_p)return this._fetch_page_p;var e=this,t=this._buildQueryParams();return this._fetch_page_p=TS.flannel.fetchAndUpsertObjectsWithQuery(t).then(function(t){return e._fetch_page_p=null,e._next_marker=t.next_marker,t.next_marker||(e._have_all_members=!0),t.objects||t}),this._fetch_page_p},_buildQueryParams:function(){var e,i={count:this._current_query_for_match?n:t,index:TS.members.shouldDisplayRealNames()?"users_by_realname":"users_by_name"};return TS.boot_data.feature_shared_channels_client&&(e=TS.utility.strLooksLikeATeamId(this._current_filter)),e?i.external_team=this._current_filter:i.filter=this._current_filter,this._current_query_for_match?(i.query=this._current_query_for_match,i.search_profile_fields=!0):i.marker=this._next_marker,this._model_ob_id?i.channels=[this._model_ob_id]:TS.model.user.is_restricted&&(i.channels=_.map(TS.shared.getAllModelObsForUser(),function(e){return e.is_im?e.user:e.id})),i},_processPage:function(e){this._members=_.union(this._members,e)},_updatePresenceListForVisibleMembers:function(){if(!this._suppress_presence&&this._presence_list&&this.$_long_list_view&&this.$_long_list_view.longListView){var e=this.$_long_list_view.longListView("getCurrentItemsInView")||[],t=_.map(e,"id");t.length&&(this._presence_list.clear(),this._presence_list.add(t))}},_fetchProcessAndDisplayPage:function(){var e=this;return this._fetchPage().then(function(t){return e._processPage(t),e._maybeHideNoResultsState(),e._members.length>0?e.$_long_list_view.longListView("setItems",e._members,!0,!0):e._showNoResultsState(),null}).then(function(){return TS.utility.rAF(function(){e._updatePresenceListForVisibleMembers(),e._long_list_view_height=e.$_long_list_view.height(),e._long_list_view_items_height=e.$_long_list_view.find(".list_items").height(),e._recursivelyFillLongListViewToHeight()}),null})},_maybeSetupSearchBar:function(){var t=this;if(!this.$_search_bar)return TS.flannel.fetchMemberCounts().then(function(n){return n.everyone>=e&&(t.$_long_list_view.before(TS.templates.team_search_bar()),t.$_search_bar=t.$_container.find(".searchable_member_list_search_bar"),t.$_search_input=t.$_search_bar.find(".searchable_member_list_input"),t.$_filter_input=t.$_search_bar.find(".searchable_member_list_filter"),t._setupSearchInput(),t._maybeSetupFilterInput()),null})},_setupSearchInput:function(){var e=this;this.$_search_bar.find(".searchable_member_list_search.loading").replaceWith(TS.templates.team_search_bar_input(this._generateFilterSearchBarTemplateArgs())),this.$_search_input=this.$_search_bar.find(".searchable_member_list_input"),this.$_clear_icon=this.$_container.find(".icon_close"),this.$_search_input.bind("keyup.searchable_member_list",this._handleSearchKeyUp.bind(this)),this.$_container.delegate(".searchable_member_list_filter","click",this._handleFilterSelect.bind(this)),this.$_clear_icon.bind("click",function(){e._reset(),Promise.resolve().then(function(){return e.$_search_input.focus(),null})}),this.triggered_by_user_action&&this.$_search_input.focus()},_maybeSetupFilterInput:function(){var e=this;if(this.$_filter_input)return this._show_filter_bar?TS.flannel.fetchMemberCounts().then(function(t){if(e._filter_counts=t,e.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(e._generateFilterSearchBarTemplateArgs())),e.$_filter_input=e.$_search_bar.find(".searchable_member_list_filter"),!e._maybeSetupFilterInputDebounced){var n={trailing:!0};e._maybeSetupFilterInputDebounced=_.debounce(function(){return e._maybeSetupFilterInput.apply(e,arguments)},1e3,n)}TS.members.joined_team_sig.add(e._maybeSetupFilterInputDebounced,e),TS.members.changed_deleted_sig.add(e._maybeSetupFilterInputDebounced,e)}):(e.$_filter_input.remove(),void(e.$_filter_input=null))},_maybeSetupFilterInputDebounced:null,_setupLongListView:function(){var e=this;this.$_long_list_view.longListView({items:this._members,approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function(e){return e.outerHeight()},makeElement:function(){return $(TS.templates.team_list_item({is_channel_membership:e._model_ob_id,is_long_list_view:!0}))},renderItem:function(t,n){t.toggleClass("deleted",!0===n.deleted).data("member-id",n.id).data("item",n),e._compact_results?t.html(TS.templates.channel_page_member_row({member:n,lazy:!1,suppress_presence:e._suppress_presence})):t.html(TS.templates.team_list_item_member_details({member:n,is_long_list_view:!0})),TS.utility.makeSureAllLinksHaveTargets(t)}}),this.$_long_list_view.delegate("li").on("click",function(t){e._prevent_member_click_handler&&t.preventDefault(),e.member_clicked_sig.dispatch(t,TS.members.getMemberById($(t.target).parents(".team_list_item").find("[data-member-id]").data("memberId")))}),this._resize_sig_handler=_.throttle(function(){e._long_list_view_height=e.$_long_list_view.height(),e._long_list_view_items_height=e.$_long_list_view.find(".list_items").height(),e._long_list_view_initial_height||(e._long_list_view_initial_height=e._long_list_view_height)},33),TS.view.resize_sig.add(this._resize_sig_handler),this.$_long_list_view.on("scroll",_.debounce(function(t){if(e._updatePresenceListForVisibleMembers(),!e._current_query_for_match){e._long_list_view_items_height-($(t.target).scrollTop()+e._long_list_view_height)<100&&e._fetchProcessAndDisplayPage()}},100)),TS.utility.rAF(function(){TS.view.resizeManually("TS.SearchableMemberList.showInitial"),e._recursivelyFillLongListViewToHeight()})},_recursivelyFillLongListViewToHeight:function(){var e=this;this._current_query_for_match||this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_members&&this._fetchProcessAndDisplayPage().then(function(){e._long_list_view_items_height=e.$_long_list_view.find(".list_items").height()})},_reset:function(){this._members=[],this._current_query_for_match="",this._current_query_for_display="",this._current_filter="everyone",this._next_marker="",this.$_search_input.val(""),this.$_clear_icon.addClass("hidden"),this._have_all_members=!1,this._maybeHideNoResultsState(),this.$_long_list_view.scrollTop(0),this.$_filter_input&&(this.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(this._generateFilterSearchBarTemplateArgs())),this.$_filter_input=this.$_container.find(".searchable_member_list_filter")),this.$_long_list_view.height(this._long_list_view_initial_height),this._fetchProcessAndDisplayPage()},_showLoadingState:function(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function(){var e=this.$_container.find(".no_results");e.length>0&&e.remove();var t=this,n=TS.templates.team_searchable_no_results({query:this._current_query_for_display,everyone_filter_selected:"everyone"===this._current_filter,members_filter_selected:this._current_filter.match(/members/),admins_filter_selected:this._current_filter.match(/admins/),restricted_filter_selected:this._current_filter.match(/guests/),deactivated_filter_selected:"deactivated"===this._current_filter,free_team:!TS.model.team.plan,user_is_admin:TS.model.user.is_admin});if(this.$_long_list_view.hide().before(n),TS.model.user.is_admin&&!TS.model.team.plan&&this._current_filter.match(/guests/)&&TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"team_directory",action:"impression"}}}),this.$_container.delegate(".clear_members_filter","click",function(){t._reset()}),"everyone"!==this._current_filter&&""!==this._current_query_for_match){var i=this._current_filter;this._current_filter="everyone",this._fetchPage().then(function(e){return t._current_filter=i,e.length>0&&(t.$_container.find(".no_results").after(TS.templates.team_other_matches_heading({query:t._current_query_for_display})),t.$_long_list_view.longListView("setItems",e,!0,!0),t.$_long_list_view.show(),TS.utility.rAF(function(){t._long_list_view_height=t.$_long_list_view.height(),t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height()})),null})}},_maybeHideNoResultsState:function(){var e=this.$_container.find(".no_results");if(0!=e.length){var t=this.$_container.find(".other_matches");t&&t.remove(),e.remove(),this.$_long_list_view.show()}},_handleSearchKeyUp:function(e){var t=$(e.target).val();t.trim().toLocaleLowerCase()!==this._current_query_for_match&&(this._fetch_page_p&&(this._fetch_page_p.cancel(),this._fetch_page_p=null),this._suppress_presence||this._presence_list.clear(),this._members=[],this._next_marker="",this._have_all_members=!1,this._current_query_for_display=t,this._current_query_for_match=t.trim().toLocaleLowerCase(),this._fetchProcessAndDisplayPage(),this.$_long_list_view.scrollTop(0),this.$_clear_icon.toggleClass("hidden",!t.trim()))},_handleFilterSelect:function(e){e.preventDefault();var t=this;TS.menu.startWithSearchableMemberListFilter(e,this._filter_counts,function(e){var n=$(e.target).closest("[data-filter]");n.length&&(t._fetch_page_p&&(t._fetch_page_p.cancel(),t._fetch_page_p=null),t._suppress_presence||t._presence_list.clear(),t._have_all_members=!1,t._members=[],t._next_marker="",t._current_filter=n.data("filter"),t._fetchProcessAndDisplayPage(),t.$_long_list_view.scrollTop(0),t.$_filter_input.replaceWith(TS.templates.team_search_bar_filter(t._generateFilterSearchBarTemplateArgs())),t.$_filter_input=t.$_container.find(".searchable_member_list_filter"))})},_generateFilterSearchBarTemplateArgs:function(){var e=this._current_filter,t={everyone_filter_selected:"everyone"===e,deactivated_filter_selected:"deactivated"===e};if(TS.boot_data.page_needs_enterprise?_.merge(t,{org_name:TS.model.team.enterprise_name,team_name:TS.model.team.name,org_members_filter_selected:"org_members"===e,org_admins_filter_selected:"org_admins"===e,org_restricted_filter_selected:"org_guests"===e,team_members_filter_selected:"members"===e,team_admins_filter_selected:"admins"===e,team_restricted_filter_selected:"guests"===e}):_.merge(t,{members_filter_selected:"members"===e,admins_filter_selected:"admins"===e,restricted_filter_selected:"guests"===e}),_.each(this._filter_counts,function(e,n){t[n+"_count"]=e}),TS.boot_data.feature_shared_channels_client){var n=[];_.each(this._filter_counts.external_teams,function(t,i){n.push({external_team_filter_selected:e===i,external_team_count:t,external_team_name:TS.teams.getTeamNameById(i)})}),_.merge(t,{ext_teams:n})}return t},test:function(){var i={};return Object.defineProperty(i,"MINIMUM_MEMBERS_FOR_SEARCH",{get:function(){return e},set:function(t){e=t}}),Object.defineProperty(i,"FETCH_PAGE_SIZE",{get:function(){return t},set:function(e){t=e}}),Object.defineProperty(i,"FETCH_PAGE_SIZE_SEARCH",{get:function(){return n},set:function(e){n=e}}),i}})}()},2390:function(e,t){!function(){"use strict";TS.registerModule("channels_suggestions",{onStart:function(){TS.client&&TS.client.login_sig.addOnce(function(){window.setTimeout(function(){TS.api.call("channels.suggestions",{}).then(_.noop)},3e4)})}})}()},2392:function(e,t){!function(){"use strict";TS.registerModule("chat_history",{onStart:function(){TS.model.input_history=TS.storage.fetchInputHistory()},add:function(e){if(!TS.model.prefs||TS.model.prefs.arrow_history||e&&0===e.indexOf("/")){var t=TS.model.input_history,n=t.indexOf(e);-1!=n&&t.splice(n,1),t.length&&""===t[0]&&t.splice(0,1),t.unshift(e),TS.storage.storeInputHistory(t),TS.boot_data.feature_tinyspeck&&(TS.log(23,"(TS-ONLY log)",e),TS.dir(23,"(TS-ONLY log)",t))}},resetPosition:function(){TS.model.input_history_index=-1},onArrowKey:function(e,t){if((!TS.model.prefs||TS.model.prefs.arrow_history)&&TS.model.input_history.length){var n;if(n=TS.utility.contenteditable.supportsTexty()?TS.utility.contenteditable.value(t):t.val(),TS.model.input_history_index<0&&(TS.chat_history.add(n),TS.model.input_history_index+=1),e.which==TS.utility.keymap.up){if(TS.model.input_history_index+=1,TS.model.input_history_index>=TS.model.input_history.length)return void(TS.model.input_history_index=TS.model.input_history.length-1)}else{if(e.which!=TS.utility.keymap.down)return;if(TS.model.input_history_index-=1,TS.model.input_history_index<0)return void(TS.model.input_history_index=-1)}var i=TS.model.input_history[TS.model.input_history_index];e.preventDefault(),TS.utility.contenteditable.supportsTexty()?TS.utility.contenteditable.deserialize(TS.client.ui.$msg_input,i):TS.utility.populateInput(TS.client.ui.$msg_input,i),e.which==TS.utility.keymap.up?TS.utility.contenteditable.supportsTexty()?TS.utility.contenteditable.cursorPosition(t,0):TS.utility.setCursorPosition(t,0):TS.utility.contenteditable.supportsTexty()||TS.utility.contenteditable.setCursorAtEnd(t)}},getCommands:function(){if(_.isArray(TS.model.input_history))return TS.model.input_history.filter(function(e){return e&&0===e.indexOf("/")})}})}()},2395:function(e,t){!function(){"use strict";TS.registerModule("client.archives",{current_model_ob:null,not_member:!1,$scroller:$("#archive_msgs_scroller_div"),$archives_msgs_div:$("#archives_msgs_div"),msgs_are_auto_scrolling:!1,active_highlight_count:0,msgs_scrolled_sig:new signals.Signal,onStart:function(){TS.shared.msg_sent_sig.add(B),TS.channels.joined_sig.add(M),TS.groups.unarchived_sig.add(x),TS.channels.unarchived_sig.add(I),TS.channels.archived_sig.add(E),TS.channels.message_removed_sig.add(D),TS.channels.message_changed_sig.add(F),TS.groups.message_removed_sig.add(D),TS.groups.message_changed_sig.add(F),TS.ims.message_removed_sig.add(D),TS.ims.message_changed_sig.add(F),TS.mpims.message_removed_sig.add(D),TS.mpims.message_changed_sig.add(F);var e=_.throttle(P,1e3);TS.view.members.unknown_resolution_rebuild_sig.add(e),TS.environment.supports_custom_scrollbar||TS.client.archives.$scroller.monkeyScroll({always_show:!0}),t=$("#monkey_scroll_wrapper_for_archive_msgs_scroller_div"),t.addClass("hidden"),$("#archives_return").addClass("hidden").removeClass("warning").find(".cancel_archives").addClass("hidden"),y()},start:function(_){var p=TS.shared.getActiveModelOb();if($("#archives_end_div_msg_lim").addClass("hidden"),!p)return void TS.warn("WTF no model_ob in TS.client.archives.start()");if(TS.client.archives.getCurrentModelOb())if(p.id==TS.client.archives.getCurrentModelOb().id){if(_&&_==n)return void(p._archive_msgs&&TS.utility.msgs.getMsg(_,p._archive_msgs)&&C(n));if(!_)return void TS.info("no change requested in TS.client.archives.start()");if(p._archive_msgs&&TS.utility.msgs.getMsg(_,p._archive_msgs))return n=_,void C(n)}else w();var T=TS.i18n.t("Loading...","archives")();TS.client.archives.$archives_msgs_div.html('<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+T+'" /><br />'+T+"</div>"),u=p.id+(_||""),n=_||null,TS.client.archives.current_model_ob=p,e=TS.shared.getHistoryApiMethodForModelOb(p),TS.client.archives.not_member=p.is_channel&&(!p.is_member||p.is_archived)||p.is_group&&p.is_archived,p.never_needs_joined_msg=!0,S(),$("#client-ui").addClass("archive_view_is_showing"),t.removeClass("hidden"),TS.client.archives.$scroller.removeClass("hidden");var y={channel:p.id,count:50,_showing_id:u,ignore_replies:!0,include_pin_count:!!TS.boot_data.feature_lazy_pins};i=!1,a=!1,s=0,r=0,o=null,l=null,d=!1,c=!1,b(),v();var k=function(e,t,i){if(!e){if(i._showing_id!=u)return!1;if(w(),"channel_not_found"===t.error)return void TS.error("Tried opening channel archives for an invalid channel!",t,i);TS.client.archives.start(null,!0)}if(f(e,t,i)&&r==s){var a=TS.utility.msgs.getMsg(n,p._archive_msgs);if(a&&TS.utility.msgs.isMsgReply(a)&&(TS.ui.replies.openConversation(p,a.thread_ts,a.ts),!p.is_channel||p.is_member))return void w();m();var o=TS.client.archives.$scroller,d=function(){TS.client.archives.msgs_are_auto_scrolling=!0,o.scrollTop(o[0].scrollHeight),TS.client.archives.msgs_are_auto_scrolling=!1;var e=n,t=!0;if(TS.boot_data.feature_archive_deeplink&&!a){var i=TS.utility.msgs.getDisplayedMsgAfterTS(n,p._archive_msgs);i&&i.ts&&(e=i.ts),t=!1}n&&TS.client.ui.scrollMsgsSoMsgIsInView(e,!1,t)};if(d(),!(l||TS.client.archives.$archives_msgs_div.find(".message").length>=20)){h(function(){d()},!0)}}};if(n){var A={channel:p.id,count:50,oldest:n,inclusive:!0,_showing_id:u,ignore_replies:!0,include_pin_count:!!TS.boot_data.feature_lazy_pins};y.latest=n,y.count=25,s=2,TS.api.callImmediately(e,A,k),TS.api.callImmediately(e,y,k).then(function(e){e&&!0===e.data.is_limited&&p&&(p.is_limited=!0)})}else s=1,setTimeout(function(){TS.model.archive_view_is_showing&&(n||TS.api.callImmediately(e,y,k).then(function(){g(y)}))},20);if(!n&&p.was_archived_this_session&&(p.was_archived_this_session=!1,p.is_channel?(TS.channels.calcUnreadCnts(p,!0),TS.channels.markMostRecentReadMsg(p,TS.model.marked_reasons.none_qualify)):(TS.groups.calcUnreadCnts(p,!0),TS.groups.markMostRecentReadMsg(p,TS.model.marked_reasons.none_qualify)),p.was_archived_this_session=!0),TS.model.archive_view_is_showing=!0,TS.client.archives.not_member&&(TS.client.channel_pane.rebuild("starred","channels"),!p.is_group)){var M={channel:p.id};TS.membership&&TS.membership.lazyLoadChannelMembership()&&(M.no_members=!0),TS.api.callImmediately("channels.info",M,function(e,t){if(TS.model.archive_view_is_showing){if(!e)return void TS.warn("WTF, bad API rsp? error:"+t.error);if(!t.channel)return void TS.warn("WTF, no channel?");var n=TS.channels.upsertChannel(t.channel);n.id==TS.client.archives.getCurrentModelOb().id&&TS.channels.data_updated_sig.dispatch(n)}})}TS.view.resizeManually("TS.client.archives started")},getCurrentModelOb:function(){return TS.client.archives.current_model_ob},maybeHandleArchiveLink:function(e,t){if(!TS.client)return!1;if(!e||!e.length)return!1;if(!e.is("a"))return!1;var n=e.prop("href");if(!n)return!1;var i=TS.utility.normalizeDevHost(n),a=TS.utility.getPathFromSlackUrl(i);if(a){var s=-1!==i.indexOf("?")&&TS.utility.url.queryStringParse(i.split("?")[1]);if("1"===_.get(s,"force-browser"))return!1;if({messages:!0,archives:!0}[a[0]]){if(a.length<2)return!1;var r=decodeURIComponent(a[1]);if(!r)return!1;var o=TS.shared.getModelObById(r)||TS.ims.getImByUsername(r)||TS.channels.getChannelByName(r)||TS.groups.getGroupByName(r)||TS.mpims.getMpimByName(r);if(!o){if(!TS.boot_data.feature_deleted_dm_archives)return!1;var l=TS.members.getMemberByName(r);if(l)return TS.ims.startImByMemberId(l.id),!0}if(TS.ims.isImWithDeletedMember(o)&&!TS.boot_data.feature_deleted_dm_archives)return!1;if(2==a.length||!a[2])return o.is_channel?TS.channels.displayChannel({id:o.id}):o.is_mpim?TS.mpims.displayMpim({id:o.id}):o.is_group?TS.groups.displayGroup({id:o.id}):TS.ims.startImById(o.id),o.id==TS.model.active_cid;var d=a[2];if(!d)return!1;if(0!==d.indexOf("p"))return!1;if(17!=d.length)return!1;if(d=d.replace("p",""),isNaN(d))return!1;var c,u=d.substr(0,10)+"."+d.substr(10);if(o.id==TS.model.active_cid&&e.hasClass("timestamp")&&(0!==e.closest("#msgs_div").length||0!==e.closest("#archives_msgs_div").length)&&(c=TS.templates.makeMsgDomId(u),0!==e.closest("#"+c).length))return!!TS.boot_data.feature_archive_deeplink;var m;return s&&s.thread_ts&&(!isNaN(s.thread_ts)&&-1===s.thread_ts.indexOf(".")&&s.thread_ts.length>10&&(s.thread_ts=s.thread_ts.substr(0,10)+"."+s.thread_ts.substr(10,6)),/^\d+\.\d+$/.test(s.thread_ts)&&(m=s.thread_ts)),m&&m!==u?!(!e.hasClass("timestamp")||0===e.closest("#convo_container").length||(c=TS.templates.makeMsgDomIdInConversation(u),0===e.closest("#"+c).length))||(TS.ui.replies.openConversation(o,m,u,t),!0):TS.client.ui.tryToJump(o.id,u,m)}return!1}},onMsgsScroll:function(){TS.model.archive_view_is_showing&&TS.utility.throttle.method(k,"ts_archives_on_msgs_scroll",250)},maybeLoadScrollBackHistory:function(){TS.client.archives.active_highlight_count||TS.model.ui.is_mouse_down||r==s&&(i?(TS.info("_scrolled_to_bottom _all_loaded_bottom:"+o),o||p()):a&&(TS.info("_scrolled_to_top _all_loaded_top:"+l),l||h()))},loadMoreBottom:function(){TS.model.archive_view_is_showing&&(o||p())},loadMoreTop:function(){TS.model.archive_view_is_showing&&(l||h())},tryToJoin:function(){TS.model.archive_view_is_showing&&TS.client.archives.getCurrentModelOb()&&TS.client.archives.getCurrentModelOb().is_channel&&(TS.client.archives.getCurrentModelOb().is_archived||$("#footer_archives_action_button").trigger("click"))},userWantsToCancel:function(){if(TS.model.archive_view_is_showing){var e=TS.client.archives.getCurrentModelOb();e.is_group&&e.is_archived?TS.client.ui.maybePromptForClosingGroup(e.id):(e.was_archived_this_session&&(e.was_archived_this_session=!1),TS.client.archives.cancel())}},cancel:function(e){if(TS.model.archive_view_is_showing){var t=(TS.client.archives.not_member||TS.ims.isImWithDeletedMember(TS.client.archives.getCurrentModelOb()))&&!e;w(t)}},rebuildMsg:function(e){if(TS.model.archive_view_is_showing&&TS.client.archives.getCurrentModelOb()&&e){var t=TS.client.archives.$archives_msgs_div.find("#"+TS.templates.makeMsgDomId(e.ts));if(t.length){var n=TS.client.archives.getCurrentModelOb(),i=TS.utility.msgs.getPrevDisplayedMsg(e.ts,n._archive_msgs),a=TS.templates.builders.msgs.buildHTML({msg:e,model_ob:n,prev_msg:i,container_id:"archives_msgs_div",enable_slack_action_links:!1});t.replaceWith(a),TS.utility.makeSureAllExternalLinksAreRefererSafe(t)}}}});var e="",t=null,n=null,i=!1,a=!1,s=0,r=0,o=null,l=null,d=!1,c=!1,u=!1,m=function(){TS.metrics.mark("_displayMsgs");var e=TS.client.archives.getCurrentModelOb();if(e){var t=e._archive_msgs,n=TS.client.archives.$archives_msgs_div;n.empty();var i,a,s,r,d=TS.boot_data.team_limit_ts>0;e&&(s=TS.utility.msgs.getOlderMsgsStatus(e),r=s.is_limited||s.more);for(var c,u,m=[],h="",p=_.reject(t,TS.utility.msgs.isMsgHidden),g=p.length-1;g>-1;g-=1)if(c&&TS.utility.msgs.isMsgHidden(c)||(u=c),c=p[g],!TS.utility.msgs.isMsgHidden(c)){var f=TS.utility.msgs.msgRollUpWorker(g,c,p,m);"continue"!==f?("swap"===f&&(c=m[0],m.length=0),u&&TS.utility.msgs.areMsgsSameDay(c,u)||(u&&(h+="</div></div>"),h+='<div class="day_container">',h+=TS.templates.messages_day_divider({ts:c.ts}),h+='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(c.ts)+'" data-ts="'+c.ts+'">'),h+=TS.templates.builders.msgs.buildHTML({msg:c,model_ob:e,prev_msg:u,container_id:"archives_msgs_div",enable_slack_action_links:!1}),0===g&&(h+="</div></div>")):c=u}n.html(h),TS.utility.makeSureAllExternalLinksAreRefererSafe(n);var S=!o;if($("#archives_bottom_div").toggleClass("hidden",!S),$("#archives_return").toggleClass("hidden",!S),d&&l&&r&&!e.is_self_im){var T=$("#archive_msg_lim_btn"),v=$("#archive_msg_lim_btn_treatment"),b=TS.experiment.getGroup("msg_lim_notifs_headers_copy");if($(".msg_lim_header_copy").addClass("hidden"),e.is_im||e.is_mpim||e.is_slackbot_im)"show_question_learn_more"===b||"show_question_see_pricing_plans"===b?$(".msg_lim_dm_h1_treatment").removeClass("hidden"):$(".msg_lim_dm_h1_control").removeClass("hidden"),$(".msg_lim_dm_h2").removeClass("hidden");else if(e.is_channel||e.is_group){var w=TS.templates.builders.makeChannelPrefix(e);$(".channel_name_msg_lim").html(w+e.name),"show_question_learn_more"===b||"show_question_see_pricing_plans"===b?$(".msg_lim_channel_h1_treatment").removeClass("hidden"):$(".msg_lim_channel_h1_control").removeClass("hidden"),$(".msg_lim_channel_h2").removeClass("hidden")}e.is_slackbot_im?a=35:e.is_mpim||e.is_im?a=33:(e.is_channel||e.is_group)&&(a=34),"show_question_see_pricing_plans"===b?(i=v.attr("href"),i=TS.utility.url.setQueryStringValue(i,"ui_element",a),i=decodeURIComponent(i).substr(1),v.attr("href",i),v.data("data-clog-ui-element",a),v.removeClass("hidden")):(i=T.attr("href"),i=TS.utility.url.setQueryStringValue(i,"ui_element",a),i=decodeURIComponent(i).substr(1),T.attr("href",i),T.data("data-clog-ui-element",a),T.removeClass("hidden")),$("#archives_end_div_msg_lim").removeClass("hidden"),TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:a}}})}else $("#archives_top_div").removeClass("hidden");TS.client.archives.msgs_are_auto_scrolling=!0,k(),TS.client.archives.msgs_are_auto_scrolling=!1,TS.ui.utility.updateClosestMonkeyScroller(TS.client.archives.$scroller),A(),(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))&&TS.metrics.measure("client_archives_display_msgs","_displayMsgs")}},h=function(t,n){c=!0,b();var i=TS.client.archives.getCurrentModelOb(),a=i._archive_msgs[i._archive_msgs.length-1].ts;s+=1;var r={channel:i.id,latest:a,count:parseInt(TS.model.subsequent_msgs_cnt/2,10),_showing_id:u,ignore_replies:!0};TS.api.callImmediately(e,r,function(e,i,s){f(e,i,s)&&(c=!1,b(),m(),a&&!n&&TS.client.ui.scrollMsgsSoMsgIsInView(a,!0,!1),t&&t())})},p=function(){d=!0,v();var t=TS.client.archives.getCurrentModelOb(),n=t._archive_msgs[0].ts;s+=1;var i={channel:t.id,oldest:n,count:parseInt(TS.model.subsequent_msgs_cnt/2,10),_showing_id:u,ignore_replies:!0};TS.api.callImmediately(e,i,function(e,t,i){f(e,t,i)&&(d=!1,v(),m(),n&&TS.client.ui.scrollMsgsSoMsgIsInView(n,!1,!1,0))})},g=function(e){var t=TS.client.archives.getCurrentModelOb();if(TS.model.archive_view_is_showing&&e._showing_id==u&&t.is_archived){var n=TS.utility.msgs.getMostRecentValidTs(t),i=TS.utility.msgs.getMostRecentValidTs({msgs:t._archive_msgs});n&&i&&n>i&&(TS.info("Message history is not most recent; get more."),o=!1,p())}},f=function(e,t,i){if(!TS.model.archive_view_is_showing)return!1;if(i._showing_id!=u)return!1;var a,s,d,c=TS.client.archives.getCurrentModelOb(),_=c._archive_msgs,m=[],h=!1,p=_&&_.length?_[0]:"";if(p&&!TS.client.msg_pane.getDivForArchiveMsg(p.ts).length&&(p=null),t.messages)for(d=0;d<t.messages.length;d+=1)s=t.messages[d].ts,_&&TS.utility.msgs.getMsg(s,_)||(a=t.messages[d],m.push(TS.utility.msgs.processImsgFromHistory(a,c.id))),TS.client.archives.not_member||c.is_im||h||!TS.utility.msgs.getMsg(s,c.msgs)||(h=!0);if(c._archive_msgs=_?m.concat(_):m,h){for(m=[],d=0;d<c._archive_msgs.length;d+=1)TS.utility.msgs.getMsg(c._archive_msgs[d].ts,c.msgs)||(a=c._archive_msgs[d],m.push(a));TS.utility.msgs.setMsgs(c,m.concat(c.msgs)),TS.client.msg_pane.rebuildMsgsWithReason("archive _onHistory");var g,f;p?f=TS.client.archives.$scroller.scrollTop():g=n;if(w(!1,!0),p)TS.client.ui.$msgs_scroller_div.scrollTop(f);else if(g){var S=TS.utility.msgs.getMsg(g,c.msgs);if(S&&TS.utility.msgs.isMsgReply(S))return TS.ui.replies.openConversation(c,S.thread_ts,S.ts),!1;var T=!0;if(TS.boot_data.feature_archive_deeplink&&!S){var y=TS.utility.msgs.getDisplayedMsgAfterTS(g,c.msgs);y&&y.ts&&(g=y.ts),T=!1}TS.client.ui.scrollMsgsSoMsgIsInView(g,!1,T)}return!1}return TS.utility.msgs.sortMsgs(c._archive_msgs),i.latest?(l=!t.has_more,b()):i.oldest?(o=!t.has_more,v()):(l=i.count!=t.messages.length,b(),o=!0,v()),r+=1,!0},S=function(){var e=TS.client.archives.getCurrentModelOb(),t=e.is_channel?"#":"",n="";e.is_channel?n='<ts-icon class="ts_icon_bold_hash_small"></ts-icon>':e.is_group&&(n='<ts-icon class="ts_icon_lock"></ts-icon>');var i="";TS.shared.isModelObOrgShared(e)?i=TS.templates.shared_channel_icon():TS.shared.isModelObShared(e)&&(i=TS.templates.shared_channels_icon()),$("#footer_archives_action_button").addClass("btn_outline");var a=TS.ims.isImWithDeletedMember(e);if(TS.client.archives.not_member||a){var s,r;$("#footer_msgs").addClass("hidden"),$("#footer").css("height","auto"),$("#footer_archives").removeClass("hidden no_tip"),e.is_archived&&!e.is_im?(s=1===e.is_moved?TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>, a moved channel","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(e.name,25)),shared:i}):TS.i18n.t("You are viewing <strong>{hash}{channel_name}{shared}</strong>, an archived channel","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(e.name,25)),shared:i}),r=TS.i18n.t('<strong aria-label="return">Esc</strong> to close',"archives")(),$("#footer_archives_text").html(s),$("#footer_archives_action_button").text(TS.i18n.t("Close Channel","archives")()),$("#footer_archives_action_tip").html('<span class="tiny dialog_cancel_hint">'+r+"</span>")):a?(s=TS.i18n.t('<ts-icon class="ts_icon_archive"></ts-icon> You are viewing the archives of a deactivated account',"archives")(),$("#footer_archives").addClass("no_tip"),$("#footer_archives_text").html(s),$("#footer_archives_action_button").text(TS.i18n.t("Close","archives")()),$("#footer_archives_action_tip").html("")):(s=TS.i18n.t("You are viewing a preview of <strong>{hash}{channel_name}{shared}</strong>","archives")({hash:n,channel_name:_.escape(TS.utility.ellipsize(e.name,25)),shared:i}),r=TS.i18n.t('<strong aria-label="return">Return <span class="return_char">&crarr;</span></strong> to join',"archives")(),$("#footer_archives_text").html(s),$("#footer_archives_action_button").text(TS.i18n.t("Join Channel","archives")()).removeClass("btn_outline"),$("#footer_archives_action_tip").html('<span class="tiny dialog_cancel_hint">'+r+"</span>")),TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")}else TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,TS.i18n.t("You are viewing the archives of {hash}{channel_name}","archives")({hash:t,channel_name:e.name}))},T=function(){$("#footer_msgs").removeClass("hidden"),$("#footer").css("height",""),$("#footer_archives").addClass("hidden"),$("#archives_bottom_div").addClass("hidden"),$("#archives_top_div").addClass("hidden"),$("#archives_return").addClass("hidden").removeClass("warning"),TS.client.archives.$scroller.addClass("hidden"),TS.client.msg_input.setPlaceholder(),TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div)},v=function(){var e;e=d?TS.i18n.t("retrieving history...","archives")():o?n?"&nbsp;":"":'<a onclick="TS.client.archives.loadMoreBottom()">'+TS.i18n.t("and more...","archives")()+"</a>",$("#archives_bottom_div").html(e)},b=function(){var e;e=c?TS.i18n.t("retrieving history...","archives")():l?TS.i18n.t("~FIN~","archives")():'<a onclick="TS.client.archives.loadMoreTop()">'+TS.i18n.t("and more...","archives")()+"</a>",$("#archives_top_div").html(e)},w=function(i,a){if(TS.model.archive_view_is_showing){i&&!TS.client.archives.previous_model_ob&&(TS.client.archives.previous_model_ob=TS.channels.getGeneralChannel()||TS.ims.getImByMemberId("USLACKBOT")),TS.client.archives.$archives_msgs_div.empty(),TS.ui.utility.updateClosestMonkeyScroller(TS.client.archives.$scroller),t.addClass("hidden");var s=!1;if(TS.client.archives.getCurrentModelOb()&&(TS.client.archives.getCurrentModelOb()._archive_msgs=void 0,TS.client.archives.not_member&&(s=!0)),n=null,TS.client.archives.current_model_ob=null,e="",TS.model.archive_view_is_showing=!1,s&&TS.client.channel_pane.rebuild("starred","channels"),$("#client-ui").removeClass("archive_view_is_showing"),T(),TS.view.resizeManually("TS.client.archives ended"),!TS.boot_data.feature_initial_scroll_position||i||a||TS.client.msg_pane.setInitialScrollPosition(-1),!TS.boot_data.feature_initial_scroll_position&&!a&&TS.model.prefs.start_scroll_at_oldest&&TS.shared.getActiveModelOb().unread_cnt?setTimeout(TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView,100):TS.client.msg_pane.checkUnreads(),i){var r=TS.client.archives.previous_model_ob;delete TS.client.archives.previous_model_ob,r.is_channel?TS.channels.displayChannel({id:r.id}):r.is_mpim?TS.mpims.displayMpim({id:r.id}):r.is_group?TS.groups.displayGroup({id:r.id}):TS.ims.startImById(r.id)}}},y=function(){$("#footer_archives_action_button").bind("click",function(){if(TS.isPartiallyBooted())return void TS.incremental_boot.userDidInteractWithUI();var e=TS.client.archives.getCurrentModelOb();e.is_channel?e.is_archived?TS.channels.closeArchivedChannel(e.id):TS.channels.joinById(e.id,function(){TS.shared.maybeFetchHistory(e),TS.client.msg_pane.maybeSetupCalls()}):e.is_im?(TS.ims.closeIm(e.id),w(!0)):TS.shared.closeArchivedChannel(e.id)}),TS.client.archives.$scroller.scroll(function(){TS.client.archives.onMsgsScroll()}),$("#archives_return .archives_return__link-column__link").bind("click",function(){TS.client.archives.not_member?o?TS.client.ui.slowScrollMsgsToBottom():(w(),TS.client.archives.start()):w()}),TS.client.ui.$msg_input.bind("textchange",function(){if(TS.model.archive_view_is_showing&&!TS.client.archives.not_member){""===$(this).val()?$("#archives_return").removeClass("warning"):$("#archives_return").addClass("warning")}})},k=function(){if(TS.model.archive_view_is_showing){TS.client.archives.msgs_scrolled_sig.dispatch();a=!1,i=!1,TS.client.ui.areMsgsScrolledToBottom(0)?(-1,i=!0):0===TS.client.archives.$scroller[0].scrollTop&&(a=!0);var e=TS.client.ui.areMsgsScrolledToBottom(50);$("#archives_return").find(".cancel_archives").toggleClass("hidden",!!e&&o),TS.client.archives.msgs_are_auto_scrolling||(TS.client.ui.checkInlineImgsAndIframes("archives"),TS.client.archives.maybeLoadScrollBackHistory())}},A=function(){var e=TS.client.archives.$scroller.find(".message"),t=[];if(e.length){var n={shortenMonth:!0};if(t.push(TS.interop.datetime.toCalendarDate(e.eq(0).data("ts"),n)),e.length>1){var i=TS.interop.datetime.toCalendarDate(e.eq(e.length-1).data("ts"),n);i!=t[0]&&t.push(i)}$("#archives_return_date").text(t.join(" - "))}},C=function(e){if(TS.client.archives.getCurrentModelOb()){var t=TS.client.archives.getCurrentModelOb(),n=TS.utility.msgs.getMsg(e,t._archive_msgs);if(n&&TS.utility.msgs.isMsgReply(n))return void TS.ui.replies.openConversation(t,n.thread_ts,n.ts)}TS.client.ui.scrollMsgsSoMsgIsInView(e,!1,!0)},M=function(e){TS.model.archive_view_is_showing&&e.id==TS.client.archives.getCurrentModelOb().id&&(TS.client.archives.not_member=!1,TS.client.archives.cancel(),TS.client.ui.instaScrollMsgsToBottom(!1))},x=function(e){TS.model.archive_view_is_showing&&e.id==TS.client.archives.getCurrentModelOb().id&&(TS.client.archives.not_member=!1,TS.client.archives.cancel(),TS.client.ui.instaScrollMsgsToBottom(!1))},I=function(e){TS.model.archive_view_is_showing&&e.id==TS.client.archives.getCurrentModelOb().id&&S()},E=function(e){TS.model.archive_view_is_showing&&e.id==TS.client.archives.getCurrentModelOb().id&&S()},B=function(e){TS.model.archive_view_is_showing&&(TS.client.archives.not_member||e.id==TS.client.archives.getCurrentModelOb().id&&TS.client.archives.cancel())},D=function(e,t){if(TS.model.archive_view_is_showing&&t&&e.id==TS.client.archives.getCurrentModelOb().id){TS.client.msg_pane.getDivForArchiveMsg(t.ts).length&&m()}},F=function(e,t){if(TS.model.archive_view_is_showing&&t&&e.id==TS.client.archives.getCurrentModelOb().id){TS.client.msg_pane.getDivForArchiveMsg(t.ts).length&&m()}},P=function(){if(TS.model.archive_view_is_showing){var e=TS.client.archives.getCurrentModelOb();if(TS.shared.getActiveModelOb()==e){var t=TS.client.archives.$scroller.scrollTop();m(e,e._archive_msgs),TS.client.archives.msgs_are_auto_scrolling=!0,TS.client.archives.$scroller.scrollTop(t),TS.client.archives.msgs_are_auto_scrolling=!1}}}}()},2396:function(e,t){!function(){"use strict";TS.registerModule("client.channel_header",{onStart:function(){n=new TS.PresenceList,TS.members.presence_changed_sig.add(o),TS.members.changed_deleted_sig.add(r),TS.dnd.dnd_statuses_changed_sig.add(S),TS.prefs.muted_channels_changed_sig.add(b),TS.groups.member_left_sig.add(m),TS.groups.member_joined_sig.add(m),TS.groups.topic_changed_sig.add(k),TS.groups.converted_to_shared_sig.add(A),TS.channels.member_left_sig.add(m),TS.channels.member_joined_sig.add(m),TS.channels.member_joined_sig.add(P),TS.channels.topic_changed_sig.add(k),TS.channels.joined_sig.add(w),TS.channels.converted_to_shared_sig.add(A),TS.pins.pinned_status_changed_sig.add(l),TS.pins.pinned_message_changed_sig.add(l),TS.pins.pinned_message_deleted_sig.add(l),TS.pins.pins_fetched_sig.add(l),TS.channels.marked_sig.add(d),TS.groups.marked_sig.add(d),TS.mpims.marked_sig.add(d),TS.ims.marked_sig.add(d),TS.channels.joined_sig.add(T),TS.channels.left_sig.add(T),TS.stars.channel_unstarred_sig.add(v),TS.client.threads.reply_count_changed.add(D),t=$("#client_header .channel_header .messages_header"),t.bind("mouseover mouseenter",function(e){$("#topic_inline_edit").toggleClass("inline_edit_hover",!!$(e.target).is("#topic_inline_edit"))})},test:function(){var e={_getHiddenChannelJoinAlertMessage:R};return Object.defineProperty(e,"_$header",{get:function(){return t},set:function(e){t=e}}),e},start:function(){if(!(e=TS.shared.getActiveModelOb())&&!TS.client.activeChannelIsHidden())return void TS.warn("TS.client.channel_header.start cannot find channel, im, or group.");var i,s,r,o,d,c,u=!1,m=!1,f=!1,S=!1;n.clear(),e&&(e.is_im?(r=e,o=TS.members.getMemberById(r.user),i=!0,n.add(o.id)):e.is_mpim?(d=e,s=!0,n.add(d.members)):(e.is_channel||e.is_group)&&(S=!0,!TS.model.user.is_restricted||e.topic&&e.topic.value||(S=!1)),u=TS.shared.isModelObShared(e),m=TS.shared.isModelObOrgShared(e),TS.apps.isAppSpaceEnabled()&&_.get(o,"is_bot")&&(f=!0),c=e.name);var v={is_shared:u,is_org_shared:m,name:c,member:o,is_dm_or_mpdm:i||s,show_topic:S,mpim:d,details_showing:$("#client-ui").hasClass("details_showing"),all_unreads:{is_showing:TS.model.unread_view_is_showing,has_new_messages:TS.model.unread_view_is_showing&&TS.client.unread.new_messages_in_channels.length,messages_loaded:TS.client.unread.messages_loaded,total_unread_count:TS.client.unread.getTotalMessagesCount(),sort_order:TS.client.unread.getSortOrder()},threads:{is_showing:TS.model.threads_view_is_showing},is_app:f};t.html(TS.templates.channel_header(v)),TS.model.active_im_id&&(g(),TS.boot_data.feature_name_tagging_client||p(o)),h(),l(),w(),a(),T(),b(),C(),x(),M(),E(),I()},updateChannelHeaderInfo:function(e){t.find("#channel_header_info").html(e)},clearUnreadPinState:function(){u(!1),$("#pinned_item_count .pin_count_new_pin_message").empty()},setActiveTab:function(e){if(_.isString(e)){var n=t.find('[data-target="'+e+'"]');t.find(".channel_header__tab").removeClass("--active"),n.addClass("--active")}}});var e,t,n,i,a=function(){TS.client.ui.rebuildMemberListToggle()},s=function(t,n){if(TS.model.ms_connected&&t){if(e){var i=TS.membership.getUserChannelMembershipStatus(t.id,e),s=i.is_known&&!i.is_member;n&&!s&&a()}f(t)}},r=function(e){s(e,!0)},o=function(e){var t=!TS.lazyLoadMembersAndBots();s(e,t)},l=function(){if(e){var t=$("#pinned_item_count"),n=t.closest(".channel_header_info_item"),i=$("#pinned_item_count_count"),a=e.pinned_items_count;d(e),e.has_pins?a?(i.text(TS.i18n.number(a,"client")),e.is_channel||n.removeClass("hidden")):i.text(""):e.is_channel?i.text(TS.i18n.number(0,"client")):n.addClass("hidden")}},d=function(e){if(!TS.boot_data.feature_lazy_pins&&e){var t=TS.pins.getUnreadPins(e);if(_.isEmpty(t))return void TS.client.channel_header.clearUnreadPinState();u(!0);var n;if(1===t.length){var i=t[0].created_by;if(!i)return;n=TS.i18n.t("1 new pin by {user_display_name}","client")({user_display_name:TS.members.getPrefCompliantMemberNameById(i,!0)})}else n=TS.i18n.t("{pin_length} new pins","client")({pin_length:t.length});$("#pinned_item_count .pin_count_new_pin_message").html(n)}},c=function(e){var t=$("#channel_members_toggle_count .channel_members_icon");t.length&&t.toggleClass("is_filled",e)},u=function(e){var t=$("#pinned_item_count .pinned_count_icon");0!==t.length&&t.toggleClass("is_filled",e)},m=function(t){e&&t&&e.id===t.id&&a()},h=function(){if(!e.is_mpim&&!e.is_im){var t;e.is_group||e.is_private?(t='<i class="ts_icon ts_icon_lock"></i>',$("#channel_title").prepend(t)):e.is_channel&&(t="#",$("#channel_title").prepend(t))}},p=function(e){var t=TS.members.getPrefCompliantMemberName(e),n=$("#channel_header_info .channel_header_member_alt_name"),i=n.closest(".channel_header_info_item");if(t!==e.profile.real_name)return $("#im_title").prepend("@"),void i.addClass("hidden");var a=t!==e.profile.real_name&&e.profile.real_name,s=a||e.name&&"@"+e.name;s&&(n.text(s),i.removeClass("hidden"))},g=function(){var e=$("#channel_header_info .channel_header_member_status"),t=TS.ims.getImById(TS.model.active_im_id),n=TS.members.getMemberById(t.user),i=TS.templates.makeMemberPresenceStateClass(n),a=TS.templates.makeMemberPresenceDomClass(n.id),s=TS.templates.makeMemberDomId(n);e.addClass(i).addClass(a).addClass(s),f(n)},f=function(n){if(TS.model.active_im_id){var i=TS.ims.getImById(TS.model.active_im_id);if(n==TS.members.getMemberById(i.user)){var a,s=!1;TS.shared.isModelObOrgShared(e)&&(s=!0,a=t.find(".ts_icon_shared_channel"),a.removeClass("away"));var r,o=$("#im_title");o.removeClass("away"),"active"===n.presence?r=TS.i18n.t("active","client")():"away"===n.presence?(r=TS.i18n.t("away","client")(),o.addClass("away"),s&&a.addClass("away")):r=n.presence,n.is_restricted&&(r=n.is_ultra_restricted?TS.i18n.t("Single-Channel Guest","client")():TS.i18n.t("Multi-Channel Guest","client")()),TS.dnd.isMemberInDnd(n)&&(r=TS.i18n.t("notifications snoozed","client")()),$("#header_status_message").html(r)}}},S=function(e){if(e&&e.length&&TS.model.active_im_id){var t=TS.ims.getImById(TS.model.active_im_id),n=TS.members.getMemberById(t.user);_.map(e,"id").indexOf(n.id)>-1&&f(n)}},T=function(){if(e){var t="";if(TS.model.active_im_id){var n=TS.ims.getImById(TS.model.active_im_id);n&&(t=TS.templates.builders.buildStarWithTip("im",n))}else if(TS.model.active_channel_id){var i=e.is_member||e.is_archived&&e.is_starred;i&&(t=TS.templates.builders.buildStarWithTip("channel",e))}else TS.model.active_group_id?t=TS.templates.builders.buildStarWithTip("group",e):TS.model.active_mpim_id&&(t=TS.templates.builders.buildStarWithTip("mpim",e));$("#star_container").html(_.trim(t))}},v=function(t){e&&t&&e.id===t.id&&e.is_archived&&T()},b=function(){if(e&&!TS.client.activeChannelIsHidden()&&!TS.model.active_im_id){var t=['<button type="button" class="btn_unstyle mute_btn ts_tip ts_tip_bottom ts_tip_lazy"',' title="'+TS.i18n.t("Unmute","client")()+'"',">",'<i class="ts_icon ts_icon_bell_slash ts_icon_inherit muted_icon"></i>',"</button>"].join(""),n=$("#mute_container"),i=$("#channel_name");TS.notifs.isCorGMuted(e.id)?(n.html(t),i.addClass("muted"),$(".mute_btn").bind("click",function(){TS.notifs.muteOrUnmuteCorG(e.id)})):(n.empty(),i.removeClass("muted"))}},w=function(){if(e){var n=(e.is_member||e.is_group)&&!TS.model.user.is_ultra_restricted&&!TS.model.user.is_restricted&&(!TS.channels.isChannelRequired(e)||TS.members.canUserPostInGeneral()),i=$("#channel_topic_text"),a=e.topic&&e.topic.value?TS.utility.formatTopicOrPurpose(e.topic.value,!0):"";if(i.html(TS.utility.removeLinksFromTabFlow(a)),n){$("#topic_inline_edit").addClass("inline_edit_editable");var s=e.is_group?"group-id":"channel-id";i.data(s,e.id),i.data("inline-edit-unformatted",e.topic.value)}y();var r=t.find("#topic_inline_edit");r.on("click",function(){TSSSB.call("updateNoDragRegion",{id:"channel-topic",width:r.outerWidth(),height:r.outerHeight(),top:r.offset().top,left:r.offset().left})})}},y=function(){TS.model.is_IE&&$("#topic_inline_edit").addClass("in_ie")},k=function(){var e=!TS.boot_data.feature_name_tagging_client&&document.getElementById("topic_inline_edit").contains(document.activeElement);TS.ui.inline_edit.containsActiveElement(t)||(TS.client.channel_header.start(),e&&$("#topic_inline_edit .inline_edit_inner").focus())},A=function(){TS.client.channel_header.start()},C=function(){if(e){if(B(),TS.model.active_im_id){var t=TS.ims.getImById(TS.model.active_im_id),n=TS.members.getMemberById(t.user);TS.client.msg_pane.maybeSetupCalls(n)}else if(TS.model.active_channel_id||TS.model.active_group_id)TS.client.msg_pane.maybeSetupCalls();else if(TS.model.active_mpim_id){var i=TS.mpims.getMpimById(TS.model.active_mpim_id);TS.client.msg_pane.maybeSetupCalls(!1,i)}$(".channel_calls_button").addClass("blue_on_hover")}},M=function(){TS.model.unread_view_is_showing&&($("#channel_header_unread_refresh").on("click",function(){TS.client.unread.reload()}),TS.model.unread_view_is_showing&&t.on("click",".channel_header_info_sort_order",TS.menu.startWithAllUnreadsSortOrderMenu))},x=function(){if(!TS.client.activeChannelIsHidden()){if(TS.newxp.inOnboarding())return!1;var t=$("#channel_actions_toggle, #channel_name");if(TS.model.active_channel_id)t.on("click.channel_actions",function(t){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}}),TS.menu.channel.startWithChannel(t,e.id)});else if(TS.model.active_group_id)t.on("click.channel_actions",function(t){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}}),TS.menu.group.startWithGroup(t,e.id)});else if(TS.model.active_im_id){var n=TS.ims.getImById(TS.model.active_im_id);t.on("click.channel_actions",function(e){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}}),n&&TS.menu.member.startWithMember(e,n.user,!1,!1,!0)})}else TS.model.active_mpim_id&&t.on("click.channel_actions",function(t){TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_settings_button"}}}),TS.menu.mpim.startWithMpim(t,e.id)})}},I=function(){TS.boot_data.feature_name_tagging_client&&$("#edit_topic_trigger").click(function(){TS.ui.channel_topic_dialog.start()})},E=function(){TS.apps.isAppSpaceEnabled()&&$('[data-action="toggleAppSpaceView"]').on("click",function(){var e=$(this).data("target");TS.client.ui.app_space.toggleView(e)})},B=function(){$(".channel_calls_button").remove()},D=function(e){var t,n=$("#channel_header_info.threads_channel_header_info");t=e?TS.i18n.t("{new_reply_count,plural,=1{{new_reply_count} new reply}other{{new_reply_count} new replies}}","threads")({new_reply_count:e}):TS.i18n.t("No new replies","threads")(),n.text(t)},F={},P=function(e,t,n){n&&(F[e.id]=F[e.id]||[],F[e.id].push(t.name),O())},O=function(){var e=$("#channel_members_toggle_count"),t=TS.model.active_channel_id,n=F[t]||[],a=0===n.length,s=_.isEqual(n,[TS.model.user.name]);if(!a&&!s){var r=R(n);TS.tips.updateTipTitle(e,r),i?clearTimeout(i):c(),i=setTimeout(function(){c(),TS.client.ui.rebuildMemberListToggle(),F={},i=null},5e3)}},R=function(e){if(_.isEmpty(e))return"";var t=e.slice(0,3).map(function(e){return"@"+e});return e.length>3&&t.push("others"),TS.i18n.t("{num_member_names, plural, =1{{first_member_name} has joined the channel} =2{{first_member_name} and {second_member_name} have joined the channel} other{{members} have joined the channel}}","jobs")({num_member_names:t.length,first_member_name:t[0],second_member_name:t[1],members:TS.i18n.listify(t).join("")})}}()},2397:function(e,t){!function(){"use strict";function e(e){if($(window.document).bind("keydown",d),TS.lazyLoadMembersAndBots()){return void new TS.SearchableMemberList({$container:$("#channel_membership_dialog_container"),id:"channel_membership_dialog",model_ob_id:e.id,triggered_by_user_action:!0}).showInitial()}var t=TS.generic_dialog.div.find("#all_members_container"),n=TS.generic_dialog.div.find("#all_members_filter input");n.focus();var s=TS.templates.channel_page_member_row({member:TS.model.user,lazy:!1}),r=$(s);r.appendTo(document.body);var l=r.height();r.remove(),t.longListView({items:[],scrollable:t,approx_item_height:l,makeElement:function(){return $('<div class="list_item_container">')},renderItem:function(e,t){var n=TS.templates.channel_page_member_row({member:t,lazy:!1});e.html(n)}}),TS.environment.supports_custom_scrollbar||t.monkeyScroll(),TS.utility.rAF(function(){t.longListView("setItems",o)}),n.on("keydown",function(e){e.which==TS.utility.keymap.esc&&TS.generic_dialog.cancel()}).on("change keyup cut paste",function(){a(i())}),TS.menu.member.member_item_click_sig.addOnce(u)}function t(t,n,i){var a=TS.templates.channel_page_all_members_dialog({searchable_member_list:TS.lazyLoadMembersAndBots()}),c=TS.i18n.t("{member_count, number} members in {channel_name}","channel_pages")({member_count:_.isUndefined(i)?n.length:i,channel_name:TS.shared.getDisplayNameForModelOb(t)});o=n,TS.generic_dialog.start({dialog_class:l,title:c,body:a,cancel_button_text:TS.i18n.t("Close","channel_pages")(),hide_footer:!0,show_cancel_button:!0,show_go_button:!1,backdrop_click_to_dismiss:!0,onShow:function(){e(t)},onEnd:function(){if(TS.lazyLoadMembersAndBots()){var e=TS.SearchableMemberList.get("channel_membership_dialog");e&&e.destroy()}TS.generic_dialog.div.remove(),TS.generic_dialog.div=void 0,s=void 0,r=void 0,o=void 0,TS.menu.member.member_item_click_sig.remove(u),$(window.document).unbind("keydown",d)}})}function n(e){if(c()){o=e;a(i(),!0)}}function i(){var e=TS.generic_dialog.div.find("#all_members_filter input");return _.toString(e.val()).toLowerCase().trim()}function a(e,t){if(t&&(s=void 0),!e||e!==s){r=r&&s&&e&&_.includes(e,s)?TS.utility.members.filterMembersByQuery(r,e):TS.utility.members.filterMembersByQuery(o,e),s=e;var n=TS.generic_dialog.div.find("#all_members_container");n.longListView("setItems",r,!0),n.toggleClass("invisible",!r.length),TS.generic_dialog.div.find("#all_members_no_matches").toggleClass("hidden",r.length>0),TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(n)})}}TS.registerModule("client.channel_page.members_dialog",{show:t,updateMembers:n,test:function(){var e={updateMembersInDialog:n};return Object.defineProperty(e,"filterMembersInDialog",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(e,"getFilter",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(e,"members",{get:function(){return o},set:function(e){o=e}}),e}});var s,r,o,l="all_members_dialog",d=function(e){e.which==TS.utility.keymap.esc&&""===TS.generic_dialog.div.find("input").val()&&TS.generic_dialog.cancel()},c=function(){return!!TS.generic_dialog.is_showing&&TS.generic_dialog.current_setting.dialog_class==l},u=function(){TS.generic_dialog.cancel()}}()},2398:function(e,t){!function(){"use strict";TS.registerModule("client.channel_page",{onStart:function(){g=new TS.PresenceList,TS.client.login_sig.add(O),TS.client.flexpane_display_switched_sig.add(L),TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.add(Q):TS.ms.connected_sig.add(Q),TS.channels.data_updated_sig.add(N),TS.channels.switched_sig.add(H),TS.channels.purpose_changed_sig.add(j),TS.channels.member_left_sig.add(Z),TS.channels.member_joined_sig.add(J),TS.channels.renamed_sig.add(V),TS.channels.left_sig.add(oe),TS.channels.joined_sig.add(le),TS.channels.topic_changed_sig.add(z),TS.channels.converted_to_shared_sig.add(K),TS.channels.shared_teams_updated_sig.add(G),TS.groups.switched_sig.add(H),TS.groups.purpose_changed_sig.add(j),TS.groups.member_left_sig.add(q),TS.groups.member_joined_sig.add(Y),TS.groups.renamed_sig.add(V),TS.groups.left_sig.add(oe),TS.groups.topic_changed_sig.add(z),TS.groups.converted_to_shared_sig.add(K),TS.groups.shared_teams_updated_sig.add(G),TS.ims.switched_sig.add(H),TS.mpims.switched_sig.add(H),TS.members.presence_changed_sig.add(X),TS.members.changed_name_sig.add(ee),TS.members.changed_profile_sig.add(ee),TS.members.changed_current_status_sig.add(ee),TS.members.changed_account_type_sig.add(ee),TS.members.changed_deleted_sig.add(te),TS.view.members.unknown_resolution_rebuild_sig.add(ee),TS.view.members.unknown_resolution_rebuild_sig.add(function(){if(de()){var e=TS.shared.getActiveModelOb();Se(e)}}),TS.membership.membership_counts_need_refetch_sig.add(_e),TS.prefs.display_real_names_override_changed_sig.add(ne),TS.prefs.team_display_real_names_changed_sig.add(ne),TS.prefs.push_changed_sig.add(W),TS.prefs.dtop_notif_changed_sig.add(W),TS.prefs.team_perms_pref_changed_sig.add(W),TS.prefs.muted_channels_changed_sig.add(W),TS.ui.growls.permission_changed_sig.add(W),TS.files.channel_files_fetched_sig.add(ie),TS.files.team_file_added_sig.add(ae),TS.files.team_file_deleted_sig.add(ae),TS.files.team_file_changed_sig.add(ae),TS.files.team_file_comment_edited_sig.add(se),TS.pins.pinned_status_changed_sig.add(re),TS.pins.pinned_message_changed_sig.add(re),TS.pins.pinned_message_deleted_sig.add(re),TS.pins.pins_fetched_sig.add(re),TS.channels.marked_sig.add(we),TS.groups.marked_sig.add(we),TS.mpims.marked_sig.add(we),TS.ims.marked_sig.add(we),TS.view.members.unknown_resolution_rebuild_sig.add(function(){be(TS.shared.getActiveModelOb())}),TS.client.channel_page.initUI(),I(),TS.view.resize_sig.add(ye)},initUI:function(){h=TS.storage.fetchChannelPageState(),h.expanded_sections||(h.expanded_sections={about:!1,pinned_items:!1,members:!1,shared_files:!1,notif_prefs:!1,apps:!1}),p=h.expanded_sections,e=$("#details_tab"),e.append(TS.templates.channel_page_empty_state({state:h})),t=e.find("#channel_page_scroller"),r=e.find(".conversation_details"),n=e.find(".channel_page_about .section_content.channel_purpose"),i=e.find(".channel_page_pinned_items .section_content.pinned_items"),a=e.find(".channel_page_member_tabs"),s=e.find(".channel_page_member_lists"),o=e.find(".channel_page_shared_files .section_content"),l=e.find(".channel_page_notif_prefs .section_content"),d=e.find(".channel_page_notif_prefs .channel_page_notif_prefs_mute_state"),c=e.find(".c-channel_insights"),u=e.find('[data-js="channel_page_apps_list"]')},showAboutSection:function(){p.about||B("about"),t.find(".channel_page_about").scrollintoview({offset:"top",px_offset:50})},showPinsSection:function(){TS.boot_data.feature_lazy_pins&&p.members&&B("members"),TS.boot_data.feature_lazy_pins&&p.shared_files&&B("shared_files"),p.pinned_items||B("pinned_items"),t.find(".channel_page_pinned_items").scrollintoview({offset:"top",px_offset:50})},showMembersSection:function(){p.pinned_items&&B("pinned_items"),TS.boot_data.feature_lazy_pins&&p.shared_files&&B("shared_files"),p.members||B("members"),t.find(".channel_page_members").scrollintoview({offset:"top",px_offset:50})},showMemberSectionAndHighlight:function(){TS.client.ui.flex.openFlexTab("details"),TS.client.channel_page.showMembersSection(),$("#channel_page_scroller .channel_page_members").highlight(null,"channel_page_members_highlighter")},showFilesSection:function(){TS.boot_data.feature_lazy_pins&&p.members&&B("members"),TS.boot_data.feature_lazy_pins&&p.pinned_items&&B("pinned_items"),p.shared_files||B("shared_files"),t.find(".channel_page_shared_files").scrollintoview({offset:"top",px_offset_:50})},showNotifPrefsSection:function(){p.notif_prefs||B("notif_prefs"),t.find(".channel_page_notif_prefs").scrollintoview({offset:"top",px_offset_:50})},showAppsSection:function(){p.apps||B("apps"),t.find('[data-js="channel_page_apps"]').scrollintoview({offset:"top",px_offset_:50})},pinnedItemHtml:function(e,t){try{var n={item:e,model_ob:t,can_remove:TS.pins.canUserPinHere(t)};if("message"===e.type){var i,a,s=e.message,r=TS.members.getPotentiallyUnknownMemberById(s.user),o=TS.utility.msgs.shouldHaveBotLabel(s,r);if(o){var l=TS.bots.getBotInfoByMsg(s);l&&(i=l.app_id,a=l.bot_id)}n.is_message=!0,n.member=r,n.permalink=TS.utility.msgs.constructMsgPermalink(t,e.message.ts,e.message.thread_ts),n.is_bot=o,n.is_reply=s.thread_ts&&s.thread_ts!=s.ts,n.is_broadcast=TS.boot_data.feature_new_broadcast&&"thread_broadcast"===s.subtype,n.app_id=i,n.bot_id=a}else"file"===e.type?n.is_file=!0:"file_comment"===e.type&&(n.is_comment=!0);return TS.templates.channel_page_pinned_item(n)}catch(e){return TS.info("Problem in pinnedItemHtml:"+e),""}},clearUnreadPinState:function(){$(".pinned_item").removeClass("unread_pin")},highlightPinnedItemForRemoval:function(e){Ge(e).addClass("delete_mode")},unHighlightPinnedItemForRemoval:function(e){Ge(e).removeClass("delete_mode")},isPurposeTooLong:function(e){return TS.utility.contenteditable.getLength(e)>TS.model.channel_purpose_max_length},updatePurposeTooLongWarning:function(e){var t=TS.client.channel_page.isPurposeTooLong(e);return $(e).parent().find(".too_long_warning").toggleClass("hidden",!t),!t},test:function(){var e={initEvents:I,rebuildChannelPage:ue,rebuildChannelDetails:Se,rebuildPinnedItems:be,rebuildMembersTabs:Ae,rebuildMemberLists:$e,generateMemberListTemplateArgs:xe,SEE_ALL_MEMBERS_DIALOG_THRESHOLD:M,MAX_SIDEBAR_MEMBERS_COUNT:x};return Object.defineProperty(e,"_will_rebuild_count_templates_after_promise_resolves",{get:function(){return T},set:function(e){T=e}}),Object.defineProperty(e,"_expanded_sections",{get:function(){return p},set:function(e){p=e}}),Object.defineProperty(e,"_renderMemberList",{get:function(){return Ie},set:function(e){Ie=e}}),e}});var e,t,n,i,a,s,r,o,l,d,c,u,m,h,p,g,f,S,T,v,b=!1,w=!1,y=!1,k=[],A={},C={},M=TS.lazyLoadMembersAndBots()?50:100,x=TS.lazyLoadMembersAndBots()?20:10,I=function(){e.on("click",".invite_link",function(){var e=TS.shared.getActiveModelOb();TS.ui.channel_invite_modal.startInviteToChannelModal(e.id)}),e.on("click",".find_files_link",function(){var e=TS.shared.getActiveModelOb();TS.search.setInputVal("in:"+(e.is_channel&&!e.is_private?"#":"")+e.name),TS.search.setFilter("files"),TS.search.submitSearch()}),e.on("click",".leave_link",function(){var e=TS.shared.getActiveModelOb();e.is_channel?TS.channels.leave(e.id):e.is_group&&TS.groups.leave(e.id)}),e.on("click",".member_preview_link[data-member-id]",function(e){e.preventDefault();var t=$(this).data("member-id");TS.menu.member.startWithMember(e,t)}),e.on("click",".section_header",function(e){var t=$(e.target).closest("[data-section-name]"),n=t.data("section-name");if(n){if(TS.boot_data.feature_lazy_pins){if("members"===n&&!p.members)return TS.client.channel_page.showMembersSection();if("pinned_items"===n&&!p.pinned_items)return TS.client.channel_page.showPinsSection();if("shared_files"===n&&!p.shared_files)return TS.client.channel_page.showFilesSection()}B(n)}}),e.on("click keydown",".edit_purpose, .purpose_cancel",function(e){"click"===e.type?D():e.which==TS.utility.keymap.enter&&D()}),e.on("click keydown",".purpose_done",function(e){"click"===e.type?F():(e.which==TS.utility.keymap.enter&&F(),e.which==TS.utility.keymap.tab&&(e.preventDefault(),e.stopImmediatePropagation(),n.find(".purpose_cancel").focus()))}),e.on("click","[data-app-user-id]",function(e){var t=$(e.currentTarget),n=t.data("app-user-id"),i=TS.members.getMemberById(n);if(i)if($(e.target).is('[data-action="remove_app"]')){var a=TS.shared.getActiveModelOb();TS.apps.maybeKickAppUserFromChannel(i,a)}else{var s=_.get(i,"profile.bot_id");s&&TS.menu.app.startWithApp(e,s).then(function(){TS.menu.positionAt(t,-350,0)})}}),TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()||(e.on("keydown","#channel_purpose_input",function(e){e.which!=TS.utility.keymap.enter||e.shiftKey||e.altKey||F(),e.which==TS.utility.keymap.esc&&D()}),e.on("focus","#channel_purpose_input",function(){n.find("#channel_purpose_input").autosize()})),e.on("click",".pinned_item .remove_pin",function(e){var t=TS.shared.getActiveModelOb(),n=$(this).closest(".pinned_item"),i=n.data("ts"),a=n.data("comment-id"),s=n.data("file-id"),r=n.data("type");"message"===r?TS.pins.unPinMessage(i.toString(),t):"file"===r?TS.pins.unPinFile(s,t):"file_comment"===r&&TS.pins.unPinFileComment(a,s,t),e.preventDefault()}),e.on("click",".pinned_item .pin_metadata",function(e){TS.client.archives.maybeHandleArchiveLink($(this))&&e.preventDefault()}),e.on("click",".pinned_item",function(e){if(!e.isDefaultPrevented()&&!$(e.target).is("a")){e.preventDefault();var t=$(this).data("type"),n=TS.shared.getActiveModelOb(),i=$(this).data("ts"),a=$(this).data("file-id"),s=$(this).attr("data-thread-ts"),r=$(this).data("is-broadcast"),o="channel_page";n.is_im||n.is_mpim?o="im_page":n.is_group&&(o="group_page"),"message"===t?s&&s!=i&&!r?TS.ui.replies.openConversation(n,s,i,o):TS.boot_data.feature_new_broadcast?TS.view.displayMsgInModelOb(n,i):TS.client.ui.tryToJump(n.id,i.toString()):"file"!==t&&"file_comment"!==t||TS.client.ui.files.previewFile(a,o)}}),e.on("click",".view_all_files_link",function(){TS.clog.track("SEARCH_OPEN",{open_method:"files"});var e=TS.shared.getActiveModelOb();TS.search.setInputVal("in:"+(e.is_channel&&!e.is_private?"#":"")+e.name),TS.search.setFilter("files"),TS.search.submitSearch()}),e.on("click",".edit_notif_prefs_btn",function(){var e=TS.shared.getActiveModelOb();TS.ui.channel_prefs_dialog.start(e.id)}),e.on("click",".add_someone",function(e){e.preventDefault();var t=TS.shared.getActiveModelOb(),n=t.is_channel||t.is_group&&!t.is_mpim;TS.boot_data.feature_channel_details_invite_link&&n?TS.ui.channel_invite_modal.startInviteToChannelModal(t.id):t.is_mpim&&TS.ui.im_browser.startWithMpim(t)}),e.on("click",".creator_link",function(){var e=TS.shared.getActiveModelOb(),t=e.created,n=e.msgs[e.msgs.length-1];if(Math.floor(n.ts)<=t){var i=TS.utility.msgs.getDisplayedMsgAfterTS(t,e.msgs);i&&TS.client.ui.scrollMsgsSoMsgIsInView(i.ts,!1,!0)}else E(t,e)}),t.on("scroll",_.debounce(function(){de()&&(f=t.scrollTop())},100))},E=function(e,t){var n=TS.shared.getHistoryApiMethodForModelOb(t),i={channel:t.id,oldest:e,count:1,inclusive:1,ignore_replies:!0,include_pin_count:!!TS.boot_data.feature_lazy_pins};TS.api.call(n,i).then(function(e){var n;return e.data.messages.length<1?(n=t._archive_msgs[0].ts,TS.client.archives.start(n)):(n=e.data.messages[0].ts,TS.utility.msgs.getMsg(n,t.msgs)?TS.client.ui.scrollMsgsSoMsgIsInView(n,!1,!0):TS.client.archives.start(n)),!0}).catch(function(){return TS.warn("Couldnt find creation message at "+e+" in channel: "+t.id)})},B=function(e){var n=TS.shared.getActiveModelOb(),i=t.find('.channel_page_section[data-section-name="'+e+'"]');0!==i.length&&(p[e]?(p[e]=!1,"about"===e&&ge(n),"pinned_items"===e&&ke(),"members"===e&&De(),"shared_files"===e&&Oe(n),"notif_prefs"===e&&ve(),"apps"===e&&Ue(),i.removeClass("expanded")):(p[e]=!0,i.addClass("expanded"),"about"===e&&Se(n),"about"===e&&(n.is_im||n.is_mpim)&&pe(n),"pinned_items"===e&&be(n),"members"===e&&$e(n),"shared_files"===e&&Pe(n),"notif_prefs"===e&&Te(n),"apps"===e&&Re(n)),TS.storage.storeChannelPageState(h),TS.ui.utility.updateClosestMonkeyScroller(t),Ne())},D=function(){n.find(".edit_purpose_label, #channel_purpose_input, .purpose_done, .purpose_cancel, .purpose_label, .channel_purpose_section .channel_purpose_text").toggleClass("hidden"),n.find("#channel_purpose_input").hasClass("hidden")?(TS.utility.contenteditable.blur(n.find("#channel_purpose_input")),n.find(".purpose_done, .purpose_cancel").blur()):TS.utility.contenteditable.focus(n.find("#channel_purpose_input"))},F=function(){var e=TS.shared.getActiveModelOb(),t=n.find("#channel_purpose_input"),i=_.trim(TS.utility.contenteditable.value(t));if(!TS.client.channel_page.isPurposeTooLong(t)){if(e.purpose.value===i)return void D();e.is_group?TS.groups.setPurpose(e.id,i):e.is_channel&&TS.channels.setPurpose(e.id,i),D()}},P=function(e){var t=TS.shared.getActiveModelOb(),n=e.channels;return t.is_group?n=e.groups:t.is_im&&(n=e.ims),-1!==n.indexOf(t.id)},O=function(){b=!0},R=function(){S&&clearInterval(S)},U=function(){R(),TS.lazyLoadMembersAndBots()&&(S=setInterval(Be,6e4))},L=function(e){var t=TS.model.ui_state.flex_name;if(!t||"details"===e&&"details"!==t){if(me(),y=!1,"details"===e){var n=TS.shared.getActiveModelOb(),i=n&&n.id?{channel_id:n.id,channel_type:n.id.charAt(0),is_member:n.is_member}:{};TS.clog.track("FLEXPANE_CHANNEL_DETAILS_CLOSE",i)}}else if(!y&&"details"===t){y=!0,ue();var a=TS.shared.getActiveModelOb(),s=a&&a.id?{channel_id:a.id,channel_type:a.id.charAt(0),is_member:a.is_member}:{};TS.clog.track("FLEXPANE_CHANNEL_DETAILS_OPEN",s)}},Q=function(){if(w){if(A={},!de())return;ue()}else w=!0},H=function(){if(b){T=!1;TS.shared.getActiveModelOb()&&(f=null,"details"===TS.model.ui_state.flex_name&&ue())}},N=function(e){ce(e)&&"details"===TS.model.ui_state.flex_name&&ue()},G=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Se(t)}},j=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Se(t)}},z=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Se(t)}},K=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Se(t)}},W=function(){if(de()){var e=TS.shared.getActiveModelOb();Te(e)}},V=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();he(t),Se(t)}},Y=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Se(t),Ae(t),p.members&&Be()}},q=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Se(t),Ae(t),p.members&&Be()}},J=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Ae(t),p.members&&Be()}},Z=function(e){if(de()&&ce(e)){var t=TS.shared.getActiveModelOb();Ae(t),p.members&&Be()}},X=function(e){ee(e,!0)},ee=function(e,t){if(TS.model.ms_connected&&e&&void 0!==e.id&&de()){var n=TS.shared.getActiveModelOb();if(n){var i=TS.membership.getUserChannelMembershipStatus(e.id,n);if(!i.is_known||i.is_member){(!TS.lazyLoadMembersAndBots()||!t)&&Ae(n),p.members&&Be()}n.creator&&n.creator===e.id&&Se(n)}}},te=function(){if(de()){var e=TS.shared.getActiveModelOb();Ae(e),p.members&&Be()}},ne=function(){if(de()){var e=TS.shared.getActiveModelOb();$e(e)}},ie=function(e){if(de()){var t=TS.shared.getActiveModelOb();t&&e&&t.id===e&&(TS.boot_data.feature_lazy_shared_files&&(delete C[t.id],t.is_channel&&!t.is_member||(A[t.id]=!0)),Pe(t))}},ae=function(e){if(de()){var t=TS.shared.getActiveModelOb();t&&(e.pinned_to&&-1!==e.pinned_to.indexOf(t.id)&&be(t),P(e)&&Pe(t))}},se=function(e,t){if(de()){var n=TS.shared.getActiveModelOb();n&&t.pinned_to&&-1!==t.pinned_to.indexOf(n.id)&&be(n)}},re=function(e){de()&&ce(e)&&be(e)},oe=function(e){delete A[e.id],de()&&TS.model.user.is_restricted&&Se(TS.shared.getActiveModelOb())},le=function(e){de()&&(ce(e)?ue():TS.model.user.is_restricted&&Se(TS.shared.getActiveModelOb()))},de=function(){return y},ce=function(e){var t=TS.shared.getActiveModelOb();return!(!t||!e||t.id!==e.id)},_e=function(){var e=TS.shared.getActiveModelOb();Ae(e),p.members&&$e(e)},ue=function(){me();var e=TS.shared.getActiveModelOb();if(e.is_im||e.is_mpim?(e.is_im?$("#details_tab").addClass("dm_info_pane"):$("#details_tab").removeClass("dm_info_pane"),e.is_mpim?$("#details_tab").addClass("mpim_info_pane"):$("#details_tab").removeClass("mpim_info_pane"),pe(e)):$("#details_tab").removeClass("dm_info_pane mpim_info_pane"),he(e),Se(e),be(e),Ae(e),$e(e),Pe(e),Te(e),TS.boot_data.feature_app_permissions_api_site&&Re(e),U(),!TS.environment.supports_custom_scrollbar){t.data("monkeyScroll")?TS.ui.utility.updateClosestMonkeyScroller(t):t.monkeyScroll()}Ne(),f&&t.scrollTop(f)},me=function(){He(),ke(),Me(),De(),ge(),Oe(),ve(),qe(),TS.boot_data.feature_app_permissions_api_site&&Ue(),R()},he=function(e){var t;if(e.is_channel&&!e.is_mpim||!e.is_channel&&e.is_group&&!e.is_mpim){$("#channel_page_title").text(TS.i18n.t("Channel Details","client")());var n='<span class="channel_name">';n+=TS.templates.builders.makeChannelPrefix(e),n+=_.escape(e.name),TS.shared.isModelObOrgShared(e)?n+=' <ts-icon class="ts_icon_org_shared_channel"></ts-icon>':TS.shared.isModelObShared(e)&&(n+=TS.templates.shared_channels_icon()),n+="</span>",t=TS.i18n.t("About {formatted_channel_name}","client")({formatted_channel_name:n})}else t='<span class="overflow_ellipsis">'+TS.i18n.t("About this conversation","client")()+"</span>";$("#details_tab_header").html(t)},pe=function(e){if(ge(),!e.is_mpim){var t=TS.members.getPotentiallyUnknownMemberById(e.user);g.add(t.id),r.html(TS.templates.channel_page_conversation_details({member:t})),TS.client.flex_pane.startLocalTimeInterval(),Fe("about")}},ge=function(){Fe("about"),g.clear(),r.empty(),TS.client.flex_pane.stopLocalTimeInterval()},fe=function(e){var t=TS.membership.getMembershipCounts(e);t.promise&&(T||(TS.has_pri[Ye]&&TS.log(Ye,"Channel member counts ("+e.id+"): Will rebuild member tabs after we get counts from API"),T=!0,t.promise.then(function(){e.id===TS.shared.getActiveModelOb().id?(TS.has_pri[Ye]&&TS.log(Ye,"Channel member counts ("+e.id+"): Got counts from API, rebuilding member tabs now"),Ae(e),TS.shared.isModelObShared(e)&&(TS.has_pri[Ye]&&TS.log(Ye,"Channel member counts ("+e.id+"): Got counts from API, rebuilding channel details now"),Se(e))):TS.has_pri[Ye]&&TS.log(Ye,"Channel member counts ("+e.id+"): Got counts from API, but active model object has changed, so not rebuilding member tabs")}).finally(function(){T=!1})));var n,i=_.get(t,"counts.member_count"),a=_.get(t,"counts.restricted_member_count");return n=t.counts?t.promise?"using provisional data while waiting for API response":"have up-to-date data":"waiting for initial data",TS.has_pri[Ye]&&TS.log(Ye,"Channel member counts ("+e.id+"): Rebuilding count templates: "+n+"; member count = "+i+"; restricted member count = "+a),t},Se=function(e){if(!e.is_im&&!e.is_mpim){var t={model_ob:e,show_set_purpose:(e.is_member||e.is_group)&&!TS.model.user.is_ultra_restricted&&(!TS.channels.isChannelRequired(e)||TS.members.canUserPostInGeneral()),show_edit_purpose_or_topic:(e.is_member||e.is_group)&&!TS.model.user.is_ultra_restricted&&!TS.model.user.is_restricted&&(!TS.channels.isChannelRequired(e)||TS.members.canUserPostInGeneral())};TS.boot_data.page_needs_enterprise&&(e.is_channel||e.is_group)&&e.is_org_shared&&e.is_global_shared&&(t.is_globally_shared=!0,t.enterprise_org_name=TS.model.enterprise.name,t.enterprise_org_icon=TS.model.enterprise.icon);var i=TS.members.getPotentiallyUnknownMemberById(e.creator),a=TS.experiment.getGroup("unknown_members_perf",TS.members.unknown_members_perf_exp_metrics);i&&i.is_self?t.creator_name=TS.i18n.t("you","channel_pages")():i&&i.is_unknown&&"unknown_members"===a?(t.is_member_unknown=!0,t.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member())):t.creator_name=i?TS.members.getPrefCompliantMemberName(i):TS.i18n.t("unknown","channel_pages")();var s=e.msgs&&e.msgs.length&&_.get(e,["msgs",e.msgs.length-1,"ts"],"");t.permalink=s&&TS.utility.msgs.constructMsgPermalink(e,s)||"javascript:void(0)";var r=TS.interop.datetime.toDateObject(e.created);if(TS.interop.datetime.isToday(r)?t.days_since_creation=0:TS.interop.datetime.isYesterday(r)&&(t.days_since_creation=1),t.creation_date=1e3*e.created,TS.boot_data.page_needs_enterprise&&e.is_org_shared&&e.shared_team_ids)t.teams_shared_with=_.map(e.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)}).filter(function(e){return e});else if(TS.shared.isModelObShared(e)){var o=0,l=fe(e);t.is_loading_members=!l.counts||!_.isObject(l.counts.teams_member_count),t.shared_teams=_.map(e.shared_team_ids,function(e){var t=TS.teams.getTeamById(e)||{id:e};return t.member_count=_.get(l,["counts","teams_member_count",e]),o+=t.member_count,t});var d=_.clone(TS.model.team);d.member_count=_.get(l,["counts","member_count"])-o,t.shared_teams.push(d)}if(n.html(TS.templates.channel_page_details(t)).removeClass("hidden"),TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()){var u=$("#channel_purpose_input");TS.utility.contenteditable.create(u,{modules:{tabcomplete:{positionMenu:function(e){e.style.width=u.outerWidth()+"px",TS.tabcomplete.positionUIRelativeToInput(e,u)},searchOptions:{complete_member_specials:!1},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members]}},onEnter:function(e){return!!e.shiftKey||(F(),!1)},onEscape:function(){D()},onTextChange:function(){TS.client.channel_page.updatePurposeTooLongWarning(u)}}),TS.utility.contenteditable.enable(u),TS.utility.contenteditable.value(u,TS.utility.unformatTopicOrPurpose(e.purpose.value)),u.on("keydown",function(e){e.which!==TS.utility.keymap.up&&e.which!==TS.utility.keymap.down||e.stopPropagation()})}Fe("about"),TS.boot_data.feature_sli_channel_insights&&_.invoke(TS,"client.ui.channel_insights.isEnabled")&&"channel"===TS.shared.getTypeForModelOb(e)&&c.removeClass("hidden")}},Te=function(e){if(ve(),!e.is_im){var t=e.id,n=TS.notifs.isCorGMuted(t),i=TS.ui.growls.checkPermission(),a=!1===i&&TS.ui.growls.no_notifications,s=!1===i&&"denied"===TS.ui.growls.getPermissionLevel(),r=!1===i&&TS.ui.growls.shouldShowPermissionButton(),o=TS.notifs.getCalculatedCorGNotifySetting(t),c=TS.notifs.getCalculatedCorGPushNotifySetting(t),_="everything"===o,u="mentions"===o,m="nothing"===o,h="everything"===c,p="mentions"===c,g="nothing"===c,f={model_ob:e,is_muted:n,desktop_notifs_enabled:i,notifications_impossible:a,notifications_not_allowed:s,notifications_not_yet_allowed:r,desktop_everything:_,desktop_mentions:u,desktop_nothing:m,push_everything:h,push_mentions:p,push_nothing:g};l.html(TS.templates.channel_page_notif_prefs(f)),d.html(TS.templates.channel_page_notif_prefs_mute_state({is_muted:n})),Fe("notif_prefs")}},ve=function(){Fe("notif_prefs"),l.empty()},be=function(e){ke();var t=e.pinned_items,n=e.pinned_items_count,a="",s=!1;TS.boot_data.feature_lazy_pins&&p.pinned_items&&!ze(e)&&(Ke(e),s=!0),TS.boot_data.feature_lazy_pins||ze(e)||(Ke(e),s=!0),n>0?$("#pinned_items_title").text(TS.i18n.t("{pinned_items_count, plural, =1 {# Pinned Item} other {# Pinned Items}}","channel_pages")({pinned_items_count:n})):$("#pinned_items_title").text(TS.i18n.t("Pinned Items","channel_pages")()),p.pinned_items&&(t&&t.length>0?t.forEach(function(t){t.file&&t.file.is_deleted||(je(t),a+=TS.client.channel_page.pinnedItemHtml(t,e))}):s?TS.boot_data.feature_lazy_pins&&(a=TS.templates.infinite_spinner({color:"white",size:"medium"})):a=TS.templates.channel_page_empty_pinned_items({model_ob:e}),i.toggleClass("loading",!(!TS.boot_data.feature_lazy_pins||!s)),a=TS.format.replaceHighlightMarkers(a),i.html(a),Fe("pinned_items"),we(e),ye())},we=function(e){if(!TS.boot_data.feature_lazy_pins&&e){TS.client.channel_page.clearUnreadPinState();var t=TS.pins.getUnreadPins(e);_.isEmpty(t)||_.forEach(t,function(e){var t;if("message"===e.type){var n=e.message.ts;t=$('.pinned_item*[data-ts="'+n+'"]')}else if("file"===e.type){var i=e.file.id;t=$('.pinned_item*[data-type="file"]*[data-file-id="'+i+'"]')}else if("file_comment"===e.type){var a=e.comment.id;t=$('.pinned_item*[data-comment-id="'+a+'"]')}t.length>0&&t.addClass("unread_pin")})}},ye=function(){de()&&p.pinned_items&&TS.utility.rAF(function(){var e=i.find(".pinned_item");e.each(function(){var e=$(this);if("message"===e.data("type")){var t=e.find(".pinned_message_text"),n=e.find(".pin_truncate_fade");t[0].scrollHeight>t[0].clientHeight+3?n.removeClass("hidden"):n.addClass("hidden")}}),e.find(".pinned_message_text").addClass("hide_scroll")})},ke=function(){Fe("pinned_items"),i.empty()},Ae=function(e){var t,n,i,a;if(!e.is_im){if(!TS.lazyLoadMembersAndBots()){var s;i=0,n=0,a=0;for(var r=0;r<e.members.length;r+=1)(s=TS.members.getMemberById(e.members[r]))&&(TS.boot_data.page_needs_enterprise?e.is_shared?s.deleted||(i+=1,"active"===s.presence&&(n+=1),s.is_restricted&&(a+=1)):s.enterprise_user&&s.enterprise_user.teams&&s.enterprise_user.teams.length&&s.enterprise_user.teams.indexOf(TS.model.team.id)>-1&&(i+=1,"active"===s.presence&&(n+=1),s.is_restricted&&(a+=1)):s.deleted||(i+=1,"active"===s.presence&&(n+=1),s.is_restricted&&(a+=1)));return t=!1,void Ce(e,t,i,n,a)}var o=fe(e);t=!o.counts,n=null,i=_.get(o,"counts.member_count"),a=_.get(o,"counts.restricted_member_count"),Ce(e,t,i,n,a)}},Ce=function(e,t,n,i,s){Me();var r={model_ob:e,member_count:n,online_count:i,restricted_count:s,show_restricted_members:s>0,is_loading_members:t,lazy_load_members_and_bots:TS.lazyLoadMembersAndBots()};a.html(TS.templates.channel_page_member_tabs(r))},Me=function(){a.empty()},xe=function(e,t,n){for(var i,a=[],s=t||e.members,r=0;r<s.length;r+=1)(i=TS.members.getMemberById(s[r]))&&(TS.boot_data.page_needs_enterprise?e.is_shared?i.deleted||a.push(i):i.enterprise_user&&i.enterprise_user.teams&&i.enterprise_user.teams.length&&i.enterprise_user.teams.indexOf(TS.model.team.id)>-1&&a.push(i):i.deleted||a.push(i));var o=TS.membership.getMembershipCounts(e),l=_.get(o,"counts.member_count");l<=M&&a.sort(TS.members.memberSorterByActiveWithBotsLast);var d={model_ob:e};return _.isUndefined(n)&&(n=l<=M),n?d.members=a:(d.members=a.slice(0,x),d.show_more_members_link=!0,d.total_member_count=l),TS.boot_data.feature_channel_details_invite_link&&(d.show_channel_invite_link=TS.permissions.members.canUserInviteToChannel(e)),d.all_members=a,d},Ie=function(e,t,n,i){var a=xe(e,t,i);n&&De(),g.add(_.map(a.members,"id")),s.html(TS.templates.channel_page_member_lists(a)),s.find("#see_all_members").on("click",function(t){t.preventDefault(),TS.client.channel_page.members_dialog.show(e,a.all_members,a.total_member_count)}),Fe("members"),Qe()},$e=function e(t,n){if(!t.is_im&&(n||De(),p.members)){n||s.addClass("loading").html(TS.templates.infinite_spinner({color:"white",size:"medium"}));var i=Math.max(x,M),a={count:i,channels:[t.id],present_first:!0,index:TS.members.shouldDisplayRealNames()?"users_by_realname":"users_by_name",filter:"everyone"},r=[TS.flannel.fetchAndUpsertObjectsWithQuery(a)],o=TS.membership.getMembershipCounts(t);o.promise&&r.push(o.promise),Promise.all(r).then(function(e){var i=e[0];if(TS.shared.getActiveModelOb().id===t.id){var a=TS.membership.getMembershipCounts(t),s=_.get(a,"counts.member_count"),r=s<=M,o=r?M:x,l=_.map(i.objects,"id").slice(0,o);return Ie(t,l,n,r),null}}).catch(function(){TS.has_pri[Ye]&&TS.log(Ye,"Flannel error: failed to fetch all members for channel "+t.id),TS.logError("failed to fetch all members for channel "+t.id,"Flannel error"),s.removeClass("loading"),s.html('<div class="align_center subtle_silver">'+TS.i18n.t("Oops, something went wrong.","client")()+' <a href="#">'+TS.i18n.t("Try again","client")()+"</a></div>"),s.find("a").click(function(n){n.preventDefault(),e(t)})})}},Ee=function(){var e=TS.shared.getActiveModelOb();$e(e,!0)},Be=_.throttle(Ee,2e4),De=function(){Fe("members"),g.clear(),He(),s.empty()},Fe=function(e){var n=t.find('.channel_page_section[data-section-name="'+e+'"]'),i=_.sum(n.children(":visible").map(function(e,t){return $(t).outerHeight(!0)}).toArray());clearTimeout(n.data("animate")),p[e]?n.css({"max-height":i,height:""}).data("animate",setTimeout(function(){p[e]&&n.css("max-height","none")},310)):n.css({"max-height":i,height:i}).data("animate",setTimeout(function(){n.css("max-height","").data("animate",setTimeout(function(){p[e]||n.css("height","")},310))},10))},Pe=function(e){Oe();var t,n=!1,i="";if(TS.boot_data.feature_lazy_shared_files&&p.shared_files&&!We(e)&&(Ve(e),n=!0),TS.boot_data.feature_lazy_shared_files||We(e)||(Ve(e),n=!0),p.shared_files){if(n&&TS.boot_data.feature_lazy_shared_files&&(i=TS.templates.infinite_spinner({color:"white",size:"medium"})),o.toggleClass("loading",!(!TS.boot_data.feature_lazy_pins||!n)),i)return o.html(i),void Fe("shared_files");for(var a=0;a<TS.model.files.length;a+=1)t=TS.model.files[a],t.is_deleted||P(t)&&k.length<10&&(k.push(t),i+=TS.templates.builders.fileHTML(t));if(k.length>=10)if(e.is_im){var s=TS.members.getPotentiallyUnknownMemberById(e.user);i+=TS.templates.channel_page_view_all_files_link({model_ob:e,member:s})}else i+=TS.templates.channel_page_view_all_files_link({model_ob:e});i?o.html(i):o.html(TS.templates.channel_page_empty_shared_files({model_ob:e})),Fe("shared_files"),Qe()}},Oe=function(){Fe("shared_files"),k=[],o.empty()},Re=function(e){Ue(),Le(),p.apps&&(u.html(TS.templates.infinite_spinner({color:"white",size:"medium"})),Fe("apps"),TS.apps.permissions.promiseToGetAppsForResource(e.id).then(function(e){var t=e.reduce(function(e,t){var n=_.clone(TS.model.apps[t.app_id]);return n&&(n.app_user_id=t.app_user_id,e.push(n)),e},[]).sort(TS.i18n.mappedSorter("name"));Le(t.length),u.html(TS.templates.channel_page_apps_list({apps:t})),Fe("apps")}))},Ue=function(){Fe("apps"),u.empty()},Le=function(e){var t=e?TS.i18n.t("{app_count} Apps","channel_pages")({app_count:e}):TS.i18n.t("Apps","channel_pages")();$("[data-js=channel_apps_title]").text(t)},Qe=function(){He(),m=t.find(".lazy").lazyload({container:t}),Ne()},He=function(){m&&m.detachEvents&&(m.detachEvents(),m=null)},Ne=function(){TS.utility.cancelRAF(v),v=TS.utility.rAF(function(){t.trigger("resize-immediate")})},Ge=function(e){var t;return"message"===e.type?t=i.find('.pinned_item[data-type="message"][data-ts="'+e.message.ts+'"]'):"file"===e.type?t=i.find('.pinned_item[data-type="file"][data-file-id="'+e.file.id+'"]'):"file_comment"===e.type&&(t=i.find('.pinned_item[data-type="file_comment"][data-comment-id="'+e.comment.id+'"]')),t},je=function(e){if("file_comment"===e.type){var t=TS.files.getFileCommentById(e.file,e.comment.id);e.comment=t}},ze=function(e){return!1===e.has_pins||TS.pins.havePinsBeenFetched(e)},Ke=function(e){TS.pins.arePinsCurrentlyBeingFetched(e)||TS.pins.fetchPins(e)},We=function(e){return!!A[e.id]},Ve=function(e){C[e.id]||(C[e.id]=!0,TS.files.fetchChannelFiles(e.id,function(t){delete C[e.id],t&&(e.is_channel&&!e.is_member||(A[e.id]=!0))},10))},Ye=1989,qe=function(){c.addClass("hidden")}}()},2399:function(e,t){!function(){"use strict";TS.registerModule("client.channel_pane",{$scroller:$("#channels_scroller"),$unread_nav:$(".channels_nav_unread"),$threads_nav:$("#col_channels .all_threads"),$app_space_nav:$("#col_channels .app_space"),onStart:function(){if(e=new TS.PresenceList,t=new TS.PresenceList,a=TS.utility.enableFeatureForUser(5),TS.useReactSidebar()){var n=document.getElementById("col_channels_react_root");TS.interop.mountChannelSidebar(n)}else TS.client.login_sig.add(r),TS.members.members_for_user_changed_sig.addOnce(TS.client.channel_pane.rebuild.bind(TS.client.channel_pane,"ims")),TS.client.channel_pane.$scroller.delegate("li a","dragstart",o)},rebuild:function(){if(!TS.useReactSidebar()){a&&TS.metrics.mark("channel_sidebar_rebuild_mark"),TS.client.channel_pane.rebuildFooter();for(var e,t=0;t<arguments.length;t+=1)e=arguments[t],"starred"===e?E():"channels"===e?D():"ims"===e?(P(),TS.apps.isAppSpaceEnabled()&&R()):"apps"===e?R():TS.error("unknown channel_pane section:"+e);a&&TS.metrics.measureAndClear("channel_sidebar_rebuild","channel_sidebar_rebuild_mark")}},rebuildFooter:function(){TS.boot_data.feature_prev_next_button?($("#col_channels_footer").empty(),$("#history_nav_btn").length||($("#col_channels_footer").append('<div id="history_nav_btn" class="clearfix"></div>'),$("#history_nav_btn").html(TS.templates.builders.buildHistoryNavBtnHtml()),TS.client.channel_pane.updateFooterUI()),L()):Q()},updateFooterUI:function(){var e=$("#left_arrow_btn"),t=$("#right_arrow_btn"),n=$("#quickswitcher_btn");g(),1===TS.model.nav_history.length?(m(e),m(t)):0===TS.model.nav_current_index?(m(e),h(t)):TS.model.nav_current_index===TS.model.nav_history.length-1?(m(t),h(e)):(h(e),h(t)),h(n)},updateQuickSwitcherBtnVisibility:function(){var e=$("#quick_switcher_btn");if(TS.model.prefs.no_omnibox_in_channels){if(e.hasClass("hidden"))return}else if(!e.hasClass("hidden"))return;e.toggleClass("hidden",!!TS.model.prefs.no_omnibox_in_channels),L()},getSortedList:function(){return U()},makeSureActiveChannelIsInView:function(){TS.model.unread_view_is_showing||M()},checkScrolledAtAll:TS.utility.immediateDebounce(function(){TS.useReactSidebar()||(TS.client.channel_pane.$scroller.scrollTop()<=0?(TS.client.channel_pane.$scroller.removeClass("has_scrolled"),s=!1):s||(TS.client.channel_pane.$scroller.addClass("has_scrolled"),s=!0))}),openChannelBrowser:function(){if(!d())return TS.sounds.play("beep");T()},openCreateChannelDialog:function(){if(TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups())return d()?void v():TS.sounds.play("beep")},openDMBrowser:function(){if(!d())return TS.sounds.play("beep");f()},openAppsBrowser:function(){if(!d())return TS.sounds.play("beep");S()},getStarredListCount:function(){return I().length}});var e,t,n=[],i=[],a=!1,s=!1,r=function(){TS.has_pri[82]&&TS.log(82,"UI bind on login_sig"),c()},o=function(e){var t=!1;if(TS.boot_data.feature_arugula){var n=e.target.dataset?e.target.dataset.dragMeta:null;e&&e.originalEvent.dataTransfer&&n&&(e.originalEvent.dataTransfer.effectAllowed="link",e.originalEvent.dataTransfer.setData("x-slack/channel-drag-json",n),t=!0)}t||e.preventDefault()},l=function(){return!(!TS.model.ms_connected&&!TS.model.change_channels_when_offline)},d=function(){return!!l()},c=function(){$(".new_channel_btn").on("click",function(e){e.stopPropagation(),TS.client.channel_pane.openCreateChannelDialog()}),$("#direct_messages_header, .new_dm_btn").on("click",function(e){e.stopPropagation(),TS.client.channel_pane.openDMBrowser()}),$("#apps_header, .add_apps_btn").on("click",function(e){if(e.stopPropagation(),!d())return TS.sounds.play("beep");S(e)}),$("#channels_header").on("click",function(){TS.client.channel_pane.openChannelBrowser()}),TS.client.channel_pane.$unread_nav.on("click",function(e){e.preventDefault(),TS.client.ui.checkForEditing(e)||TS.client.unread.showUnreadView()}),TS.client.channel_pane.$threads_nav.on("click",function(e){e.preventDefault(),TS.client.ui.checkForEditing(e)||TS.client.threads.showThreadsView()}),TS.client.channel_pane.$app_space_nav.on("click",function(e){if(e.preventDefault(),TS.model.sorting_mode_is_showing)return TS.sounds.play("beep");TS.client.app_space.showAppSpaceView()}),TS.client.channel_pane.$scroller.find(".section_holder ul").on("click",function(e){if(!TS.view.maybeFollowLink(e)){if(e.preventDefault(),e.stopPropagation(),!l())return TS.sounds.play("beep");if(TS.client.ui.checkForEditing(e))return TS.sounds.play("beep");var t=$(e.target),n=t.closest(".member").find(".im_name"),i=n.data("member-id"),a=t.closest(".group_name"),s=a.data("group-id"),r=t.closest(".channel_name"),o=r.data("channel-id"),c=t.closest(".mpim").find(".mpim_name"),_=c.data("mpim-id"),u=t.attr("href");if(i)if(t.hasClass("im_close")){var m=TS.ims.getImByMemberId(i);TS.client.ui.maybePromptForClosingIm(m.id)}else{if(!d())return TS.sounds.play("beep");TS.ims.startImByMemberId(i)}else if(s)if(t.hasClass("group_close"))TS.client.ui.maybePromptForClosingGroup(s);else{if(!d())return TS.sounds.play("beep");TS.groups.displayGroup({id:s,path:u})}else if(o){if(!d())return TS.sounds.play("beep");TS.channels.displayChannel({id:o,channel_path:u})}else if(_){if(t.hasClass("mpim_close"))return void TS.mpims.closeMpim(_);if(!d())return TS.sounds.play("beep");TS.mpims.displayMpim({id:_,path:u})}}})},u=function(){var e=TS.channels.getUnarchivedChannelsForUser().length,t=TS.groups.getUnarchivedGroups().length,n=e+t,i=$(".channel_list_header_label");if(TS.boot_data.feature_sidebar_hide_count||$("#channel_header_count").text(TS.i18n.number(n)),i.length){var a=i.attr("aria-label")||"";i.attr("aria-label",a.replace("[0]",n))}},m=function(e){e.off(),e.children("div.ts_tip_tip").addClass("hidden"),e.addClass("disabled")},h=function(e){var t=e.selector;"#left_arrow_btn"===t?e.off().on("click",function(){if(TS.newxp.inOnboarding())return!1;TS.client.nav_history.setDirection(TS.utility.keymap.left),window.history.go(-1)}):"#right_arrow_btn"===t?e.off().on("click",function(){if(TS.newxp.inOnboarding())return!1;TS.client.nav_history.setDirection(TS.utility.keymap.right),window.history.go(1)}):"#quickswitcher_btn"===t&&e.off().on("click",function(){if(TS.newxp.inOnboarding())return!1;TS.ui.jumper.start()}),e.children("div.ts_tip_tip").removeClass("hidden"),e.removeClass("disabled")},p=function(e){return null===e?"":"All Unreads"===e||"Threads"===e||"Apps"===e?e:TS.shared.getDisplayNameForModelOb(TS.shared.getModelObById(e))},g=function(){var e={type:"ts_icon_arrow_large_left",name:"Previous",mac_or_pc:TS.model.is_mac?"":"Alt",prev_or_next:"ts_icon_arrow_left_medium"},t={type:"ts_icon_arrow_large_right",name:"Next",mac_or_pc:TS.model.is_mac?"":"Alt",prev_or_next:"ts_icon_arrow_right_medium"},n=TS.model.nav_current_index,i=TS.model.nav_history,a=i.length,s=null,r=null;0===a?TS.error("No navigation history yet!!!"):1===a?(s=i[n].id,r=i[n].id):n===a-1?s=i[n-1].id:0===n?r=i[n+1].id:(s=i[n-1].id,r=i[n+1].id),e.name=p(s),t.name=p(r),$("#left_arrow_btn").html(TS.templates.footer_tool_tip(e)),$("#right_arrow_btn").html(TS.templates.footer_tool_tip(t))},f=function(){TS.ui.im_browser.start(),$("#direct_messages_header, .channels_list_new_btn").tooltip("hide")},S=function(){TS.ui.apps_browser.start(),$("#apps_header, .channels_list_new_btn").tooltip("hide")},T=function(){TS.ui.channel_browser.start(),$("#channels_header").find(".channel_list_header_label").tooltip("hide")},v=function(){TS.ui.new_channel_modal.start(),$(".channels_list_new_btn").tooltip("hide")},b=function(e){return e.is_im?TS.ims.getDisplayNameOfUserForImLowerCase(e):e.is_mpim?TS.mpims.getDisplayNameLowerCase(e):e._name_lc},w=function(e){var t="",n={model_ob:e};return e.is_im?(n.member=TS.members.getMemberById(e.user),n.color_names=!1,n.show_close_link=!0,t=TS.templates.member(n)):t=e.is_mpim?TS.templates.mpim(n):e.is_group?TS.templates.group(n):TS.templates.channel(n),t},y=function(){var e=TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups();$(".new_channel_btn").toggleClass("hidden",!e)},k=function(e,t){if(e.is_slackbot_im)return-1;if(t.is_slackbot_im)return 1;if(e.is_self_im)return-1;if(t.is_self_im)return 1;var n=e.is_mpim?TS.mpims.getDisplayNameLowerCase(e):TS.ims.getDisplayNameOfUserForImLowerCase(e),i=t.is_mpim?TS.mpims.getDisplayNameLowerCase(t):TS.ims.getDisplayNameOfUserForImLowerCase(t);return TS.i18n.sorter(n,i)},A=function(e,t){var n=b(e),i=b(t),a=!e.is_im&&TS.notifs.isCorGMuted(e.id)?"Z":"",s=!t.is_im&&TS.notifs.isCorGMuted(t.id)?"Z":"";return TS.model.prefs.separate_private_channels?(n=e.is_channel?a+"A"+n:e.is_group&&!e.is_mpim?a+"B"+n:e.is_slackbot_im?a+"C"+n:e.is_self_im?a+"D"+n:a+"E"+n,i=t.is_channel?s+"A"+i:t.is_group&&!t.is_mpim?s+"B"+i:t.is_slackbot_im?s+"C"+i:t.is_self_im?s+"D"+i:s+"E"+i):(n=e.is_channel||e.is_group&&!e.is_mpim?a+"A"+n:e.is_slackbot_im?a+"B"+n:e.is_self_im?a+"C"+n:a+"D"+n,i=t.is_channel||t.is_group&&!t.is_mpim?s+"A"+i:t.is_slackbot_im?s+"B"+i:t.is_self_im?s+"C"+i:s+"D"+i),TS.i18n.sorter(n,i)},C=function(e,t){var n=e._name_lc,i=t._name_lc;return TS.model.prefs.separate_private_channels&&(n=(e.is_channel?"a":"z")+n,i=(t.is_channel?"a":"z")+i),TS.i18n.sorter(n,i)},M=function(){TS.useReactSidebar()||x()},x=function(){var e;e=TS.model.threads_view_is_showing?TS.client.channel_pane.$scroller.find(".all_threads"):TS.model.app_space_view_is_showing?TS.client.channel_pane.$scroller.find(".app_space"):TS.client.channel_pane.$scroller.find(".section_holder ul li.active"),e.length&&e.scrollintoview({offset:"top",px_offset:50,scroller:TS.client.channel_pane.$scroller})},I=function(){var e,n,a,s,r,o=TS.channels.getChannelsForUser(),l=TS.model.groups,d=TS.model.ims,c=[],u=[];for(e=0;e<o.length;e+=1)if(n=o[e],n.is_starred){var m=TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==n.id;(n.is_member||n.was_archived_this_session||m)&&u.push(n)}for(e=0;e<l.length;e+=1)a=l[e],a.is_starred&&(a.is_archived&&!a.was_archived_this_session||u.push(a));for(e=0;e<d.length;e+=1)s=d[e],s.is_starred&&(r=TS.members.getMemberById(s.user),r?r.deleted||(s.is_open||s.unread_cnt)&&(u.push(s),c.push(r.id)):TS.warn('Expected member "'+s.user+'" to exist, but it does not!'));c.length===i.length&&_.intersection(c,i).length===c.length||(t.clear(),t.add(c)),i=c;var h,p=TS.model.mpims;for(e=0;e<p.length;e+=1)h=p[e],h.is_starred&&(h.is_open||h.unread_cnt)&&u.push(h);return u.sort(A),u},E=function(){var e=I(),t="";$("#starred_div").toggleClass("hidden",!e.length),e.forEach(function(e){t+=w(e)}),$("#starred-list").html(t),TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller($("#starred-list")),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()},B=function(){for(var e,t=TS.channels.getChannelsForUser(),n=[],i=[],a=TS.model.groups,s=[],r=[],o=0;o<t.length;o+=1){e=t[o];var l=TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==e.id;e.is_starred||(e.is_mpim||(e.is_member||e.was_archived_this_session||l)&&(TS.notifs.isCorGMuted(e.id)?i.push(e):n.push(e)))}$.each(a,function(e,t){var n=TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==t.id;(!t.is_archived||t.was_archived_this_session||n)&&(t.is_starred||(TS.notifs.isCorGMuted(t.id)?r.push(t):s.push(t)))});var d=n.concat(s),c=i.concat(r);return d.sort(C),c.sort(C),d.concat(c)},D=function(){var e=B(),t=e.length;if(y(),TS.model.user.is_restricted&&!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups()&&0===t)return void $("#channels").addClass("hidden");if($("#channels").removeClass("hidden"),!TS.model.user.is_ultra_restricted){var n=$("#channels_header"),i=!TS.model.user.is_restricted;n.find(".channel_list_header_label").tooltip("destroy"),n.toggleClass("hoverable",i),i&&n.find(".channel_list_header_label").tooltip({placement:"top-left",container:"body",delay:{show:400,hide:150}})}var a="";e.forEach(function(e){a+=w(e)}),$("#channel-list").html(a),u(),TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller($("#channel-list")),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()},F=function(){var t=[],i=TS.mpims.getVisibleMpims(),a=[];TS.members.getMembersForUser().forEach(function(e){var n=TS.ims.getImByMemberId(e.id);e.deleted&&TS.client.archives.getCurrentModelOb()!==n||n&&(n.is_open||n.unread_cnt)&&(TS.apps.isAppSpaceEnabled()&&(e.is_app_user||e.is_bot)||n.is_starred&&!e.deleted||t.push(n))});var s=_.map(t,"user");s.length===n.length&&_.intersection(s,n).length===s.length||(e.clear(),e.add(s)),n=s,i=i.filter(function(e){return!(!e.is_open&&!e.unread_cnt)&&(!e.is_starred&&(!TS.notifs.isCorGMuted(e.id)||(a.push(e),!1)))});var r=t.concat(i);return r.sort(k),a.sort(k),r.concat(a)},P=function(){var e=F(),t="";e.forEach(function(e){t+=w(e)}),$("#im-list").html(t),$("#direct_messages").removeClass("hidden"),TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller($("#im-list")),TS.ui.admin_invites.maybeShowInviteLink(),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()},O=function(){var e=[];return TS.members.getMembersForUser().forEach(function(t){var n=TS.ims.getImByMemberId(t.id);t.deleted&&TS.client.archives.current_model_ob!==n||n&&(n.is_open||n.unread_cnt)&&(t.is_app_user||t.is_bot)&&(n.is_starred&&!t.deleted||e.push(n))}),e.sort(k),e},R=function(){if(TS.apps.isAppSpaceEnabled()){var e=O(),t="";e.forEach(function(e){t+=w(e)}),$("#apps-list").html(t),$("#app_messages").removeClass("hidden")}},U=function(){return I().concat(B(),F())},L=function(){var e=TS.model.prefs.no_omnibox_in_channels;TS.boot_data.feature_prev_next_button&&(e=e&&TS.model.prefs.prev_next_btn);var t=$("#channel_scroll_down");$("#col_channels_footer").toggleClass("hidden",e),t.toggleClass("no_sidebar_footer",!!e);var n=!!TS.boot_data.feature_initial_scroll_position;TS.view.resizeManually("TS.client.channel_pane _updateChannelPaneFooterVisibility",n)},Q=function(){$("#quick_switcher_btn").off().html(TS.templates.builders.buildQuickSwitcherBtnHtml()).on("click",function(){return!TS.newxp.inOnboarding()&&(TS.ui.jumper.start(),TS.clog.track("QUICKSWITCHER_ACTION",{click_target:"quick_switcher_btn",trigger:"quick_switcher_btn",action:"opened"}),TS.client.channel_pane.updateQuickSwitcherBtnVisibility())}),TS.client.channel_pane.updateQuickSwitcherBtnVisibility()}}()},2400:function(e,t){!function(){"use strict";TS.registerModule("client.deprecation",{supported:{chrome:51,firefox:47,safari:9,msie:11,msedge:14,electron:"0.0.0"},onStart:function(){TS.client.login_sig.addOnce(function(){TS.qs_args.deprecate_modal?n():TS.qs_args.deprecate_modal_unsupported?i():TS.qs_args.deprecate_modal_install?a():TS.qs_args.deprecate_modal_install_unsupported?s():TS.qs_args.deprecate_modal_ssb&&r(),TS.client.deprecation.isDeprecatedSSB()?r():TS.client.deprecation.isBrowserSupported()||(TS.client.deprecation.canInstallSSB()?TS.client.deprecation.isBrowserFamilySupported()?a():s():TS.client.deprecation.isBrowserFamilySupported()?n():i())})},isBrowserSupported:function(){if(TS.model.is_electron&&TS.model.desktop_app_version){var e=TS.model.desktop_app_version,t=e.major+"."+e.minor+"."+e.patch;return TS.utility.compareSemanticVersions(t,TS.client.deprecation.supported.electron)>=0||(TS.console.info(e," electron app is deprecated!"),!1)}return window.bowser?!bowser.mobile&&(!!_.some(TS.client.deprecation.supported,function(e,t){return bowser[t]&&bowser.version>=e})||(!(!bowser.firefox||45!==Math.floor(bowser.version))||(TS.console.warn(bowser,navigator.userAgent,"is deprecated!"),!1))):(TS.console.warn("no bowser???"),!0)},isBrowserFamilySupported:function(){return!!window.bowser&&_.some(TS.client.deprecation.supported,function(e,t){return bowser[t]})},isDeprecatedSSB:function(){return!TS.client.deprecation.isBrowserSupported()&&TS.model.is_our_app},canInstallSSB:function(){return!!TS.model.is_win_7_plus||(!(!TS.model.is_mac||1!==TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8"))||!!TS.model.is_lin)}})}();var n=function(){TS.metrics.count("deprecation_modal");var e=TS.i18n.t("This browser is out of date","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:!0}).replace("emoji-sizer","");e=new Handlebars.SafeString(e),TS.ui.fs_modal.start({title:e,body:TS.i18n.t("<p>We know it's a hassle to upgrade, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please upgrade to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:!0,go_button_text:TS.i18n.t("Learn More","deprecation")(),show_cancel_button:!1,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function(){TS.metrics.count("deprecation_button"),TS.utility.openInNewTab("https://get.slack.help/hc/"+TS.i18n.zdLocale()+"/articles/201746897","_blank")},onShowComplete:function(){$("#fs_modal .dialog_go").focus()}}),$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})},i=function(){TS.metrics.count("deprecation_modal_unsupported");var e=TS.i18n.t("This browser is no longer supported","deprecation")()+" "+TS.emoji.graphicReplace(":construction:",{jumbomoji:!0}).replace("emoji-sizer","");e=new Handlebars.SafeString(e),TS.ui.fs_modal.start({title:e,body:TS.i18n.t("<p>We know it's a hassle to change browsers, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please switch to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:!0,go_button_text:TS.i18n.t("Learn More","deprecation")(),show_cancel_button:!1,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function(){TS.metrics.count("deprecation_button_unsupported"),TS.utility.openInNewTab("https://get.slack.help/hc/"+TS.i18n.zdLocale()+"/articles/201746897","_blank")},onShowComplete:function(){$("#fs_modal .dialog_go").focus()}}),$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})},a=function(){TS.metrics.count("deprecation_modal_install");var e=TS.i18n.t("This browser is out of date","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:!0}).replace("emoji-sizer","");e=new Handlebars.SafeString(e),TS.ui.fs_modal.start({title:e,body:TS.i18n.t("<p>We know it's a hassle to upgrade, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please upgrade to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend downloading our desktop app: you'll get greater control over your notifications, easy switching between teams, and  handily  automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:!0,go_button_text:TS.i18n.t("Use the Slack app","deprecation")(),show_cancel_button:!1,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function(){TS.metrics.count("deprecation_button_install"),TS.utility.openInNewTab("/ssb/redirect","_blank")},onShowComplete:function(){$("#fs_modal .dialog_go").focus()}}),$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})},s=function(){TS.metrics.count("deprecation_modal_install_unsupported");var e=TS.i18n.t("This browser is no longer supported","deprecation")()+" "+TS.emoji.graphicReplace(":construction:",{jumbomoji:!0}).replace("emoji-sizer","");e=new Handlebars.SafeString(e),TS.ui.fs_modal.start({title:e,body:TS.i18n.t("<p>We know it's a hassle to change browsers, but we want your experience of Slack to be fast, secure, and the best it can possibly be.</p><p><strong>To continue using Slack, please switch to one of our <a href='https://get.slack.help/hc/{locale}/articles/201746897'>supported browsers</a> soon.</strong> As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p><p>For the finest Slack experience, we recommend <a href='https://slack.com/downloads'>downloading our desktop app</a>: you'll get greater control over your notifications, easy switching between teams, and  handily  automatic updates!</p>","deprecation")({locale:TS.i18n.zdLocale()}),show_secondary_go_button:!0,go_button_text:TS.i18n.t("Use the Slack app","deprecation")(),show_cancel_button:!1,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function(){TS.metrics.count("deprecation_button_install_unsupported"),TS.utility.openInNewTab("/ssb/redirect","_blank")},onShowComplete:function(){$("#fs_modal .dialog_go").focus()}}),$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})},r=function(){TS.metrics.count("deprecation_modal_ssb");var e=TS.i18n.t("This is an out-of-date version of Slack","deprecation")()+" "+TS.emoji.graphicReplace(":spiral_calendar_pad:",{jumbomoji:!0}).replace("emoji-sizer","");e=new Handlebars.SafeString(e),TS.ui.fs_modal.start({title:e,body:TS.i18n.t("<p>We've made some great improvements to our desktop app  it now runs faster, uses far less memory, and updates automatically.</p><p><strong>To continue using Slack, please <a href='https://slack.com/downloads'>manually download our new desktop app</a> soon.</strong> We want your experience of Slack to be fast, secure, and the best it can possibly be. As always, feel free to <a href='mailto:feedback@slack.com'>contact us</a> if you have questions.</p>","deprecation")(),show_secondary_go_button:!0,go_button_text:TS.i18n.t("Update the App","deprecation")(),show_cancel_button:!1,secondary_go_button_class:"btn_link",secondary_go_button_text:TS.i18n.t("Skip for now","deprecation")(),modal_class:"deprecate_modal",onGo:function(){TS.metrics.count("deprecation_button_ssb"),TS.utility.openInNewTab(o(),"_blank")},onShowComplete:function(){$("#fs_modal .dialog_go").focus()}}),$(".deprecate_modal a").on("click",function(){TS.ui.fs_modal.close()})},o=function(){var e=!1,t="";return TS.model.is_mac?e="osx":TS.model.is_win?(e="windows",t=TS.model.is_win_64?"windows_64":"windows"):TS.model.is_lin&&(e="linux"),e?"https://slack.com/downloads/instructions/"+e+"?os="+e+"&build_architecture="+t:"https://slack.com/downloads"}},2401:function(e,t){!function(){"use strict";TS.registerModule("client.downloads",{onStart:function(){TS.client.login_sig.add(p)},updateDownloadsView:function(e){TS.useReactDownloads()&&TS.redux.dispatch(TS.interop.redux.features.downloads.syncDownloads(e))},startDownload:function(e,t){if(!TS.model.supports_downloads)return!1;if(!e)return!1;if(!U(e))return!1;var n=W(U(e)),i=t||!!n,a=0;return i&&("downloads"===TS.model.ui.active_tab_id&&TS.model.ui_state.flex_visible||(a=TS.model.ui_state.flex_visible?100:300),TS.client.ui.flex.openFlexTab("downloads")),TS.useReactDownloads()?(TSSSB.call("startDownload",{id:e.id,url:U(e)}),!0):n?("canceled"!==n.state&&"failed"!==n.state||b(n.token),setTimeout(K,a,n.token),!0):f(e)},downloadWithTokenDidSelectFilepath:function(e,t){var n=r[e];if(!n)return void TS.error("downloadWithTokenDidSelectFilepath: no download for token: "+e);n.file_path=t,O(n)},downloadWithTokenProgress:function(e,t){var n=r[e];if(!n)return void TS.error("downloadWithTokenProgress: no download for token: "+e);var i=G(n);n.progress=t;var a=z(n.token);a.length||TS.error("downloadWithTokenProgress: no $dl found for token: "+n.token);var s=Math.max(.02,Math.min(1,n.progress));a.find(".download_progress_bar").css("width",100*s+"%"),a.find(".download_estimate").text(j(n)),1==n.progress?O(n,"completed"):i&&n.progress>0?(a.find(".partial_size").html(TS.utility.convertFilesize(n.progress*i.size)+" of "+TS.utility.convertFilesize(i.size)),D()):-1!=n.progress&&TS.error("downloadWithTokenProgress: bad dl: "+n)},downloadWithTokenDidFinish:function(e){var t=r[e];if(!t)return void TS.error("downloadWithTokenDidFinish: no download for token: "+e);O(t,"completed")},downloadWithTokenDidFailWithReasonAndCode:function(e,t){if(!r[e])return void TS.error("downloadWithTokenDidFailWithReasonAndCode: no download for token: "+e);TS.generic_dialog.alert(TS.i18n.t("Download failed: {reason}","downloads")({reason:t})),M()},downloadMetadataChanged:function(){n&&(n=!1,M())},maybeBuild:function(){if(TS.model.supports_downloads)if(TS.useReactDownloads()){var e=React.createElement(TS.interop.redux.downloadsView,{},null),t=React.createElement(TS.interop.redux.provider,{store:TS.redux.getStoreInstance()},e);ReactDOM.render(t,o[0],function(){var e=_.get(window,"desktop.downloads.update");e&&e.call(window.desktop.downloads)})}else{if($("#downloads_scroller .monkey_scroll_hider").css("width","auto"),i)return;i=!0,TS.model.ms_logged_in_once&&g()}},maybeShowFlexMenuProgBar:function(){TS.model.supports_downloads&&L()},addIndividualDownload:function(e,n){m=e,t=n,H(m)},removeIndividualDownload:function(){m=$(),t=""}});var e,t,n=!1,i=!1,a=!1,s=[],r={},o=$("#downloads_tab"),l=$("#downloads_scroller"),d=$("#downloads_empty"),c=$("#downloads_tab_clear"),u=$("#downloads_shift_hint"),m=$(),h=[],p=function(){e=$(".flex_menu_download_circle"),TS.model.supports_downloads&&(i&&g(),H(e))},g=function(){if(TS.model.supports_downloads){if(TS.useReactDownloads())throw new Error("Legacy _build called");if(!a){a=!0,d.html(TS.emoji.graphicReplace(d.html()));var e=function(e){return $(e).closest(".download_item").data("token")};l.on("click.dl","a.download_cancel_link",function(t){t.stopPropagation(),S(e(t.target))}),l.on("click.dl",".download_item.completed",function(t){t.stopPropagation();var n=e(t.target);t.shiftKey?v(n):T(n)}),l.on("click.dl",".download_item.canceled, .download_item.failed",function(t){t.stopPropagation(),b(e(t.target))}),l.on("click.dl","i.download_remove_link",function(t){t.stopPropagation(),w(e(t.target))}),l.on("click",'[data-action="load_more"]',function(e){e.preventDefault(),q()}),$(document).on("keydown",function(e){e.which===TS.utility.keymap.shift&&o.addClass("shift_key")}),$(document).on("keyup",function(){o.removeClass("shift_key")}),TS.ui.window_focus_changed_sig.add(function(){o.removeClass("shift_key")}),c.on("click.dl",y),o.addClass("supports_open_file"),C()}}},f=function(e){var t=TSSSB.call("startDownload",U(e));return t?(r[t]={token:t,progress:0,state:"in_progress",href:U(e),http_status:null,file_path:U(e),file_exists:!1,mime_type:"",start_ts:Date.now()/1e3,dl_start_ts:Date.now()/1e3,end_ts:0,base64_png:""},s.push(r[t]),k(),F(r[t]),x(),setTimeout(K,50,t),!0):(TS.error('startDownload called with url: "'+U(e)+'" but I got no token'),!1)},S=function(e){if(!1===TSSSB.call("cancelDownloadWithToken",e))return void TS.error("_cancelDownload with token: "+e+" failed");P(e,"canceled")},T=function(e){!1===TSSSB.call("revealDownloadWithToken",e)&&TS.error("_showDownload with token: "+e+" failed")},v=function(e){var t=!1,n=r[e];n&&(t=TSSSB.call("openFileAtPath",n.file_path)),!1===t&&TS.error("_openDownload with token: "+e+" failed")},b=function(e){if(!1===TSSSB.call("retryDownloadWithToken",e))return void TS.error("_retryDownload with token: "+e+" failed");r[e].dl_start_ts=Date.now()/1e3,P(e,"in_progress")},w=function(e){!1===TSSSB.call("pruneTokensFromHistory",JSON.stringify([e]))&&TS.error("_removeDownload with token: "+e+" failed"),window.winssb?n=!0:M()},y=function e(t){if(!t&&V("in_progress"))return void TS.generic_dialog.start({title:TS.i18n.t("Clear all downloads","downloads")(),body:"<p>"+TS.i18n.t("You have an active download. Are you sure you want to clear them all?","downloads")()+"</p>",show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Yes, clear them all","downloads")(),onGo:function(){e(!0)}});!1===TSSSB.call("pruneTokensFromHistory",JSON.stringify(Object.keys(r)))&&TS.error("_removeAllDownloads with tokens: "+JSON.stringify(Object.keys(r))+" failed"),window.winssb?n=!0:C()},k=function(){s.sort(function(e,t){return e.start_ts<t.start_ts?1:e.start_ts>t.start_ts?-1:0})},A=function(){var e=TSSSB.call("metadataForDownloads"),t=_.cloneDeep(r);s.length=0,e&&(r=JSON.parse(e),_.forOwn(r,function(e,n){e.token=n,e.start_ts=parseFloat(e.start_ts),e.start_ts>9999999999&&(e.start_ts/=1e3),t[n]?(e.hasOwnProperty("progress")||(e.progress=t[n].progress),e.dl_start_ts=t[n].dl_start_ts):e.dl_start_ts=e.start_ts,s.push(e)})),k()},C=function(){if(TS.useReactDownloads())throw new Error("Legacy render called");A(),x(),I(),L()},M=function(){if(TS.useReactDownloads())throw new Error("Legacy update called");A(),x(),B(),L()},x=function(){s.length?(l.removeClass("hidden"),d.addClass("hidden"),u.removeClass("hidden"),c.toggleClass("hidden",s.length<2)):(l.empty().addClass("hidden"),d.removeClass("hidden"),c.addClass("hidden"),u.addClass("hidden"))},I=function(){var e=_.take(s,20),t=E(e);e.length<s.length&&(t+=TS.templates.downloads_load_more()),l.html(t),TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))},E=function(e){var t="";return _.forEach(e,function(e){t+=R(e)}),t},B=function(){var e;if(!s.length)return void L();var t=s,n=l.find(".download_item:last").attr("data-token");if(n){var i=_.findIndex(s,{token:n});i>=0&&(t=_.take(s,i+1))}_.forEach(t,function(t){e=z(t.token),e.length?O(t):F(t)});var a=0;l.find(".download_item").each(function(t,n){a+=1,e=$(n),e.hasClass("hidden_with_fade_out_and_shrink")||r[e.data("token")]||(e.css("height",e.outerHeight()+"px"),setTimeout(function(e){return function(){e.addClass("hidden_with_fade_out_and_shrink")}}(e),0))}),a&&setTimeout(function(){TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"))},550)},D=function(){m.length&&t&&Q(),L()},F=function(e){if(!e)return void TS.error("_addDlDiv: no dl passed");l.prepend(R(e)),TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller")),D()},P=function(e,t){var n=r[e];if(!n)return void TS.error("_updateDownloadByToken: no download for token: "+e);O(n,t)},O=function(e,t){if(!e)return void TS.error("_updateDownload: no dl passed");t&&(e.state=t),"completed"===e.state?e.progress=1:"in_progress"===e.state||(e.progress=0),D(t);var n=z(e.token);if(!n.length)return void TS.error("no $dl found for token: "+e.token);n.hasClass("hidden_with_fade_out_and_shrink")||(n.replaceWith(R(e)),TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller")))},R=function(e){var t=G(e);if(!t&&!e.tried_fetch){e.tried_fetch=!0;var n,i,a=new RegExp(TS.utility.regexpEscape(TS.model.team.id)+"-F[A-Z0-9]+"),s=e.href.match(a),o=_.isString(e.href)&&e.href.substr(0,e.href.lastIndexOf("/")||e.href.length)+"/[redacted]"||"[invalid]";if((!s||!s.length)&&TS.boot_data.page_needs_enterprise){var l="T"+TS.model.enterprise.id.substr(1);a=new RegExp(TS.utility.regexpEscape(l)+"-F[A-Z0-9]+"),s=e.href.match(a),s&&s.length&&TS.warn("_buildItem: no file found matching TS.model.team.id of "+TS.model.team.id+", found with enterprise ID "+TS.model.enterprise.id+" + E->T ("+l+")")}s&&s.length?(n=s[0],i=n.split("-")[1],TS.warn("_buildItem: fetching file for dl.href: "+o),Z(i,function(){(e=r[e.token])&&O(e)})):TS.error("_buildItem: no file id found in dl.href: "+o+". TS.model.team.id = "+TS.model.team.id+(TS.boot_data.page_needs_enterprise?", TS.model.enterprise.id = "+TS.model.enterprise.id:", no enterprise ID."))}var d,c,u,m="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",h=0,p=0;t&&(m=t.thumb_160||t.thumb_80,d=t.filetype||null,c=t.pretty_type||null,u=t.name||null,h=t.size,"in_progress"===e.state&&e.progress&&(p=e.progress*h));var g=e&&e.file_path&&e.file_path.split(/\/|\\/)&&e.file_path.split(/\/|\\/).reverse(),f=g&&g[0];f||TS.warn("_buildItem: no file_path found in dl.file_path"+e.file_path);var S={item:e,img_src:m,filetype:d,pretty_type:c,name:f||u,size:h,partial_size:p,estimate:j(e),debug:JSON.stringify(r,null,2),perc:"completed"===e.state?100:100*Math.max(.02,e.progress)};return S.name||TS.warn("_buildItem: file name is empty or undefined in template_args.name"+S.name),TS.templates.download_item(S)},U=function(e){return e.url_private_download},L=function(){var t=0,n=0;if(_.forOwn(r,function(e){if("in_progress"===e.state&&!(isNaN(e.progress)||e.progress>=1)){var i=G(e);i&&i.size&&(t+=i.size,n+=i.size*Math.max(0,e.progress))}}),t){var i=N(n,t);e.circleProgress({value:i}).addClass("shown_with_fade_in"),$("#downloads_menu_progress").removeClass("hidden").find(".download_progress_bar").css("width",100*i+"%")}else e.removeClass("shown_with_fade_in"),$("#downloads_menu_progress").addClass("hidden")},Q=function(){var e,n=0,i=0;if(_.forOwn(r,function(a){if("in_progress"===a.state&&!isNaN(a.progress)&&!(a.progress>=1)&&(e=G(a)))return e.id===t?(e.size&&(n+=e.size,i+=e.size*Math.max(0,a.progress)),!1):void 0}),n&&e){var a=N(i,e.size);m.circleProgress({value:a}).addClass("shown_with_fade_in")}else m.removeClass("shown_with_fade_in")},H=function(e){e.circleProgress({value:0,size:9,animation:!1,fill:{gradient:["#50acf4","#41a6f5"]},emptyFill:"rgba(211,211,211,1)",thickness:2,lineCap:"round",startAngle:Math.PI/-2})},N=function(e,t){var n=e/t;return Math.max(.06,Math.min(1,n))},G=function(e){return TS.files.getFileByDownloadUrlPrivate(e.href)},j=function(e){if(!e)return"";if("in_progress"!==e.state)return"";if(e.progress>=1)return"";if(-1==e.progress)return"";if(!e.progress)return"";if(e.progress<.02)return"...";var t=Date.now()/1e3-e.dl_start_ts,n=t*(1/e.progress),i=n-t;return TS.i18n.t("{seconds}s remaining","downloads")({seconds:Math.ceil(i)})},z=function(e){return l.find('[data-token="'+e+'"]')},K=function(e){var t=z(e);t.scrollintoview({duration:100,offset:"center_vertical",complete:function(){t.highlight(3e3,"download_item_highlighter",null,0)}})},W=function(e){return Y("href",e)},V=function(e){return Y("state",e)},Y=function(e,t){if(!e)return null;if(!t&&0!==t)return null;for(var n=0;n<s.length;n+=1)if(s[n][e]==t)return s[n];return null},q=function(){var e=l.find(".download_item:last"),t=e.attr("data-token");if(!e.length||!t)return void J();var n=_.findIndex(s,{token:t}),i=_(s).drop(n+1).take(20).value(),a=E(i);e.after(a),_.includes(i,_.last(s))&&J()},J=function(){l.find(".downloads_load_more").remove()},Z=function(e,t){h.push({id:e,callback:t}),X()},X=_.debounce(function(){var e=h;if(h=[],e&&e.length)if(1===e.length){var t=e[0];TS.files.fetchFileInfo(t.id,t.callback)}else{var n=_.map(e,"id");TS.files.fetchMultipleFiles(n,function(t){t&&_.forEach(e,function(e){var t=TS.files.getFileById(e.id);t&&e.callback(e.id,t)})})}},10)}()},2402:function(e,t){!function(){"use strict";TS.registerModule("client.flex_pane",{onStart:function(){o.init(),$("#flex_contents").delegate("div.file_list_item","dragstart",n)},startLocalTimeInterval:function(){clearInterval(e),e=setInterval(s,6e4),s()},stopLocalTimeInterval:function(){clearInterval(e)},maybeFetchFileList:function(){if(TS.model.team&&TS.model.ui_state&&TS.model.ui_state.flex_visible&&"files"===TS.model.ui_state.flex_name&&!TS.model.ui_state.flex_extra){var e,n=(_.isArray(TS.model.file_list_types)&&TS.model.file_list_types||["all"]).sort().join(","),s=$("#file_list").data("list");if("all"===s)return e=i("team",n),void(t[e]||(t[e]=!0,TS.files.fetchTeamFiles(n,a)));var r=$("#file_list").data("filter-user")||"";r&&(e=i(r,n),t[e]||(t[e]=!0,TS.files.fetchMemberFiles(r,n,a)))}}});var e,t={},n=function(e){var t=!1;if(TS.boot_data.feature_arugula){var n=e.target.dataset?e.target.dataset.dragMeta:null;e&&e.originalEvent.dataTransfer&&n&&(e.originalEvent.dataTransfer.effectAllowed="link",e.originalEvent.dataTransfer.setData("x-slack/file-drag-json",n),t=!0)}t||e.preventDefault()},i=function(e,t){return e=e||"team",t=t||"all",e+"_"+t},a=function(e,n,a){if(!e)return void delete t[i(a.user,a.types)];TS.view.files.throttledRebuildList()},s=function(){TS.utility.throttle.method(r,"view_tz_labels",1e3)},r=function(){var e,t=$(".timezone_label"),n=[];t.each(function(t,i){if(i=$(i),!(e=TS.members.getMemberById(i.data("member-id"))))return void n.push("");n.push(TS.utility.date.memberLocalTime(e,!0)),e=null,i=null}),t.each(function(e,t){t=$(t),t.find(".timezone_value").text(n[e]),t=null}),t=null},o=function(){var e,t,n,i,a=function(t){TS.view.rebuildMentions(),t&&(clearTimeout(n),n=setTimeout(function(){e||r()},500))},s=function(){$(".flex_header").append('<div id="rxn_toast_div" class="hidden ts_tip ts_tip_bottom"></div>'),i=$("#rxn_toast_div"),i.on("click",function(){TS.model.ui_state.flex_visible&&"mentions"===TS.model.ui_state.flex_name||TS.client.ui.flex.openFlexTab("mentions"),d()}),i.on("mouseenter",function(){$("html").unbind("mousemove.rxn_toast"),l()}),i.on("mouseleave",function(){o()})},r=function(){var t=TS.rxns.getNextRxnRecordThatNeedsAlert();if(t){if(!t.emoji)return TS.error("rxn_record.emoji missing");if(!Object.keys(t.emoji).length)return TS.error("rxn_record.emoji is empty");e=t;var n=TS.rxns.need_alerts[t.rxn_key];n||TS.error("WTF no since");var a,s,r=0;Object.keys(t.emoji).forEach(function(e){t.emoji[e].forEach(function(i){i.was_toasted||i.when<n||(i.rxn_source=t.source,r+=1,(!a||i.when<a.when)&&(a=i,s=e))})}),s||(TS.error("WTF no emoji_name"),TS.dir(0,t,"rxn_record")),a?a.was_toasted=!0:TS.error("oldest_who_when is undefined."),1==r&&delete TS.rxns.need_alerts[t.rxn_key];var l,d=TS.shared.getModelObById(a.rxn_source);d.is_im?l=TS.i18n.t("Direct Message","flex_pane")():d.is_group&&d.is_mpim?l=TS.mpims.getDisplayName(d,!1):d.is_group||d.is_private?l=d.name:d.is_channel&&(l="#"+d.name);var c=TS.members.getPrefCompliantMemberNameById(a.id,!0),_='<span class="ts_tip_tip"><span>&nbsp;&nbsp;'+c+"&nbsp;&nbsp;</span><br><span>"+l+"</span></span>",u=TS.emoji.graphicReplace(":"+s+":");t.url&&(u='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+t.url+');"></span>'),u+=_;var m=i.css("top"),h=-(50+i.height()),p=i.find(".ts_tip_tip").outerWidth()>150?"ts_tip_rightish":"";i.html(u).removeClass("hidden"),i.addClass(p).css({opacity:0,top:h}).transition({opacity:1,top:m},300),o(),$("#client-ui").addClass("rxn_toasting"),$("html").bind("mousemove.rxn_toast",o)}},o=function(){clearTimeout(t),t=setTimeout(d,3e3)},l=function(){clearTimeout(t),i.css("opacity",1)},d=function(){l(),i.transition({opacity:0},400),$("html").unbind("mousemove.rxn_toast"),t=setTimeout(function(){i.addClass("hidden"),$("#client-ui").removeClass("rxn_toasting"),c()},401)},c=function(){e=null,r()};return{init:function(){s(),TS.rxns.rxn_records_changed_sig.add(TS.utility.throttleFunc(a,100,!0))}}}()}()},2403:function(e,t){!function(){"use strict";TS.registerModule("client.history_prefetch",{onStart:function(){TS.boot_data.feature_disable_history_prefetch&&(n=10)},addToHistoryFetchQueue:function(e){if(e)return t||(t=[]),-1===t.indexOf(e)&&(t.push(e),!0)},processHistoryFetchQueue:function(){if(t._being_processed||!t.length)return!1;if(a(),s(),r(),o(),TS.has_pri[d]){var e=[];_.each(t,function(t){e.push(t)}),TS.log(d,"pre-loading history for "+t.length+(1===t.length?" item: ":" items: ")+e.join(", "))}return t.being_processed=!0,t.length>1?TS.api.callFuncWhenApiQisEmpty(function(){l(),l()}):TS.api.callFuncWhenApiQisEmpty(l),!0},resetHistoryFetchQueue:function(){t=[],i=[]}});var e,t=[],n=20,i=[],a=function(){if(!i.length){if(TS.frecency&&!e){var t=TS.frecency.getExisting("jumper");e=t&&t.getMostCommon()}if(!e)return void TS.warn('WTF no TS.frecency module? or no "jumper" frecency?');i=e.filter(function(e){return e.score>=40}).map(function(e){return e.id})}},s=function(){if(i.length)for(var e,n=i.length-1;n>=0;n-=1)-1!==(e=t.indexOf(i[n]))&&t.unshift(t.splice(e,1)[0])},r=function(){var e=_.filter(t,function(e){var t=TS.shared.getModelObById(e);return t&&(t.is_im||t.is_mpim)});e.reverse(),_.each(e,function(e){var n=t.indexOf(e);t.unshift(t.splice(n,1)[0])})},o=function(){for(var e=0,i=0,a=t.length;i<a;i+=1){var s=TS.shared.getModelObById(t[i]);if(s&&!s.is_im&&!s.is_mpim){e=i,TS.has_pri[d]&&TS.log(d,"queued "+e+" required IM/MPIM item(s) for pre-fetch: "+t.slice(0,i).join(", "));break}}var r=t.length;t.length=Math.min(t.length,n+e),r!==t.length&&TS.has_pri[d]&&TS.log(d,"truncated history fetch queue from "+r+" to "+t.length+(e?", including "+e+" required IM/MPIM item(s)":""))},l=function e(){if(!t||!t.length)return TS.has_pri[d]&&TS.log(d,"_processHistoryFetchQueue: done."),void(t.being_processed=!1);var n=t.shift(),i=TS.shared.getModelObById(n);if(!i)return void TS.warn('_processHistoryFetchQueue: could not find model_ob for id "'+n+'"');var a=TS.shared.getControllerForModelOb(i);if(!a)return TS.warn("_processHistoryFetchQueue: could not find controller for model_ob"),e();TS.shared.maybeFetchHistory(i),i.history_is_being_fetched?a.history_fetched_sig.addOnce(function(t){TS.has_pri[d]&&TS.log(d,'fetched history for "'+t.id+'"'),TS.api.callFuncWhenApiQisEmpty(function(){window.setTimeout(e,250+250*Math.random())})}):(TS.has_pri[d]&&TS.log(d,'_processHistoryFetchQueue: no history fetch started for "'+i.id+'" - assuming up to date.'),e())},d=58}()},2404:function(e,t){!function(){"use strict";TS.registerModule("client.msg_input",{$input:$(),tabcomplete_completions:{},onStart:function(){e=$("#snippet_prompt"),t=e.find(".warning"),n=e.find("#snippet_prompt_character_count"),i=$("#notification_bar"),a=$("#chat_input_tab_ui"),TS.channels.renamed_sig.add(TS.client.msg_input.setPlaceholder),TS.groups.renamed_sig.add(TS.client.msg_input.setPlaceholder),TS.members.changed_current_status_sig.add(TS.client.msg_input.setPlaceholder),TS.members.changed_name_sig.add(TS.client.msg_input.setPlaceholder),TS.members.changed_real_name_sig.add(TS.client.msg_input.setPlaceholder),TS.prefs.display_real_names_override_changed_sig.add(TS.client.msg_input.setPlaceholder),TS.prefs.team_display_real_names_changed_sig.add(TS.client.msg_input.setPlaceholder),TS.client.login_sig.add(TS.client.msg_input.onLogin)},onLogin:function(){var e=TS.client.ui.files.$file_btn.width();TS.client.msg_input.$input.data("tab_complete_ui_x_offset",e)},bind:function(e){if(TS.client.msg_input.$input=e,TS.utility.contenteditable.supportsTexty()){var t=_.throttle(function(t){var n=TS.utility.contenteditable.value(e);v(n),b(n),w(n),TS.model.prefs.msg_preview&&C(n),"silent"!==t&&(n.trim()?TS.client.msg_input.storeLastMsgForActiveModelOb(n):TS.client.msg_input.storeLastMsgForActiveModelOb(""))},100),n={modules:{clipboard:{onPaste:function(t){var n=!1;return TS.ui.paste.supportsUploadOnPaste()&&(TS.model.is_FF&&bowser.version<50||!t.clipboardData?n=!0:(n=TS.ui.paste.detectImageFromEvent(t))&&TS.utility.contenteditable.blur(e)),n||(t.stopPropagation(),TS.utility.contenteditable.paste(e,t))}},msginput:{onLeftWhenEmpty:function(){TS.utility.contenteditable.blur(e),$("#primary_file_button").click()},onUpArrowCmd:function(){k(c.up,!0)},onUpArrow:function(){k(c.up,!1)},onDownArrow:function(){k(c.down,!1)}},tabcomplete:{appendMenu:function(e){document.querySelector("#messages_container").appendChild(e)},positionMenu:function(e){e.style.bottom=0,e.style.left="62px",e.style.right="20px",e.style.top="auto",TS.utility.rAF(function(){e.offsetTop<0&&(e.style.top=0),e=null})}}},placeholder:e.data("placeholder"),onEnter:function(t){return TS.model.is_mac&&t.shiftKey&&t.metaKey||(TS.model.is_win||TS.model.is_lin)&&t.shiftKey&&t.ctrlKey?(TS.client.msg_input.startSnippet(),!1):(TS.client.ui.cal_key_checker.prevent_enter||D(e),!1)},onTextChange:function(e){g(),P(),t(e)}};TS.boot_data.feature_keyboard_navigation&&(n.attributes={tabindex:1}),TS.utility.contenteditable.create(e,n),TS.boot_data.feature_texty_mentions&&$("#msg_form .msg_mentions_button").removeClass("hidden").on("click",h)}TS.utility.contenteditable.enable(e),TS.utility.contenteditable.supportsTexty()||e.TS_tabComplete({complete_cmds:!0,complete_channels:!0,complete_user_groups:!0,complete_emoji:!0,complete_member_specials:!0,no_tab_out:!0,onMemberComplete:function(e){if(-1===["@everyone","@channel","@here"].indexOf(e)){var t=TS.shared.getActiveModelOb();TS.client.msg_input.tabcomplete_completions[t.id]||(TS.client.msg_input.tabcomplete_completions[t.id]=[]),-1===TS.client.msg_input.tabcomplete_completions[t.id].indexOf(e)&&TS.client.msg_input.tabcomplete_completions[t.id].push(e)}},onComplete:function(t,n){TS.utility.populateInput(e,t,n),TS.client.msg_input.storeLastMsgForActiveModelOb(TS.utility.contenteditable.value(e))},ui_initer:TS.ui.msg_tab_complete.start,suspended:!0,sort_by_membership:!0,include_self:!!TS.boot_data.feature_name_tagging_client}),TS.utility.contenteditable.supportsTexty()||T(),TS.utility.contenteditable.supportsTexty()||e.on("textchange",m),e.on("keydown.msg_input",function(t){if(!TS.utility.contenteditable.supportsTexty()){var n=Date.now(),i=TS.utility.contenteditable.value(e),s=$.trim(i);if(w(i),TS.client.ui.keyPressIsValidForGotoNextOpenChannelOrIM(t))return t.preventDefault(),void(TS.model.profiling_keys&&TS.model.addProfilingKeyTime("input keydown",Date.now()-n));if(t.which==c.enter&&t.metaKey&&t.shiftKey)TS.client.msg_input.startSnippet();else{if(!(t.which!=c.enter||t.shiftKey||t.altKey||t.ctrlKey)){if(t.which==c.enter&&t.metaKey)TS.client.msg_input.startSnippet();else if(""!==s&&!TS.client.ui.cal_key_checker.prevent_enter){if(a.length&&!a.hasClass("hidden")&&TS.model.prefs.tab_ui_return_selects)return void t.preventDefault();if(TS.model.prefs.enter_is_special_in_tbt&&TS.utility.isCursorWithinTBTs(e))return;D(e,t)}return t.preventDefault(),void(TS.model.profiling_keys&&TS.model.addProfilingKeyTime("input keydown",Date.now()-n))}if(t.which==c.enter&&!TS.model.is_mac&&t.shiftKey&&!t.altKey&&t.ctrlKey)TS.client.msg_input.startSnippet();else{if(t.which==c.shift);else if(t.which==c.enter&&(t.ctrlKey||t.altKey)){if(!TS.model.is_mac||TS.model.is_FF||TS.model.is_electron||TS.model.is_chrome_desktop){var r=e.getCursorPosition();TS.utility.contenteditable.value(e,i.substr(0,r)+"\n"+i.substr(r)),e.trigger("autosize").trigger("autosize-resize"),e.setCursorPosition(r+1)}}else TS.model.prefs&&TS.model.prefs.enter_is_special_in_tbt&&t.which==c.enter&&t.shiftKey&&TS.utility.isCursorWithinTBTs(e)&&D(e,t);a.length&&!a.hasClass("hidden")?TS.model.is_our_app&&TS.model.is_electron&&(t.which!=c.up&&t.which!=c.left&&t.which!=c.down&&t.which!=c.right||t.preventDefault()):TS.client.ui.shouldEventTriggerMaybeEditLast(t,e)?TS.client.ui.maybeEditLast(t):""!=i||t.altKey||TS.utility.cmdKey(t)||t.which!=c.left?y(t,i)&&TS.chat_history.onArrowKey(t,TS.client.msg_input.$input):(t.preventDefault(),TS.menu.file.startWithNewFileOptions(t,$("#primary_file_button")),e.blur())}}TS.model.profiling_keys&&TS.model.addProfilingKeyTime("input keydown",Date.now()-n)}})},setOffline:function(){TS.client.msg_input.$input.addClass("offline"),F()},setOnline:function(){TS.client.msg_input.$input.removeClass("offline"),P()},resized:function(e,t){var n=Date.now();if(TS.client.ui.$emo_menu||(TS.client.ui.$emo_menu=$(".emo_menu")),TS.boot_data.feature_initial_scroll_position?TS.client.ui.areMsgsScrolledToBottom(50)&&TS.client.ui.instaScrollMsgsToBottom():TS.view.resizeManually("TS.client.msg_input.resized original:"+e+" height:"+t),TS.model.is_FF&&!TS.utility.contenteditable.supportsTexty()){var i=$("#footer").outerHeight();i>=115?(TS.client.ui.$msg_input.removeClass("with-emoji-menu"),TS.client.ui.$emo_menu.addClass("hidden")):i<96&&(TS.client.ui.$msg_input.addClass("with-emoji-menu"),TS.client.ui.$emo_menu.removeClass("hidden"))}TS.model.profiling_keys&&TS.model.addProfilingKeyTime("inputResized "+e+" "+t,Date.now()-n)},storeLastMsgForActiveModelOb:function(e){var t=TS.shared.getActiveModelOb();TS.model.input_history_index>-1&&TS.model.input_history[TS.model.input_history_index]!=e&&TS.chat_history.resetPosition("storeLastMsgInputForActive "+e),t&&t.last_msg_input!=e&&(t.last_msg_input=e,t.has_draft=!!e,TS.storage.storeLastMsgInput(t.id,t.last_msg_input))},populate:function(e){TS.utility.populateInput(TS.client.ui.$msg_input,e),TS.utility.contenteditable.supportsTexty()||(TS.client.msg_input.storeLastMsgForActiveModelOb(e),TS.client.msg_input.$input.trigger("autosize").trigger("autosize-resize"))},populateWithLast:function(){var e=TS.shared.getActiveModelOb();if(e){if(TS.model.ms_logged_in_once||TS.format.hasOnlyValidMemberIds(e.last_msg_input))if(TS.chat_history.resetPosition("populateChatInputWithLast"),u[e.id]=e.last_msg_input,TS.utility.contenteditable.supportsTexty()){var t=TS.client.msg_input.$input;TS.utility.contenteditable.deserialize(t,e.last_msg_input),TS.view.prefs.toggleSpellcheck(),TS.utility.contenteditable.focus(t),TS.utility.contenteditable.setCursorAtEnd(t),g()}else TS.client.ui.$msg_input.TS_tabComplete("suspend"),TS.client.msg_input.populate(e.last_msg_input),TS.client.ui.$msg_input.TS_tabComplete("unsuspend"),TS.client.ui.$msg_input.TS_tabComplete("changeoption","member_prefix_required",e.is_slackbot_im)}},startSnippet:function(){var e=d;TS.ui.snippet_dialog.startCreate(TS.utility.contenteditable.value(TS.client.ui.$msg_input),e),TS.view.clearMessageInput(),d=!1},createSnippetFromPrompt:function(){s&&(d=!0,TS.client.msg_input.startSnippet())},setPlaceholder:function(){TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,B()),TS.utility.contenteditable.supportsTexty()||TS.client.msg_input.$input.trigger("autosize").trigger("autosize-resize")},test:function(){return{_maybeHandleReactionCmdInMsgInput:M,_maybeShareFilesInMessage:x,_shareFiles:I,_shouldOnArrowKey:y}}});var e,t,n,i,a,s,r,o,l,d=!1,c=TS.utility.keymap,u={},m=function(){var e=Date.now(),t=TS.utility.contenteditable.value(TS.client.msg_input.$input),n=TS.format.cleanMsg(t);TS.client.msg_input.storeLastMsgForActiveModelOb(t),TS.model.profiling_keys&&TS.model.addProfilingKeyTime("input textchange",Date.now()-e),v(n),b(n),f+=1,""===n&&(S=0,f=0),P(),TS.utility.contenteditable.supportsTexty()&&g(),TS.model.prefs.msg_preview&&C(t)},h=function(){var e=TS.utility.contenteditable.getFormats(TS.client.msg_input.$input),t=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);if(t.start>0&&e.slackmention&&t.start<TS.utility.contenteditable.getLength(TS.client.msg_input.$input)&&TS.utility.contenteditable.getFormats(TS.client.msg_input.$input,t.start+1).slackmention)return void TS.utility.contenteditable.focus(TS.client.msg_input.$input);var n=" @",i=t.start>0?TS.utility.contenteditable.getTextForRange(TS.client.msg_input.$input,t.start-1,1):"";if("@"===i)return void TS.utility.contenteditable.focus(TS.client.msg_input.$input);(0===t.start||i.match(/\s/))&&(n="@"),TS.utility.contenteditable.focus(TS.client.msg_input.$input),TS.utility.contenteditable.insertTextAtCursor(TS.client.msg_input.$input,n,!1)},p=0,g=function(){var e=TS.client.msg_input.$input.height();e!==p&&(TS.utility.rAF(function(){TS.client.ui.files.$file_btn.height(e),TS.client.ui.files.$file_btn.height("")}),TS.client.msg_input.resized(p,e),p=e)},f=0,S=0,T=function(){var e;TS.channels&&TS.channels.switched_sig&&TS.channels.switched_sig.add(function(){S=0,f=0}),TS.client.msg_input.$input.autosize({boxOffset:18,placeholder:!1,callback:function(){S+=1,TS.client.msg_input.resized.apply(this,arguments);var t=TS.utility.contenteditable.displayValue(TS.client.msg_input.$input);if(""===t)S=0,f=0;else if(!e&&t&&t.length>20&&f>20&&S>5&&S/f>.66){var n=document.querySelectorAll("#msgs_div .message").length+" messages in current channel. Resize vs. change count: "+S+" / "+f+" ("+S/f+")";TS.logError(n,"Excessive message input resize events","Message Input Error"),e=!0}}})},v=function(a){var r,o=TS.utility.contenteditable.supportsTexty()?TS.format.cleanMsg(a):a;r=TS.features.isEnabled("message_input_byte_limit")?TS.utility.msgs.charsOverLimit(o):o.length-TS.model.input_maxlength;var l=r>0;n.text(TS.i18n.t("Your message is {diff_count, plural, =1{# character}other{# characters}} too long.","msg_input")({diff_count:r})),l&&!s?(t.removeClass("hidden"),e.removeClass("hidden"),i.addClass("showing_snippet_prompt"),s=!0):!l&&s&&(e.addClass("hidden"),i.removeClass("showing_snippet_prompt"),s=!1,d=!1)},b=function(e){r||(r=$("#special_formatting_text"));var t=e.length>2;t&&!o?(r.addClass("showing"),o=!0):!t&&o&&(r.removeClass("showing"),o=!1)},w=function(e){var t=TS.shared.getActiveModelOb();e&&0!==e.indexOf("/")&&e.trim().length?TS.typing.userStarted(t):TS.typing.userEnded(t)},y=function(e,t){if(e.shiftKey||e.altKey||e.metaKey||e.ctrlKey)return!1;var n=TS.utility.contenteditable.cursorPosition(TS.client.msg_input.$input);if(0===n.length){if(e.which==c.up&&n.start<1)return!0;if(e.which==c.down&&n.end>=t.length)return!0}return!1},k=function(e,t){if(TS.client.ui.isUserAttentionOnChat()){var n=jQuery.Event("keydown",{altKey:!1,shiftKey:!1,which:e});t&&(TS.model.is_mac?n.metaKey=!0:n.ctrlKey=!0);var i=TS.client.msg_input.$input,a=TS.utility.contenteditable.displayValue(i);TS.client.ui.shouldEventTriggerMaybeEditLast(n,i)?TS.client.ui.maybeEditLast(n):y(n,a)&&TS.chat_history.onArrowKey(n,i)}},A="",C=function(e){var t;t="/me "===e.substr(0,4)&&e.length>4?"<i>"+TS.format.formatDefault(TS.format.cleanMsg(e.substr(3)))+"</i>":"/shrug "===e.substr(0,7)?TS.format.formatDefault(TS.format.cleanMsg(e.substr(6)))+" \\_()_/":"/"===e.substr(0,1)?"":TS.format.formatDefault(TS.format.cleanMsg(e)),t=t||(TS.model.prefs.msg_preview_persistent?"&nbsp;":"");var n=t!=A;if(A=t,n&&TS.client.ui.$msg_preview_msg.html(t),t&&!TS.model.msg_preview_showing)TS.model.msg_preview_showing=!0,TS.client.ui.$msg_preview.removeClass("hidden"),TS.client.msg_input.$input.data("$tab_complete_ui_y_positioner",TS.client.ui.$msg_preview);else if(!t&&TS.model.msg_preview_showing)TS.model.msg_preview_showing=!1,TS.client.ui.$msg_preview.addClass("hidden"),TS.client.msg_input.$input.data("$tab_complete_ui_y_positioner",null);else if(!n)return;var i=TS.view.last_preview_height;TS.view.measureMsgPreview(),i!=TS.view.last_preview_height&&(TS.boot_data.feature_initial_scroll_position?TS.client.ui.areMsgsScrolledToBottom(50)&&TS.client.ui.instaScrollMsgsToBottom():TS.view.resizeManually()),TS.ui.msg_tab_complete.isShowing()&&TS.ui.msg_tab_complete.positionUI()},M=function(e){var t,n=TS.shared.getActiveModelOb(),i=TS.utility.msgs.getDisplayedMsgs(n.msgs);return i.length&&(t=_(i).take(5).find(function(e){return!e.is_ephemeral&&!e.no_display})),TS.client.ui.maybeHandleReactionCmd(t,e,function(){TS.chat_history.add($.trim(e)),TS.view.clearMessageInput()})},x=function(e,t,n){var i=TS.utility.findUrls(e),a=i.map(TS.utility.getFileIDFromURL),s=_.compact(a.map(TS.files.getFileById)),r=[],o=[];if(s.forEach(function(e){TS.files.isFilePrivate(e)&&e.bot_id?r.push(e):t&&t.is_im&&e.user===t.user?r.push(e):TS.files.isFilePrivate(e)&&e.user===TS.model.user.id?r.push(e):TS.files.isFilePrivate(e)&&e.user!==TS.model.user.id&&o.push(e)}),!r.length&&!o.length)return void n(!1);r.length&&o.length?E(o,e,t,function(){I(r,e,t,n)}):r.length?I(r,e,t,n):o.length&&E(o,e,t,n)},I=function e(t,n,i,a){var s=t[0],r=t.slice(1);TS.files.shareFile(s.id,i.id,"",!0,function(){r.length>0?e(r,n,i,a):a(!0)})},E=function(e,t,n,i){TS.files.reShareConfirmation(e,function(){I(e,t,n,i)})},B=function(){var e=TS.shared.getActiveModelOb();if(!(e&&TS.permissions.members.canPostInModelOb(TS.model.user,e)&&(e.is_im||e.is_mpim||e.is_channel||e.is_group)))return"";var t,n;if(e.is_self_im)t=TS.i18n.t("Message yourself","msg_input")(),TS.boot_data.feature_texty&&(n=TS.members.getMemberCurrentStatusForDisplay(e.user,{stop_animations:!0}))&&(t+=" "+n);else{var i;e.is_im?(i=TS.members.getPrefCompliantMemberNameById(e.user,!1,!0),TS.boot_data.feature_texty&&(i=_.escape(i)),TS.boot_data.feature_texty&&(n=TS.members.getMemberCurrentStatusForDisplay(e.user,{stop_animations:!0}))&&(i+=" "+n)):e.is_mpim?i=TS.mpims.getDisplayName(e,!1,!1,3):e.is_group?i=e.name:e.is_channel&&(i="#"+e.name),!e.is_im&&TS.boot_data.feature_texty&&(i=_.escape(i)),t=TS.i18n.t("Message {msg}","msg_input")({msg:i})}return t},D=function(t,n){TS.client.stats&&TS.client.stats.isEnabled()&&TS.metrics.mark("msg_input_try_to_submit");var i=TS.format.cleanMsg(TS.utility.contenteditable.value(t));if(TS.features.isEnabled("message_input_byte_limit")?TS.utility.msgs.charsOverLimit(i)>0:i.length>TS.model.input_maxlength)return e.highlight(600,"",null,0),void(n&&n.preventDefault());var a=function(){var e=TS.utility.contenteditable.value(t);if(TS.view.submit()){TS.chat_history.resetPosition("enter key");var n=TS.utility.members.getUsernamesMentionedInString(e),i=TS.shared.getActiveModelOb(),a=TS.client.msg_input.tabcomplete_completions&&TS.client.msg_input.tabcomplete_completions[i.id]?TS.client.msg_input.tabcomplete_completions[i.id]:[];if(!n.length)return;u[i.id]&&(n=_.difference(n,TS.utility.members.getUsernamesMentionedInString(u[i.id])));var s=n.filter(function(e){return-1===a.indexOf(e)&&(TS.members.getMemberByName(e)||TS.user_groups.getUserGroupsByHandle(e))});TS.clog.track("MSG_SUBMITTED_MENTIONS",{num_mentions:s.length}),TS.client.msg_input.tabcomplete_completions[i.id]&&delete TS.client.msg_input.tabcomplete_completions[i.id],u[i.id]&&delete u[i.id]}else TS.model.is_msg_rate_limited||TS.client.ui.addOrFlashEphemeralBotMsg({channel:TS.model.active_cid,icons:{emoji:":electric_plug:"},username:"connectbot",text:TS.i18n.t("Hmm, your computer seems to be *offline*, so sending messages wont work at the moment.","msg_input")(),ephemeral_type:"disconnected_feedback"})};M(i)||x(i,TS.shared.getActiveModelOb(),function(){a()})},F=function(){if(!l){var e=TS.client.ui.$messages_input_container||TS.client.msg_input.$input;e.addClass("pretend-to-be-online"),l=setTimeout(function(){e.removeClass("pretend-to-be-online")},1e4)}},P=function(){if(l){(TS.client.ui.$messages_input_container||TS.client.msg_input.$input).removeClass("pretend-to-be-online"),clearTimeout(l),l=void 0}}}()},2405:function(e,t){!function(){"use strict";function e(){return m.find(".messages_banner:not(.messages_banner_bottom)").filter(":visible").filter(function(){var e=$(this);return!("hidden"===e.css("visibility")||e.hasClass("no_opacity"))})}TS.registerModule("client.msg_pane",{last_render_time:null,last_rendered_msg:null,last_in_stream_msg:null,dont_check_unreads_til_switch:!1,date_change_timer:null,new_msgs_bar_showing:!1,did_rebuild_msgs_sig:new signals.Signal,onStart:function(){o=new TS.PresenceList,TS.team.team_email_domain_changed_sig.add(x,TS.client.msg_pane),TS.team.team_domain_changed_sig.add(x,TS.client.msg_pane),TS.team.team_name_changed_sig.add(x,TS.client.msg_pane),TS.prefs.team_auth_mode_changed_sig.add(x,TS.client.msg_pane),TS.prefs.team_allow_calls_changed_sig.add(D,TS.client.msg_pane),TS.prefs.team_calling_app_name_changed_sig.add(D,TS.client.msg_pane),TS.utility.calls.started_platform_call_sig.add(B,TS.client.msg_pane),TS.members.changed_admin_perms_sig.add(x,TS.client.msg_pane),TS.prefs.dtop_notif_changed_sig.add(R),TS.prefs.team_perms_pref_changed_sig.add(R),TS.prefs.muted_channels_changed_sig.add(R),TS.ui.growls.permission_changed_sig.add(R),TS.channels.converted_to_shared_sig.add(b),TS.groups.converted_to_shared_sig.add(b),TS.channels.shared_teams_updated_sig.add(w),TS.groups.shared_teams_updated_sig.add(w),TS.client&&TS.client.highlights&&(TS.client.highlights.updated_sig.add(TS.client.msg_pane.maybeRenderHighlightedMessages),TS.client.highlights.feedback_submitted_sig.add(TS.client.msg_pane.maybeRenderHighlightedMessageFeedback)),TS.client.msg_pane.initDateChange(),bowser&&bowser.msie&&bowser.version<11&&f&&(f+=" hidden")},initDateChange:function(){TS.client.msg_pane.date_change_timer||(TS.client.msg_pane.date_change_timer=window.setInterval(function(){TS.utility.throttle.method(TS.client.msg_pane.checkForDateChange,"date_change_check",1e3)},9e5))},checkForDateChange:function(){TS.model&&TS.model.active_cid&&TS.client.msg_pane.last_render_time&&TS.client.msg_pane.last_render_time.getDay()!==(new Date).getDay()&&TS.client.msg_pane.rebuildMsgsWithReason("TS.client.msg_pane.checkForDateChange")},rebuildChannelMembersList:function(){if(TS.members.is_in_bulk_upsert_mode)return void(u||(u=!0,TS.members.batch_upserted_sig.addOnce(function(){u=!1,TS.client.msg_pane.rebuildChannelMembersList()})));TS.client.ui.rebuildMemberListToggle()},rebuildMsgsWithReason:function(e,t){if(!TS.useReactMessages())if(t){if(TS.utility.enableFeatureForUser(10)&&TS.statsd.count("client_msgs_rebuild_throttled"),!_.isEmpty(T)&&e&&(T+=", "),T+=e,v+=1,S)return;y(T),S=!0,setTimeout(function(){v>1&&(y(T),TS.metrics.count("rebuild_msgs_with_reason_throttles",v)),S=!1,T="",v=0},1e3)}else y(e)},setInitialScrollPosition:function(e){if(!TS.useReactMessages()&&TS.model.prefs){var t=TS.shared.getActiveModelOb();TS.model.prefs.start_scroll_at_oldest?t.unread_cnt?(TS.client.ui.instaScrollMsgsToBottom(!1),TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()):e>0?TS.client.ui.$msgs_scroller_div.length&&(TS.client.ui.$msgs_scroller_div[0].scrollTop=e):TS.client.ui.instaScrollMsgsToBottom(!1):TS.client.ui.instaScrollMsgsToBottom(!1),t._has_auto_scrolled=!0}},displayTitle:function(){TS.client.channel_header.start()},clearUnreadDivider:function(){TS.client.ui.$msgs_unread_divider&&(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.clearUnreadDivider: removing TS.client.ui.$msgs_unread_divider"),TS.client.ui.$msgs_unread_divider.remove(),TS.client.ui.$msgs_unread_divider=null,$(".day_container.unread_day_container").removeClass("unread_day_container"))},hideMessageContainer:function(){m.addClass("hidden"),h.addClass("hidden")},showMessageContainer:function(){m.removeClass("hidden"),h.removeClass("hidden")},hideCenterWorkspace:function(){p.addClass("hidden")},showCenterWorkspace:function(){p.removeClass("hidden")},maybeHideNewMsgsBar:function(e){if(TS.client.msg_pane.maybeClearNewMsgsTimer(null,!0),TS.model.prefs.mark_msgs_read_immediately){if(e&&("esc"===e||"clicked"===e))return TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeHideNewMsgsBar: hiding immediately because reason = "+e),void TS.client.msg_pane.hideNewMsgsBar();var t=TS.shared.getActiveModelOb();!t||t._temp_unread_cnt||t.unread_cnt||(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeHideNewMsgsBar: no _temp_ or unread_cnt - setting a timer to hide new msgs bar for "+t.id),TS.client.msg_pane.maybeStartNewMsgsTimer(t))}else TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeHideNewMsgsBar: no mark_read_immediately pref - hiding now"),TS.client.msg_pane.hideNewMsgsBar()},clearUnreadDividerAndHideNewMsgsBar:function(e){TS.client.msg_pane.clearUnreadDivider(),TS.client.msg_pane.maybeHideNewMsgsBar(e)},maybeClearUnreadDivider:function(e,t){e&&t&&!e.unread_cnt&&t.user&&t.user==TS.model.user.id&&(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeClearUnreadDivider: clearing because you sent a message in "+e.id+" and unread_cnt = "+e.unread_cnt),TS.client.msg_pane.clearUnreadDivider(),TS.utility.msgs.maybeClearPrevLastRead())},assignLastReadMsgDiv:function(e){var t;if(e&&e.msgs.length){var n=e._prev_last_read||e.last_read;if((t=TS.utility.msgs.getMsg(n,e.msgs))&&!TS.utility.msgs.isMsgHidden(t)&&!TS.utility.msgs.isMsgRolledUp(t))return void(a=TS.client.msg_pane.getCanonicalDivForMsg(n));n>TS.utility.msgs.getOldestValidTs(e)?(t=TS.utility.msgs.getDisplayedMsgBeforeTS(n,e.msgs),t?a=TS.client.msg_pane.getCanonicalDivForMsg(t.ts):(a=null,TS.error("nulling out _$last_read_msg_div because we could not find a message to use #1"))):a=null}},insertUnreadDivider:function(){if(!TS.client.ui.$msgs_unread_divider){var e=TS.shared.getActiveModelOb();if(!e)return void TS.error("insertUnreadDivider no channel, no im, no group");if(TS.model.seen_onboarding_this_session&&e.id==TS.model.welcome_model_ob.id||!TS.client.msg_pane.last_in_stream_msg)return void A();var t,n=!1;TS.model.ui.is_window_focused||TS.client.msg_pane.clearUnreadDivider(),t=TS.model.ui.is_window_focused?e._prev_last_read||e.last_read:e.last_read;var i=TS.client.msg_pane.is_rebuilding;if(e.unread_cnt&&TS.client.msg_pane.last_in_stream_msg&&!TS.client.msg_pane.dont_check_unreads_til_switch)if(i||!TS.model.ui.is_window_focused)TS.has_pri[j]&&TS.log(j,"TS.view.addMsg() on "+e.id+": inserting red line because is_rebuild, or window not focused.");else if(TS.model.ui.is_window_focused){var s=TS.client.ui.isMsgInView(TS.client.msg_pane.last_in_stream_msg.ts);s?(e.is_im&&(TS.has_pri[j]&&TS.log(j,"TS.view.addMsg() on "+e.id+": clearing red line because new msg is in view."),TS.client.msg_pane.clearUnreadDivider()),TS.utility.msgs.maybeClearPrevLastRead(),n=!0):TS.has_pri[j]&&TS.log(j,"TS.view.addMsg() on "+e.id+": inserting red line because new msg is out of view.")}if(TS.notifs.isCorGMuted(e.id))return void(TS.has_pri[j]&&TS.log(j,"insertUnreadDivider(): "+e.id+" is muted - exiting"));if("0000000000.000000"===t&&(TS.has_pri[j]&&TS.log(j,"insertUnreadDivider(): "+e.id+" last_read is zero ("+t+") - not inserting."),n=!0),a){var r=TS.client.msg_pane.getCanonicalDivForMsg(e.last_read);if(r){var o=r.nextAll();if(o.length>0){_.every(o,function(e){return $(e).hasClass("hidden")})&&(n=!0)}}}if((!n||TS.boot_data.feature_scrollback_half_measures)&&(e.unread_cnt&&t<TS.client.msg_pane.last_in_stream_msg.ts||t<TS.client.msg_pane.last_in_stream_msg.ts)){var l=TS.templates.messages_unread_divider(),d=!1;if(TS.boot_data.feature_scrollback_half_measures&&n&&(d=!0),a&&a.length)a.after(l);else{if(t>TS.utility.msgs.getOldestValidTs(e)){var c,u=TS.utility.msgs.getDisplayedMsgAfterTS(t,e.msgs);u&&(c=TS.client.msg_pane.getCanonicalDivForMsg(u.ts)),c&&c.length?c.before(l):TS.client.ui.$msgs_div.find(".message").last().before(l)}else TS.client.ui.$msgs_div.find(".message").first().before(l),TS.boot_data.feature_scrollback_half_measures&&(d=!0)}TS.client.ui.$msgs_unread_divider=$("#msgs_unread_divider"),TS.client.ui.$msgs_unread_divider.data("last_read_ts",t),d&&TS.client.ui.$msgs_unread_divider.addClass("invisible"),e.unread_cnt?$(".unread_divider").removeClass("no_unreads"):$(".unread_divider").addClass("no_unreads"),!TS.client.ui.$msgs_unread_divider.next(".day_divider").length&&!TS.client.ui.$msgs_unread_divider.is(":last-child")||d||(TS.client.ui.$msgs_unread_divider.addClass("adjacent_to_date"),TS.client.ui.$msgs_unread_divider.closest(".day_container").next(".day_container").addClass("unread_day_container"))}var m=e._temp_unread_cnt||e.unread_cnt;if((e._temp_last_read||e.last_read)<TS.client.msg_pane.last_in_stream_msg.ts&&m){A();var h=$("#messages_unread_status");TS.client.ui.isUnreadDividerInView()?(h.addClass("quiet no_jump"),h.off("click mouseenter mouseleave"),h.click(function(e){e.preventDefault(),TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.clicked)})):(h.removeClass("quiet no_jump"),h.off("click mouseenter mouseleave"),h.click(function(e){e.preventDefault(),TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()})),TS.client.msg_pane.showNewMsgsBar(),TS.client.msg_pane.startNewMsgsTimer(),h=null}A()}},updateEndMarker:function(){var e=TS.shared.getActiveModelOb();if(!e)return void TS.error("updateEndMarker no channel, no im, no group");o.clear();var n,i,a=$("#end_display_meta"),s=$("#end_display_padder"),r=$("#end_display_div"),c=$("#end_display_msg_lim"),u=$("#end_display_msg_lim_bottom_margin"),m=$("#end_div"),h=$("#end_display_status"),p=$("#channel_meta"),g=$("#group_meta"),f=TS.boot_data.team_limit_ts>0,S="",T=!1;if(e.history_fetch_failed?S=TS.i18n.t('Retrieving history failed. <a onclick="TS.client.ui.doLoadScrollBackHistory(true)">Try again?</a>',"client")():e.history_is_being_fetched?S=TS.i18n.t("Retrieving history...","client")():(n=TS.utility.msgs.getOlderMsgsStatus(e),1!=TS.qs_args.test_is_limited||n.more||(n.is_limited=!0),n.more?TS.model.seen_onboarding_this_session&&e.id==TS.model.welcome_model_ob.id||(S='<a onclick="TS.client.ui.doLoadScrollBackHistory(true)">'+TS.i18n.t("And more...","client")()+"</a>"):TS.newxp.shouldShowFirstWelcome()||(T=!0)),e.is_slackbot_im?i=35:e.is_mpim||e.is_im?i=33:(e.is_channel||e.is_group)&&(i=34),f&&n&&n.is_limited&&T&&!e.is_slackbot_im&&!l){d=!0;var v,b=$("#msg_lim_header_btn"),w=$("#msg_lim_header_btn_treatment");if(t=TS.experiment.getGroup("msg_lim_notifs_headers_copy"),$("#slackbot_meta").addClass("hidden"),a.addClass("hidden"),s.addClass("hidden"),p.addClass("hidden"),g.addClass("hidden"),$("#im_meta").addClass("hidden"),$(".not_limited_copy").addClass("hidden"),$(".msg_lim_header_copy").addClass("hidden"),$(".msg_lim_cta_btn").addClass("hidden"),e.is_im||e.is_mpim)"show_question_learn_more"===t||"show_question_see_pricing_plans"===t?$(".msg_lim_dm_h1_treatment").removeClass("hidden"):$(".msg_lim_dm_h1_control").removeClass("hidden"),$(".msg_lim_channel_h2").addClass("hidden"),$(".msg_lim_dm_h2").removeClass("hidden");else if(e.is_channel||e.is_group){var y=TS.templates.builders.makeChannelPrefix(e);$(".channel_name_msg_lim").html(y+e.name),"show_question_learn_more"===t||"show_question_see_pricing_plans"===t?$(".msg_lim_channel_h1_treatment").removeClass("hidden"):$(".msg_lim_channel_h1_control").removeClass("hidden"),$(".msg_lim_channel_h2").removeClass("hidden")}"show_question_see_pricing_plans"===t?(v=w.attr("href"),v=TS.utility.url.setQueryStringValue(v,"ui_element",i),v=decodeURIComponent(v).substr(1),w.attr("href",v),w.data("data-clog-ui-element",i),w.removeClass("hidden")):(v=b.attr("href"),v=TS.utility.url.setQueryStringValue(v,"ui_element",i),v=decodeURIComponent(v).substr(1),b.attr("href",v),b.data("data-clog-ui-element",i),b.removeClass("hidden")),u.css("min-height","30px"),u.removeClass("hidden"),r.addClass("msg_lim_styling"),r.removeClass("not_msg_lim_styling"),c.removeClass("hidden"),m.addClass("end_div_msg_lim"),m.css("margin-top","0"),TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:i}}})}else if(T)if(a.removeClass("hidden"),c.addClass("hidden"),m.removeClass("end_div_msg_lim"),u.addClass("hidden"),d&&(r.removeClass("msg_lim_styling"),r.addClass("not_msg_lim_styling")),m.css("margin-top","auto"),e.is_channel||e.is_group){var k,A=TS.interop.datetime.toCalendarDateOrNamedDay(e.created),C=TS.interop.datetime.toDateObject(e.created);k=TS.interop.datetime.isYesterday(C)||TS.interop.datetime.isToday(C)?$.trim(A.toLowerCase()):TS.i18n.t("on {date}","client")({date:A});var M,I,E,B,D,F,P,O=TS.members.getPotentiallyUnknownMemberById(e.creator);if(e.is_mpim)p.addClass("hidden"),g.addClass("hidden"),$("#im_meta").removeClass("hidden"),$("#slackbot_meta").addClass("hidden"),U(e);else if(e.is_group){if(p.addClass("hidden"),g.removeClass("hidden"),$("#im_meta").addClass("hidden"),$("#slackbot_meta").addClass("hidden"),M=!1,I=!0,$(".group_meta_name").html(TS.templates.builders.makeGroupLink(e,M,I)),$(".group_meta_name").find("a").addClass("ocean_teal").bind("click",function(e){e.preventDefault(),TS.menu.group.startWithGroup(e,$(e.target).data("group-id"))}),TS.boot_data.page_needs_enterprise){var R=g.find(".group_meta_shared_info");E=g.find(".end_action_integration").parent(),e.is_org_shared?(F={model_ob:e},e.is_global_shared?F.all_teams=!0:(D=3,F.and_more_number=e.shared_team_ids.length-D,F.more_teams=e.shared_team_ids.slice(D),F.teams_shared_with=_.map(e.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)})),B=TS.templates.shared_channels_channel_meta_info(F),R.html(B).removeClass("hidden"),E.addClass("hidden")):(R.empty().addClass("hidden"),E.removeClass("hidden"))}if(O&&O.is_self?$("#group_creator_name").html("You"):$("#group_creator_name").html(O?TS.templates.builders.makeMemberPreviewLink(O):"Unknown"),$("#group_meta_archived_parent").addClass("hidden"),e.parent_group){var L=TS.groups.getGroupById(e.parent_group);L&&($("#group_meta_archived_parent").removeClass("hidden"),$("#group_meta_archived_parent_link").attr("href","/archives/"+L.id).text(L.name))}$("#group_create_date").html(k),e.purpose.value?($("#group_meta_purpose_container").removeClass("hidden"),$("#group_meta_purpose").html(TS.utility.formatTopicOrPurpose(e.purpose.value)),$("#group_meta_purpose_prompt").addClass("hidden"),$(".end_action_purpose").closest("li").addClass("hidden")):($("#group_meta_purpose_container").addClass("hidden"),$(".end_action_purpose").closest("li").removeClass("hidden"))}else if(e.is_channel){if(p.removeClass("hidden"),g.addClass("hidden"),$("#im_meta").addClass("hidden"),$("#slackbot_meta").addClass("hidden"),M=!1,I=!0,$(".channel_meta_name").html(TS.templates.builders.makeChannelLink(e,M,I)),$(".channel_meta_name").find("a").bind("click",function(e){e.preventDefault(),TS.menu.channel.startWithChannel(e,$(e.target).data("channel-id"))}),TS.boot_data.page_needs_enterprise){var Q=p.find(".channel_meta_shared_info");E=p.find(".end_action_integration").parent(),e.is_org_shared?(F={model_ob:e},D=3,e.is_global_shared?F.all_teams=!0:(F.and_more_number=e.shared_team_ids.length-D,F.more_teams=e.shared_team_ids.slice(D),F.teams_shared_with=_.map(e.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)})),B=TS.templates.shared_channels_channel_meta_info(F),Q.html(B).removeClass("hidden"),E.addClass("hidden")):(Q.empty().addClass("hidden"),E.removeClass("hidden"))}O&&O.is_self?$("#channel_creator_name").html("You"):$("#channel_creator_name").html(O?TS.templates.builders.makeMemberPreviewLink(O):"Unknown"),$("#channel_create_date").html(k),e.purpose.value?($("#channel_meta_purpose_container").removeClass("hidden"),$("#channel_meta_purpose").html(TS.utility.formatTopicOrPurpose(e.purpose.value)),$("#channel_meta_purpose_prompt").addClass("hidden"),$(".end_action_purpose").closest("li").addClass("hidden")):($("#channel_meta_purpose_container").addClass("hidden"),$(".end_action_purpose").closest("li").removeClass("hidden"))}$(".end_action_purpose").off("click").on("click.show_purpose_dialog",function(){TS.ui.purpose_dialog.start(e.name,e)}),$(".end_action_integration").attr("href","/apps/new?channel="+e.id),$(".end_action_invite").off("click").on("click.show_invite_dialog",function(){TS.ui.channel_invite_modal.startInviteToChannelModal(e.id)}),x()}else if(e.is_slackbot_im){p.addClass("hidden"),g.addClass("hidden"),$("#im_meta").addClass("hidden"),$("#slackbot_meta").removeClass("hidden"),P=TS.members.getPotentiallyUnknownMemberById(e.user);var H=TS.model.team.prefs.compliance_export_start||0,N=H&&!!TS.model.team.prefs.compliance_export_start;$("#slackbot_meta").html(TS.templates.slackbot_badge({member:P,compliance_exports_enabled_for_team:N,compliance_export_start:H}))}else p.addClass("hidden"),g.addClass("hidden"),$("#im_meta").removeClass("hidden"),$("#slackbot_meta").addClass("hidden"),(P=TS.members.getPotentiallyUnknownMemberById(e.user))&&(o.add(P.id),$("#im_meta").html(TS.templates.dm_badge({member:P,model_ob:e,compliance_exports_enabled_for_team:!!TS.model.team.prefs.compliance_export_start,compliance_export_start:TS.model.team.prefs.compliance_export_start||0})));else a.addClass("hidden"),c.addClass("hidden"),m.removeClass("end_div_msg_lim"),u.addClass("hidden");if(f&&n&&n.is_limited&&e.is_slackbot_im&&l){d=!0;var G=!!window.navigator.userAgent.match("Trident");t=TS.experiment.getGroup("msg_lim_notifs_headers_copy"),G&&(u.css("min-height","55px"),u.removeClass("hidden")),"show_question_learn_more"===t?$("#slackbot_msg_lim_learn_more").removeClass("hidden"):"show_question_see_pricing_plans"===t?$("#slackbot_msg_lim_see_pricing_plans").removeClass("hidden"):$("#slackbot_msg_lim_control").removeClass("hidden"),$(".msg_lim_copy").removeClass("hidden"),$(".not_limited_copy").addClass("hidden"),TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"impression",ui_element:i}}})}else $(".msg_lim_copy").addClass("hidden"),m.removeClass("wave"),$(".not_limited_copy").removeClass("hidden");S?(h.removeClass("hidden"),h.html(S)):h.addClass("hidden")},clearBlueBarTimer:function(){var e=TS.shared.getActiveModelOb();e&&(l=!!e.is_slackbot_im),r&&(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.clearBlueBarTimer: clearing timer of "+r),clearTimeout(r),r=null)},maybeClearNewMsgsTimer:function(e,t){if(s){var n=TS.shared.getActiveModelOb();!t&&e&&e.id!==n.id||(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: clearing _onNewMsgsTimer of "+s),clearTimeout(s),s=null)}},maybeStartNewMsgsTimer:function(e){if(s)return void(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: NOT clearing msgs timer because one already exists of "+s));var t=TS.shared.getActiveModelOb();if(e&&e.id!==t.id)return void(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: NOT starting a new timer because related_model_ob "+e.id+" !== "+t.id));TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.maybeClearNewMsgsTimer: starting _onNewMsgsTimer while on "+t.id),TS.client.msg_pane.startNewMsgsTimer()},startNewMsgsTimer:function(){s&&(TS.has_pri[z]&&TS.log(z,"startNewMsgsTimer: clearing _new_msgs_tim of "+s),clearTimeout(s),s=null),s=setTimeout(M,1500),TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.startNewMsgsTimer: set timer ID = "+s+" while on "+TS.shared.getActiveModelOb().id)},showNewMsgsBar:function(){if(!TS.client.activeChannelIsHidden()){var e=TS.shared.getActiveModelOb();if(e&&TS.notifs.isCorGMuted(e.id))return void(TS.has_pri[z]&&TS.log(z,"insertUnreadDivider(): "+e.id+" is muted - exiting"));TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.showNewMsgsBar"),A(),$("#messages_unread_status").removeClass(f),TS.client.msg_pane.new_msgs_bar_showing=!0,TS.client.msg_pane.topMessagesBannerShown()}},hideNewMsgsBar:function(e){if(TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.hideNewMsgsBar"),TS.client.msg_pane.clearBlueBarTimer(),!e&&TS.model.prefs.mark_msgs_read_immediately){var t=TS.shared.getActiveModelOb();if(t&&(t._temp_unread_cnt||t.unread_cnt))return TS.has_pri[z]&&TS.log(z,"TS.client.msg_pane.hideNewMsgsBar: NOT hiding because read state pref is mark_msgs_read_immediately, and the model still has some unreads. _temp_unread_cnt = "+t._temp_unread_cnt+", unread_cnt = "+t.unread_cnt),void TS.client.msg_pane.maybeStartNewMsgsTimer(t)}$("#messages_unread_status").addClass(f),TS.client.msg_pane.new_msgs_bar_showing=!1,TS.client.msg_pane.topMessagesBannerHidden()},lastReadIsOlderThanCurrentHistory:function(e){return e=e||TS.shared.getActiveModelOb(),!!parseInt(e.last_read,10)&&(!(!e.msgs||!e.msgs.length)&&(!(e.oldest_msg_ts&&e.last_read<e.oldest_msg_ts)&&!_.some(e.msgs,function(t){return t.ts<=e.last_read})))},checkUnreads:function(){if(TS.boot_data.feature_no_placeholders_in_messages||TS.client.ui.checkInlineImgsAndIframesMain(),TS.client.ui.isUserAttentionOnChat()&&!TS.model.archive_view_is_showing&&!TS.client.activeChannelIsHidden()){var e=TS.shared.getActiveModelOb();if(e&&TS.model.prefs){if(!e.unread_cnt)return a&&a.length&&TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed),void A();if(TS.client.msg_pane.dont_check_unreads_til_switch)return void A();var t=!0,n=(e.unreads,TS.notifs.isCorGMuted(e.id)),i=TS.model.prefs.mark_msgs_read_immediately;if(TS.boot_data.feature_scrollback_half_measures&&i&&TS.model.prefs.start_scroll_at_oldest&&!e.is_limited&&TS.client.msg_pane.lastReadIsOlderThanCurrentHistory(e)&&(i=!1,Q(e)),i)t=!0;else if(n)t=!0;else{if(TS.shared.getOldestUnreadTsForId(e.id)){var s=TS.shared.getOldestUnreadTsForId(e.id);t=TS.client.ui.isMsgInView(s),TS.has_pri[G]&&TS.log(G,"checkUnreads "+e.id+": oldest_unread_ts = "+s+", isMsgInView (all_unreads_are_seen) = "+t)}else TS.has_pri[G]&&TS.log(G,"checkUnreads "+e.id+": no oldest_unread_ts?")}if(!e.is_im&&!e.is_mpim){var r="checkUnreads "+e.id+": NOT MARKING most recent as read because ";e._history_fetched_since_last_connect?TS.shared.didDeferMessageHistoryById(e.id)?(TS.has_pri[G]&&TS.log(G,r+"did_defer_initial_msg_history."),t=!1):e.history_is_being_fetched&&(TS.has_pri[G]&&TS.log(G,r+"history_is_being_fetched."),t=!1):(TS.has_pri[G]&&TS.log(G,r+"!_history_fetched_since_last_connect."),t=!1)}TS.has_pri[G]&&TS.log(G,"checkUnreads "+e.id+": all_unreads_are_seen = "+t+", last_read_msg_div = "+(a&&a.length)+", last_read = "+e.last_read),t&&(a&&a.length||!parseInt(e.last_read,10)||i||n)&&(i?(TS.has_pri[G]&&TS.log(G,"Maybe marking most recent read msg in active because viewed: "+e.id),e.history_is_being_fetched?TS.has_pri[G]&&TS.log(G,"NOT MARKING most recent as read because history being fetched"):TS.client.msg_pane.new_msgs_bar_showing?(TS.has_pri[G]&&TS.log(G,"NOT MARKING most recent as read because new msgs bar is showing."),i&&(e._mark_most_recent_read_timer||(TS.has_pri[G]&&TS.log(G,"Setting a timer to mark "+e.id+" as read."),e._mark_most_recent_read_timer=window.setTimeout(function(){e._mark_most_recent_read_timer=null,k(e),e=null},500)),TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed),TS.client.msg_pane.maybeStartNewMsgsTimer(e))):(TS.has_pri[G]&&TS.log(G,"Marking most recent read msg in active because viewed: "+e.id),TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed))):(TS.has_pri[G]&&TS.log(G,"checkUnreads "+e.id+": All unreads are seen. Marking as viewed."),TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.viewed))),A()}}},getCanonicalDivForMsg:function(e){if(TS.client.ui.$msgs_div.find("ts-conversation").length){var t=TS.client.ui.$msgs_div.find('ts-message[data-ts="'+e+'"]').not("ts-relatives ts-message");return 1==t.length?t:t.filter(":not(ts-conversation) > ts-message")}return TS.client.ui.$msgs_div.find("#"+TS.templates.makeMsgDomId(e))},getDivsForMsg:function(e){return TS.client.ui.$msgs_div.find("ts-conversation").length?TS.client.ui.$msgs_div.find('ts-message[data-ts="'+e+'"]'):TS.client.msg_pane.getCanonicalDivForMsg(e)},getDivForArchiveMsg:function(e){return TS.client.archives.$archives_msgs_div.find("#"+TS.templates.makeMsgDomId(e))},topMessagesBannerShown:function(){m.hasClass("has_top_messages_banner")||m.toggleClass("has_top_messages_banner",e().length>0)},topMessagesBannerHidden:function(){m.hasClass("has_top_messages_banner")&&m.toggleClass("has_top_messages_banner",e().length>0)},cleanMsgDiv:function(){},addMaybeClick:function(e,t){e&&(t=_.isFunction(t)?t:_.noop,g[e]=t)},maybeClick:function(e){var t=$(e).data("maybe-click");g[t]&&g[t]()},areCallsEnabled:function(){return TS.utility.calls.isEnabled()},maybeSetupCalls:function(e,t){var n,i;if(t||(t=TS.shared.getActiveModelOb()),(!t||!TS.shared.isModelObShared(t)||"Slack"!==TS.model.team.prefs.calling_app_name)&&TS.model.team.prefs.allow_calls)if(TS.model.active_im_id)!e||e.is_bot||e.is_slackbot||e.is_self||!TS.client.msg_pane.areCallsEnabled()||(n={is_dm:!0,id:TS.model.active_im_id},i={dm_member:e,name:TS.members.getPrefCompliantMemberName(e,!1,!0)},P(n,i));else if(TS.model.active_channel_id||TS.model.active_group_id){t=TS.shared.getActiveModelOb();var a=!TS.channels.isChannelRequired(t)||TS.permissions.members.canPostInChannel(TS.model.user);TS.client.msg_pane.areCallsEnabled()&&a&&(n=TS.model.active_channel_id?{id:TS.model.active_channel_id}:{id:TS.model.active_group_id},P(n))}else TS.model.active_mpim_id&&TS.client.msg_pane.areCallsEnabled()&&(i={names:TS.mpims.getDisplayName(t)},n={is_dm:!1,is_mpdm:!0,id:TS.model.active_mpim_id},P(n,i))},setUnreadPoint:function(e){var t=TS.shared.getActiveModelOb(),n=TS.utility.msgs.getMarkMsgTSForUnreadPoint(e,t.msgs,t);if(!n)return!1;if(TS.model.active_channel_id)TS.channels.markReadMsg(TS.model.active_channel_id,n,TS.model.marked_reasons.back);else if(TS.model.active_im_id)TS.ims.markReadMsg(TS.model.active_im_id,n,TS.model.marked_reasons.back);else if(TS.model.active_group_id)TS.groups.markReadMsg(TS.model.active_group_id,n,TS.model.marked_reasons.back);else{if(!TS.model.active_mpim_id)return!1;TS.mpims.markReadMsg(TS.model.active_mpim_id,n,TS.model.marked_reasons.back)}return TS.model.client.reads.length=0,TS.client.markLastReadsWithAPI(),TS.has_pri[z]&&TS.log(z,"setUnreadPoint for "+t.id+": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()"),TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar(),TS.has_pri[G]&&TS.log(G,"setUnreadPoint for "+t.id+" - marking dont_check_unreads_til_switch = true."),TS.client.msg_pane.dont_check_unreads_til_switch=!0,TS.utility.msgs.maybeClearPrevLastRead(),TS.client.msg_pane.insertUnreadDivider(),!0},maybeResetUnreadsCheck:function(e){if(TS.client.msg_pane.dont_check_unreads_til_switch){var t=TS.shared.getActiveModelOb();e&&t&&t.id==e.id&&(TS.has_pri[H]&&TS.log(H,"resetting dont_check_unreads_til_switch, so unread / banner fade work can be re-done on current model_ob."),TS.client.msg_pane.dont_check_unreads_til_switch=!1)}},maybeInsertUnreadDividerAndNewMsgsBar:function(e){if(e){var t=TS.shared.getActiveModelOb();if(t&&e.id===t.id){if(TS.has_pri[N]&&TS.log(N,"channelUnreadCountChanged: "+e.id+" - unread count changed for active model_ob of "+t.id),!e.unread_cnt)return TS.has_pri[N]&&TS.log(N,"channelUnreadCountChanged: "+e.id+" - unread_cnt is 0. Maybe starting new msgs timer."),void TS.client.msg_pane.startNewMsgsTimer();TS.model.ui.is_window_focused?TS.model.prefs&&!TS.model.prefs.mark_msgs_read_immediately&&TS.client.ui.$msgs_unread_divider&&!TS.client.ui.isUnreadDividerInView()&&(TS.has_pri[N]&&TS.log(N,"channelUnreadCountChanged: "+e.id+" - window is in focus, BUT, unread divider is not in view - clearing existing state, will show in new position."),TS.client.msg_pane.clearUnreadDivider(),TS.utility.msgs.maybeClearPrevLastRead()):(TS.has_pri[N]&&TS.log(N,"channelUnreadCountChanged: "+e.id+" - window is not in focus, so removing and re-inserting unread divider so it can be updated."),TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar(),TS.utility.msgs.maybeClearPrevLastRead()),TS.client.msg_pane.insertUnreadDivider(),TS.model.ui.is_window_focused?TS.has_pri[N]&&TS.log(N,"channelUnreadCountChanged: "+e.id+" - NOT showing new msgs bar because window is in focus."):(TS.has_pri[N]&&TS.log(N,"channelUnreadCountChanged: "+e.id+" - showing new msgs bar."),TS.client.msg_pane.showNewMsgsBar())}}},maybeResetAndAutoScroll:function(e){},setCallButtonState:function(e){var t=TS.utility.calls.isMultiPartyEnabled();TS.utility.calls.isEnabled()&&"Slack"!==TS.model.team.prefs.calling_app_name&&(t=!0);var n=!0;!t&&TS.utility.calls.isCurrentContextMultiParty()&&(n=!1),$(".call_icon").toggleClass("call_window_offline",!(e&&n))},maybeRenderHighlightedMessages:function(e){var t=TS.shared.getActiveModelOb();e[t.id]&&_.each(e[t.id],function(e,n){var i=TS.utility.msgs.getMsgByProp("ts",n,t.msgs);i&&(e.show_recap||e.is_leaving_feedback||e.left_feedback)&&TS.utility.msgs.replaceMsg(t,i,!1,!0)})},maybeRenderHighlightedMessageFeedback:function(e){var t=TS.shared.getActiveModelOb();t&&e[t.id]&&_.each(e[t.id],function(e,n){var i=TS.utility.msgs.getMsgByProp("ts",n,t.msgs);i&&("positive"===e.feedback?TS.client.ui.$msgs_div.find('ts-message[data-ts="'+i.ts+'"] .sli_briefing__feedback_controls').addClass("gave_positive_feedback"):(e.is_leaving_feedback||e.left_feedback)&&TS.utility.msgs.replaceMsg(t,i,!1,!0))})}});var t,n,i,a,s,r,o,l=!1,d=!1,c=0,u=!1,m=$("#messages_container"),h=$("#footer"),p=$("#center_workspace_container"),g={},f="no_pointer_events no_opacity",S=!1,T="",v=0,b=function(){TS.client.msg_pane.updateEndMarker()},w=function(){TS.client.msg_pane.updateEndMarker()},y=function(e){if(TS.metrics.mark("_rebuildMsgs"),!TS.useReactMessages()){var t=TS.shared.getActiveModelOb();if(t&&(l=!!t.is_slackbot_im),t){TS.utility.enableFeatureForUser(10)&&TS.statsd.count("client_msgs_rebuild"),TS.client.msg_pane.is_rebuilding=!0;var a;TS.msg_edit.editing&&TS.msg_edit.editing_in_msg_pane&&(a=TS.msg_edit.pauseEditing()),TS.has_pri[j]&&TS.log(j,"rebuilding msgs for "+TS.model.active_cid),TS.model.ui.msgs_are_auto_scrolling=!1,TS.has_pri[z]&&TS.log(z,"rebuildMsgs(), "+t.id+", reason: "+(e||"not specified")),TS.has_pri[z]&&TS.log(z,"rebuildMsgs(), "+t.id+": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()"),TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar();var s,r=-1,o="";TS.client.msg_pane.last_render_time=new Date,TS.client.msg_pane.last_rendered_msg=null,TS.client.msg_pane.last_in_stream_msg=null,r=t.scroll_top,s=t.msgs;var d,c,u,m,h,p=[];if(TS.boot_data.feature_initial_scroll_position&&t.id===i&&(h=TS.client.ui.areMsgsScrolledToBottom(0)),TS.boot_data.feature_initial_scroll_position||TS.client.ui.$msgs_div.empty(),s){s.length||(o="");for(var g=[],f=0,S=_.reject(s,TS.utility.msgs.isMsgHidden),T=S.length-1;T>-1;T-=1)if(d&&TS.utility.msgs.isMsgHidden(d)||(c=d),d=S[T],!TS.utility.msgs.isMsgHidden(d)){var v=TS.utility.msgs.msgRollUpWorker(T,d,S,g);if("continue"!==v){"swap"===v&&(d=g[0],g.length=0),f+=1;var b=O(d,c);if(b&&(c&&(o+="</div></div>"),o+='<div class="day_container">',o+=TS.templates.messages_day_divider({ts:d.ts}),o+='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(d.ts)+'" data-ts="'+d.ts+'">'),TS.boot_data.feature_message_replies_inline&&(TS.utility.msgs.msgHasReplies(d)||TS.ui.thread.isMessageBeingConvertedToThread(t.id,d)))try{m=TS.ui.thread.makeInlineThread(t.id,d.ts),m&&(p.push(m),o+=TS.ui.thread.buildThreadHTML(m,{inline:!0,expanded:TS.ui.thread.isThreadExpanded(t.id,d.ts)}))}catch(e){e.message||(e.message=""),TS.warn("Problem building inline thread "+d.ts+": "+JSON.stringify(e.message))}else o+=TS.templates.builders.msgs.buildHTML({msg:d,model_ob:t,prev_msg:c,container_id:"msgs_div",enable_slack_action_links:!0});0===T&&(o+="</div></div>"),d.is_pending||(TS.client.msg_pane.last_in_stream_msg=d,TS.utility.msgs.isMsgHidden(d)||(TS.client.msg_pane.last_rendered_msg=d))}else d=c}if(TS.boot_data.page_needs_enterprise&&f&&f<20&&TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): Enterprise case: Loading more history, message "+f+" < min_count of 20"),TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): "+s.length+" msgs, of which "+f+" were counted as visible."),!TS.isPartiallyBooted()&&s.length&&f<20)if(n&&i==t.id);else{n=!0;var w=function e(){n=!1,TS.channels.switched_sig.remove(e),TS.groups.switched_sig.remove(e),TS.ims.switched_sig.remove(e),TS.mpims.switched_sig.remove(e)};TS.channels.switched_sig.addOnce(w),TS.groups.switched_sig.addOnce(w),TS.ims.switched_sig.addOnce(w),TS.mpims.switched_sig.addOnce(w),TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): loading more history because count is < 20"),TS.model.prefs.start_scroll_at_oldest&&!t.is_im&&(TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): loading scrollback, AND, resetting _has_auto_scrolled so we scroll to oldest again when more history loads."),u=!0),TS.client.ui.doLoadScrollBackHistory(!0)}i=t.id}else o="-";if(TS.client.ui.$msgs_div.html(o),TS.boot_data.feature_message_replies_inline&&_.forEach(p,function(e){if(TS.ui.thread.isThreadExpanded(t.id,e.root_msg.ts)){var n=TS.client.ui.$msgs_div.find('ts-thread[data-ts="'+e.ts+'"]');TS.ui.thread.renderReplyInput(n,e)}}),TS.utility.makeSureAllLinksHaveTargets(TS.client.ui.$msgs_div),TS.client.msg_pane.assignLastReadMsgDiv(t),TS.client.msg_pane.insertUnreadDivider(),TS.isPartiallyBooted()||I(),TS.client.msg_pane.updateEndMarker(),TS.boot_data.feature_no_placeholders_in_messages||TS.client.ui.checkInlineImgsAndIframesMain(),TS.attachment_actions.select.decorateNewElements(),TS.boot_data.feature_initial_scroll_position)h&&TS.client.ui.instaScrollMsgsToBottom(!1);else if(TS.client.ui.instaScrollMsgsToBottom(!1),-1==r||void 0===r||TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest&&t.unread_cnt){var y=TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest;if(y&&t.unread_cnt&&TS.client.msg_pane.new_msgs_bar_showing&&!t._has_auto_scrolled){if(!TS.model.ui.is_window_focused)return void(TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): NOT resetting and applying auto-scroll on "+t.id+", because window is not in focus."));TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): resetting has_auto_scrolled on "+t.id+" and forcing first unread to scroll into view, because new msgs bar is still up and unread_cnt = "+t.unread_cnt),r=-1,C(t)}t._has_auto_scrolled&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()||(TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): insta-scrolling to bottom(false) and then first unread into view because of last_scroll_top = -1 or undefined (actual: "+r+") OR (pref to scroll AND unread), where unread_cnt = "+t.unread_cnt),TS.client.ui.instaScrollMsgsToBottom(!1),TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest&&TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView(function(){}),t.is_im||u||function(e){TS.utility.rAF(function(){var t=TS.shared.getActiveModelOb();t&&t.id===e.id&&(TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest&&(TS.client.ui.instaScrollMsgsToBottom(!1),TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView(function(){})),e.msgs.length?(TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): marking has_auto_scrolled because !is_im and has msgs"),e._has_auto_scrolled=!0):(TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): NOT marking has_auto_scrolled because no msgs yet"),e._has_auto_scrolled=!1),e=null)})}(t))}else TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): insta-scrolling to last_scroll_top of "+r),TS.client.ui.instaScrollMsgsToPosition(r,!1);!TS.boot_data.feature_initial_scroll_position&&u&&t._has_auto_scrolled&&(TS.has_pri[j]&&TS.log(j,"rebuildMsgs(): resetting scroll state due to pending history call"),r=-1,C(t)),a&&TS.msg_edit.resumeEditing(a),o=null,s=null,t=null,TS.client.msg_pane.is_rebuilding=!1,TS.client.msg_pane.did_rebuild_msgs_sig.dispatch(),(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))&&TS.metrics.measure("client_msg_pane_rebuild_msgs","_rebuildMsgs")}}},k=function(e){e&&(e._temp_unread_cnt||e._temp_last_read)&&(TS.has_pri[H]&&TS.log(H,"_clearTempReadState: Nulling _temp_unread_cnt and _temp_last_read on "+e.id),e._temp_unread_cnt=null,e._temp_last_read=null)},A=function(){if(TS.client.ui.$msgs_unread_divider){var e=TS.shared.getActiveModelOb();TS.utility.msgs.maybeCalcUnreadCnts(e),TS.has_pri[z]&&TS.log(z,"_updateNewMsgsDisplay: "+e.id+", unread_cnt = "+e.unread_cnt);var t=e._temp_unread_cnt||e.unread_cnt,n=e._temp_last_read||e.last_read;if(t){var i=TS.utility.msgs.getOldestValidTs(e),a=t,s="";n<i&&a>10&&(s="+",a=10*Math.floor(a/10));var r,o=TS.client.ui.$msgs_unread_divider.data("last_read_ts");if(!(o||(TS.has_pri[z]&&TS.log(z,"_updateNewMsgsDisplay: "+e.id+" - No last_read_ts - no unread divider? Trying _prev_last_read ("+e._prev_last_read+") || model_ob.last_read ("+e.last_read+")"),o=e._prev_last_read||e.last_read)))return void(TS.has_pri[z]&&TS.log(z,"_updateNewMsgsDisplay: "+e.id+" - Still no last_read_ts - exiting."));var l=TS.utility.msgs.getDisplayedMsgAfterTS(o,e.msgs);r=l?l.ts:o;var d,c,_={shortenMonth:!1,excludeYear:!0},u=TS.interop.datetime.toCalendarDateOrNamedDay(r,_),m=TS.interop.datetime.toDateObject(r);d=TS.interop.datetime.isToday(m)?TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time}","client"):TS.interop.datetime.isYesterday(m)?TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time} {date_string}","client"):TS.i18n.t("{unread_message_count}{plus} new {unread_message_count, plural, =1 {message} other {messages}} since {time} on {date_string}","client"),c=d({unread_message_count:a,plus:s,time:TS.interop.datetime.toTime(r,{do24hrTime:TS.utility.date.do24hrTime()}),date_string:u}),$("#new_msg_info").html(c),TS.ui.a11y.saveUnreadCountMessage(e,c)}else TS.client.msg_pane.new_msgs_bar_showing&&(TS.has_pri[z]&&TS.log(z,"_updateNewMsgsDisplay: "+e.id+", unread_cnt = "+t+" - maybe starting new msgs timer."),TS.client.msg_pane.maybeStartNewMsgsTimer())}},C=function(e){e&&TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest&&(e._has_auto_scrolled=!1,TS.model.ui.msgs_are_auto_scrolling=!1,e.scroll_top=-1)},M=function(){var e=TS.shared.getActiveModelOb();if(e)if(TS.has_pri[z]&&TS.log(z,"_onNewMsgsTimer: current model is "+e.id+", unread_cnt = "+e.unread_cnt+", timer ID = "+s),s=null,e.unread_cnt){if(TS.model.prefs.mark_msgs_read_immediately&&!e.history_is_being_fetched)return TS.has_pri[z]&&TS.log(z,"_onNewMsgsTimer: checking unreads (with intent to mark as read) and exiting, because not fetching history and unread_cnt = "+e.unread_cnt),void TS.client.msg_pane.checkUnreads();TS.has_pri[z]&&TS.log(z,"_onNewMsgsTimer: re-starting new msgs timer because unread_cnt = "+e.unread_cnt),TS.client.msg_pane.startNewMsgsTimer()}else if(!TS.model.prefs.mark_msgs_read_immediately||TS.model.prefs.start_scroll_at_oldest||r){if(e.history_is_being_fetched)return TS.has_pri[z]&&TS.log(z,"_onNewMsgsTimer: not hiding new msgs bar because history is being fetched for current model_ob ("+e.id+")"),TS.client.msg_pane.startNewMsgsTimer();TS.has_pri[z]&&TS.log(z,"_onNewMsgsTimer: calling TS.client.msg_pane.hideNewMsgsBar() immediately"),TS.client.msg_pane.hideNewMsgsBar(),$(".unread_divider").addClass("no_unreads")}else{r=setTimeout(function(){TS.has_pri[z]&&TS.log(z,"_onNewMsgsTimer: calling TS.client.msg_pane.hideNewMsgsBar() after 1500 msec"),r=null,TS.client.msg_pane.hideNewMsgsBar(),$(".unread_divider").addClass("no_unreads")},1500)}},x=function(){var e=TS.shared.getActiveModelOb();if(!e)return void TS.error("updateEndMarker no channel, no im, no group");var t=$(".end_action_slack_invite"),n=t.parent(),i=$(".end_action_invite").parent();if(e.is_general){var a;if("normal"===TS.model.team.prefs.auth_mode&&TS.model.team.email_domain){var s=location.hostname.replace(/[^.]*/,_.escape(TS.model.team.domain));a=TS.i18n.t('<i class="ts_icon ts_icon_user ts_icon_inherit"></i> Send <a class="underline ts_tip ts_tip_top" href="https://{hostname}/signup">this link<span class="copied_ok ts_tip_tip hidden">Copied!</span></a> to your team to invite them',"client")({hostname:s}),TS.clipboard.canWriteText()&&t.off("click").html(a).find("a").on("click",function(e){e.preventDefault();var t,n=$(".copied_ok"),i="https://"+s+"/signup";TS.clipboard.writeText(i),n.removeClass("hidden"),t&&window.clearTimeout(t),t=window.setTimeout(function(){n.addClass("hidden")},2e3)})}else TS.model.user.is_admin&&(a=TS.i18n.t('<a><i class="ts_icon ts_icon_user ts_icon_inherit"></i> Invite people to <strong>{teamname}</strong></a>',"client")({teamname:_.escape(TS.model.team.name)}),t.off("click").on("click.show_admin_invite_modal",TS.ui.admin_invites.start).html(a));n.toggleClass("hidden",!a),i.toggleClass("hidden",!!a)}else n.addClass("hidden"),i.removeClass("hidden")},I=function(){if(!(c>0||TS.model.team.plan||TS.newxp.inOnboarding())){var e,t,n,i=!1,a=$("#notification_banner"),s=Math.floor(Date.now()/1e3),r=TS.model.team.prefs.limit_reached_ts/1e6,o=$("#msg_lim_banner_btn_learn").attr("href");c+=1;var l=TS.model.team.approaching_msg_limit,d=TS.model.prefs.growth_msg_limit_approaching_cta_count>0;if(l&&!d)TS.client.ui.$msgs_div.addClass("hide_day_dividers_for_notif_banner"),$("#notification_banner img").attr({src:"/img/emoji_2016_06_08/apple/231b.png",alt:"sand hourglass emoji"}),e=63,o=o+"&ui_step="+e,$("#msg_lim_banner_btn_learn").attr("href",o),$("#notification_banner h1").addClass("hidden"),$("#msg_limit_h1_approaching").removeClass("hidden"),$("#msg_limit_h2_approaching").removeClass("hidden"),a.removeClass("hidden"),i=!0;else if(r>0){var _=TS.model.prefs.growth_msg_limit_reached_cta_count>0,u=TS.model.prefs.growth_msg_limit_long_reached_cta_count>0,m=TS.interop.datetime.addDays(r,7),h=s>=r&&s<=m;if(h&&!_)TS.client.ui.$msgs_div.addClass("hide_day_dividers_for_notif_banner"),$("#notification_banner img").attr({src:"/img/emoji_2016_06_08/apple/1f3c1.png",alt:"chequered flag emoji"}),e=64,o=o+"&ui_step="+e,$("#msg_lim_banner_btn_learn").attr("href",o),$("#notification_banner h1").addClass("hidden"),$("#msg_limit_h1_reached").removeClass("hidden"),$("#msg_limit_h2_reached").removeClass("hidden"),a.removeClass("hidden"),i=!0;else if(!u){var p=!1,g=!1,f=!1,S=TS.model.prefs.growth_msg_limit_reached_cta_last_ts,T=TS.interop.datetime.addDays(S,30),v=TS.interop.datetime.addDays(r,30),b=TS.interop.datetime.addDays(r,37);v>0&&b>0?p=v<=s&&s<=b:T>0&&(f=s>=T),g=f||p,g&&(TS.client.ui.$msgs_div.addClass("hide_day_dividers_for_notif_banner"),$("#notification_banner img").attr({src:"/img/emoji_2016_06_08/apple/1f680.png",alt:"rocket emoji"}),e=65,o=o+"&ui_step="+e,$("#msg_lim_banner_btn_learn").attr("href",o),$("#notification_banner h1").addClass("hidden"),$("#msg_limit_h1_long_reached").removeClass("hidden"),$("#msg_limit_h2_long_reached").removeClass("hidden"),t=TS.model.team.messages_count-1e4,t>9&&t<100?t=10*Math.floor(t/10):t>100&&t<=999999?(t=100*Math.floor(t/100),t=TS.utility.numberWithCommas(t)):t>999999&&(t=TS.utility.number.formatNumberWithAbbreviation(t,{precision:3})),$(".num_msgs_beyond_limit").html(t),a.removeClass("hidden"),i=!0)}}i&&(TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:e,action:"impression"}}}),n={63:{growth_msg_limit_approaching_cta_ts:s,growth_msg_limit_approaching_cta_count:TS.model.prefs.growth_msg_limit_approaching_cta_count+1},64:{growth_msg_limit_reached_cta_last_ts:s,growth_msg_limit_reached_cta_count:TS.model.prefs.growth_msg_limit_reached_cta_count+1},65:{growth_msg_limit_long_reached_cta_last_ts:s,growth_msg_limit_long_reached_cta_count:TS.model.prefs.growth_msg_limit_long_reached_cta_count+1}},$("#msg_lim_banner_btn_learn, #msg_lim_banner_btn_skip").click(function(t){TS.client.ui.$msgs_div.removeClass("hide_day_dividers_for_notif_banner"),a.addClass("hidden");var i,s,r=t.toElement.id;"msg_lim_banner_btn_learn"===r?(i="click",s="pricing_button"):"msg_lim_banner_btn_skip"===r&&(i="close",s="skip_for_now_button"),TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:e,action:i,ui_element:s}}}),TS.prefs.setMultiPrefsByAPI(n[e])}))}},E=!1,B=function(e){E=e.is_loading,D()},D=function(){F(),TS.model.team.prefs.allow_calls&&TS.client.msg_pane.displayTitle()},F=function(){$(".channel_calls_button").remove()},P=function(e,t){t=t||{};var n=TS.shared.getActiveModelOb();if(n&&TS.permissions.members.canPostInChannel(n)){var i=TS.utility.calls.isCallWindowReady()||!TS.utility.calls.platformHasCallsCode(),a=TS.utility.calls.isMultiPartyEnabled();TS.utility.calls.isEnabled()&&"Slack"!==TS.model.team.prefs.calling_app_name&&(a=!0);var s=n.is_channel&&!n.is_member,r=!0;!a&&TS.utility.calls.isCurrentContextMultiParty()&&(r=!1);var o=i&&r&&!s,l="Slack"!==TS.model.team.prefs.calling_app_name,d=["call_icon"];if(o||d.push("call_window_offline"),t.is_dm_user_offline&&d.push("away"),e.is_dm&&t.hasOwnProperty("dm_member")&&d.push(TS.templates.makeMemberDomIdById(t.dm_member.id)),TS.client.msg_pane.areCallsEnabled()){var c,_,u=$("#channel_calls_container");s?c=TS.i18n.t("Join this channel to start a call","client")():r?e.is_dm||e.is_mpdm?t.is_dm_user_offline?c=TS.i18n.t("{name} is currently offline and unreachable","client")({name:t.name}):(_=e.is_mpdm?t.names:t.name,c=l?TS.i18n.t("Call {call_name} with {calling_app_name}","client")({call_name:_,calling_app_name:TS.model.team.prefs.calling_app_name}):TS.i18n.t("Call {call_name}","client")({call_name:_})):c=l?TS.i18n.t("Start a call with {calling_app_name}","client")({calling_app_name:TS.model.team.prefs.calling_app_name}):TS.i18n.t("Start a call","client")():c=e.is_mpdm?TS.i18n.t("Only paid teams can call from group conversations.","client")():TS.i18n.t("Only paid teams can start calls from channels.","client")();var m="";m+=TS.templates.menu_call_button({is_platform_call_loading:E,button_classes:"voice_call",tip_text:c,icon_classes:d.concat("ts_icon_phone").join(" ")}),u.html(m),u.removeClass("hidden"),e.id&&r&&$(".channel_calls_button.voice_call").on("click.video_call",function(){if(!s){var t="Slack"!==TS.model.team.prefs.calling_app_name;TS.clog.track("CALLS_START_VOICE_BUTTON_CLICKED",{is_platform_call:t,calling_app_id:TS.model.team.prefs.calling_app_id}),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_calls_button"}}}),t?TS.utility.calls.launchPlatformCalls(e):TS.utility.calls.startCallInModelOb(e)}});Date.now()-new Date(1e3*TS.model.user.created)>6048e5&&TS.model.seen_welcome_2&&TS.model.supports_screen_sharing&&!TS.model.is_lin&&r&&!l&&TS.utility.calls.isPaidTeam()&&TS.experiment.loadUserAssignments().then(function(){if("enabled"===TS.experiment.getGroup("calls_ss")&&"disabled"!==TS.experiment.getGroup("calls_coachmarks_ss")&&TS.model.is_our_app){var e=-1===TS.utility.compareSemanticVersions(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch,"2.5.2");TS.model.prefs.seen_calls_ss_main_coachmark||TS.model.prefs.seen_calls_ss_window_coachmark||e||(TS.coachmark.start(TS.coachmarks.coachmarks.calls_ss_main),TS.model.prefs.seen_calls_ss_main_coachmark=!0,TS.prefs.setPrefByAPI({name:"seen_calls_ss_main_coachmark",value:!0}))}})}}},O=function(e,t){return!t||!TS.utility.msgs.areMsgsSameDay(e,t)},R=function(){var e=TS.shared.getActiveModelOb();e.is_mpim&&U(e)},U=function(e){var t,n=TS.notifs.isCorGMuted(e.id),i=TS.notifs.getCalculatedCorGNotifySetting(e.id),a=TS.ui.growls.checkPermission(),s=!1===a&&TS.ui.growls.no_notifications,r=!1===a&&"denied"===TS.ui.growls.getPermissionLevel(),o=!1===a&&TS.ui.growls.shouldShowPermissionButton(),l={members:TS.mpims.getMembersInDisplayOrder(e),model_ob:e,compliance_exports_enabled_for_team:!!TS.model.team.prefs.compliance_export_start,compliance_export_start:TS.model.team.prefs.compliance_export_start||0,desktop_setting:i,is_muted:n,desktop_notifs_enabled:a,notifications_impossible:s,notifications_not_allowed:r,notifications_not_yet_allowed:o};$("#im_meta").html(TS.templates.dm_badge(l)),t=$(".mpim_notif_prefs"),t.find(".more_options").on("click",function(){TS.ui.channel_prefs_dialog.start(e.id)}),t.find("#notifications_muted_cb").on("change",function(){TS.notifs.isCorGMuted(e.id)&&TS.notifs.muteOrUnmuteCorG(e.id)}),t.find("#no_notifications_cb").on("change",function(){TS.model.prefs.all_channels_loud?TS.notifs.makeCorGDTopEverything(e.id):TS.notifs.makeCorGDTopMentions(e.id),TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})}),t.find("#all_notifications_rd").on("change",function(){TS.notifs.makeCorGDTopEverything(e.id),TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})}),t.find("#mentions_rd").on("change",function(){TS.notifs.makeCorGDTopMentions(e.id),TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")})})},L=!1,Q=function(e){e.is_channel&&(L||(TS.metrics.count("banner_not_cleared"),L=!0,TS.channels.switched_sig.addOnce(function(){L=!1})))},H=58,N=99,G=142,j=888,z=999}()},2406:function(e,t){!function(){"use strict";function e(){if(!_.isFunction(window.requestAnimationFrame))return void TS.warn("Enhanced debugging: unable to install beachball detector without requestAnimationFrame");TS.info("Enhanced debugging: installing beachball detector");var e=[],t=TS.replaceConsoleFunction(function(n,i,a){var s=_.toArray(a).slice(1).join(" ");return e.push({type:n,pri:i,msg:s,time:performance.now()}),t.apply(window,arguments)}),n=[],i=performance.now(),a=function t(){var a=performance.now(),s=a-i,r=i;if(i=a,n.push(s),n.length>60&&n.shift(),requestAnimationFrame(t),n.length<60)return void(e.length=0);var o=_.sum(n)/n.length;s>4*o&&TS.has_pri[O]&&(TS.log(O,"========"),TS.log(O,"Enhanced debugging: slowness detected"),TS.log(O,"Current time: "+a+"; previous frame was at "+r),TS.log(O,"Last frame took: "+Math.round(s)+" ms"),TS.log(O,"Average frame takes: "+Math.round(o)+" ms"),e.length?(TS.log(O,"Begin logs since last healthy tick:"),e.forEach(function(e){var t=e.time-r,n="["+_.padStart(Math.floor(t),5," ")+"]",i=e.pri?" ("+e.pri+")":"";TS.log(O,n+" "+e.type+i+": "+e.msg)}),TS.log(O,"End logs since last healthy tick")):TS.log(O,"(No logs captured, sorry)"),TS.log(O,"========")),e.length=0};requestAnimationFrame(a)}TS.registerModule("client",{before_login_sig:new signals.Signal,login_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,flexpane_display_switched_sig:new signals.Signal,core_url:null,onStart:function(){TS.client.core_url=document.location.href.split(/\/+messages/)[0]+"/messages",TS.model.ui_state=TS.storage.fetchUIState(),TS.model.initial_ui_state_str=TS.model.ui_state?JSON.stringify(TS.model.ui_state):"none",TS.model.flex_name_in_url=TS.utility.getFlexNameFromUrl(location.href).toLowerCase(),TS.model.flex_extra_in_url=TS.utility.getFlexExtraFromUrl(location.href),-1==TS.model.flex_names.indexOf(TS.model.flex_name_in_url)&&(TS.model.flex_name_in_url="",TS.model.flex_extra_in_url=""),TS.model.flex_name_in_url&&"search"!==TS.model.flex_name_in_url&&(TS.model.ui_state.flex_name=TS.model.flex_name_in_url,TS.model.ui_state.flex_extra=TS.model.flex_extra_in_url||""),"list"===TS.model.ui_state.flex_name&&(TS.model.ui_state.flex_name="files"),"activity"===TS.model.ui_state.flex_name&&(TS.model.ui_state.flex_name="mentions"),TS.model.ui_state.flex_visible=!!TS.model.ui_state.flex_name,TS.storage.storeUIState(TS.model.ui_state);var e=$("body");TS.boot_data.feature_name_tagging_client&&e.addClass("feature_name_tagging_client"),TS.boot_data.feature_texty_mentions&&e.addClass("feature_texty_mentions"),TS.boot_data.feature_texty_search&&e.addClass("feature_texty_search"),TS.boot_data.feature_archive_deeplink&&e.addClass("feature_archive_deeplink"),TS.utility.contenteditable.supportsTexty()&&e.addClass("feature_texty"),TS.boot_data.feature_file_threads&&e.addClass("feature_file_threads"),TS.boot_data.feature_min_web&&TS.model.is_electron&&desktop&&desktop.teams&&desktop.teams.setTeamIdleTimeout&&D(),TS.client.user_added_to_team_sig.add(TS.client.userAddedToTeam),TS.client.user_removed_from_team_sig.add(TS.client.userRemovedFromTeam),TS.isSocketManagerEnabled()&&TS.interop.SocketManager.troubleConnectingSig.add(TS.client.showConnectionTroubleDialog)},isEnhancedDebuggingEnabled:function(){return!!n},gogogo:function(){$(window).bind("popstate",g),TS.model.is_mac_ssb&&TSSSB.callMacGap("didSignin",{id:TS.model.user.id,name:TS.model.user.name,team_id:TS.model.team.id,team_name:TS.model.team.name,team_url:"https://"+location.host})},updateTeamIcon:function(){TS.model.team.icon&&(TS.model.team.icon.image_68&&!0!==TS.model.team.icon.image_default?window.winssb?TSSSB.call("setImage",TS.model.team.icon):TSSSB.call("setImage",TS.model.team.icon.image_68):TSSSB.call("setImage",!1))},markLastReadsWithAPI:function(){if(!TS.isPartiallyBooted()){var e;if(TS.useRedux()){var t=TS.redux.channels.getAllIdsNeedingMarking();t.forEach(function(t){var n=TS.redux.channels.getEntityById(t);if(n){TS.model.last_reads_set_by_client[n.id+"_"+n.last_read]=!0,e="muted"===n._marked_reason;var i="channels.mark",a=TS.channels.onMarked;TS.redux.channels.isGroup(n)?(i="groups.mark",a=TS.groups.onMarked):TS.redux.channels.isIm(n)?(i="im.mark",a=TS.ims.onMarked,e=void 0):TS.redux.channels.isMpim(n)&&(i="mpim.mark",a=TS.mpims.onMarked),TS.boot_data.feature_shared_channels_beta&&(i="conversations.mark"),TS.api.call(i,{channel:t,ts:n.last_read,reason:n._marked_reason},a,e)}}),t.length&&TS.redux.channels.clearAllMarkingFlags()}else{if(TS.model&&TS.model.channels){TS.channels.getChannelsFilteredBy("needs_api_marking").forEach(function(t){TS.model.last_reads_set_by_client[t.id+"_"+t.last_read]=!0,t.needs_api_marking=!1,e="muted"===t._marked_reason,TS.api.call("channels.mark",{channel:t.id,ts:t.last_read,reason:t._marked_reason},TS.channels.onMarked,e)})}if(TS.model&&TS.model.ims){TS.ims.getImsFilteredBy("needs_api_marking").forEach(function(e){TS.model.last_reads_set_by_client[e.id+"_"+e.last_read]=!0,e.needs_api_marking=!1,TS.api.call("im.mark",{channel:e.id,ts:e.last_read,reason:e._marked_reason},TS.ims.onMarked)})}if(TS.model&&TS.model.groups){TS.groups.getGroupsFilteredBy("needs_api_marking").forEach(function(t){TS.model.last_reads_set_by_client[t.id+"_"+t.last_read]=!0,t.needs_api_marking=!1,e="muted"===t._marked_reason,TS.api.call("groups.mark",{channel:t.id,ts:t.last_read,reason:t._marked_reason},TS.groups.onMarked,e)})}if(TS.model&&TS.model.mpims){TS.mpims.getMpimsFilteredBy("needs_api_marking").forEach(function(t){TS.model.last_reads_set_by_client[t.id+"_"+t.last_read]=!0,t.needs_api_marking=!1,e="muted"===t._marked_reason,TS.boot_data.feature_shared_channels_beta?TS.api.call("conversations.mark",{channel:t.id,ts:t.last_read,reason:t._marked_reason},TS.mpims.onMarked,e):TS.api.call("mpim.mark",{channel:t.id,ts:t.last_read,reason:t._marked_reason},TS.mpims.onMarked,e)})}}}},activeChannelDisplayGoneAway:function(){TS.model.active_history.pop();for(var e,t,n,i=function(e){TS.model.active_history.push(e.id),TS.model.active_channel_id=null,TS.model.active_im_id=null,TS.model.active_group_id=null,TS.model.active_mpim_id=null,e.is_im?TS.model.active_im_id=e.id:e.is_mpim?TS.model.active_mpim_id=e.id:e.is_group?TS.model.active_group_id=e.id:e.is_channel&&(TS.model.active_channel_id=e.id),TS.model.active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id};TS.model.active_history.length&&!n;)if(e=TS.model.active_history.pop(),t=TS.shared.getModelObById(e),t.is_im&&t.is_open){if(n=!0,TS.has_pri[O]&&TS.log(O,"switching to im "+t.id),TS.client.activeChannelIsHidden())return i(t);TS.ims.displayIm(t.id),TS.client.channelDisplaySwitched({id:t.id})}else if(t.is_mpim&&t.is_open){if(n=!0,TS.has_pri[O]&&TS.log(O,"switching to mpim "+t.id),TS.client.activeChannelIsHidden())return i(t);TS.mpims.displayMpim({id:t.id,replace_history_state:!0})}else if(t.is_group&&!t.is_archived){if(n=!0,TS.has_pri[O]&&TS.log(O,"switching to group "+t.id),TS.client.activeChannelIsHidden())return i(t);TS.groups.displayGroup({id:t.id})}else if(t.is_channel){if(n=!0,TS.has_pri[O]&&TS.log(O,"switching to channel "+t.id),TS.client.activeChannelIsHidden())return i(t);TS.channels.displayChannel({id:t.id,replace_history_state:!0})}if(!TS.model.active_history.length){var a=TS.channels.getUnarchivedChannelsForUser(),s=TS.groups.getUnarchivedGroups();if(a.length>0){var r=_.find(a,{is_member:!0})||a[0];return TS.client.activeChannelIsHidden()?i(r):void TS.channels.displayChannel({id:r.id,replace_history_state:!0})}if(s.length>0)return TS.client.activeChannelIsHidden()?i(s[0]):void TS.groups.displayGroup({id:s[0].id});TS.error("WTF no channel or group to display?")}},flexDisplaySwitched:function(e,t,n,i){if(t=S(t),n=!0,!i&&(TS.model.c_name_in_url||TS.client.activeChannelIsHidden())){var a=function(){return TS.model.unread_view_is_showing?"/unreads":TS.model.threads_view_is_showing?"/threads":TS.model.app_space_view_is_showing?"/app-space":"/messages/"+TS.model.c_name_in_url}(),s=TS.utility.refashionUrl(window.location.href,a,e,t);T(s,n)}var r=TS.model.ui_state.flex_name,o=TS.model.ui_state.flex_extra;TS.model.flex_name_in_url=e,TS.model.flex_extra_in_url=t,TS.model.ui_state.flex_name=e,TS.model.ui_state.flex_extra=t,TS.model.ui_state.prev_flex_name=r,TS.model.ui_state.prev_flex_extra=o,TS.storage.storeUIState(TS.model.ui_state),TS.client.flexpane_display_switched_sig.dispatch(r,o)},channelDisplaySwitched:function(e){var t=_.defaults({},e,{from_history:!1,replace_history_state:!1}),n=t.id;if(!n)return void TS.error("no model id supplied");var i=t.replace_history_state,a=t.no_history_add;if(!n)return TS.error("no model_ob_id?"),!1;var s=TS.shared.getModelObById(n);if(!s)return TS.error("unknown model_ob id: "+n),!1;var r=TS.utility.getChannelStringIdentifierForUrl(s),o=t.channel_path||"/messages/"+r;if(!a){var l=S(TS.model.flex_extra_in_url),d=TS.utility.refashionUrl(window.location.href,o,TS.model.flex_name_in_url,l);T(d,!TS.model.c_name_in_url||i)}if(TS.model.c_name_in_url=r,!TS.client.activeChannelIsHidden()){if(s.is_channel&&n==TS.model.active_channel_id)return TS.warn("not switching, it is the active channel already"),!1;if(s.is_im&&n==TS.model.active_im_id)return TS.warn("not switching, it is the active im already"),!1;if(s.is_mpim&&n==TS.model.active_mpim_id)return TS.warn("not switching, it is the active mpim already"),!1;if(s.is_group&&n==TS.model.active_group_id)return TS.warn("not switching, it is the active group already"),!1}TS.utility.msgs.checkForMsgsToTruncate(),TS.model.last_active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id,TS.model.active_channel_id=null,TS.model.active_im_id=null,TS.model.active_group_id=null,TS.model.active_mpim_id=null,TS.model.unread_view_is_showing=!1,TS.model.threads_view_is_showing=!1,TS.model.app_space_view_is_showing=!1,s.is_im?TS.model.active_im_id=n:s.is_mpim?TS.model.active_mpim_id=n:s.is_group?TS.model.active_group_id=n:s.is_channel&&(TS.model.active_channel_id=n),TS.model.active_cid=TS.model.active_channel_id||TS.model.active_im_id||TS.model.active_group_id||TS.model.active_mpim_id,TSSSB.call("displayChannel",TS.model.active_cid),TS.view.updateTitleWithContext(),s.last_made_active=Date.now();var c=n;TS.has_pri[O]&&TS.log(O,c+" is now active");var u=TS.model.active_history,m=u.indexOf(c);return-1!=m&&u.splice(m,1),u.push(c),TS.has_pri[O]&&TS.log(O,u),TS.storage.storeActiveHistory(u),TS.useReactSidebar()&&TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem(c)),!0},unreadViewActivated:function(e,t){if(!t){var n=S(TS.model.flex_extra_in_url),i=TS.utility.refashionUrl(window.location.href,"/unreads",TS.model.flex_name_in_url,n);e||TS.model.unread_view_is_showing||TS.model.c_name_in_url||(e=!0),T(i,e)}return TS.model.unread_view_is_showing?(TS.warn("not switching, unread view is already active"),!1):(TS.client.threads.destroyThreadsView(),TS.model.threads_view_is_showing=!1,TS.client.app_space.destroyAppSpaceView(),TS.model.app_space_view_is_showing=!1,TS.apps.isAppSpaceEnabled()&&TS.client.ui.app_space.resetUI(),TS.client.archives.cancel(!0),TS.model.unread_view_is_showing=!0,TS.view.updateTitleWithContext(),!0)},threadsViewActivated:function(e,t){if(!t){var n=S(TS.model.flex_extra_in_url),i=TS.utility.refashionUrl(window.location.href,"/threads",TS.model.flex_name_in_url,n);e||TS.model.threads_view_is_showing||TS.model.c_name_in_url||(e=!0),T(i,e)}return TS.model.threads_view_is_showing?(TS.warn("not switching, threads view is already active"),!1):(TS.client.unread.isEnabled()&&(TS.client.unread.destroyUnreadView(),TS.model.unread_view_is_showing=!1),TS.model.threads_view_is_showing=!0,TS.client.app_space.destroyAppSpaceView(),TS.model.app_space_view_is_showing=!1,TS.apps.isAppSpaceEnabled()&&TS.client.ui.app_space.resetUI(),TS.client.archives.cancel(!0),TS.view.updateTitleWithContext(),!0)},appSpaceViewActivated:function(e,t){if(!t){var n=S(TS.model.flex_extra_in_url),i=TS.utility.refashionUrl(window.location.href,"/app-space",TS.model.flex_name_in_url,n);e||TS.model.app_space_view_is_showing||TS.model.c_name_in_url||(e=!0),T(i,e)}return TS.model.app_space_view_is_showing?(TS.warn("not switching, app space view is already active"),!1):(TS.client.unread.isEnabled()&&(TS.client.unread.destroyUnreadView(),TS.model.unread_view_is_showing=!1),TS.client.threads.destroyThreadsView(),TS.model.threads_view_is_showing=!1,TS.client.archives.cancel(!0),TS.model.app_space_view_is_showing=!0,TS.view.updateTitleWithContext(),!0)},calculateInitialCid:function(){return v()},calculateInitialMessage:function(){return b()},startCheckingForCleanup:function(){p()},complianceExportStartChanged:function(){m()},onFirstLoginMS:function(){if(B("timing-www-perceived-load"),C(),f(),setInterval(TS.client.markLastReadsWithAPI,5e3),p(),TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.add(o):TS.ms.connected_sig.add(o),TS.channels.renamed_sig.add(a),TS.groups.renamed_sig.add(i),TS.members.changed_name_sig.add(r),TS.members.changed_account_type_sig.add(s),TS.view.members.unknown_resolution_rebuild_sig.add(r),TS.prefs.box_enabled_changed_sig.add(c),TS.prefs.dropbox_enabled_changed_sig.add(u),TS.prefs.compliance_export_start_changed_sig.add(m),TS.prefs.team_disallow_public_file_urls_changed_sig.add(h),TS.model.team.prefs.compliance_export_start&&m(),TS.model.mac_ssb_version&&!TS.model.prefs.no_macssb1_banner&&TS.prefs.setPrefByAPI({name:"no_macssb1_banner",value:!0}),window.winssb&&!TS.model.prefs.no_winssb1_banner&&TS.prefs.setPrefByAPI({name:"no_winssb1_banner",value:!0}),1==TS.qs_args.halt_at_loading_screen)throw new Error("Intentionally halting at loading screen");TS._incremental_boot&&TS.client.ui&&TS.client.ui.$messages_input_container&&TS.client.ui.$messages_input_container.addClass("pretend-to-be-online"),$("#loading_welcome").transition({opacity:0},200,function(){$("#col_channels_bg").css("z-index",0),$("#loading-zone").transition({opacity:0},200,function(){if($("body").removeClass("loading"),TS.view.resizeManually("onFirstLoginMS"),$("#loading-zone, #loading_zone_styles").remove(),l(),TS.model.initial_msg_ts){var e=TS.shared.getActiveModelOb();e&&e.id&&TS.client.ui.tryToJump(e.id,TS.model.initial_msg_ts,TS.model.initial_thread_ts)}})});var e=TS.shared.getActiveModelOb(),t=e&&e.msgs&&(e.msgs.length>0||null===e.latest);TS.client.archives.current_model_ob||(t?(TS.metrics.mark("content_visible"),TS.metrics.measure("client_content_visible_4","start_nav","content_visible")):e&&(TS.client.ui.record_content_visible_metric_after_fetching_model_ob=e.id)),TS.experiment&&TS.experiment.getGroup("perf_aa",["client_total_load","beachballs"])},onEveryLoginMS:function(e){var n=TS.shared.getActiveModelOb(),i=TS.shared.getControllerForModelOb(n);window.desktop&&desktop.teams&&desktop.teams.setTeamLocale&&desktop.teams.setTeamLocale(TS.i18n.locale()),n&&!n.history_is_being_fetched&&TS.shared.checkInitialMsgHistory(n,i),TS.model.ms_logged_in_once||(TS.warn(Date.now()-TS.boot_data.start_ms+"ms from first html to login_sig.dispatch()"),TS.client.before_login_sig.dispatch(),TS.client.login_sig.dispatch()),TS.useReactMessages()||(TS.isPartiallyBooted()?e._incremental_boot_users_counts_resp&&(t=e._incremental_boot_users_counts_resp,k(t)):t?(k(t),t=void 0):y()),TS.model.ims.forEach(function(e){e.id!=TS.model.active_im_id&&(e.is_open||TS.shared.hasUnreads(e))&&TS.shared.checkInitialMsgHistory(e,TS.ims,!0)}),TS.model.channels.forEach(function(e){e.id!=TS.model.active_channel_id&&e.is_member&&TS.shared.checkInitialMsgHistory(e,TS.channels,!0)}),TS.model.groups.forEach(function(e){e.id!=TS.model.active_group_id&&(e.is_archived||TS.shared.checkInitialMsgHistory(e,TS.groups,!0))}),TS.model.mpims.forEach(function(e){e.id!=TS.model.active_mpim_id&&(e.is_archived||(e.is_open||TS.shared.hasUnreads(e))&&TS.shared.checkInitialMsgHistory(e,TS.mpims,!0))})},handleDeepLink:function(e){if(e=decodeURIComponent(e),TS.info("handleDeepLink url:"+e),e&&e.indexOf&&-1!=e.indexOf("://")&&-1!=e.indexOf("?")){var t=e.split("?"),n=t[0].split("://")[1];if(TS.info("handleDeepLink cmd:"+n),n){var i=t[1];TS.info("handleDeepLink qs:"+i);var a=TS.utility.url.queryStringParse(i);TS.info("handleDeepLink qs_args:"+JSON.stringify(a,null,2)),TS.client._handleParsedDeepLink(n,a)}}},handleDeepLinkWithArgs:function(e){TS.info("handleDeepLinkWithArgs string:"+e);var t=TS.utility.parseJSONOrElse(e,null);if(t){var n=t.cmd;n&&(delete t.cmd,TS.client._handleParsedDeepLink(n,t))}},_handleParsedDeepLink:function(e,t){if(t.team){if(t.team!=TS.model.team.id)return void TS.generic_dialog.alert(TS.i18n.t("You tried to perform an action on a team youre not yet logged into! Sorry, no can do :/","client")());var n,i=t.id;if("channel"===e)return(n=TS.shared.getModelObById(i))?void TS.client.ui.tryToJump(n.id,t.message,t.thread_ts):TS.error(i+" is not a recognized channel/dm/group");if("user"===e){if(!TS.members.getMemberById(i))return TS.error(i+" is not a recognized member");TS.client.ui.previewMember(i);var a=TS.ims.getImByMemberId(i);return a?(n=TS.shared.getModelObById(a.id))?void TS.client.ui.tryToJump(n.id,t.message):TS.error(a+" is not a recognized dm"):TS.error("Could not get im channel for user "+i)}if("file"===e)return void TS.client.ui.files.previewFile(i);"team"===e&&(i?TS.client.ui.previewMember(i):TS.client.ui.showTeamList())}},manualReconnectNow:function(){TS.isSocketManagerEnabled()?TS.interop.SocketManager.reconnectImmediately():TS.ms.manualReconnectNow()},apiPaused:function(e){var t;if(e.reason.API_ERROR)t=TS.i18n.t('Were having trouble connecting to Slack. Well try again shortly, or you can <a onclick="TS.client.manualReconnectNow()">try now</a>.',"client")();else if(e.reason.SERVICE_DOWN){var n="https://status.slack.com/"+_.escape(_.get(TS.model,"team.prefs.custom_status_site",""));t=TS.i18n.t('Slack is unavailable, but dont worry  were on the case. <a href="{status_uri}">Check our status page</a> for updates.',"client")({status_uri:n})}else e.reason.OFFLINE&&(t=TS.i18n.t('Your computer seems to be offline. Well keep trying to reconnect, or you can <a onclick="TS.client.manualReconnectNow()">try now</a>.',"client")());TS.model.ms_logged_in_once?($("#connection_div").html(t).removeClass("hidden"),TS.client.msg_pane.topMessagesBannerShown()):($("#loading_message_attribution").empty(),$("#loading_message_attribution_img").remove(),$("#loading_welcome_msg").html(t))},apiUnpaused:function(){TS.model.ms_logged_in_once?($("#connection_div").html("").addClass("hidden"),TS.client.msg_pane.topMessagesBannerHidden()):($("#loading_message_attribution").empty(),$("#loading_message_attribution_img").remove(),$("#loading_welcome_msg").html(TS.i18n.t("Trying to log in again.","client")()))},displayModelObById:function(e){var t=TS.shared.getModelObById(e);t&&TS.client.displayModelOb(t)},displayModelOb:function(e){return e.presence?TS.ims.startImByMemberId(e.id):e.is_im?TS.ims.startImById(e.id):e.is_mpim?TS.mpims.displayMpim({id:e.id}):e.is_group?TS.groups.displayGroup({id:e.id}):e.is_channel?TS.channels.displayChannel({id:e.id}):void 0},activateMsgRateLimit:function(e){TS.model.is_msg_rate_limited||(e||(e={}),TS.model.is_msg_rate_limited=!0,e.notify_user&&TS.client.ui.addEphemeralBotMsg({text:TS.i18n.t("To stop overzealous bots from flooding channels, Slack sets a limit on flurries of messages. You are reading this, so you are not a bot. And yet  somehow  you hit this limit.","client")(),ephemeral_type:"disconnected_feedback",slackbot_feels:"sad_surprise"}))},deactivateMsgRateLimit:function(){TS.model.is_msg_rate_limited&&(TS.model.is_msg_rate_limited=!1)},userAddedToTeam:function(e){if(TS.info("You have been added to a team with the ID of "+e+"."),TS.model.is_our_app&&TS.model.is_electron){var t={user_id:TS.model.user.id,enterprise_id:TS.model.enterprise.id,team_ids:e};if(!TS.shared.isRelevantTeam())return void TS.info("This team is not relevant, ignoring user_added_to_team for "+e+".");TS.info("Attempting to sign in to team with ID of "+e,t);var n=TSSSB.call("getSignedInTeamIds");if(!n||!n.length)return void TS.warn("WTF no signed-in team IDs from app?",n);if(-1!==n.indexOf(e))return TS.info("User is already signed into team "+e+". Exiting."),void(F=_.union(F,[e]));TS.info("calling enterprise.teams.signin for team_id = "+e,t),TS.api.call("enterprise.teams.signin",t).then(function(t){var n=t.data.teams;if(!n||!n.length)return void TS.warn("WTF no authed_teams from enterprise.teams.signin?");var i;_.each(n,function(t){if(t&&t.team_id==e){var n=document.domain.split(".").splice(1).join(".");i={name:TS.model.user.name,id:TS.model.user.id,team_id:e,team_name:t.team_name,team_url:"https://"+t.team_domain+"."+n}}}),i?(TS.info("calling TSSSB didSignIn with app_params",i),TSSSB.call("didSignIn",i)):TS.warn("WTF did not find matching authed team?",n)})}},userRemovedFromTeam:function(e){if(e!==TS.model.team.id)return void TS.info("You have been removed from the team with ID = "+e+".");TS.model._user_removed_from_team||(TS.model._user_removed_from_team=!0,TS.generic_dialog.start({body:"<p>"+TS.i18n.t("You have been removed from the <strong>{team_name}</strong> team.","client")({team_name:_.escape(TS.model.team.name)})+"</p>",show_cancel_button:!1,esc_for_ok:!0,go_button_text:TS.i18n.t("OK","client")(),onGo:function(){if(_.includes(F,e))return TS.info("Was going to remove this team, but we were told to add them before the user hit ok to the original removal event."),void(F=_.remove(F,function(t){return t===e}));TS.model.is_our_app?(TS.info("calling TSSSB.signOutAndRemoveTeam because user_removed_from_team with team_id = "+e),TSSSB.signOutAndRemoveTeam(e)):TS.reload(null,"user_removed_from_team with team_id = "+e)}}))},activeChannelIsHidden:function(){return TS.model.unread_view_is_showing||TS.model.threads_view_is_showing||TS.model.app_space_view_is_showing},setClientLoadWatchdogTimer:function(){null!==x&&(E("www-load-watchdog-v2",I),I*=2),I<3e5&&(x=window.setTimeout(TS.client.setClientLoadWatchdogTimer,I))},showConnectionTroubleDialog:function(){var e;e=TS.model.is_our_app?TS.i18n.t("Weve seen this problem clear up with a restart of Slack, a solution which we suggest to you now only with great regret and self-loathing.","ms")():TS.i18n.t("Weve seen this problem clear up with a restart of your browser, a solution which we suggest to you now only with great regret and self-loathing.","ms")();var t=TS.i18n.t("Connection trouble","ms")();TS.generic_dialog.start({title:t,body:TS.i18n.t("<p>Apologies, were having some trouble with your WebSocket connection.</p>","ms")()+"<p>"+e+"</p>",show_cancel_button:!1,go_button_text:TS.i18n.t("OK","ms")(),esc_for_ok:!0}),(TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig:TS.ms.connected_sig).addOnce(function(){TS.generic_dialog.is_showing&&_.get(TS.generic_dialog.current_setting,"title")===t&&TS.generic_dialog.cancel()})}});var t,n,i=function(e){e.id==TS.model.active_group_id&&(TS.client.activeChannelIsHidden()||TS.client.channelDisplaySwitched({id:e.id,replace_history_state:!0}))},a=function(e){e.id==TS.model.active_channel_id&&(TS.client.activeChannelIsHidden()||TS.client.channelDisplaySwitched({id:e.id,replace_history_state:!0}))},s=function(e){if(e&&e.id==TS.model.user.id){var t;t=e.is_ultra_restricted?TS.i18n.t("Your account permissions have changed! You are now a single-channel guest of the team. You must now reload for the changes to take effect.","client")():e.is_restricted?TS.i18n.t("Your account permissions have changed! You are now a multi-channel guest of the team. You must now reload for the changes to take effect.","client")():TS.i18n.t("Your account permissions have changed! You are now a full member of the team. You must now reload for the changes to take effect.","client")(),TS.generic_dialog.start({title:TS.i18n.t("Reload required","client")(),body:"<p>"+t+"</p>",show_cancel_button:!1,esc_for_ok:!0,go_button_text:TS.i18n.t("Reload","client")(),onGo:function(){TS.reload()}})}},r=function(e){if(TS.model.active_im_id&&e){var t=TS.ims.getImByMemberId(e.id);if(!t||t.id!=TS.model.active_im_id)return;TS.client.channelDisplaySwitched({id:t.id,replace_history_state:!0})}else if(TS.model.active_mpim_id&&e&&e.id){var n=TS.mpims.getMpimById(TS.model.active_mpim_id);if(!n||!e)return;var i=TS.membership.getUserChannelMembershipStatus(e.id,n),a=i.is_known&&!i.is_member;if(a)return;TS.client.channelDisplaySwitched({id:n.id,replace_history_state:!0})}},o=function(){TS.ims.checkForOldImsToClose(),TS.shared&&(TS.has_pri[P]&&TS.log(P,"_socketConnected: calling TS.shared.maybeResetHistoryFetchedOnAll"),TS.shared.maybeResetHistoryFetchedOnAll())},l=function(){var e=TS.qs_args.open;e&&("create_channel"===e?(TS.model.ms_connected||TS.model.change_channels_when_offline)&&(TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups())&&TS.ui.new_channel_modal.start():"invite_members"===e?(TS.model.user.is_admin||!TS.model.team.prefs.invites_only_admins&&!TS.model.user.is_restricted)&&TS.ui.admin_invites.start():"notifications"===e?TS.ui.prefs_dialog.start("notifications"):"help"===e?TS.help_modal.start():"channel_membership"===e&&TS.client.channel_page.members_dialog.show(TS.shared.getActiveModelOb()),T(TS.utility.url.removeUrlQueryStringValue(location.href,"open"),!0))},d=function(e,t,n,i){var a,s,r=e;document.getElementById(r)||(s=document.getElementsByTagName("head"),s=s&&s[0]?s[0]:document.body,a=document.createElement("script"),a.setAttribute("async",!0),t&&a.setAttribute("data-app-key",t),a.id=r,a.src=n,s?s.appendChild(a):TS.logError&&TS.logError({message:i},"No target_node for TS.client._dynamicallyLoadJS"))},c=function(){if(!window.BoxSelect&&TS.model.prefs.box_enabled&&boot_data.box_js_url){var e=boot_data.box_app_key,t=boot_data.box_js_url;d("boxjs",e,t,"_boxEnabledChanged: Could not append box script node")}},u=function(){if(!window.Dropbox&&TS.model.prefs.dropbox_enabled&&boot_data.dropbox_js_url){var e=boot_data.dropbox_app_key,t=boot_data.dropbox_js_url;d("dropboxjs",e,t,"_dropboxEnabledChanged: Could not append dropbox script node")}},m=function(){var e,t,n=$(".show_when_ce_enabled"),i=$(".show_when_ce_disabled"),a=$(".js_compliance_export_start");TS.model.team.prefs.compliance_export_start?(a.html(TS.interop.datetime.toDate(TS.model.team.prefs.compliance_export_start)),n.removeClass("hidden"),i.addClass("hidden")):(n.addClass("hidden"),i.removeClass("hidden")),(e=TS.shared.getActiveModelOb())&&(t=TS.members.getMemberById(e.user))&&e.is_im&&$("#im_meta").html(TS.templates.dm_badge({member:t,model_ob:e,compliance_exports_enabled_for_team:!!TS.model.team.prefs.compliance_export_start}))},h=function(){TS.model.team.prefs.disallow_public_file_urls&&($(".file_public_link").remove(),$("#file_public_link_revoker").remove())},p=function(){setInterval(function(){TS.model.ms_connected&&TS.ims.checkForOldImsToClose(),TS.utility.msgs.checkForMsgsToTruncate()},9e5)},g=function(){TS.ui.fs_modal.is_showing&&TS.ui.fs_modal.close(),TS.ui.jumper.is_showing&&TS.ui.jumper.end();var e=history.location||document.location;TS.qs_args=TS.utility.url.queryStringParse(e.search.substring(1));var t=TS.utility.isUnreadViewPath(e.pathname),n=TS.utility.isThreadsViewPath(e.pathname),i=TS.utility.isAppSpaceViewPath(e.pathname),a=TS.utility.getFlexNameFromUrl(e.href),s=TS.utility.getFlexExtraFromUrl(e.href);t||n||i||TS.model.ui_state.flex_name||!TS.model.ui_state.details_tab_active?(a=TS.model.ui_state.flex_name,s=TS.model.ui_state.flex_extra):(a="details",s=""),(t||n||i)&&"details"===a&&(a="",s="");var r=TS.utility.getChannelNameFromUrl(e.href),o=r.split(":");r=o[0];var l=o.length>1?o[1]:"";if(TS.model.channels){var d,c,_,u,m,h,p=!1;_=TS.shared.getModelObById(r),_&&(d=_.id,(TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client)&&_.is_im?c=_:_.is_mpim?h=_:_.is_channel?u=_:_.is_group&&(m=_)),!d&&r&&(u=TS.channels.getChannelByName(r),u?d=u.id:-1!=r.indexOf("@")&&(c=TS.ims.getImByUsername(r))&&(d=c.id),d||(m=TS.groups.getGroupByName(r))&&(d=m.id),d||(h=TS.mpims.getMpimByName(r))&&h.is_open&&(d=h.id)),TS.info("_onPopState\nc_extra from new url:"+l+"\nflex_name from new url:"+a+"\nflex_extra from new url:"+s),d?(p=!0,TS.info("c_name from new url is good, using id = "+d)):t||n||i||(TS.model.channels.length&&(u=TS.channels.getFirstChannelYouAreIn())&&(d=u.id,TS.info("got getFirstChannelYouAreIn:"+d)),!d&&TS.model.ims.length&&(c=TS.ims.getFirstOpenIm())&&(d=c.id,TS.info("got getFirstOpenIm:"+d))),TS.boot_data.feature_prev_next_button&&(TS.model.nav_used=!0),c?TS.ims.startImByMemberId(c.user,!0):u?TS.channels.displayChannel({id:u.id,from_history:!0,replace_history_state:!p}):m?TS.groups.displayGroup({id:m.id,from_history:!0,replace_history_state:!p}):h?TS.mpims.displayMpim({id:h.id,from_history:!0,replace_history_state:!p}):t?TS.client.unread.showUnreadView(!0,!0):n?TS.client.threads.showThreadsView(!0,!0):i?TS.client.app_space.showAppSpaceView(!0,!0):TS.error("WTF DONT KNOW WHAT TO DO"),TS.client.ui.flex.setFlexStateFromHistory(a,s);var g=function(){return t?"/unreads":n?"/threads":i?"/app-space":"/messages/"+r}(),f=TS.utility.refashionUrl(window.location.href,g,a,s);T(f,!0)}},f=function(){if(!TS.model.initial_cid)return void TS.error("TS.model.initial_cid was empty when _switchToInititalModelOb was called, which should be impossible");var e=TS.shared.getModelObById(TS.model.initial_cid);e||TS.error("TS.model.initial_cid ("+TS.model.initial_cid+") referred to a channel that does not exist in _switchToInititalModelOb, which should be impossible");if(e.is_im?e.is_open?TS.client.channelDisplaySwitched({id:e.id,replace_history_state:!0}):TS.ims.startImByMemberId(e.user,!0):e.is_mpim?TS.mpims.displayMpim({id:e.id,replace_history_state:!0}):e.is_group&&!e.is_mpim?TS.groups.displayGroup({id:e.id,replace_history_state:!0}):e.is_channel&&TS.client.channelDisplaySwitched({id:e.id,replace_history_state:!0}),TS.model.initial_unread_view&&TS.model.prefs.enable_unread_view){TS.client.unread.showUnreadView(!1,!0,!0)}TS.model.initial_threads_view&&TS.client.threads.showThreadsView(!1,!0),TS.model.initial_app_space_view&&TS.client.app_space.showAppSpaceView(!1,!0),TS.boot_data.feature_prev_next_button&&(TS.client.nav_history.initialSetup(),TS.client.nav_history.updateNavHistory())},S=function(e){return e?(-1!=e.indexOf("#")&&(e=e.replace(/#/g,"%23")),-1!=e.indexOf("/")&&(e=e.replace(/\//g,"%252F")),e):e},T=function(e,t){if(!history.pushState)return void TS.warn("This browser does not support pushState.");window.location.href.replace(/%20/g," ")!==e.replace(/%20/g," ")&&(t?window.history.replaceState(null,null,e):window.history.pushState(null,null,e))},v=function(){if(TS.model.initial_cid)return void(TS.boot_data.feature_archive_deeplink&&TS.client.calculateInitialMessage());var e,t,n,i,a,s,r,o=TS.storage.fetchActiveHistory();for(!window.location.pathname.match(/^\/(message|unreads|threads|app-space)/)&&window.history&&window.history.replaceState(null,null,window.location.origin+"/messages"),function(){if(!TS.model.welcome_model_ob||!TS.model.welcome_model_ob.id){var e=TS.ims.getImByMemberId("USLACKBOT");if(e)TS.model.welcome_model_ob=e;else{TS.error("Tried to lookup Slackbot but failed");var t="im.open";TS.boot_data.feature_shared_channels_beta&&(t="conversations.open"),TS.api.callImmediately(t,{user:"USLACKBOT"}).finally(function(){var e=TS.i18n.t("Slack has encountered a problem and needs to reload.","client")(),t=TS.i18n.t("Reload required","client")(),n=TS.i18n.t("Reload","client")();return TS.generic_dialog.alert(e,t,n)}).then(function(){TS.reload()})}}}(),t=0;t<o.length;t+=1)e=o[t],TS.model.active_history.indexOf(e)>-1||(r=TS.shared.getModelObById(e))&&(r.is_im&&r.is_open?TS.model.active_history.push(e):r.is_mpim&&r.is_open?TS.model.active_history.push(e):r.is_group&&!r.is_archived?TS.model.active_history.push(e):!r.is_channel||r.is_archived||TS.model.user.is_restricted||TS.model.active_history.push(e));TS.model.c_name_in_url=TS.utility.getChannelNameFromUrl(location.href);var l=TS.model.c_name_in_url,d=TS.utility.isUnreadViewPath(location.pathname),c=TS.utility.isThreadsViewPath(location.pathname),u=TS.utility.isAppSpaceViewPath(location.pathname);d&&(TS.model.initial_unread_view=!0),c&&(TS.model.initial_threads_view=!0),u&&(TS.model.initial_app_space_view=!0);if(TS.model.initial_cid=function(){if(l){if(n=TS.channels.getChannelByName(l))return n.id;if(a=TS.ims.getImByUsername(l))return a.id;if(i=TS.groups.getGroupByName(l))return i.id;if(s=TS.mpims.getMpimByName(l))return s.id}if(TS.model.active_history.length&&(e=TS.model.active_history[TS.model.active_history.length-1],r=TS.shared.getModelObById(e)))return e;var o;if(TS.model.user.is_restricted){var d=TS.model.channels;for(d.sort(function(e,t){return e._name_lc>t._name_lc?1:t._name_lc>e._name_lc?-1:0}),t=0;t<d.length;t+=1)if(n=d[t],!n.is_archived&&n.is_member)return n.id;var c=TS.model.groups;for(c.sort(function(e,t){return e._name_lc>t._name_lc?1:t._name_lc>e._name_lc?-1:0}),t=0;t<c.length;t+=1)if(i=c[t],!c.is_archived)return i.id;if(o=TS.ims.getImByMemberId("USLACKBOT"))return o.id}else{if(TS.model.user.is_primary_owner&&!TS.model.prefs.newxp_seen_last_message&&(o=TS.ims.getImByMemberId("USLACKBOT")))return o.id;var u=TS.channels.getGeneralChannel();if(u)return u.id;TS.info("No general channel?! Known channel IDs:",_.map(TS.model.channels,"id"));var m=TS.ims.getImByMemberId("USLACKBOT");if(m)return TS.info("Using IM with Slackbot ("+m.id+") as our initial model object"),m.id}alert(TS.i18n.t("ERROR could not find starting channel","client")())}(),!TS.model.initial_cid){var m="TS.client.calculateInitialCid() failed to find a channel";throw TS.error(m),new Error(m)}TS.boot_data.feature_archive_deeplink&&TS.client.calculateInitialMessage()},b=function(){TS.model.initial_msg_ts||(TS.model.initial_msg_ts=TS.utility.getMessageTimestampFromUrl(location.href),TS.model.initial_thread_ts=TS.qs_args.thread_ts)},w=function(e,t){var n;e.forEach(function(e){var i=t(e);if(!i)return void TS.warn("users.counts returned data for a model_ob we don't know about",e.id);if(!i.is_archived||i.is_member){n=n||TS.shared.getControllerForModelOb(i),i._latest_via_users_counts=e.latest,TS.shared.setUserCountsInfoForId(i.id,e);var a=parseInt(i.unread_cnt,10),s=parseInt(i.unread_highlight_cnt,10),r=e.has_unreads?1:0;i.is_im||i.is_mpim?i.unread_cnt=e.unread_count_display||e.dm_count||r:(i.unread_cnt=r?Math.max(i.unread_cnt,e.unread_count_display||e.dm_count||r):e.unread_count_display||e.dm_count||r,i.unread_highlight_cnt=e.mention_count_display||0);var o=TS.notifs.isCorGMuted(i.id);if(!n)return void TS.warn("Unable to figure out controller for model_ob with id="+i.id);if(!i.msgs.length||i.unread_cnt===a&&i.unread_highlight_cnt===s||(TS.has_pri[P]&&TS.log(P,'msgs exist, calculating unreads for "'+i.id+'"'),n.calcUnreadCnts(i,!1)),i.unread_cnt===a||o||(TS.has_pri[P]&&TS.log(P,'unread count has changed for "'+i.id+'", from '+a+" to "+i.unread_cnt),n.unread_changed_sig.dispatch(i)),i.unread_highlight_cnt!==s&&(TS.has_pri[P]&&TS.log(P,'unread highlight count has changed for "'+i.id+'", from '+s+" to "+i.unread_highlight_cnt),n.unread_highlight_changed_sig.dispatch(i)),o){i.unread_highlight_cnt||(i.unread_cnt=0,n.markMostRecentReadMsg(i,TS.model.marked_reasons.none_qualify));var l=!0;TS.has_pri[P]&&TS.log(P,"we have a muted channel: "+i.id),"hide_read_channels"===TS.model.prefs.sidebar_behavior?(TS.has_pri[P]&&TS.log(P,"user pref is to HIDE READ CHANNELS"),i.unread_cnt||i.unread_highlight_cnt?(TS.has_pri[P]&&TS.log(P,i.id+" has unreads."),l=!1):(TS.has_pri[P]&&TS.log(P,i.id+" has no unreads"),i.id==TS.model.active_cid?(TS.has_pri[P]&&TS.log(P,i.id+" is currently being viewed. showing even though no unreads."),l=!0):(TS.has_pri[P]&&TS.log(P,i.id+" is not the active channel. no unreads, can be hidden."),l=!1))):"hide_read_channels_unless_starred"===TS.model.prefs.sidebar_behavior&&(TS.has_pri[P]&&TS.log(P,"user pref is to HIDE READ CHANNELS UNLESS STARRED"),i.unread_cnt||i.unread_highlight_cnt?(TS.has_pri[P]&&TS.log(P,i.id+" has unreads."),l=!1):(TS.has_pri[P]&&TS.log(P,i.id+" has no unreads"),i.is_starred?(TS.has_pri[P]&&TS.log(P,i.id+" IS STARRED - showing even though no unreads."),l=!0):i.id==TS.model.active_cid?(TS.has_pri[P]&&TS.log(P,i.id+" is currently being viewed. showing even though no unreads."),l=!0):(TS.has_pri[P]&&TS.log(P,i.id+" is not the active channel. no unreads, can be hidden."),l=!1))),i._show_in_list_even_though_no_unreads=l,o&&!i.unread_highlight_cnt&&TS.shared.maybeMarkReadIfMuted(i,n)}if(i.unread_cnt||i.unread_highlight_cnt){if(!TS.client.history_prefetch)return void TS.warn("WTF no TS.client.history_prefetch module?");TS.client.history_prefetch.addToHistoryFetchQueue(i.id)}}})},y=function(){var e={mpim_aware:!0,only_relevant_ims:!0,simple_unreads:!0,include_threads:!0};TS.api.callImmediately("users.counts",e).then(k)},k=function(e){TS.client.history_prefetch&&TS.client.history_prefetch.resetHistoryFetchQueue();var t=0,n=0;w(e.data.channels,function(e){return TS.channels.getChannelById(e.id)||TS.groups.getGroupById(e.id)}),w(e.data.groups,function(e){return e.is_mpim?TS.mpims.getMpimById(e.id):TS.groups.getGroupById(e.id)}),w(e.data.ims,function(e){return e.has_unreads&&(t+=1),e.dm_count&&(n+=e.dm_count),TS.ims.getImById(e.id)}),w(e.data.mpims,function(e){if(e.is_mpim)return TS.mpims.getMpimById(e.id)});var i=e.data.threads;return i&&(TS.client.threads.setThreadsUnreadData(i.has_unreads,i.mention_count),TS.client.threads.logThreadState("users.counts: "+!!i.has_unreads+" "+i.mention_count)),TS.client.history_prefetch&&TS.client.history_prefetch.processHistoryFetchQueue(),TS.info("Finished processing users.counts"),TS.info(t+" IMs with unreads, "+n+" total dm_count"),null},A=function(){if(!JSON._shimmed){JSON._shimmed=!0;var e=JSON.parse;JSON.parse=function(t){var n=performance.now(),i=e.apply(this,arguments),a=performance.now()-n;return a>1&&TS.info("JSON parsing: "+_.toString(t).length+" bytes took "+_.round(a,2)+" ms"),i};var t=JSON.stringify;JSON.stringify=function(){var e=performance.now(),n=t.apply(this,arguments),i=performance.now()-e;return i>1&&TS.info("JSON stringify into "+n.length+" bytes took "+_.round(i,2)+" ms"),n}}},C=function(){return n=TS.client&&(TS.qs_args.enhanced_debugging||TS.model.prefs.enhanced_debugging),"0"===TS.qs_args.enhanced_debugging&&(n=!1),!!n&&(e(),A(),M(),!0)},M=function(){if(TS.model.is_our_app){var e,t;window.addEventListener("sleep",function(){e||(e=setInterval(function(){TS.info("Debug tick")},1e3))},!1),window.addEventListener("wake",function(){t||(TS.info("Will stop debug ticking in 300 seconds"),t=setTimeout(function(){clearTimeout(e),t=void 0,e=void 0,TS.info("Stopping debug ticking")},3e5))},!1)}},x=null,I=1e4,E=function(e,t){},B=function(e){window.clearTimeout(x),window.performance&&performance.timing&&E(e,Date.now()-window.performance.timing.navigationStart)},D=function(){var e="dev"===TS.boot_data.version_ts?5:43200;TSSSB.call("setTeamIdleTimeout",e)},F=[],P=58,O=4}()},2407:function(e,t){!function(){"use strict";function e(){r=!0,a=0,i=[],s=0;var e,t=performance.now(),n=0,_=function _(){if(r){var m=performance.now(),h=m-t;if(t=m,h>c?(a+=1,o+=1):h>d&&(s+=1,l+=1),0===n&&(e=m),(n+=1)===u){var p=(m-e)/1e3,g=Math.floor(n/p);n=0,TS.debug_widget&&TS.debug_widget.isVisible()&&TS.debug_widget.setFrameRate(g),i.push(g)}requestAnimationFrame(_)}};requestAnimationFrame(_)}function t(){if(TS.metrics.count("stutters",s),TS.metrics.count("beachballs",a),!_.isEmpty(i)){var e,t=_.min(i),n=i.sort(),r=Math.floor(n.length/2);e=n.length%2==1?n[r]:(n[r-1]+n[r])/2,TS.metrics.store("fps_min",t),TS.metrics.store("fps_median",e)}s=void 0,a=void 0,i=void 0}function n(){r=!1}TS.registerModule("client.stats.responsiveness",{onStart:function(){TS.client.login_sig.addOnce(function(){if(!TS.client.isEnhancedDebuggingEnabled()){if(!_.isFunction(window.requestAnimationFrame))return void TS.warn("Unable to install beachball detector without requestAnimationFrame");if(!window.performance)return void TS.warn("Unable to install beachball detector without performance");TS.client.stats.start_collecting_sig.add(e),TS.client.stats.stop_collecting_sig.add(function(){t(),n()}),(TS.client.stats.isEnabled()||TS.client.stats.isCollectingInitialTimePeriodStats())&&(e(),TS.client.stats.initial_time_period_collection_finished_sig.add(function(){TS.client.stats.isEnabled()||n()})),window.addEventListener("sleep",function(){r&&n()})}})},isEnabled:function(){return!!r},getTotalBeachballCount:function(){return o},getTotalStutterCount:function(){return l}});var i,a,s,r=!1,o=0,l=0,d=100,c=1e3,u=300}()},2408:function(e,t){!function(){"use strict";TS.registerModule("client.stats",{start_collecting_sig:new signals.Signal,stop_collecting_sig:new signals.Signal,initial_time_period_collection_finished_sig:new signals.Signal,onStart:function(){TS.client.login_sig.addOnce(function(){if(d(),(TS.utility.enableFeatureForUser(i)||r||s)&&(o(),r||s||setInterval(o,a)),(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1))&&_.each(TS.boot_data,function(e,t){0===t.indexOf("feature_")&&TS.metrics.count(t+(e?"_on":"_off"))}),window.PerformanceObserver)try{var e=new window.PerformanceObserver(function(e){_.each(e.getEntries(),function(e){"longtask"===e.entryType&&((TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))&&TS.metrics.store(e.entryType,e.duration),TS.utility.enableFeatureForUser(5)&&TS.clog.track("PERF_LONGTASKS",{elapsed_time:e.duration}))})});window.PerformanceLongTaskTiming&&e.observe({entryTypes:["longtask"]})}catch(e){TS.console.logError(e,"perf_observer","client_error",!0)}})},isEnabled:function(){return r&&"1"===TS.qs_args.client_stats||!!t},isCollectingInitialTimePeriodStats:function(){return!!e}});var e,t,n,i=50,a=6e5,s=!!TS.has_pri[p],r=TS.qs_args.hasOwnProperty("client_stats"),o=function(){var e,i=!!t;r||s?(e="1"==TS.qs_args.client_stats||s,TS.has_pri[p]&&TS.log(p,"client.stats: enabled? "+e+" set by "+(s?"user in debug prefs":"query parameter"))):e=TS.utility.enableFeatureForUser(1),TS.has_pri[p]&&TS.log(p,"client.stats: enabled now? "+i+"; should be enabled? "+e),e!==i&&(e?(n={},n.rb_all=0,n.rb_all_but=0,n.rb_msgs=0,n.up_member=0,t=setInterval(l,6e4),TS.client.ui.did_rebuild_all_sig.add(c),TS.client.ui.did_rebuild_all_but_msgs_sig.add(u),TS.client.msg_pane.did_rebuild_msgs_sig.add(m),TS.members.member_was_upserted_sig.add(h),TS.client.stats.start_collecting_sig.dispatch()):(n=void 0,clearInterval(t),t=void 0,TS.client.ui.did_rebuild_all_sig.remove(c),TS.client.ui.did_rebuild_all_but_msgs_sig.remove(u),TS.client.msg_pane.did_rebuild_msgs_sig.remove(m),TS.members.member_was_upserted_sig.remove(h),TS.client.stats.stop_collecting_sig.dispatch()))},l=function(){_.each(n,function(e,t){TS.has_pri[p]&&TS.log(p,"client.stats: "+t+" = "+e),TS.metrics.store("cs_"+t,e,{allow_zero:!0,is_count:!0}),n[t]=0})},d=function(){if(TS.boot_data.feature_webapp_always_collect_initial_time_period_stats||TS.utility.enableFeatureForUser(1)){TS.has_pri[p]&&TS.log(p,"Will collect additional stats for the first "+_.round(10,1)+" minutes of this session"),TS._count_bytes_received=!0,TS._bytes_received=0;var t=0,n=function(){t+=1};TS.members.member_was_upserted_sig.add(n),e=setTimeout(function(){e=void 0,TS.info("Received "+TS._bytes_received+" bytes in the first "+_.round(10,2)+" minutes of the session"),TS.metrics.count("client_session_bytes_received",TS._bytes_received),TS.metrics.count("client_total_members_loaded",_.filter(TS.model.members,function(e){return _.isUndefined(e.is_unknown)||!_.get(e,"is_unknown")}).length),TS.metrics.count("client_total_member_upserts",t),TS.metrics.count("initial_beachballs",TS.client.stats.responsiveness.getTotalBeachballCount()),TS.metrics.count("initial_stutters",TS.client.stats.responsiveness.getTotalStutterCount()),TS._count_bytes_received=!1,TS.members.member_was_upserted_sig.remove(n),TS.client.stats.initial_time_period_collection_finished_sig.dispatch()},6e5)}},c=function(){n.rb_all+=1},u=function(){n.rb_all_but+=1},m=function(){n.rb_msgs+=1},h=function(){n.up_member+=1},p=1991}()},2409:function(e,t){!function(){"use strict";TS.registerModule("client.threads",{switched_sig:new signals.Signal,reply_count_changed:new signals.Signal,new_thread_reply_count_changed:new signals.Signal,threads_unread_changed:new signals.Signal,onStart:function(){TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.add(h):TS.ms.connected_sig.add(h),TS.channels.message_received_sig.add(C),TS.groups.message_received_sig.add(C),TS.ims.message_received_sig.add(C),TS.mpims.message_received_sig.add(C),TS.channels.message_removed_sig.add(A),TS.groups.message_removed_sig.add(A),TS.ims.message_removed_sig.add(A),TS.mpims.message_removed_sig.add(A),TS.channels.message_changed_sig.add(k),TS.groups.message_changed_sig.add(k),TS.ims.message_changed_sig.add(k),TS.mpims.message_changed_sig.add(k),TS.replies.sanity_check_failed_sig.add(Q),TS.replies.thread_subscription_changed_sig.add(F),TS.channels.joined_sig.add(j),TS.groups.joined_sig.add(j),TS.groups.left_sig.add(G),s=TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(1),e=new TS.PromiseQueue},showThreadsView:function(t,a){t=!!t,a=!!a;var s=!a&&t;return!!TS.client.threadsViewActivated(a,s)&&(TS.client.threads.switched_sig.dispatch(),TS.msg_edit.editing_in_msg_pane&&TS.msg_edit.resetEditUI(),TS.client.ui.threads.showThreadsView(),n?(TS.info("Starting threads view with local data"),i=z(),w(),TS.client.ui.threads.startWithData(n,o),R(l),g(i)):(TS.info("Starting threads view from the api"),e.addToQ(f)),!0)},destroyThreadsView:function(){$("#client-ui").hasClass("threads_view_is_showing")&&(TS.client.ui.threads.destroyThreadsView(),t&&t.isPending()&&t.cancel(),t=null,l=0,i=null,clearTimeout(r),!u&&n&&n.length||(u=!1,p()))},maybeReloadThreadsView:function(){TS.model.threads_view_is_showing&&(TS.client.ui.threads.resetUI(),e.addToQ(f))},getMessage:function(e,t){if(!n)return null;var i=null;return _.find(n,function(n){return n.model_ob.id==e.id&&(t==n.root_msg.ts?(i=n.root_msg,!0):!!(i=_.find(n.replies,{ts:t.toString()})))}),i},getThread:function(e,t){if(n)return _.find(n,function(n){return n.model_ob.id===e.id&&n.root_msg.ts===t})},getCurrentReplyCount:function(){return l||0},getNewThreadReplyCount:function(){var e=_.takeWhile(n,function(e){return L(e)});return e&&e.length?_.reduce(e,function(e,t){return e+_.reduce(t.replies,function(e,t){return t.ts>=i?e+1:e},0)},0):0},updateThreadState:function(e,t,n){var i=N();TS.client.threads.setThreadsUnreadData(e,t+i,n),TS.client.threads.logThreadState("update_thread_state: "+!!e+" "+(t+i)+" "+n)},setThreadsUnreadData:function(e,t,n){TS.model.threads_has_unreads=e,TS.model.threads_mention_count=t||0,TS.utility.msgs.countAllUnreads(),n&&(d=n),TS.client.ui.threads.updateChannelPaneUnreadState(TS.model.threads_has_unreads,TS.model.threads_mention_count),!TS.client.threads.hasUnreadThreads()&&TS.model.threads_view_is_showing&&TS.client.ui.threads.maybeRemoveNewRepliesBanner(),TS.client.threads.threads_unread_changed.dispatch()},setThreadsUnreadDataFromUsersCounts:function(e,t){TS.client.threads.setThreadsUnreadData(e,t),TS.client.threads.logThreadState("users.counts: "+!!e+" "+t)},markAllNewThreads:function(){_.forEach(n,function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(t&&t.subscribed){var n=t.last_read;(!n||n<e.ts)&&TS.replies.markThread(e.model_ob.id,e.root_msg.thread_ts,e.ts)}}),!TS.client.threads.hasUnreadThreads()&&TS.model.threads_view_is_showing&&TS.client.ui.threads.maybeRemoveNewRepliesBanner()},hasUnreadThreads:function(){return _.some(n,function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);if(t&&t.subscribed){var n=t.last_read;return!n||n<e.ts||void 0}})},showNewRepliesAndMarkThread:function(t,i){if(n){var a=TS.shared.getModelObById(t);if(a){var s=TS.client.threads.getThread(a,i);s&&e.addToQ(function(){if(TS.model.threads_view_is_showing){s.max_visible_ts=_.last(s.replies).ts,TS.client.ui.threads.revealNewReplies(s);var e=_.maxBy(s.replies,"ts").ts;return TS.replies.markThread(t,i,e),null}})}}},showPreviousReplies:function(t,i){if(n){var a=TS.shared.getModelObById(t);if(a){var s=TS.client.threads.getThread(a,i);if(s){var r,o=_.get(s,"replies.length")&&_.first(s.replies).ts,l=_.get(s,"root_msg.reply_count",0);if(o&&l>TS.replies.DEFAULT_HISTORY_API_LIMIT)r=TS.replies.getThreadBefore(t,i,o);else{r=TS.replies.getThreadLazy(t,i,!0)}return e.addToQ(function(){if(TS.model.threads_view_is_showing)return r.then(function(e){if(TS.model.threads_view_is_showing){var t=e.messages,n=1/0;s.replies&&s.replies.length&&(n=_.first(s.replies).ts),s.min_visible_ts=n,s.replies=s.replies.concat(_.reject(t,{ts:s.root_msg.ts})),s.replies=_.uniqBy(s.replies,"ts"),s.replies=_.sortBy(s.replies,"ts")}}),TS.client.ui.threads.revealPreviousReplies(s,r),r})}}}},loadMoreThreads:function(){return e.addToQ(S)},threadCompare:function(e,t){return"new"===e.grouping&&"old"===t.grouping?-1:"old"===e.grouping&&"new"===t.grouping?1:e.ts<t.ts?1:e.ts>t.ts?-1:0},maybeRerenderMessage:function(t,n){TS.model.threads_view_is_showing&&t&&n.thread_ts&&e.addToQ(function(){var e=TS.client.threads.getThread(t,n.thread_ts);e&&B(e,n)})},debugUnthreads:function(){var e="\n"+m.join("\n");TS.info(e)},logThreadState:function(e){TS.has_pri[K]&&TS.log(K,"unread thread state change: "+e);var t=TS.interop.datetime.toTime(Date.now()/1e3,{includeMeridiem:!1,includeSeconds:!0});m.unshift(t+" "+e),m=_.take(m,15)},getThreadsLoadedCount:function(){return n?n.length:0}});var e,t,n,i,a,s,r,o=!1,l=0,d="0000000000.000000",c=[],u=!1,m=[],h=function(e){e||(p(),TS.client.threads.maybeReloadThreadsView())},p=function(){e.clear(),n=null},g=function(e){TS.client.threads.hasUnreadThreads()?(TS.replies.markAllThreads(e),TS.model.threads_has_unreads||TS.metrics.count("threads_unread_inconsistency_no_local_unreads")):TS.model.threads_has_unreads&&(TS.metrics.count("threads_unread_inconsistency_has_local_unreads"),TS.warn("Correcting threads_has_unreads: was true but threads view has no new replies"),TS.client.threads.setThreadsUnreadData(!1,0),TS.client.threads.logThreadState("_markAllThreadsAfterLoading: false 0"))},f=function(){return s&&TS.metrics.mark("threads_view_time_to_fetch_and_display"),i=z(),clearTimeout(r),r=setTimeout(function(){TS.client.ui.threads.displaySlowLoadingMessage()},5e3),t=TS.api.call("subscriptions.thread.getView",{current_ts:i,limit:8}),t.then(T).then(function(e){var t=e.total_unread_replies,a=e.has_more;return TS.model.threads_view_is_showing&&TS.client.ui.threads.startWithData(n,a),R(t),TS.model.threads_view_is_showing&&g(i),s&&TS.metrics.measureAndClear("threads_view_time_to_fetch_and_display","threads_view_time_to_fetch_and_display"),e}).catch(v)},S=function(){t&&t.isPending()&&t.cancel();var e=_.last(n).ts;return clearTimeout(r),r=setTimeout(function(){TS.client.ui.threads.displaySlowLoadingMessage()},5e3),t=TS.api.call("subscriptions.thread.getView",{current_ts:e,limit:8}),t.then(T).catch(v)},T=function(e){TS.info("Processing subscriptions.thread.getView response"),clearTimeout(r);var t=e.data,i=t.threads,a=t.total_unread_replies||0,s=t.has_more;o=s,s&&i.length<8&&TS.error("subscriptions.thread.getView returned fewer threads than the limit but has_more is true"),i=_.filter(i,function(e){if(!e.root_msg)return TS.error("Missing root_msg in subscriptions.thread.getView response"),!1;if(!e.root_msg.thread_ts)return TS.error("root_msg has no thread_ts in subscriptions.thread.getView response"),!1;var t=e.root_msg.channel;return t?(e.model_ob=TS.shared.getModelObById(t),e.model_ob?(e.root_msg=TS.utility.msgs.processImsg(e.root_msg,t),!1===e.root_msg._subscribed?(TS.error("Got a thread that is not subscribed to in subscriptions.thread.getView response: "+e.root_msg.thread_ts),!1):(e.replies=[],e.latest_replies&&(e.latest_replies=_.map(e.latest_replies,function(e){return TS.utility.msgs.processImsg(e,t)}),e.latest_replies=_.sortBy(e.latest_replies,"ts"),e.replies=e.replies.concat(e.latest_replies)),e.unread_replies&&(e.unread_replies=_.map(e.unread_replies,function(e){return TS.utility.msgs.processImsg(e,t)}),e.unread_replies=_.sortBy(e.unread_replies,"ts"),e.replies=e.replies.concat(e.unread_replies)),e.replies.length?(e.ts=_.last(e.replies).ts,e.unread_replies?e.grouping="new":(e.ts=e.ts,e.grouping="old")):(e.ts=e.root_msg.ts,e.grouping="old"),e.initial_last_read=e.root_msg._last_read||0,TS.replies.maybeSlurpSubscriptionState(e.model_ob.id,[e.root_msg]),!0)):(TS.error("No channel with c_id "+t+" in subscriptions.thread.getView response"),!1)):(TS.error("No c_id in subscriptions.thread.getView response"),!1)}),n||(n=[]),n=n.concat(i);var l=_.uniqBy(n,function(e){return e.model_ob.id+e.root_msg.ts});return l.length!==n.length&&(TS.error("Removing duplicate threads in subscriptions.thread.getView response"),n=l),y(n),{total_unread_replies:a,has_more:s,threads:n}},v=function(e){TS.error("Threads view error during loading:"),TS.error(e);var t=_.get(e,"data.error");t||(t=_.get(e,"message")),t||(t=e),_.isString(t)||(t=JSON.stringify(t)),TS.error(t);var n=_.get(e,"stack");n&&TS.error(JSON.stringify(n)),TS.console.logError(e,"threads_view_fatal_error"),clearTimeout(r),p(),TS.client.ui.threads.displayFatalError()},b=function(e,t,n){var i=TS.replies.getSubscriptionState(e.id,t.ts),a=_.filter(n,function(e){return!i.last_read||e.ts>i.last_read}),s=_.filter(n,function(e){return i.last_read&&e.ts<=i.last_read}),r={model_ob:e,root_msg:t,replies:[]};if(s.length&&!a.length?(r.replies=_.takeRight(s,2),s=_.dropRight(s,2)):s.length&&(r.replies.push(_.last(s)),s=_.dropRight(s,1)),s.length){var o=t.reply_count-r.replies.length;o>0&&o<3&&s.length===o&&(r.replies=s.concat(r.replies))}return a.length&&(r.replies=r.replies.concat(a)),r.replies.length?(r.ts=_.last(r.replies).ts,a.length?r.grouping="new":r.grouping="old"):(r.ts=t.ts,r.grouping="old"),r.initial_last_read=i.last_read||0,r},w=function(){if(n){n=_(n).map(function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);return t&&t.subscribed?e.model_ob.is_channel&&!e.model_ob.is_member?null:b(e.model_ob,e.root_msg,e.replies):null}).compact().value(),n.sort(TS.client.threads.threadCompare);var e=n.length;n=_.take(n,8),e>n.length&&(o=!0),O()}},y=function(e){var t=_.map(e,"ts");e.sort(TS.client.threads.threadCompare),_.isEqual(t,_.map(e,"ts"))||TS.warn("Threads out of order; fixed in client")},k=function(t,i){n&&t&&i&&i.thread_ts&&e.addToQ(function(){var e=TS.client.threads.getThread(t,i.thread_ts);if(e)return B(e,i)})},A=function(t,i){n&&t&&i&&i.thread_ts&&e.addToQ(function(){var e=x(t,i);TS.model.threads_view_is_showing&&e&&TS.client.ui.threads.maybeRemoveMessageFromThread(t,i)})},C=function(t,n){t&&n&&(n.is_ephemeral||TS.utility.msgs.isTempMsg(n)||(!a||n.ts>a)&&(a=n.ts),n.thread_ts&&TS.utility.msgs.isMsgReply(n)&&e.addToQ(function(){return TS.replies.promiseToGetSubscriptionState(t.id,n.thread_ts).then(function(e){if(e&&e.subscribed){M(t,n,e);var i=TS.client.threads.getThread(t,n.thread_ts);return i?E(i,n):D(t,n.thread_ts)}})}))},M=function(e,t){if(!(t.ts<=d)){if(!(e.id===TS.ui.replies.activeConvoModelId()&&t.thread_ts===TS.ui.replies.activeConvoThreadTs()&&TS.client.ui.isUserAttentionOnChat())&&P(t)){var n=1e3*parseFloat(t.ts),i="away"===TS.model.user.presence,a=i||n<TS.model.user._presence_last_changed,s=TS.model.here_regex.test(t.text)&&!a,r=TS.utility.msgs.getMsgMentionData(t).non_channel_mentions,o=r||s?TS.model.threads_mention_count+1:TS.model.threads_mention_count;!0===TS.model.threads_has_unreads&&TS.model.threads_mention_count===o||(TS.client.threads.setThreadsUnreadData(!0,o),s&&!r&&H(e.id,t.thread_ts,t.ts),TS.client.threads.logThreadState("message_received: true "+o+" "+e.id+" "+t.thread_ts+" "+t.ts))}}},x=function(e,t){if(n&&e&&t){var a=TS.client.threads.getThread(e,t.thread_ts);if(!a)return!1;if(t.ts===t.thread_ts)return TS.error("Attempting to remove remove root msg from thread instead of converting it to tombstone"),!1;var s=!1,r=_.findIndex(a.replies,{ts:t.ts});-1!==r&&(a.replies.splice(r,1),s=!0);if(-1!==_.findIndex(a.root_msg.replies,{ts:t.ts})&&(a.root_msg.replies.splice(r,1),s=!0),parseFloat(t.ts)>i&&(R(l-1),U()),!a.replies.length&&!_.get(a.root_msg,"replies.length"))return I(e,a),s;var o=_.findIndex(a.unread_replies,{ts:t.ts});-1!==o&&a.unread_replies.splice(o,1);var d=_.findIndex(a.latest_replies,{ts:t.ts});return-1!==d&&a.latest_replies.splice(d,1),s}},I=function(e,t){n&&t&&(n=_.without(n,t),TS.model.threads_view_is_showing&&TS.client.ui.threads.maybeRemoveThread(e,t))},E=function(e,t){if(n&&e&&t){if(-1===_.findIndex(e.replies,{ts:t.ts})){!e.max_visible_ts&&P(t)&&(e.max_visible_ts=e.replies.length?_.last(e.replies).ts:e.root_msg.ts),e.replies.push(t),e.replies=_.sortBy(e.replies,"ts");var i=!1;return P(t)||(i=!0,e.max_visible_ts=_.last(e.replies).ts),TS.model.threads_view_is_showing&&TS.client.ui.threads.maybeUpdateThreadWithMessage(e,t,i),"old"===e.grouping&&TS.client.ui.threads.hideCaughtUpDivider(),R(l+1),U(),null}}},B=function(e,t){if(n&&e&&t){var i=!1;t.ts===t.thread_ts&&(e.root_msg=t,i=!0);var a=_.findIndex(e.replies,{ts:t.ts});-1!==a&&(e.replies.splice(a,1,t),i=!0),TS.model.threads_view_is_showing&&i&&TS.client.ui.threads.maybeUpdateThreadWithMessage(e,t)}},D=function(e,t){if(n&&e&&t){if(!TS.client.threads.getThread(e,t)){return TS.replies.getThreadLazy(e.id,t,!0).then(function(t){var i=t.root_msg,a=_.filter(t.messages,TS.utility.msgs.isMsgReply),s=b(e,i,a),r=TS.replies.getSubscriptionState(e.id,i.ts),o=s.replies.filter(function(e){return!r.last_read||e.ts>r.last_read}).length;return n.unshift(s),n.sort(TS.client.threads.threadCompare),TS.model.threads_view_is_showing&&TS.client.ui.threads.insertNewThread(s),R(l+o),U(),null})}}},F=function(t,i,a){if(n&&t&&i&&a.subscribed){var s=TS.shared.getModelObById(t);s&&e.addToQ(function(){TS.client.threads.getThread(s,i)||D(s,i)})}},P=function(e){return!(e.user===TS.model.user.id||e.is_ephemeral)},O=function(){l=0,_.each(n,function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.ts),n=_.filter(e.replies,function(e){return!t.last_read||e.ts>t.last_read});l+=n.length}),R(l)},R=function(e){l=e,TS.client.threads.reply_count_changed.dispatch(l)},U=function(){if(TS.model.threads_view_is_showing){var e=TS.client.threads.getNewThreadReplyCount();e&&TS.client.threads.new_thread_reply_count_changed.dispatch(e)}},L=function(e){var t=TS.replies.getSubscriptionState(e.model_ob.id,e.root_msg.thread_ts);return!t||(!t.last_read||e.ts>t.last_read)},Q=function(t,n,i,a,s){s||e.addToQ(function(){var e=TS.client.threads.getThread(t,n.ts);e&&(e.replies=_.reject(i,{ts:e.root_msg.ts}),TS.model.threads_view_is_showing&&TS.client.ui.threads.maybeRedrawThread(e))})},H=function(e,t,n){var i=TS.replies.getSubscriptionState(e,t);i&&i.subscribed&&(i.last_read&&i.last_read>=n||c.push({model_ob_id:e,thread_ts:t,msg_ts:n}))},N=function(){return _.remove(c,function(e){var t=TS.shared.getModelObById(e.model_ob_id);if(!t)return!0;if(t.is_channel&&!t.is_member)return!0;var n=TS.replies.getSubscriptionState(e.model_ob_id,e.thread_ts);return!n||!n.subscribed||!!(n.last_read&&n.last_read>=e.msg_ts)}),c.length},G=function(e){if(n){var t=_.filter(n,function(t){return t.model_ob.id===e.id});_.forEach(t,function(t){I(e,t)})}},j=function(){n&&(TS.model.threads_view_is_showing?u=!0:p())},z=function(){var e;a&&(e=parseFloat(a));var t=Math.floor(Date.now()/1e3);return e?t>a?(TS.has_pri[K]&&TS.log(K,"Starting threads view with current time because it is greater than _max_ts"),t):(e+=1,TS.has_pri[K]&&TS.log(K,"Starting threads view with "+e+" because it is greater than the current time"),e):(TS.has_pri[K]&&TS.log(K,"Starting threads view with current time because !_max_ts"),t)},K=2004}()},2411:function(e,t){!function(){"use strict";TS.registerModule("client.ui.app_profile",{onStart:function(){$('[data-js="app_profile_tab"]').on("click",'[data-js="app_profile_btn"]',TS.client.ui.app_profile.onButtonClick)},active_app:null,openWithApp:function(n,i,a,s){if(n){void 0==s&&(s=!0),TS.client.ui.app_profile.active_app=n,e=TS.apps.constructTemplateArgsForCardAndProfile(n,i,a,s),TS.client.ui.flex.openAppProfileFlex(i||n.id),$('[data-js="app_profile_header"]').html(TS.templates.app_profile_title(e));var r=$('[data-js="app_profile_scroller"]');r.html(TS.templates.app_profile(e)),t=r.find('[data-js="app_profile_desc"]'),t.find('[data-js="app_profile_desc_inner"]').height()<=1.2*t.height()?t.removeClass("app_desc_expand_showing"):t.css("max-height",t.find('[data-js="app_profile_desc_inner"]').height());var o=r.find('[data-js="app_auth_settings"]');s&&!_.get(n,"is_slack_integration")?TS.apps.promiseToGetFullAppProfile(i,a,n.id,!0).then(function(t){if(t.auth_summary_list){var n={name:e.name,auth_summary_list:t.auth_summary_list};o.html(TS.templates.app_profile_settings(n))}else o.hide()}):o.hide()}},onButtonClick:function(e){var n=$(this),i=n.data("action");if("open_bot_dm"===i){var a=TS.client.ui.app_profile.active_app,s=a.bot_user?a.bot_user.id:"";TS.clog.track("USER_PROFILE_CLICK",{app_id:a.id,bot_id:s}),e.preventDefault(),TS.ims.startImByMemberId(s)}else"open_overflow_menu"===i?TS.client.ui.app_profile.openOverflowMenu(e):"desc_expand"===i?(t.removeClass("app_desc_expand_showing"),setTimeout(function(){t.addClass("app_desc_collapse_showing")},300)):"desc_collapse"===i&&(t.removeClass("app_desc_collapse_showing"),t.addClass("app_desc_expand_showing"))},openOverflowMenu:function(t){if(!TS.menu.isRedundantClick(t)&&!TS.client.ui.checkForEditing(t)){TS.menu.buildIfNeeded(),TS.menu.clean(),TS.menu.$menu_items.html(TS.templates.menu_app_profile_items(e)),TS.menu.start(t,!0);var n=$(t.target);TS.menu.positionAt(n,n.width()-TS.menu.$menu.width(),n.height()+8),TS.menu.$menu_items.on("click.menu","li",TS.client.ui.app_profile.onOverflowMenuClick),TS.menu.keepInBounds()}},onOverflowMenuClick:function(e){var t=$(this),n=t.data("action"),i=TS.client.ui.app_profile.active_app;"files"===n?(e.preventDefault(),TS.view.files.clearFilter(),TS.client.ui.files.filterFileList(i.bot_user.id)):"invite_to_channel"===n&&(e.preventDefault(),TS.ui.invite.showInviteMemberToChannelDialog(i.bot_user.id));var a=i.id,s=i.bot_user?i.bot_user.id:"";TS.clog.track("USER_PROFILE_CLICK",{app_id:a,bot_id:s}),TS.menu.end()}});var e,t}()},2412:function(e,t){!function(){"use strict";TS.registerModule("client.ui.files",{$file_btn:null,onStart:function(){function e(){TS.client.ui.files.bindUploadUI(),TS.client.ui.files.bindFileUI(),TS.useReactMessages()?TS.files.media.bindVideoElements({container:".p-history_container",onError:g}):TS.files.media.bindVideoElements({container:"#msgs_div",onError:g})}TS.files.team_file_comment_added_sig.add(TS.client.ui.files.teamFileCommentAdded),TS.files.team_file_comment_edited_sig.add(TS.client.ui.files.teamFileCommentEdited),TS.files.team_file_comment_deleted_sig.add(TS.client.ui.files.teamFileCommentDeleted),TS.files.team_file_changed_sig.add(TS.client.ui.files.teamFileChanged),TS.files.team_file_deleted_sig.add(TS.client.ui.files.teamFileDeleted),TS.view.members.unknown_resolution_rebuild_sig.add(TS.client.ui.files.memberChanged),TS.has_pri[82]&&TS.log(82,"deferring UI bind until login_sig"),TS.client.login_sig.add(e)},preview_file_waiting_on:null,showFilesFromHistory:function(e){if(!e)return TS.client.ui.files._displayFileList(),void TS.client.flexDisplaySwitched("files",null,!1,!0);var t=TS.files.getFileById(e);t?(TS.client.ui.files._displayFile(t.id),TS.client.flexDisplaySwitched("files",t.id,!1,!0),TS.files.fetchFileInfo(e)):(TS.client.ui.files.preview_file_waiting_on=e,TS.files.fetchFileInfo(e,function(e,t){e==TS.client.ui.files.preview_file_waiting_on&&(TS.client.ui.files.preview_file_waiting_on=null,t?(TS.client.ui.files._displayFile(t.id),TS.client.flexDisplaySwitched("files",t.id,!1,!0)):(TS.client.ui.files._displayFileList(),TS.client.flexDisplaySwitched("files",null,!0)))}))},_displayFile:function(n,s,r){var o=TS.files.getFileById(n);return!!o&&(!!TS.client.ui.flex._displayFlexTab("files")&&(TS.boot_data.feature_file_threads?(e=s,t=r):TS.client.ui.files._rebuildBackFromFilePreview(s),TS.model.previewed_file_id=n,TS.view.files.hideList(),$("#file_list_container").hideWithRememberedScrollTop(),TS.boot_data.feature_share_mention_comment_cleanup?r?a(o,r):i(o):($("#file_preview_container").unhideWithRememberedScrollTop(),TS.client.ui.files.rebuildFilePreview(o),$("#file_preview_scroller").scrollTop(0)),$("#file_comment_form").css("visibility",""),TS.view.resizeManually("TS.client.ui.files._displayFileList"),!0))},_displayFileList:function(){return!!TS.client.ui.flex._displayFlexTab("files",!0)&&(TS.model.previewed_file_id="",$("#file_preview_container").hideWithRememberedScrollTop(),$("#file_list_container").unhideWithRememberedScrollTop(),TS.view.files.unHideList(),TS.view.resizeManually("TS.client.ui.files._displayFileList"),!0)},rebuildFilePreview:function(n){var i;n.user&&"USLACKBOT"===n.user&&n.bot_id?(i=TS.bots.getBotById(n.bot_id),i.is_bot=!0,i.is_service=!0):i=TS.members.getPotentiallyUnknownMemberById(n.user);var a=TS.files.getFileActions(n);if(a.file=n,a.member=i,a.user=TS.model.user,a.show_open_public_link=!TS.model.team.prefs.disallow_public_file_urls,a.show_revoke_public_link=!TS.model.team.prefs.disallow_public_file_urls&&a.revoke_public_link,TS.boot_data.feature_file_threads){var r=p(n,e,t),o=TS.shared.getModelObById(r);a.model_ob=o}"email"===n.mode&&(a.to_more_count=n.to.length-1,a.cc_more_count=n.cc.length-1),n&&n.id&&("snippet"!==n.mode&&"post"!==n.mode&&"space"!==n.mode||n.content||n.content_html||n.content_highlight_html||TS.files.fetchFileInfo(n.id)),$.extend(a,TS.files.getFileTemplateArguments(n));var d=$("#file_preview_scroller").find("#file_preview_head_section");a.video_height&&(a.video_height=TS.model.native_video_embed_height_flexpane);var c=TS.templates.file_preview_title(a),_=TS.templates.file_preview_file(a),u=TS.templates.file_preview_meta(a),m=!1;if(TS.files.fileIsHostedSupportedMedia(n)&&n.id===TS.model.previewed_file_id){var g;if(TS.files.fileIsSupportedAudio(n)?g=d.find("audio"):TS.files.fileIsSupportedVideo(n)&&(g=d.find("video")),g.length){var f=g[0],S=!f.paused,T=0===f.currentTime,v=f.currentTime===f.duration;(S||!T&&!v)&&(m=!0)}}if(m)d.find(".file_preview_title").replaceWith(c),d.find(".file_preview_meta").replaceWith(u);else{var b=c+_+u;d.html(b)}TS.utility.makeSureAllLinksHaveTargets(d),TS.files.fileIsImage(n)?d.find(".image_container .image_bg img").error(function(){$(this).closest(".image_body").addClass("broken_image")}):TS.files.fileIsSupportedVideo(n)?TS.files.media.bindVideoElements({container:d,onError:function(e){e.addClass("hidden")}}):"space"===n.mode&&TS.utility.attachments.unfurlPlaceholders(d),a={file:n};var w=$("#file_preview_scroller").find("#file_preview_comments_section");if(w.html(TS.templates.comments(a)),TS.utility.makeSureAllLinksHaveTargets(w),TS.boot_data.feature_file_threads)l(n.id),h(n);else if(n.id!=TS.model.last_previewed_file_id){var y=TS.storage.fetchLastCommentInput(n.id);y?TS.utility.contenteditable.value($("#file_comment_form #file_comment"),y):TS.utility.contenteditable.clear($("#file_comment_form #file_comment")),TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment")),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||$("#file_comment_form #file_comment").trigger("keyup")}if(n.mode,TS.model.last_previewed_file_id=n.id,n.content&&"snippet"===n.mode){$("#truncated_message").addClass("hidden");var k=!!TS.model.code_wrap_long_lines,A=$("#snippet_wrap"),C=$('#flex_contents .snippet_container[data-file-id="'+n.id+'"]');A.bind("change",function(){TS.model.code_wrap_long_lines=$(this).prop("checked"),TS.model.code_wrap_long_lines?C.addClass("snippet_wrap"):C.removeClass("snippet_wrap")}),k&&(A.prop("checked","checked"),C.addClass("snippet_wrap"))}TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller")),TS.boot_data.feature_file_threads||s(n),(TS.utility.contenteditable.hasFocus($("#file_comment"))||TS.utility.contenteditable.isActiveElement($("#file_comment")))&&$("#file_comment_submit_btn").scrollintoview({offset:"bottom",px_offset:-50,duration:0})},cleanFilePreview:function(){$("#file_preview_head_section").empty(),$("#file_preview_comments_section").empty(),TS.boot_data.feature_file_threads&&(e=null,t=null)},_rebuildBackFromFilePreview:function(e){var t=$("#back_from_file_preview");t.unbind();var n;"member_preview"===e?(n=TS.i18n.t("Team Member","files")(),t.html(TS.templates.builders.filePreviewBackIcon()+" "+n),t.bind("click.back",function(){TS.client.ui.previewMember(TS.model.last_previewed_member_id)})):"starred_items"===e?(n=TS.i18n.t("Starred Items","files")(),t.html(TS.templates.builders.filePreviewBackIcon()+" "+n),t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("stars")})):"search_results"===e?(n=TS.i18n.t("Search Results","files")(),t.html(TS.templates.builders.filePreviewBackIcon()+" "+n),t.bind("click.back",function(){TS.search.view.showResults(),TS.search.view.maybeRebuildResults()})):"channel_page"===e?(n=TS.i18n.t("Channel Details","files")(),t.html(TS.templates.builders.filePreviewBackIcon()+" "+n),t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")}),t.data("origin",e)):"group_page"===e?(n=TS.i18n.t("Channel Info","files")(),t.html(TS.templates.builders.filePreviewBackIcon()+" "+n),t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")})):"im_page"===e?(n=TS.i18n.t("Conversation Details","files")(),t.html(TS.templates.builders.filePreviewBackIcon()+" "+n),t.bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")})):(n=TS.i18n.t("Files","files")(),t.html(TS.templates.builders.filePreviewBackIcon()+" "+n),t.bind("click.back",function(){TS.client.ui.files.showFileList(),TS.client.flex_pane.maybeFetchFileList()})),t.data("origin",e)},previewFile:function(e,t,n,i,a){var s=TS.files.getFileById(e);if(TS.model.ui_state.flex_visible&&TS.model.previewed_file_id===e&&!$("#file_preview_scroller").is(":hidden")&&$("#file_preview_scroller").highlight(1500,"flex_highlight",!1,0),!s)return TS.client.ui.files.preview_file_waiting_on=e,void TS.files.fetchFileInfo(e,function(e,n){e==TS.client.ui.files.preview_file_waiting_on&&(TS.client.ui.files.preview_file_waiting_on=null,n?TS.client.ui.files.previewFile(n.id,t,!0,a):TS.generic_dialog.alert(TS.i18n.t("This file cant be found.","files")(),TS.i18n.t("Sorry, that didnt work","files")()))});TS.client.ui.files._displayFile(e,t,a)&&(TS.client.flexDisplaySwitched("files",e),i&&TS.utility.contenteditable.focus($("#file_comment")),n||TS.files.fetchFileInfo(e))},teamFileCommentAdded:function(e,t){n(e)&&TS.client.ui.files.appendFileComment(e,t),TS.boot_data.feature_share_mention_comment_cleanup&&TS.files.resetFileCommentsGroup(e)},teamFileCommentEdited:function(e,t){n(e)&&TS.client.ui.files.updateFileComment(e,t),TS.boot_data.feature_share_mention_comment_cleanup&&TS.files.resetFileCommentsGroup(e)},teamFileCommentDeleted:function(e,t){n(e)&&TS.ui.comments.removeFileComment(e,t,function(){TS.boot_data.feature_file_threads&&h(e),TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))}),TS.boot_data.feature_share_mention_comment_cleanup&&TS.files.resetFileCommentsGroup(e)},teamFileChanged:function(e){"files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==e.id&&TS.client.ui.files.rebuildFilePreview(e),TS.boot_data.feature_share_mention_comment_cleanup&&TS.files.resetFileCommentsGroup(e)},teamFileDeleted:function(e){"files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==e.id&&TS.client.ui.files.showFileList(),TS.boot_data.feature_share_mention_comment_cleanup&&TS.files.resetFileCommentsGroup(e)},memberChanged:function(e){if("unknown_members"===TS.experiment.getGroup("unknown_members_perf",TS.members.unknown_members_perf_exp_metrics)){var t=TS.files.getFileById(TS.model.previewed_file_id);t&&n(t)&&_(t.comments).filter({user:e.id}).map(_.partial(TS.client.ui.files.updateFileComment,t)).value()}},storeLastCommentInputForPreviewedFile:function(e){TS.model.previewed_file_id&&TS.storage.storeLastCommentInput(TS.model.previewed_file_id,e)},bindFileUI:function(){$("#file_list_heading").bind("click.show_menu",function(e){e.preventDefault(),TS.menu.file.startWithFileFilter(e)}),$("#file_list_clear_filter").bind("click.clear_filter",function(e){e.stopPropagation(),TS.view.files.clearFilter()}),$("#file_list_toggle_all").bind("click.toggleList",function(){TS.client.ui.files.toggleFileList("all")}),$("#file_list_toggle_user").bind("click.toggleList",function(e){if(!e.isDefaultPrevented()){var t=$("#file_list").data("filter-user");t?TS.client.ui.files.toggleFileList(t):TS.client.ui.files.toggleFileList(TS.model.user.id)}}),$("#file_list_toggle_users").bind("click.show_menu",function(e){e.preventDefault(),TS.boot_data.page_needs_enterprise||TS.lazyLoadMembersAndBots()?TS.menu.file.startWithFileMemberPromiseFilter(e):TS.menu.file.startWithFileMemberFilter(e)})},showFileList:function(){TS.client.ui.files._displayFileList()&&($("#search_tabs").hide(),TS.client.flexDisplaySwitched("files"))},filterFileList:function(e){"all"===e?(TS.model.active_file_list_filter=e,TS.view.files.clearFilter()):"user"===e?(TS.view.files.clearFilter(),TS.client.ui.files.toggleFileList(TS.model.user.id)):TS.interop.utility.looksLikeMemberId(e)?TS.client.ui.files.toggleFileList(e):(TS.model.active_file_list_filter=e,TS.view.file_list_heading=TS.model.file_list_type_map[e],TS.model.file_list_types=[e],TS.view.files.filterSet(),$("#file_list_clear_filter").removeClass("hidden"))},toggleFileList:function(e){var t=$("#file_list"),n=$("#file_list_toggle_all"),i=$("#file_list_toggle_user"),a=$("#file_list_toggle_users"),s=TS.i18n.t("Just You","files")();if(t.data("list")!=e){if(t.data("list",e),"all"===e)TS.model.active_file_list_member_filter="all",i.removeClass("active").find("a").text(s),a.removeClass("active"),n.addClass("active"),t.data("filter-user",TS.model.user.id);else{var r=TS.members.getMemberById(e);r?(TS.model.active_file_list_member_filter=e,n.removeClass("active"),i.addClass("active"),a.addClass("active"),r.id==TS.model.user.id?i.find("a").text(s):i.find("a").text(TS.members.getPrefCompliantMemberName(r)),t.data("filter-user",e)):TS.error(e+" is not valid?")}TS.view.files.filterSet()}},submitFileComment:function(e){var t=$("#file_comment_form #file_comment"),n=TS.utility.contenteditable.value(t),i=TS.format.cleanMsg(n);if(!$.trim(i))return void TS.sounds.play("beep");var a=TS.model.previewed_file_id,s=t.closest("[data-model-ob-id]").attr("data-model-ob-id");TS.ui.fs_modal_file_viewer.is_showing&&(a=TS.ui.fs_modal_file_viewer.getCurrentFileId());var r=TS.files.getFileById(a);if(!r)return void TS.error("no file to submit comment");var o=TS.ui.needToBlockAtChannelKeyword(n,r);if(o)return void TS.generic_dialog.alert(TS.i18n.t("<p>A Team Owner has restricted the use of <strong>{keyword}</strong> messages.</p>","files")({keyword:_.escape(o)}));if(!e){var l=r.channels.concat(r.groups),d=l.filter(function(e){return TS.ui.needToShowAtChannelWarning(e,n)});if(d.length>0)return void TS.ui.at_channel_warning_dialog.startInFlexPane(r,d,n)}TS.utility.contenteditable.clear($("#file_comment_form #file_comment")),TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment")),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||$("#file_comment_form #file_comment").trigger("keyup"),TS.ui.fs_modal_file_viewer.is_showing&&$("#file_comment").closest("#fs_modal").length&&TS.clog.track("FILE_FULLSCREEN_COMMENT_ADD",{}),TS.files.addComment(a,i,s,function(e,t,n){e?TS.storage.storeLastCommentInput(n.file,""):(alert("error: comment not added to file"),n.file==TS.model.last_previewed_file_id&&(TS.utility.contenteditable.value($("#file_comment_form #file_comment"),TS.storage.fetchLastCommentInput(n.file)),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||$("#file_comment_form #file_comment").trigger("keyup")))})},rebuildFilePreviewAndCommentsIncludingMember:function(e){var t={member:e,for_message:!0};$("#col_flex .message_current_status.color_"+e.id).replaceWith(TS.templates.current_status(t))},appendFileComment:function(e,t){var n=$(".file_comments_"+e.id),i=TS.members.getPotentiallyUnknownMemberById(t.user);if(n.append(TS.templates.builders.buildCommentHTML({file:e,comment:t,show_comment_actions:!0,member:i})),TS.utility.makeSureAllLinksHaveTargets(n),t.user==TS.model.user.id){var a;a=TS.boot_data.feature_file_threads?$("#file_reply_container"):$("#file_comment_submit_btn"),a.scrollintoview({offset:"bottom",px_offset:-50,duration:0})}TS.boot_data.feature_file_threads&&h(e);var s;s=TS.boot_data.feature_share_mention_comment_cleanup?$(".file_comments_scroller"):$("#file_preview_scroller"),TS.ui.utility.updateClosestMonkeyScroller(s)},updateFileComment:function(e,t){var n=TS.members.getPotentiallyUnknownMemberById(t.user),i=$('.comment[data-comment-id="'+t.id+'"]');i.length&&(i.replaceWith(TS.templates.builders.buildCommentHTML({file:e,comment:t,show_comment_actions:!0,member:n})),i.each(function(){TS.utility.makeSureAllLinksHaveTargets($(this))}),TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller")))},validateFiles:function(e,t,n){function i(e){p=Math.max(0,p+e)}function a(){m=[],p=0,h=0,g=!1,f=!1}function s(){g||m.length&&(g=!0,TS.client.ui.file_dropped_sig.dispatch(m,t))}function r(){if(f)return!1;h>0&&(m.length>=p||p<=0)&&(f=!0,T.length?u(e,function(){n?n(m,s):s()}):n?n(m,s):s())}function o(e){m.push(e)}function l(e){return e.onerror=null,e.onload=null,null}function d(e,t){var n,i;if(i={isFile:null,isDirectory:null},e.size<16384&&window.FileReader){n=new FileReader,n.onload=function(e){n=l(e.currentTarget),i.isFile=!0,t(i)},n.onerror=function(e){n=l(e.currentTarget),i.isDirectory=!0,t(i)};try{n.readAsDataURL(e)}catch(e){n=l(n),i.isDirectory=!0,t(i)}}else t(i)}function c(e,t,n){var i,a,s,r,o;return a=!1,!!(o=e.name||t.name)&&(s=o.lastIndexOf("."),-1!==s&&(r=o.substr(s)),r&&(i=S[r]&&S[r].enabled?S[r]:null),t&&(t.isFile||t.isDirectory)?t.isDirectory||t.isFile&&i&&i.applyToFile?(a=!0,n(a)):(a=!1,n(a)):void d(e,function(e){return e.isDirectory?a=!0:i&&i.applyToFile&&(a=!0),n(a)}))}function u(e,t){var n,i,a,s,r,o,l,d,c;if(T.length){for(a=[],l="",c="",n=0,i=T.length;n<i;n+=1)a.push("<li><strong>"+_.escape(T[n].name)+"</strong></li>");T.length>1?(r=T.length===h?TS.i18n.t("All files unsupported","files")():TS.i18n.t("Some files unsupported","files")(),l="<ul>"+a.join("\n")+"</ul>"):1===T.length&&(r=TS.i18n.t("File unsupported","files")()),s=h-T.length,T.length>1?d=TS.i18n.t("<p>Try uploading a .zip version of these files instead.","files")():1===T.length&&(d=TS.i18n.t("<p>Try uploading a .zip version of this file instead.","files")()),s>1?c=TS.i18n.t("<p>(Dont worry, your other files are next.)</p>","files")():1===s&&(c=TS.i18n.t("<p>(Dont worry, your other file is next.)</p>","files")()),o=1===T.length?TS.i18n.t("<p>Sorry, <strong>{excluded_file}</strong> is a type of file not supported by Slack</p>","files")({excluded_file:_.escape(T[0].name)}):T.length===h?TS.i18n.t("<p>Sorry, none of those file types are supported by Slack.</p>","files")():TS.i18n.t("<p>Sorry, some of those file types are not supported by Slack.</p>","files")(),TS.generic_dialog.start({title:r,body:o+l+d+c,show_cancel_button:!1,esc_for_ok:!0,onGo:function(){TS.generic_dialog.end(),t&&t()}})}return T.length}if(e){t=!!t;var m=[],h=0,p=0,g=!1,f=!1,S={},T=[];TS.client.ui.resetFiles||(TS.client.ui.resetFiles=a),function(e){h=e.length,i(e.length);for(var t,n,a,s,l=0;l<e.length;l+=1)t=e[l],a=t,s=t,(t.isFile||t.isDirectory)&&(n=t,s=t),t.getAsEntry?(n=t.getAsEntry(),s=n):t.webkitGetAsEntry&&(n=t.webkitGetAsEntry(),s=n),"function"==typeof t.getAsFile?a=t.getAsFile():File&&t instanceof File&&(a=t),s&&a||i(-1),function(e,t){c(e,t,function(n){n?(t.name?T.push(t):T.push(e),i(-1),r()):(0===e.size?i(-1):o(e),r())})}(a,s)}(e),r()}},bindUploadUI:function(){TS.client.ui.files.$upload||(TS.client.ui.files.$upload=$("#file_upload")),$(".file_upload_btn").bind("click.file_menu",function(e){return!TS.client.ui.shouldIgnoreClick(e)&&(TS.menu.file.startWithNewFileOptions(e,$(this)),!1)}),TS.client.ui.files.$upload.bind("change",function(){if(window.desktop&&desktop.app&&desktop.app.focusWebView&&desktop.app.focusWebView(),$(this).val()){var e=$(this)[0].files;if(e){if(!e.length)return;TS.view.filesSelected(e),TS.client.ui.files.$upload.val("")}}}),$("body").bind("drop",function(e){var t,n;if(window.focus(),e.preventDefault(),$("body").removeClass("drop-target"),TS.boot_data.feature_take_profile_photo&&$("body").find("#edit_member_profile_container").length>0){if(n=e.originalEvent.dataTransfer,n&&(t=n.files||n.items),!t)return;return void TS.ui.edit_member_profile.handleDrop(t)}if(!TS.client.ui.checkForEditing(e)){if("disable_all"===TS.model.team.prefs.disable_file_uploads)return void TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("At the request of your administrator, file uploads have been disabled on this team.","files")(),show_cancel_button:!1,onGo:function(){TS.files.uploadOver(!1)}});var i=e&&e.shiftKey,a=TS.shared.getActiveModelOb();if(a&&a.is_general&&!TS.members.canUserPostInGeneral())return TS.generic_dialog.start({title:TS.i18n.t("Cant share in #{channel_name}","files")({channel_name:a.name}),body:TS.i18n.t("To keep things tidy, your Team Owners have set limits on sharing files and sending messages in #<strong>{channel_name}</strong>.","files")({channel_name:a.name}),show_cancel_button:!1,go_button_text:TS.i18n.t("OK","files")()}),!1;if(a&&TS.shared.isModelObOrgShared(a)&&!TS.permissions.members.canPostInChannel(a))return TS.generic_dialog.start({title:TS.i18n.t('Cannot Post To #{channel_name}<ts-icon class="ts_icon_org_shared_channel"></ts-icon>',"files")({channel_name:a.name}),body:TS.i18n.t('An Owner of your team has limited who can post to <strong>#{channel_name}<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>. Nothing personal! You can share your file in another channel.',"files")({channel_name:a.name}),show_cancel_button:!1,go_button_text:TS.i18n.t("Okay!","files")()}),!1;TS.model.archive_view_is_showing&&TS.client.archives.getCurrentModelOb().is_archived&&(i=!1),n=e.originalEvent.dataTransfer,n&&(t=n.files||n.items),t&&TS.client.ui.files.validateFiles(t,i)}}),$("#drop-zone").unbind("click.dismiss").bind("click.dismiss",function(){$("body").removeClass("drop-target")}),$(window).draghover().on({draghoverstart:function(e,t,n){if(window.winssb&&TS.info("draghoverstart winssb_file:"+n),!TS.model.ui.is_mouse_down){var i=!1;if(t&&t.originalEvent&&t.originalEvent.dataTransfer&&t.originalEvent.dataTransfer.types)for(var a=t.originalEvent.dataTransfer.types,s=0;s<a.length;s+=1)if("files"===a[s].toLowerCase()){i=!0;break}if(i||(i=!!n),i){if(TS.boot_data.feature_take_profile_photo&&$("body").find("#edit_member_profile_container").length>0)return $("body").addClass("drop-target"),void TS.ui.edit_member_profile.handleDrag(!0);if(!$("body").hasClass("file_snippet")&&"disable_all"!==TS.model.team.prefs.disable_file_uploads){if(TS.msg_edit.editing)return!1;var r=TS.shared.getActiveModelOb();if(r&&TS.channels.isChannelRequired(r)&&!TS.permissions.members.canPostInChannel(r))return!1;$("body").addClass("drop-target"),TS.ui.fs_modal.is_showing&&TS.ui.fs_modal.deactivate()}}}},draghoverend:function(){if($("body").removeClass("drop-target"),TS.boot_data.feature_take_profile_photo&&$("body").find("#edit_member_profile_container").length>0)return void TS.ui.edit_member_profile.handleDrag(!1);TS.ui.fs_modal.is_showing&&TS.ui.fs_modal.activate()}})}});var e=null,t=null;Object.defineProperty(TS.client.ui.files,"$file_btn",{get:function(){return delete TS.client.ui.files.$file_btn,TS.client.ui.files.$file_btn=$("#primary_file_button"),TS.client.ui.files.$file_btn}});var n=function(e){var t="files"===TS.model.ui.active_tab_id&&TS.model.previewed_file_id==e.id,n=e.id===TS.ui.fs_modal_file_viewer.getCurrentFileId();return t||n},i=function(e){$(".file_comments_container").hideWithRememberedScrollTop(),$(".file_details_container").unhideWithRememberedScrollTop(),r(e),$(".file_details_scroller").scrollTop(0)},a=function(e,t){$(".file_details_container").hideWithRememberedScrollTop(),$(".file_comments_container").unhideWithRememberedScrollTop(),o(e,t),$(".file_comments_scroller").scrollTop(0)},s=function(e){$(".file_comment_tip").html(TS.templates.builders.makeFileCommentHelpHTML(e))},r=function(e){var t=$.extend(TS.files.getFileDetailsMetaTemplateArguments(e),TS.files.getFileTemplateArguments(e));t.video_height&&(t.video_height=TS.model.native_video_embed_height_flexpane);var n=TS.templates.file_details_meta(t),i=$(".file_details_scroller").find(".file_details_meta");i.html(n),TS.utility.makeSureAllLinksHaveTargets(i),"space"===e.mode&&TS.utility.attachments.unfurlPlaceholders(i),TS.files.createFileCommentsGroup(e);var a=TS.templates.file_details_share_to(e),s=$(".file_details_scroller").find(".file_details_share_to");s.html(a),TS.utility.makeSureAllLinksHaveTargets(s),TS.model.last_previewed_file_id=e.id,TS.ui.utility.updateClosestMonkeyScroller($(".file_details_scroller"))},o=function(e,t){TS.files.createFileCommentsGroup(e);var n=jQuery.extend(!0,{},e),i=n._comments_grouped[t];n.comments=i.comments;var a={file:n,comment_group:i,c_id:t};$.extend(a,TS.files.getFileTemplateArguments(e));var s=$(".file_comments_scroller"),r=TS.templates.file_comments(a);s.find(".file_comments").html(r),$(".back_from_file_comments").attr("data-file-id",n.id),s.attr("data-model-ob-id",t);var o=s.data("monkeyScroll");o&&o.updateFunc()},l=function(e){var t=$("#file_reply_container");t.empty(),t.append(TS.ui.replies.getReplyInputAvatarHTML()),TS.ui.inline_msg_input.make(t,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:!1,complete_cmds:!0,in_thread:!0,onSubmit:function(t,n){TS.model.ms_connected&&("/"===n.substr(0,1)&&"//"!==n.substr(0,2)||(u(""),TS.files.addComment(e,n,null,function(t){t?TS.storage.storeLastCommentInput(e,""):c(n)})))},getMsgDivForEditing:function(){},onTextChange:function(n){var i=TS.ui.replies.getReplyInputValueForStorage(n);TS.storage.storeLastCommentInput(e,i);var a=$("#file_preview_scroller")[0];TS.ui.replies.maybeScrollReplyInputToBottomOfScroller(a),TS.ui.replies.checkReplyInputLengthAndUpdate(t)}}),TS.ui.replies.bindReplyInputFocusEvents(t),d(e,t);var n=TS.storage.fetchLastCommentInput(e);n&&c(n)},d=function(e,t){if(e&&0!==t.length){t.append(TS.templates.reply_broadcast_buttons({label_id:e,view:"convo"}));t.find(".reply_broadcast_label_container, .reply_send").mousedown(function(e){e.preventDefault(),m(t)}).click(function(){m(t)})}},c=function(e,t){var n=$("#file_reply_container .message_input");TS.utility.populateInput(n,e,e.length),t&&TS.storage.storeLastCommentInput(t,e)},u=function(e){c("",e),$("#file_reply_container .reply_broadcast_toggle").attr("checked",!1)},m=function(e){var t=e.find(".message_input");TS.utility.contenteditable.focus(t)},h=function(e){var t=$("#file_preview_head_section .convo_flexpane_divider"),n=_.get(e,"comments.length")||0;TS.ui.replies.updateFlexpaneThreadDivider(t,n)},p=function(e,t,n){if(TS.boot_data.feature_file_threads){var i;return"file_share_msg"===t&&n?i=n:e.channels&&e.channels.length?i=_.first(e.channels):e.groups&&e.groups.length&&(i=_.first(e.groups)),i}},g=function(e){e.addClass("hidden")}}()},2413:function(e,t){!function(){"use strict";TS.registerModule("client.ui.flex",{onStart:function(){function e(){TS.client.ui.flex.bindFlexUI()}TS.client.flexpane_display_switched_sig.add(u),TS.has_pri[g]&&TS.log(g,"deferring UI bind until login_sig"),TS.client.login_sig.add(e)},bindFlexUI:function(){var e=$("#client_header");$("#col_flex").delegate(".close_flexpane","click",function(){TS.model.ui_state.flex_visible&&("search"===TS.model.ui_state.flex_name?TS.clog.track("SEARCH_CLOSE",{}):"whats_new"===TS.model.ui_state.flex_name&&TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"close_flexpane",step:TS.client.whats_new.getNewestID()}),TS.client.ui.flex.hideFlex())}),e.delegate("#flex_menu_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;TS.menu.startWithFlexMenu(e),TS.client.downloads.maybeShowFlexMenuProgBar(),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_flex_menu_button"}}})}),e.delegate("#details_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;"whats_new"===TS.model.ui_state.flex_name&&TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"details_toggle",step:TS.client.whats_new.getNewestID()}),l("details"),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_channel_details_button"}}})}),e.delegate("#recent_mentions_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;l("mentions"),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_activity_button"}}})}),e.delegate("#stars_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;l("stars"),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_stars_button"}}})}),e.delegate("#channel_members_toggle_count","click",function(e){d(e),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_members_count_button"}}})}),e.delegate("#pinned_item_count","click",function(e){c(e),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"header_pins_count_button"}}})}),e.delegate("#whats_new_toggle","click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;TS.clog.track("WHATSNEW_ACTION",{action:"open_pane_badged",trigger:"whats_new_toggle",step:TS.client.whats_new.getNewestID()}),$("#client-ui").removeClass("whats_new_showing"),l("whats_new")})},cleanupFlexExcluding:function(e){if("files"!==e&&(TS.view.files.cleanList(),TS.client.ui.files.cleanFilePreview()),"team"!==e&&(TS.client.ui.flex._unregisterCurrentStatusInput(),TS.lazyLoadMembersAndBots())){var t=TS.SearchableMemberList.get("team_directory");t&&t.destroy()}"stars"!==e&&TS.view.cleanStars(),"mentions"!==e&&TS.view.cleanMentions(),"search"!==e&&TS.search.view.cleanResults(),"groups"!==e&&($("#user_groups_list_wrapper").longListView("setHidden",!0),TS.view.user_groups_members_list_lazyload&&(TS.view.user_groups_members_list_lazyload.detachEvents(),TS.view.user_groups_members_list_lazyload=null))},toggleFlex:function(){if(TS.model.ui_state.flex_visible)TS.client.ui.flex.hideFlex();else if(TS.model.ui.active_tab_id){var e="list"===TS.model.ui.active_tab_id;TS.client.ui.flex.showFlex(e),TS.client.flexDisplaySwitched(TS.model.ui.active_tab_id||"",TS.model.ui.last_flex_extra||"")}else{var t=TS.model.ui_state.prev_flex_name||TS.model.default_flex_name,n=TS.model.ui_state.prev_flex_extra;TS.client.ui.flex.setFlexStateFromHistory(t,n)}},hideFlex:function(e,t){if(TS.client.ui.flex.cleanupFlexExcluding(),TS.model.ui_state.flex_visible)if("details"===TS.model.ui_state.flex_name)e||(TS.model.ui_state.details_tab_active=!1);else if(TS.model.ui_state.details_tab_active&&!TS.client.activeChannelIsHidden())return void TS.client.ui.flex.openFlexTab("details",t);var n=function(){$("#"+TS.model.ui_state.flex_name+"_tab").removeClass("active"),TS.model.ui.last_flex_extra=TS.model.flex_extra_in_url,TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").removeClass("flex_pane_showing")}),TS.model.ui_state.flex_visible=!1,TS.model.ui.active_tab_id=null,TS.view.resizeManually("TS.client.ui.flex.hideFlex"),TS.model.ui.scrolled_to_msg_ts&&(TS.client.ui.scrollMsgsSoMsgIsInView(TS.model.ui.scrolled_to_msg_ts,!1,!0,200),TS.model.ui.scrolled_to_msg_ts=null),TS.client.flex_pane.stopLocalTimeInterval(),$(".messages_banner").removeClass("flex_pane_showing"),TS.client.flexDisplaySwitched("","",t,e),TS.client.ui.flex.adjustIFramesInSpecialFlexPanes(),document.activeElement&&$(document.activeElement).closest("#col_flex").length>0&&TS.view.focusMessageInput(),TS.utility.contenteditable.supportsTexty()||TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize")};"list"===TS.model.ui.active_tab_id?$("#flex_contents").transition({opacity:0},100,n):n()},last_window_width_diff:392,last_window_width_diff_default:392,showFlex:function(e,t){var n=TS.client.ui.areMsgsScrolledToBottom();TS.client.activeChannelIsHidden()||!n?TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").addClass("flex_pane_showing")}):$("#client-ui").addClass("flex_pane_showing"),TS.model.ui_state.flex_visible=!0,TS.storage.storeUIState(TS.model.ui_state),t||TS.view.resizeManually("TS.client.ui.flex.showFlex"),n&&TS.client.ui.instaScrollMsgsToBottom(!1),$(".messages_banner").addClass("flex_pane_showing"),e?$("#flex_contents").css("opacity",0).transition({opacity:100},150):$("#flex_contents").css("opacity",100),"files"===TS.model.ui.active_tab_id&&""!==TS.model.ui.last_flex_extra&&TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"),!0),"downloads"===TS.model.ui.active_tab_id&&TS.ui.utility.updateClosestMonkeyScroller($("#downloads_scroller"),!0),"team"!==TS.model.ui.active_tab_id||TS.model.previewed_member_id||TS.client.flex_pane.startLocalTimeInterval(),"files"===TS.model.ui.active_tab_id||!TS.model.ui.active_tab_id&&"files"===TS.model.default_flex_name?TS.view.files.maybeRebuildList():"search"===TS.model.ui.active_tab_id&&TS.search.search_filter_set_sig.dispatch(),"team"===TS.model.ui.active_tab_id&&window.setTimeout(function(){TS.view.maybeRebuildUserGroupList()},1),TS.client.ui.flex.adjustIFramesInSpecialFlexPanes(),TS.utility.contenteditable.supportsTexty()||TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize")},_displayFlexTab:function(n,i){var s=$("#"+n+"_tab");return!!s.length&&(TS.model.ui_state.flex_visible||TS.client.ui.flex.showFlex(!1,!0),TS.isPartiallyBooted()?(e=n,t=i,a(),!0):("stars"===n?TS.model.user&&TS.model.user.stars&&!TS.stars.fetched_once?($("#member_stars_list").html(o),TS.stars.fetchUserStarredItems()):TS.model.user.stars&&TS.model.user.stars.length&&TS.view.rebuildStars(!0):"downloads"===n?TS.client.downloads.maybeBuild():"mentions"===n?TS.model.user&&TS.model.user.mentions&&!TS.mentions.fetched_once?(TS.view.rebuildMentionsLoading(),TS.mentions.fetchMentions()):TS.model.user.mentions&&TS.model.user.mentions.length&&TS.view.rebuildMentionsImmediately(!0):"files"===n?TS.view.files.unHideList():"team"===n?TS.client.flex_pane.startLocalTimeInterval():"details"===n?TS.model.ui_state.details_tab_active=!0:"groups"===n&&$("#user_groups_list_wrapper").longListView("setHidden",!1),"team"!==n&&TS.client.flex_pane.stopLocalTimeInterval(),TS.client.ui.flex.cleanupFlexExcluding(n),$("#flex_contents > .panel").removeClass("active"),s.addClass("active"),TS.utility.contenteditable.isActiveElement(TS.search.input)||s.find(".heading").focus(),TS.model.ui.active_tab_id=n,TS.model.ui.active_tab_ts=Date.now(),"search"===n&&TS.ui.utility.updateClosestMonkeyScroller($("#search_results")),i||TS.view.resizeManually("TS.client.ui.flex._displayFlexTab flex_name:"+n),TS.client.ui.flex.adjustIFramesInSpecialFlexPanes(),!0))},adjustIFramesInSpecialFlexPanes:function(){if(TS.boot_data.special_flex_panes){var e,t,n,i=TS.model.ui.active_tab_id;_.forOwn(TS.boot_data.special_flex_panes,function(a){TS.has_pri[g]&&TS.log(g,"special_flex_pane: "+i),t=$("#"+a.flex_name+"_tab"),t.length&&(n=t.find("iframe"),n.length&&(e="about:blank",TS.model.ui_state.flex_visible&&a.flex_name===i&&(e=n.data("src")),n.attr("src")!==e&&(TS.has_pri[g]&&TS.log(g,"loading src: "+e),n.attr("src",e))))})}},openFlexTab:function(e,t){if(TS.client.ui.flex._displayFlexTab(e)){var n;"files"===e?n=TS.model.previewed_file_id:"team"===e?(n=TS.model.previewed_member_name)||(n=TS.model.previewed_user_group_id):"search"===e&&(n=TS.search.last_search_query),TS.client.flexDisplaySwitched(e,n,t)}},setFlexStateFromHistory:function(e,t,i){if(TS.isPartiallyBooted())return n=arguments,void s();if(!e)return void((TS.model.ui_state.flex_name||i)&&TS.client.ui.flex.hideFlex(!0));t=t||"";var a=TS.model.ui_state.flex_extra||"";if(i||e!=TS.model.ui_state.flex_name||t!=a){if("list"===e&&(e="files"),"groups"===e&&!TS.lazyLoadMembersAndBots())return void TS.client.ui.flex.hideFlex(!0);TS.client.ui.flex._displayFlexTab(e)&&("files"===e?TS.client.ui.files.showFilesFromHistory(t):"team"===e?TS.client.ui.showTeamFromHistory(t):"search"===e?TS.client.ui.showSearchFromHistory(t):"convo"===e&&t?TS.client.ui.showRepliesFromHistory(t):"apps"===e?TS.client.ui.showAppsFromHistory(t):TS.client.flexDisplaySwitched(e,null,!1,!0))}},openConversationFlex:function(e,t){var n=e.id+"-"+t;(!TS.model.ui_state.flex_visible||"convo"!==TS.model.ui_state.flex_name||TS.model.ui_state.flex_extra!=n)&&(TS.client.ui.flex._displayFlexTab("convo"),TS.client.flexDisplaySwitched("convo",n))},openAppProfileFlex:function(e){var t=e;TS.client.ui.flex._displayFlexTab("apps"),TS.client.flexDisplaySwitched("apps",t)},rebuildMsgCurrentStatusIncludingMember:function(e){var t=TS.model.ui_state.flex_name;if("mentions"===t||"stars"===t){var n=$("#col_flex"),i={member:e,for_message:!0};_.each(TS.model.user[t],function(t){if(TS.utility.msgs.memberSentMessage(e,t.message)){n.find('ts-message[data-ts="'+t.message.ts+'"] .message_current_status').replaceWith(TS.templates.current_status(i))}})}else"files"===t&&TS.client.ui.files.rebuildFilePreviewAndCommentsIncludingMember(e)},registerCurrentStatusInput:function(){TS.client.ui.flex._unregisterCurrentStatusInput(),TS.client.ui.flex._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#member_preview_container"),has_presets_menu:!0,onEscape:p,onSave:p,onError:p}),$(".current_status_cover").on("click.current_status",h),$(".current_status_clear_icon_cover").on("click.current_status",function(e){e.stopPropagation(),TS.client.ui.flex._current_status_input&&TS.client.ui.flex._current_status_input.clearCurrentStatus()})},_unregisterCurrentStatusInput:function(){TS.client.ui.flex._current_status_input&&(TS.client.ui.flex._current_status_input.destroy(),TS.client.ui.flex._current_status_input=null),$(".current_status_cover").off(".current_status"),$(".current_status_clear_icon_cover").off(".current_status")}});var e,t,n,i=function(){e=void 0,t=void 0},a=_.once(function(){var n=function(){var n=e,a=t;i(),TS.model.ui_state.flex_visible&&TS.model.ui_state.flex_name&&n&&TS.client.ui.flex._displayFlexTab(n,a)};TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.addOnce(n):TS.ms.connected_sig.addOnce(n)}),s=_.once(function(){var e=function(){var e=n;return n=void 0,TS.client.ui.flex.setFlexStateFromHistory.apply(window,e)};TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.addOnce(e):TS.ms.connected_sig.addOnce(e)}),r=TS.i18n.t("Loading...","flexpane")(),o='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+r+'" /><br />'+r+"</div>",l=function(e){TS.model.ui_state.flex_visible&&TS.model.ui_state.flex_name===e?TS.client.ui.flex.hideFlex():TS.client.ui.flex.openFlexTab(e)},d=function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;TS.client.ui.flex.openFlexTab("details"),TS.client.channel_page.showMembersSection(),$("#channel_page_scroller .channel_page_members").highlight(null,"channel_page_members_highlighter")},c=function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;TS.client.ui.flex.openFlexTab("details"),TS.client.channel_page.showPinsSection(),$("#channel_page_scroller .channel_page_pinned_items").highlight(null,"channel_page_members_highlighter")},u=function(){var e=TS.model.ui_state.flex_visible,t=TS.model.ui_state.flex_name,n=TS.shared.getActiveModelOb();if(m(n),"team"===t&&TS.model.ui_state.flex_extra||(TS.model.previewed_member_id=null,TS.model.previewed_member_name=null,TS.model.previewed_user_group_id=null),e){var i=$("#details_toggle"),a=i.find(".ts_tip_tip"),s=$("#recent_mentions_toggle"),r=$("#stars_toggle");n&&"details"===t?(i.addClass("active"),n.is_im||n.is_mpim?a.text(TS.i18n.t("Hide Conversation Details","flexpane")()):(n.is_group||n.is_channel)&&a.text(TS.i18n.t("Hide Channel Details","flexpane")()),$("#client-ui").hasClass("details_showing")||TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").addClass("details_showing")})):"mentions"===t?(s.addClass("active"),s.find(".ts_tip_tip").text(TS.i18n.t("Hide Activity","flexpane")())):"stars"===t&&(r.addClass("active"),r.find(".ts_tip_tip").text(TS.i18n.t("Hide Starred Items","flexpane")()))}},m=function(e){var t=$("#details_toggle .ts_tip_tip");$("#client-ui").hasClass("details_showing")&&TS.client.ui.maintainMessagePanePosition(function(){$("#client-ui").removeClass("details_showing")}),$(".channel_header_icon.active").removeClass("active"),e&&(e.is_im||e.is_mpim?t.text(TS.i18n.t("Show Conversation Details","flexpane")()):t.text(TS.i18n.t("Show Channel Details","flexpane")())),$("#recent_mentions_toggle .ts_tip_tip").text(TS.i18n.t("Show Activity","flexpane")()),$("#stars_toggle .ts_tip_tip").text(TS.i18n.t("Show Starred Items","flexpane")())},h=function(){$(".current_status_container").addClass("active"),TS.client.ui.flex._current_status_input&&TS.client.ui.flex._current_status_input.focus()},p=function(e){var t=e&&(e.text||e.emoji);t&&($(".current_status_cover .current_status").html(TS.format.formatCurrentStatus(e.text,void 0,{stop_animations:!0,prevent_copy_paste:!1})),$(".current_status_cover .current_status_emoji_cover").html(TS.format.formatCurrentStatus(e.emoji,void 0,{stop_animations:!0,transform_missing_emoji:!0,ignore_emoji_mode_pref:"as_text"===TS.model.prefs.emoji_mode}))),$(".current_status_container").toggleClass("with_status_set",!!t),$(".current_status_container").removeClass("active")},g=82}()},2414:function(e,t){!function(){"use strict";TS.registerModule("client.ui",{test:function(){return{}},CLIENT_HEADER_OVERHANG:8,POSSIBLE_REBUILD_OMISSIONS:["channel_header","user_current_status","channel_pane_channels","channel_pane_apps","channel_pane_ims","channel_pane_starred"],$msgs_scroller_div:$("#msgs_scroller_div"),$msgs_div:$("#msgs_div"),$msg_input:$("#msg_input"),$msg_preview_msg:$("#msg_preview_msg"),$msg_preview:$("#msg_preview"),$emo_menu:null,$banner:$("#banner"),$msgs_unread_divider:null,file_dropped_sig:new signals.Signal,file_pasted_sig:new signals.Signal,did_rebuild_all_sig:new signals.Signal,did_rebuild_all_but_msgs_sig:new signals.Signal,msgs_scrolled_sig:new signals.Signal,onStart:function(){function t(){TS.client.ui.enhanceComponents(),TS.client.ui.bindCommentInput(),$(window.document).keydown(TS.client.ui.onWindowKeyDown).keyup(TS.client.ui.onWindowKeyUp),$("#team_menu .notifications_menu_btn").bind("click",function(e){if(TS.client.ui.shouldIgnoreClick(e))return!1;TS.menu.startWithNotificationsMenu(e)}),$("#team_menu").bind("click",function(e){return!TS.client.ui.shouldIgnoreClick(e)&&(!$(e.target).closest(".notifications_menu_btn").length&&void TS.menu.startWithTeamAndUser(e))}),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||$("#file_preview_container").on("textchange","#file_comment",function(){TS.client.ui.files.storeLastCommentInputForPreviewedFile($(this).val()),TS.ui.utility.updateClosestMonkeyScroller($("#file_preview_scroller"))}),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||$("#file_comment").css("overflow","hidden").autogrow(),$("#file_comment_form").bind("submit",function(){return TS.client.ui.files.submitFileComment(),!1}),$(window).on("click",T),TS.qs_args.ignore_mm||$("#header, #footer, #col_channels, #client_body, #col_flex").on("mouseenter",T),"ontouchstart"in document.documentElement?$("html").addClass("touch"):$("html").addClass("no_touch"),TS.client.archives.$scroller.scroll(function(){TS.model.ui.cached_archive_scroll_result=null}),TS.client.ui.$msgs_scroller_div.scroll(function(){TS.model.ui.cached_msgs_scroll_result=null}),TS.experiment.loadUserAssignments().then(function(){if("unknown_members"===TS.experiment.getGroup("unknown_members_perf",TS.members.unknown_members_perf_exp_metrics)){var e=_.throttle(function(e){var t=$(e.target),n=t.closest("button"),i=n.data("emoji");if(i){i=i.toString();var a=t.closest(".rxn_panel").data("rxnKey"),s=TS.rxns.getExistingRxnsByKey(a),r=_.find(s,{name:i}),o=r.users,l={count:r.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(s,i),name:i,url:r.url,rxn_key:a,member_ids:o};TS.tips.updateTipTitle(n,TS.i18n.t("Loading team members","client")()),TS.members.ensureMembersArePresent(o).then(function(){var e=TS.templates.builders.buildRxnTitle(l,!0);TS.tips.updateTipTitle(n,e)}).catch(function(){TS.tips.updateTipTitle(n,TS.i18n.t("Couldnt load team members","client")())})}},300);$("BODY").delegate(".rxn_panel button","mouseover",e)}}),$(window).on("copy cut",function(e){if(TS.utility.isFocusOnInput()){if(!TS.utility.contenteditable.supportsTexty())return;var t=document.activeElement;if(!TS.utility.contenteditable.isContenteditable(t))return}try{var n,i,a=window.getSelection(),s=TS.format.formatSelection(a,{customFn:function(e){return e.getAttribute("data-member-label")===e.textContent?e.getAttribute("data-member-label"):e.hasAttribute("data-member-name")?"@"+e.getAttribute("data-member-name"):void 0}});if(TS.boot_data.feature_texty_mentions&&(i=TS.format.formatSelection(a,{customFn:function(e){return e.hasAttribute("data-member-id")?"<@"+e.getAttribute("data-member-id")+"|"+e.getAttribute("data-member-label")+">":e.hasAttribute("data-user-group-id")?"<@"+e.getAttribute("data-user-group-id")+"|"+e.getAttribute("data-stringify-text")+">":e.hasAttribute("data-broadcast-id")?"<@"+e.getAttribute("data-broadcast-id")+"|"+e.getAttribute("data-stringify-text")+">":void 0}})),TS.boot_data.feature_texty_mentions&&$(e.target).closest(".ql-editor").length&&(n=TS.format.formatSelectionAsHTML(a)),s){var r={"text/plain":s,text:s,"public.utf8-plain-text":s,Text:s};TS.boot_data.feature_texty_mentions&&(n&&(r["text/html"]=n,r["slack/"+TS.model.team.id]=n),i&&(r["slack/plain"]=i)),TS.clipboard.writeTextFromEvent(e,r)}}catch(e){TS.error("window copy handler error: "+e)}})}V(),TS.channels.data_updated_sig.add(v),TS.ui.window_focus_changed_sig.add(TS.client.ui.windowFocusChanged),TS.membership.membership_counts_need_refetch_sig.add(TS.client.ui.rebuildMemberListToggle),TS.channels.joined_sig.add(TS.client.ui.rebuildMemberListToggle),TS.channels.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched),TS.ims.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched),TS.groups.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched),TS.mpims.switched_sig.add(TS.client.ui.channelOrImOrGroupDisplaySwitched),TS.prefs.color_names_in_list_changed_sig.add(TS.client.ui.prefColorNamesInListChanged),TS.prefs.msg_preview_changed_sig.add(TS.client.ui.prefMsgPreviewChanged),TS.prefs.sidebar_behavior_changed_sig.add(TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads),TS.rooms.added_sig.add(y),TS.rooms.changed_name_sig.add(k),TS.rooms.changed_participants_sig.add(A),TS.rooms.changed_date_end_sig.add(C),TS.rooms.changed_channels_sig.add(M),TS.prefs.team_display_email_addresses_changed_sig.add(D),TS.prefs.team_allow_calls_changed_sig.add(E),TS.view.im.im_ui_updated_with_new_msg_sig.add(p),TS.view.channel.channel_ui_updated_with_new_msg_sig.add(p),TS.view.group.group_ui_updated_with_new_msg_sig.add(p),TS.view.mpim.mpim_ui_updated_with_new_msg_sig.add(p),setInterval(G,15e3),TS.client.ui.$msgs_scroller_div.bind("mousedown mouseup",function(){TS.client.msg_pane.checkUnreads()});var n=null;e=new TS.PresenceList,$("html").bind("mousedown",function(e){TS.model.ui.is_mouse_down=!0,TS.client.ui.maybeTickleMS(),n=$(e.target)}),$("html").bind("dragend",function(){TS.model.ui.is_mouse_down=!1}),$("html").bind("mouseup",function(){TS.model.ui.is_mouse_down=!1,setTimeout(function(){n&&n.closest(".monkey_scroll_handle").length&&(TS.model.archive_view_is_showing?TS.client.archives.maybeLoadScrollBackHistory():TS.model.showing_welcome_2||TS.client.ui.maybeLoadScrollBackHistory()),n=null},10)}),TS.client.ui.$msgs_scroller_div.scroll(TS.client.ui.onMsgsScroll),TS.useReactSidebar()||TS.client.channel_pane.$scroller.scroll(TS.client.ui.onChannelsScroll),TS.client.login_sig.add(TS.client.ui.loggedIn,TS.ui),TS.client.msg_input.bind(TS.client.ui.$msg_input),TS.boot_data.feature_texty&&(TS.model.is_our_app||TS.boot_data.feature_texty_browser_substitutions)||TSSSB.call("inputFieldCreated",TS.client.ui.$msg_input.get(0)),TS.has_pri[Q]&&TS.log(Q,"deferring UI bind until login_sig"),TS.client.login_sig.add(t),TS.useReactMessages()&&TS.interop.mountMessagePane(document.querySelector(".p-history_container"))},spaces_tooltip:{state:"hide",pending_change:null},loggedIn:function(){if(TS.isPartiallyBooted()&&!TS.model.ms_connected)return TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.addOnce(TS.client.ui.loggedIn):TS.ms.connected_sig.addOnce(TS.client.ui.loggedIn),TS.model.ui_state.flex_name&&TS.client.ui.flex.showFlex(),void $("#main_emo_menu").removeClass("hidden").bind("click.incremental_boot",function(e){e.preventDefault(),TS.incremental_boot.userDidInteractWithUI()});TS.client.ui.flex.setFlexStateFromHistory(TS.model.ui_state.flex_name,TS.model.ui_state.flex_extra,!0),TS.model.ui_state.flex_name&&(TS.client.flexDisplaySwitched(TS.model.ui_state.flex_name,TS.model.ui_state.flex_extra,!0),TS.client.ui.flex.showFlex()),$("#main_emo_menu").removeClass("hidden").off("click.incremental_boot").bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:TS.client.ui.$msg_input,offset_y:4}),TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"emoji_menu_button"}}})}),window.extraCmds&&window.extraCmds(),TS.shared.checkDisplayEmailAddressPref()},rebuildAllButMsgs:function(e,t,r){if(t=t||{},r){if(a=a||e,TS.client.ui.POSSIBLE_REBUILD_OMISSIONS.forEach(function(e){t[e]||(s[e]=!1)}),i+=1,n)return;c(a,s),n=!0,setTimeout(function(){n=!1,i>1&&(c(a,s),TS.metrics.count("rebuild_all_but_msgs_throttles",i)),i=0,a=!1,s={}},1e3)}else c(e,s)},rebuildAll:function(e,t){if(t){if(TS.utility.enableFeatureForUser(10)&&TS.statsd.count("client_rebuild_throttled"),l=l||e,o+=1,r)return;u(l),r=!0,setTimeout(function(){r=!1,o>1&&(u(l),TS.metrics.count("rebuild_all_throttles",o)),o=0,l=!1},1e3)}else u(e)},windowFocusChanged:function(e){e?(TS.client.ui.startUnreadCheckingTimer(),TS.client.ui.maybeTickleMS(),TS.view&&TS.view.updateTitleBarColor(),TS.model.ui.is_mouse_down=!1):clearTimeout(TS.client.ui.unread_checking_tim)},cal_key_checker:{tim:null,tim_ms:200,prevent_enter:!1,space_pressed_last:!1,reset:function(){clearTimeout(TS.client.ui.cal_key_checker.tim),TS.client.ui.cal_key_checker.space_pressed_last=!1,TS.client.ui.cal_key_checker.prevent_enter=!1},check:function(e){TS.client.ui.cal_key_checker.space_pressed_last&&32!=e?(TS.client.ui.cal_key_checker.reset(),73==e&&(TS.client.ui.cal_key_checker.prevent_enter=!0,TS.client.ui.cal_key_checker.tim=setTimeout(TS.client.ui.cal_key_checker.reset,TS.client.ui.cal_key_checker.tim_ms))):32==e?(TS.client.ui.cal_key_checker.reset(),TS.client.ui.cal_key_checker.space_pressed_last=!0,TS.client.ui.cal_key_checker.tim=setTimeout(TS.client.ui.cal_key_checker.reset,TS.client.ui.cal_key_checker.tim_ms)):TS.client.ui.cal_key_checker.reset()}},keyPressIsValidForFocusOnNextOrPreviousMessage:function(e){if(!e)return!1;var t=TS.utility.keymap,n=-1!==[t.left_square_bracket,t.right_square_bracket,t.minus_sign,t.equals_sign].indexOf(e.which),i=e.altKey&&TS.utility.cmdKey(e);return n&&i&&TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()},keyPressIsValidForGotoNextOpenChannelOrIM:function(e){var t=TS.utility.keymap;if(!e)return!1;if(!e.altKey)return!1;if(e.which!=t.up&&e.which!=t.down)return!1;if(!TS.client.ui.isUserAttentionOnChat())return!1;if(TS.utility.isFocusOnInput()){var n=$(document.activeElement),i=TS.utility.contenteditable.getLength(n);if(i){if(TS.utility.contenteditable.isTextSelected(n))return!1;var a=TS.utility.getCursorPosition(n).start;if(e.which==t.up&&0!==a)return!1;if(e.which==t.down&&a!=i)return!1}}return!0},page_scroll_dest:null,onWindowKeyDown:function(e){if(TS.isPartiallyBooted())return void(TS.utility.cmdKey(e)&&(e.preventDefault(),e.stopPropagation()));var t=Date.now(),n=TS.utility.keymap,i=e.which==n.enter;TS.model.last_key_down_e=e,TS.client.ui.cal_key_checker.check(e.which);var a=TS.key_triggers[e.which.toString()];if(!TS.client.ui.isUserAttentionOnChat()||!a||a.isDisabled&&a.isDisabled(e)||(!e.metaKey||e.ctrlKey&&TS.model.is_mac)&&(!e.ctrlKey||e.altKey||TS.model.is_mac)||!(!a.no_shift&&(e.shiftKey||a.shift_optional)||a.no_shift&&!e.shiftKey))if(TS.boot_data.feature_a11y_keyboard_shortcuts&&TS.client.ui.keyPressIsValidForFocusOnNextOrPreviousMessage(e))switch(e.preventDefault(),e.stopPropagation(),e.which){case n.left_square_bracket:TS.ui.a11y.focusOnPreviousMessage();break;case n.right_square_bracket:TS.ui.a11y.focusOnNextMessage();break;case n.minus_sign:TS.ui.a11y.focusOnOldestUnreadMessage();break;case n.equals_sign:TS.ui.a11y.focusOnMessageInput()}else if(!TS.client.ui.isUserAttentionOnChat()||TS.client.activeChannelIsHidden()||TS.utility.isFocusOnInput()||!TS.utility.cmdKey(e)||e.altKey||e.which!=n.up)if(!TS.client.ui.isUserAttentionOnChat()||e.which!=n.left_square_bracket&&e.which!=n.right_square_bracket&&e.which!=n.left&&e.which!=n.right)if(TS.client.ui.keyPressIsValidForGotoNextOpenChannelOrIM(e)){var s=!1;e.which==n.up?s=TS.client.ui.gotoNextOpenChannelOrIM(e.shiftKey,!0):e.which==n.down&&(s=TS.client.ui.gotoNextOpenChannelOrIM(e.shiftKey,!1)),s&&TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input)&&TS.client.ui.$msg_input.blur(),e.preventDefault()}else if(!TS.client.ui.isUserAttentionOnChat()&&!TS.ui.shortcuts_dialog.showing||191!=e.which||e.altKey||e.shiftKey||!TS.utility.cmdKey(e))if(TS.client.ui.isUserAttentionOnChat()&&190==e.which&&!e.altKey&&TS.utility.cmdKey(e))"whats_new"===TS.model.ui_state.flex_name&&TS.clog.track("WHATSNEW_ACTION",{action:"close_pane",trigger:"keyboard_cmd_dot",step:TS.client.whats_new.getNewestID()}),TS.client.ui.flex.toggleFlex(),e.preventDefault();else if(TS.client.ui.isUserAttentionOnChat()&&TS.utility.cmdKey(e)&&e.shiftKey&&(75==e.which||84==e.which&&TS.model.is_our_app))TS.ui.fs_modal.is_showing?TS.ui.fs_modal.close():(84==e.which?TS.client.threads.showThreadsView():TS.ui.im_browser.start(),e.preventDefault());else if(e.which==n.space)TS.model.prefs&&TS.model.prefs.pagekeys_handled&&(TS.utility.isFocusOnInput()?e.which==n.space&&e.shiftKey&&TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)&&TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input)&&(TS.client.ui.$msg_input.blur(),e.preventDefault()):TS.model.is_FF&&TS.client.ui.$msgs_scroller_div.focus());else if(e.which==n.esc)TS.client.ui.onEscKey(e);else if(!(TS.utility.isPageKey(e.which)&&TS.model.prefs&&TS.model.prefs.pagekeys_handled)||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey)if(TS.utility.isFocusOnInput()||!TS.client.ui.isUserAttentionOnChat()||TS.client.activeChannelIsHidden()||TS.utility.isArrowKey(e.which)||TS.utility.isPageKey(e.which)||e.metaKey||e.ctrlKey||e.altKey||TS.ui.react_emoji_menu.is_showing)if(!window.macgap&&!window.winssb||TS.utility.isFocusOnInput()||!TS.client.ui.isUserAttentionOnChat()||TS.client.activeChannelIsHidden()||e.which!=n.V||e.altKey||!TS.utility.cmdKey(e))TS.model.archive_view_is_showing&&e.which==n.enter&&!e.metaKey&&!e.ctrlKey&&e.altKey;else{var r,o,l=window.macgap||window.winssb;l.clipboard&&l.clipboard.readString&&l.clipboard.readImage&&(r=l.clipboard.readString(),r?(TS.client.msg_input.populate(TS.utility.contenteditable.value(TS.client.ui.$msg_input)+r),e.preventDefault()):(o=l.clipboard.readImage())&&(TS.ui.paste.startUploadFromMacSSBReadImage(o,e.shiftKey),e.preventDefault())),TS.view.focusMessageInput()}else{if(16==e.keyCode)return;if(TS.boot_data.feature_keyboard_navigation&&"BUTTON"==e.target.tagName&&i&&bowser&&bowser.msedge)return e.preventDefault(),void e.target.click();if(TS.model.archive_view_is_showing&&i)return void TS.client.archives.tryToJoin();if(TS.boot_data.feature_keyboard_navigation&&(e.which==n.tab||i))return;(e.which==n.tab&&!TS.utility.cmdKey(e)||i)&&e.preventDefault(),TS.view.focusMessageInput()}else{var d=TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input),c=!d&&TS.utility.isFocusOnInput(),_=TS.model.archive_view_is_showing,u=_?TS.client.archives.$scroller:TS.client.ui.$msgs_scroller_div,m=u[0].scrollTop,h=u[0].scrollHeight,p=u.height();t=m,null!==TS.client.ui.page_scroll_dest&&(t=TS.client.ui.page_scroll_dest);var g=!0,S=$(document.activeElement);e.which==n.pageup?c?g=!1:TS.client.ui.page_scroll_dest=t-p:e.which==n.pagedown?c?g=!1:TS.client.ui.page_scroll_dest=t+p:e.which==n.home?c||d&&S.val()?(TS.model.is_mac&&(e.shiftKey||(S.setCursorPosition(0),e.preventDefault())),g=!1):TS.client.ui.page_scroll_dest=0:e.which==n.end&&(c||d&&S.val()?(TS.model.is_mac&&(e.shiftKey||(S.setCursorPosition(1e6),e.preventDefault())),g=!1):TS.client.ui.page_scroll_dest=h),g&&(TS.client.ui.slowScrollMsgsToPosition(TS.client.ui.page_scroll_dest,!0,function(){TS.client.ui.page_scroll_dest=null}),e.preventDefault())}else TS.ui.shortcuts_dialog.showing?TS.ui.shortcuts_dialog.cancel():TS.ui.shortcuts_dialog.start(),e.preventDefault();else f(e);else TS.client.ui.maybeEditLast(e);else e.preventDefault(),e.stopPropagation(),TS.model.ms_logged_in_once&&TS.model.prefs&&!$("body").hasClass("loading")&&a.func(e);TS.model.profiling_keys&&TS.model.addProfilingKeyTime("onWindowKeyDown",Date.now()-t),(e.which==n.shift||e.shiftKey)&&(TS.model.shift_key_pressed=!0),e.which==n.insert&&(TS.model.insert_key_pressed=!0),(e.which==n.alt||e.altKey)&&(TS.model.alt_key_pressed=!0),e.shiftKey&&e.metaKey&&e.which!=n.V&&(TS.model.shift_key_pressed=!1)},onWindowKeyUp:function(e){TS.model.last_key_down_e=null;var t=TS.utility.keymap;e.which==t.shift&&(TS.model.shift_key_pressed=!1),e.which==t.insert&&(TS.model.insert_key_pressed=!1),e.which==t.alt&&(TS.model.alt_key_pressed=!1,TS.utility.isFocusOnInput()||TS.selection.isAnyTextSelected()||TS.ui.fs_modal.is_showing||TS.view.focusMessageInput())},onEscKey:function(e){try{e.stopPropagation()}catch(e){}try{e.preventDefault()}catch(e){}if(TS.client.ui.isUserAttentionOnChat()&&!TS.model.unread_view_is_showing){if(TS.model.archive_view_is_showing)return void TS.client.archives.userWantsToCancel();if(!TS.msg_edit.editing&&!TS.ui.react_emoji_menu.is_showing){var t=e.shiftKey;if(t){var n=function(){TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.esc_all,t);var e,n=TS.model.channels,i=TS.model.groups;for(TS.useRedux()&&TS.redux.channels.clearAllShowInListEvenThoughUnreadsFlags(),e=n.length-1;e>-1;e-=1)TS.useRedux()||(n[e]._show_in_list_even_though_no_unreads=!1),n[e].unread_cnt&&(TS.channels.markMostRecentReadMsg(n[e],TS.model.marked_reasons.muted,!0),TS.channels.unread_changed_sig.dispatch(n[e],!0));for(e=i.length-1;e>-1;e-=1)TS.useRedux()||(i[e]._show_in_list_even_though_no_unreads=!1),i[e].unread_cnt&&(TS.groups.markMostRecentReadMsg(i[e],TS.model.marked_reasons.muted,!0),TS.groups.unread_changed_sig.dispatch(i[e],!0));TS.replies.markAllThreads()};if(!1===TS.model.prefs.confirm_clear_all_unreads||0===TS.model.all_unread_cnt)n();else{var i='<p class="no_bottom_margin float_right"><label class="checkbox overlay_pref block"><input id="confirm_clear_all_unreads_cb" type="checkbox" /> '+TS.i18n.t("Dont ask me again, please","client")()+"</label><p>";TS.generic_dialog.start({title:TS.i18n.t("Clear all unreads?","client")(),body:"<p>"+TS.i18n.t("<b>Shift+esc</b> will clear all unread messages and notifications. Are you sure you want to do this? Its liberating  but theres no going back.","client")()+"</p>"+i,show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Yes, clear all!","client")(),onGo:function(){n(),!!$("#confirm_clear_all_unreads_cb").prop("checked")&&TS.prefs.setPrefByAPI({name:"confirm_clear_all_unreads",value:!1})}})}}else TS.client.activeChannelIsHidden()?TS.model.threads_view_is_showing&&TS.client.threads.markAllNewThreads():TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.esc,t)}}},checkForEditing:function(e){if(!TS.msg_edit.editing)return!1;if(!e||!e.target||0===$(e.target).closest("#message_edit_form, #emoji_menu").length){if(!TS.msg_edit.editing_in_msg_pane)return!1;if(TS.msg_edit.mousedown_active)return TS.msg_edit.mousedown_active=!1,!0;if(TS.msg_edit.cancelEditingINothingHasChanged())return!1;TS.sounds.play("beep"),TS.msg_edit.promptEdit()}return!0},maybeTickleMS:function(){if(TS.model.user&&TS.model.ms_connected&&"away"!==TS.model.user.manual_presence){Date.now()-TS.model.last_net_send<2e4&&"active"===TS.model.user.presence||TS.client.ui.tickleMS()}},tickleMS:function(){TS.model.last_net_send=Date.now(),TS.isSocketManagerEnabled()?TS.interop.SocketManager.send({type:"tickle"}):TS.ms.send({type:"tickle"})},forceMarkAllRead:function(e,t){if(TS.client.msg_pane.dont_check_unreads_til_switch=!1,TS.client.ui.markMostRecentReadMsgInActive(e,!0),t){var n,i=TS.model.channels,a=TS.model.ims,s=TS.model.groups,r=TS.model.mpims;for(n=i.length-1;n>-1;n-=1)i[n].unread_cnt&&TS.channels.markMostRecentReadMsg(i[n],e,!0);for(n=a.length-1;n>-1;n-=1)a[n].unread_cnt&&TS.ims.markMostRecentReadMsg(a[n],e,!0);for(n=s.length-1;n>-1;n-=1)s[n].unread_cnt&&TS.groups.markMostRecentReadMsg(s[n],e,!0);for(n=r.length-1;n>-1;n-=1)r[n].unread_cnt&&TS.mpims.markMostRecentReadMsg(r[n],e,!0)}TS.client.markLastReadsWithAPI()},maybePromptForSetActive:function(){"away"===TS.model.user.manual_presence&&(TS.model.ui.is_window_focused?TS.client.ui.promptForSetActive():TS.ui.window_focus_changed_sig.addOnce(TS.client.ui.promptForSetActive))},promptForSetActive:function(){if(TS.model.prefs.confirm_user_marked_away){var e=TS.model.user,t='<p class="no_bottom_margin float_right"><label class="checkbox overlay_pref block"><input id="confirm_user_marked_away" type="checkbox" /> '+TS.i18n.t("Dont ask me again, please","client")()+"</label><p>";setTimeout(function(){"away"===e.manual_presence&&TS.generic_dialog.start({unique:"set_active_prompt",title:TS.i18n.t('You are marked as "away"',"client")(),body:"<p>"+TS.i18n.t("Would you like to switch to appear active?","client")()+"</p>"+t,show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Yes, set me to active","client")(),go_button_class:"btn_success",cancel_button_text:TS.i18n.t("No, still away","client")(),onGo:function(){"away"===e.manual_presence&&TS.members.toggleUserPresence(),!!$("#confirm_user_marked_away").prop("checked")&&TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:!1})},onCancel:function(){!!$("#confirm_user_marked_away").prop("checked")&&TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:!1})}})},2e3)}},enhanceComponents:function(){$("#flexpane_tabs li a").on("shown",function(){TS.view.resizeManually("TS.client.ui.enhanceComponents")})},shouldEventTriggerMaybeEditLast:function(e,t){return TS.utility.contenteditable.isEmpty(t)&&(TS.utility.cmdKey(e)||TS.model.prefs&&!TS.model.prefs.arrow_history)&&!e.altKey&&e.which==TS.utility.keymap.up},maybeEditLast:function(e){e.preventDefault(),e.stopPropagation();var t,n,i=TS.shared.getActiveModelOb();return i&&(n=i.msgs,n=TS.utility.msgs.getDisplayedMsgs(n),t=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,n))?(TS.msg_edit.startEdit(t.ts,TS.shared.getActiveModelOb()),!0):(TS.sounds.play("beep"),!1)},bindCommentInput:function(){TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()?$("#file_comment").on("focusin",function(){var e=$(this).closest(".flex_content_scroller")[0];e&&(e.scrollTop=e.scrollHeight)}):$("#file_comment").bind("focus",function(){var e=$(this).closest(".flex_content_scroller")[0];e&&(e.scrollTop=e.scrollHeight)})},showRepliesFromHistory:function(e){TS.client.flexDisplaySwitched("convo",e,!1,!0)},showAppsFromHistory:function(e){if(!e)return TS.client.ui.flex.hideFlex();var t,n=TS.shared.getActiveModelOb().id,i=TS.channels.getChannelById(n);if(_.get(i,"is_shared"))return TS.client.ui.flex.hideFlex();t=_.get(TS.model.team,"id"),TS.apps.promiseToGetFullAppProfile(e,t,null,!0).then(function(n){TS.client.ui.app_profile.openWithApp(n,e,t),TS.client.flexDisplaySwitched("apps",e,!1,!0)}).catch(function(){return TS.client.ui.flex.hideFlex()})},showSearchFromHistory:function(e){if(!e)return void TS.client.ui.flex.openFlexTab("mentions");e=TS.search.truncateQuery(e),e=e.replace(/%23/g,"#"),e=e.replace(/%252F/g,"/"),$("#search_terms").val(e).data("textchange_lastvalue",e),$("#header_search_form").submit(),TS.client.flexDisplaySwitched("search",e,!1,!0)},showTeamFromHistory:function(e,t){if(!e)return TS.client.ui._displayTeamList(),void TS.client.flexDisplaySwitched("team",null,!1,!0);var n;if(TS.interop.utility.looksLikeMemberId(e)&&!(n=TS.members.getMemberById(e))&&!t)return void TS.flannel.fetchAndUpsertObjectsByIds([e]).finally(function(){TS.client.ui.showTeamFromHistory(e,!0)});n||(n=TS.members.getMemberByName(e));var i=TS.user_groups.getUserGroupsById(e);n?TS.client.ui._displayMember(n.id).then(function(e){TS.client.flexDisplaySwitched("team",e,!1,!0)},_.noop):i?(TS.client.ui._displayUserGroup(i.id),TS.client.flexDisplaySwitched("team",i.id,!1,!0)):(TS.client.ui._displayTeamList(),TS.client.flexDisplaySwitched("team",null,!0))},showView:function(e){switch(e){case"Vall_unreads":TS.client.unread.showUnreadView();break;case"Vall_threads":TS.client.threads.showThreadsView();break;case"Vapp_space":TS.ui.apps_browser.start();break;default:TS.warn('Unknown view "'+e+'" passed to TS.client.ui.showView()')}},onSubmit:function(e){try{var t=$.trim(e);if(!t)return;var n="/unarchive"===t||"/leave"===t||"/part"===t||"/close"===t,i=TS.shared.getActiveModelOb();if(!n&&i&&i.is_archived)return TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","client")()),void TS.client.msg_input.populate(t);TS.view.clearMessageInput(),TS.utility.contenteditable.clearHistory(TS.client.msg_input.$input),"/"===e.substr(0,1)&&"//"!==e.substr(0,2)?TS.client.ui.sendSlashCommand(i,e):TS.client.ui.sendMessage(i,e)}catch(e){TS.error(e)}},sendSlashCommand:function(e,t,n){TS.chat_history.add(t);var i=TS.cmd_handlers.parseArgs(t),a=TS.utility.msgs.getEditLastShortcutCmd(t);if(TS.cmd_handlers[i.cmd]&&"client"===TS.cmd_handlers[i.cmd].type)setTimeout(function(){TS.cmd_handlers.runCommand(i,n,e)},10);else if(a)TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",e.id),TS.utility.msgs.tryToEditLastMsgFromShortcut(a);else{if(n&&!TS.cmd_handlers.isCmdSupportedInThreads(i.cmd))return void TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(i.cmd,i.original_txt,n,e);"/me"===i.cmd&&TS.model.prefs.convert_emoticons&&"as_text"!==TS.model.prefs.emoji_mode&&(i.rest=TS.format.doEmoticonConversion(i.rest));var s=i.rest,r=TS.format.cleanCommandText(s);TS.boot_data.feature_name_tagging_client&&(s=_.trim(i.original_txt.substr(i.cmd.length)),r=TS.format.cleanMsg(s));var o={command:i.cmd,text:r,channel:e.id,disp:i.disp};n&&(o.thread_ts=n.ts),TS.api.call("chat.command",o,function(e,t,n){TS.client.ui.onAPICommand(e,t,n,s)})}m(e)},sendMessage:function(e,t,n,i){if(TS.chat_history.add(t),e.is_mpim)TS.mpims.sendMsg(e.id,t,n,i);else if(e.is_group)TS.groups.sendMsg(e.id,t,n,i);else if(e.is_im)TS.ims.sendMsg(e.id,t,n,i);else{if(!e.is_channel)return;TS.channels.sendMsg(e.id,t,n,i)}e.id===TS.model.active_cid&&TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid),m(e)},prefMsgPreviewChanged:function(){!TS.model.prefs.msg_preview&&TS.model.msg_preview_showing?(TS.client.ui.$msg_preview.addClass("hidden"),TS.model.msg_preview_showing=!1):TS.model.prefs.msg_preview&&!TS.model.msg_preview_showing&&TS.client.ui.$msg_input.trigger("textchange"),TS.model.prefs.msg_preview&&!TS.model.prefs.msg_preview_persistent&&TS.model.msg_preview_showing&&TS.client.ui.$msg_input.trigger("textchange"),TS.view.resizeManually()},prefColorNamesInListChanged:function(){TS.model.prefs.color_names_in_list?$(".nuc").removeClass("nuc").addClass("user_colored"):$(".user_colored").removeClass("user_colored").addClass("nuc")},onAPICommand:function(e,t,n,i){var a,s=TS.model.active_cid;if(!e){n.channel&&n.thread_ts?TS.utility.populateThreadInputs(n.disp+" "+i,n.channel,n.thread_ts):TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)&&TS.utility.populateInput(TS.client.ui.$msg_input,n.disp+" "+i);var r,o=_.escape(n.disp)+(i?" "+_.escape(i):"");r=t.error&&"restricted_action"===t.error?TS.i18n.t("*{cmd_txt}* failed because you are not allowed to perform that action. Talk to your Team Owner.","client")({cmd_txt:o}):t.error&&"Unknown command"!==t.error&&"unknown_command"!==t.error?TS.i18n.t('*{cmd_txt}* failed with the error "{err_txt}"',"client")({cmd_txt:o,err_txt:t.error}):t.error?TS.i18n.t('*{cmd_txt}* is not a valid command. In Slack, all messages that start with the "/" character are interpreted as commands.\n\n If you are trying to send a message and not run a command, try preceding the "/" with an empty space.',"client")({cmd_txt:o}):TS.i18n.t("*{cmd_txt}* failed with an unknown error.","client")({cmd_txt:o}),a={text:r,ephemeral_type:"temp_slash_cmd_feedback",channel:s,slackbot_feels:"sad_surprise"},n.channel&&n.thread_ts&&(a.channel=n.channel,a.thread_ts=n.thread_ts,a.ephemeral_type="threads_temp_slash_cmd_feedback"),TS.client.ui.addOrFlashEphemeralBotMsg(a)}if(t.response){if(t.open_url){var l="_"+Math.random();TS.info("gonna try to launch a new tab/window with target: "+l+" url: "+t.open_url),TS.utility.openInNewTab(t.open_url,l)}if(t.keep_input){var d=n.command+" "+i;n.channel&&n.thread_ts?TS.utility.populateThreadInputs(d,n.channel,n.thread_ts):TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)&&TS.utility.populateInput(TS.client.ui.$msg_input,d)}var c=s;n.channel&&n.channel!=c&&(TS.channels.getChannelById(n.channel)?c=n.channel:TS.ims.getImById(n.channel)?c=n.channel:TS.groups.getGroupById(n.channel)&&(c=n.channel)),t.is_temp?(a={text:t.response,ephemeral_type:"temp_slash_cmd_feedback",channel:c},n.thread_ts&&(a.thread_ts=n.thread_ts,a.ephemeral_type="threads_temp_slash_cmd_feedback"),TS.client.ui.addOrFlashEphemeralBotMsg(a)):(TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid),n.channel&&n.thread_ts?TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.channel):TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid),a={text:t.response,channel:c,thread_ts:n.thread_ts},TS.client.ui.addEphemeralBotMsg(a))}else e&&(n.channel&&n.thread_ts?TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.channel):TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid),t.keep_input&&(n.channel&&n.thread_ts?TS.utility.populateThreadInputs(n.command+" "+i,n.channel,n.thread_ts):TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input)&&TS.utility.populateInput(TS.client.ui.$msg_input,n.command+" "+i)))},checkInlineImgsAndIframesEverywhere:function(e){TS.client.ui.checkInlineImgsAndIframes("main",e),TS.client.ui.checkInlineImgsAndIframes("search",e),TS.client.ui.checkInlineImgsAndIframes("archives",e),TS.client.ui.checkInlineImgsAndIframes("file_preview",e),TS.client.ui.checkInlineImgsAndIframes("file_list",e),TS.client.ui.checkInlineImgsAndIframes("replies",e),TS.client.ui.checkInlineImgsAndIframes("threads",e),TS.client.ui.checkInlineImgsAndIframes("unread",e)},checkInlineImgsAndIframesMain:function(){TS.client.ui.checkInlineImgsAndIframes("main")},getCachedDimensionsRect:function(e,t){var n;return TS.model.ui[e]?TS.model.ui[e]:t&&t[0]?(n=t.dimensions_rect(),n.width&&0!==n.width&&(TS.model.ui[e]=n),n):{top:0,bottom:0,left:0,right:0,width:0,height:0}},checkInlineImgsAndIframes:function(e,t){var n,i;if("main"===e)n=TS.client.ui.$msgs_div,i=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);else if("search"===e)n=$("#search_results"),i=TS.client.ui.getCachedDimensionsRect("cached_search_scroller_rect",n);else if("archives"===e)n=TS.client.archives.$scroller,i=TS.client.ui.getCachedDimensionsRect("cached_archives_scroller_rect",n);else if("file_preview"===e)n=$("#file_preview_container"),i=TS.client.ui.getCachedDimensionsRect("cached_file_preview_scroller_rect",n);else if("file_list"===e)n=$("#file_list"),i=TS.client.ui.getCachedDimensionsRect("cached_file_list_scroller_rect",n);else if("replies"===e)n=$("#convo_scroller"),i=TS.client.ui.getCachedDimensionsRect("cached_convo_scroller_rect",n);else if("unread"===e)n=TS.client.ui.unread.$scroller,i=TS.client.ui.getCachedDimensionsRect("cached_unread_scroller_rect",n);else{if("threads"!==e)return void TS.info("unknown which in checkInlineImgsAndIframes(which)");n=TS.client.ui.threads.$scroller,i=TS.client.ui.getCachedDimensionsRect("cached_threads_scroller_rect",n)}t&&TS.info("checkInlineImgsAndIframes which:"+e);var a,s,r,o,l=n.find(".msg_inline_holder:not(.hidden) .msg_inline_child.hidden, .msg_inline_file_preview_toggler:not(.collapsed) + .image_container .image_bg");l.each(function(){s=$(this),o=s.closest(".msg_inline_holder, .image_container"),o.length&&(o.data("loaded_bg")||(a=o.dimensions_rect(),t&&TS.dir(0,a),t&&TS.dir(0,i),TS.utility.doRectsOverlap(i,a)?(t&&TS.info("yes"),s.data("real-background-image")?(s.removeClass("hidden"),s.css("background-image",'url("'+s.data("real-background-image")+'")'),r=s.find("img")):(r=s,r.removeClass("hidden")),r.attr("src",r.data("real-src")),r.error(function(){$(this).closest(".msg_inline_holder, .image_body").addClass("broken_image")}),o.data("loaded_bg",!0)):t&&TS.warn("no"),s=null,r=null,o=null))}),n.find(".iframe_placeholder").each(function(){var e=$(this),t=e.closest(".msg_inline_holder");if(t.length){var n=t.dimensions_rect();if(TS.utility.doRectsOverlap(i,n)){var a=TS.utility.getIframeHTMLFromPlaceholder(e[0].outerHTML);e.replaceWith($(a))}}})},logUnreads:function(){var e=[],t=TS.shared.getActiveModelOb(),n=t.unreads;if(t){for(var i=0;i<n.length;i+=1)-1==TS.model.client.reads.indexOf(n[i])&&e.push(n[i]);TS.info(e)}},markMostRecentReadMsgInActive:function(e,t){var n=TS.shared.getActiveModelOb();TS.has_pri[H]&&n.unread_cnt&&TS.log(H,"TS.client.ui.markMostRecentReadMsgInActive, "+n.id+": reason = "+e+(t?", get_rid_of_line = "+t:""));var i=TS.shared.getControllerForModelOb(n);_.isFunction(i.markMostRecentReadMsg)&&i.markMostRecentReadMsg(n,e),t&&(TS.has_pri[H]&&TS.log(H,"markMostRecentReadMsgInActive, "+n.id+', reason = "'+e+'": calling TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar()'),TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar(e),TS.ui.pins.clearUnreadPinState(n)),n&&(n._temp_unread_cnt||n._temp_last_read)&&(TS.has_pri[L]&&TS.log(L,"markMostRecentReadMsgInActive: Nulling _temp_unread_cnt and _temp_last_read on "+n.id),n._temp_unread_cnt=null,n._temp_last_read=null)},isMsgInView:function(e){var t=TS.shared.getActiveModelOb();if(t){var n=TS.utility.msgs.getMsg(e,t.msgs);n&&n._jl_rolled_up_in&&(e=n._jl_rolled_up_in)}var i=TS.client.msg_pane.getCanonicalDivForMsg(e);if(!i.length)return!1;if(i.hasClass("hidden"))return!0;var a=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);return TS.client.ui.isElInView(i,5,a)},isUnreadDividerInView:function(e){e=e||5;var t=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);return TS.client.ui.isElInView(TS.client.ui.$msgs_unread_divider,e,t)},isElInView:function(e,t,n){if(!e||!e.length)return!1;t=t||0;var i=e.dimensions_rect();return i.height>n.height?TS.utility.doesRectContainRect(i,n,t,!0):!!TS.utility.doesRectContainRect(n,i,t,!0)},scrollSoTopUnseenChannelIsInView:function(e){if(!TS.useReactSidebar()){var t=I(TS.client.channel_pane.$scroller,$(e));if(t.length)t.first().scrollintoview({offset:"top",px_offset:50,scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null});else{var n=$("#starred_div");n.length&&n.length&&!n.hasClass("hidden")?$("#starred_section_header").scrollintoview({scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null}):$("#channels_header").scrollintoview({scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null})}}},scrollSoBottomUnseenChannelIsInView:function(e){if(!TS.useReactSidebar()){var t=I(TS.client.channel_pane.$scroller,$(e));t.length?t.last().scrollintoview({offset:"bottom",px_offset:-50,scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null}):TS.client.channel_pane.$scroller.children().last().scrollintoview({scroller:TS.environment.supports_custom_scrollbar?TS.client.channel_pane.$scroller:null})}},onChannelsScroll:function(){TS.useReactSidebar()||(TS.model.ui.cached_channels_scroller_rect=null,TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads(),TS.client.channel_pane.checkScrolledAtAll())},checkUnseenChannelsImsGroupsWithUnreads:TS.utility.immediateDebounce(function(){TS.useReactSidebar()||TS.client.ui.actuallyCheckUnseenChannelsImsGroupsWithUnreads()}),actuallyCheckUnseenChannelsImsGroupsWithUnreads:function(){if(!TS.useReactSidebar()){TS.client.ui.getCachedDimensionsRect("cached_channels_scroller_rect",TS.client.channel_pane.$scroller);var e,t,n,i,a=!1;i=TS.client.channel_pane.$scroller.find("li.unread:not(.muted_channel):not(.all_unreads)"),i.each(function(){var i=$(this);if(!TS.client.ui.isElInView(i,10,TS.model.ui.cached_channels_scroller_rect)){var s;s=i.hasClass("all_threads")?i.closest("#channels_scroller").position().top+i.position().top:i.closest(".section_holder").position().top+i.position().top,s<TS.model.ui.cached_channels_scroller_rect.top?(e=!0,i.hasClass("mention")&&(n=!0)):(t=!0,i.hasClass("mention")&&(a=!0))}});var s=$("#channel_scroll_up");e?(s.removeClass("hidden unseen_have_mentions"),n?s.addClass("unseen_have_mentions").find("span").html(TS.i18n.t("unread mentions","client")()):s.find("span").html(TS.i18n.t("more unreads","client")())):s.addClass("hidden").removeClass("unseen_have_mentions");var r=$("#channel_scroll_down");t?(r.removeClass("hidden unseen_have_mentions"),a?r.addClass("unseen_have_mentions").find("span").html(TS.i18n.t("unread mentions","client")()):r.find("span").html(TS.i18n.t("more unreads","client")())):r.addClass("hidden").removeClass("unseen_have_mentions")}},onMsgsScrollThrottled:function(){if(TS.client.ui.msgs_scrolled_sig.dispatch(),TS.client.ui.markScrollTop(),TS.client.ui.$msgs_unread_divider&&TS.shared.getActiveModelOb().unread_cnt){var e=TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div),t=z(TS.client.ui.$msgs_unread_divider,5,e),n=$("#messages_unread_status"),i="within"===t,a="below"===t,s=i&&!(TS.boot_data.feature_scrollback_half_measures&&TS.client.msg_pane.lastReadIsOlderThanCurrentHistory());n.toggleClass("unreads_below",a),n.toggleClass("quiet no_jump",s),n.off("click mouseenter mouseleave"),i?n.click(function(e){e.preventDefault(),TS.boot_data.feature_scrollback_half_measures&&TS.client.msg_pane.lastReadIsOlderThanCurrentHistory()?TS.client.ui.$msgs_scroller_div.animate({scrollTop:0},75):TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.clicked)}):(n.click(function(e){e.preventDefault(),TS.boot_data.feature_scrollback_half_measures&&TS.client.msg_pane.lastReadIsOlderThanCurrentHistory()?TS.client.ui.$msgs_scroller_div.animate({scrollTop:0},200):TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()}),TS.client.msg_pane.showNewMsgsBar(),TS.client.msg_pane.startNewMsgsTimer())}TS.model.ui.msgs_are_auto_scrolling||TS.client.msg_pane.checkUnreads()},onMsgsScroll:function(){TS.utility.throttle.method(TS.client.ui.onMsgsScrollThrottled,"ts_ui_on_msgs_scroll",250)},markScrollTop:function(){var e;e=TS.client.ui.areMsgsScrolledToBottom()?-1:TS.client.ui.$msgs_scroller_div[0].scrollTop;var t=!1,n=TS.shared.getActiveModelOb(),i=TS.shared.getControllerForModelOb(n);if(_.isFunction(i.markScrollTop)&&(t=i.markScrollTop(n.id,e)),0===e&&TS.shared.getActiveModelOb()&&TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id&&TS.model.cancelled_welcome_2_this_session)return TS.model.cancelled_welcome_2_this_session=!1,void TS.view.adjustForWelcomeSlideShow();t&&TS.client.ui.maybeLoadScrollBackHistory()},maybeLoadScrollBackHistory:function(){TS.client.ui.active_highlight_count||TS.model.ui.is_mouse_down||TS.client.ui.doLoadScrollBackHistory()},doLoadScrollBackHistory:function(e){var t=TS.shared.getActiveModelOb(),n=TS.shared.getControllerForModelOb(t);_.isFunction(n.maybeLoadScrollBackHistory)&&n.maybeLoadScrollBackHistory(t.id,e)},areMsgsScrolledToBottom:function(e,t){var n=TS.model.archive_view_is_showing?TS.model.ui.cached_archive_scroll_result:TS.model.ui.cached_msgs_scroll_result;if(null!==n&&!t)return n;e=isNaN(e)?50:e;var i=TS.model.archive_view_is_showing?TS.client.archives.$scroller:TS.client.ui.$msgs_scroller_div,a=i[0];if(a){var s=parseInt(i.css("height"),10)+a.scrollTop+e>=a.scrollHeight;return TS.model.archive_view_is_showing?TS.model.ui.cached_archive_scroll_result=s:TS.model.ui.cached_msgs_scroll_result=s,s}},instaScrollMsgsToBottom:function(e){if(TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest){var t=TS.shared.getActiveModelOb();if(t&&t.unread_cnt&&TS.model.ui.msgs_are_auto_scrolling){if(TS.model.ui.is_window_focused)return void(TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToBottom: exiting early because unread_cnt = "+t.unread_cnt+", and TS.model.ui.msgs_are_auto_scrolling = true"));TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToBottom: allowing scroll despite msgs_are_auto_scrolling = true and unread_cnt = "+t.unread_cnt+", because window is blurred.")}}TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToBottom: and_check = "+e);var n=TS.client.ui.$msgs_scroller_div[0].scrollHeight;if(TS.boot_data.feature_initial_scroll_position&&!n)return void(TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToBottom: stopping because scrollHeight is 0"));TS.client.ui.instaScrollMsgsToPosition(n,e,!0)},slowScrollMsgsToBottom:function(){TS.model.archive_view_is_showing?TS.client.archives.$scroller.animate({scrollTop:TS.client.archives.$scroller[0].scrollHeight},"500"):TS.client.ui.$msgs_scroller_div.animate({scrollTop:TS.client.ui.$msgs_scroller_div[0].scrollHeight},"500")},instaScrollMsgsToPosition:function(e,t,n){TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToPosition: scroll_top = "+e+", and_check = "+t+", set_btm_result = "+n),TS.model.ui.msgs_are_auto_scrolling=!0,TS.client.ui.$msgs_scroller_div.length&&(TS.client.ui.$msgs_scroller_div[0].scrollTop=e);var i=TS.shared.getActiveModelOb();setTimeout(function(){if(TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToPosition -> timeout(): scroll_top = "+e+", set_btm_result = "+n+"... resetting msgs_are_auto_scrolling."),TS.model.ui.msgs_are_auto_scrolling=!1,null!==n){var t=TS.shared.getActiveModelOb();if(i.id!==t.id)return TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToPosition -> timeout(): active model_ob changed from "+i.id+" to "+t.id),void(TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToPosition -> timeout(): NOT setting TS.client.ui.cached_msgs_scroll_result = "+n));TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToPosition -> timeout(): set TS.client.ui.cached_msgs_scroll_result = "+n+", previously "+TS.client.ui.cached_msgs_scroll_result),TS.client.ui.cached_msgs_scroll_result=n}},100),t&&(TS.has_pri[N]&&TS.log(N,"instaScrollMsgsToPosition: and_check, so checking unreads as well."),TS.client.msg_pane.checkUnreads())},slowScrollMsgsToPosition:function(e,t,n){var i=TS.model.archive_view_is_showing;t=t&&!i;var a;i?(TS.client.archives.msgs_are_auto_scrolling=!0,a=TS.client.archives.$scroller):(TS.model.ui.msgs_are_auto_scrolling=!0,a=TS.client.ui.$msgs_scroller_div),a.stop().animate({scrollTop:e},"500",function(){setTimeout(function(){i?TS.client.archives.msgs_are_auto_scrolling=!1:TS.model.ui.msgs_are_auto_scrolling=!1},100),t&&TS.client.msg_pane.checkUnreads(),n&&n()})},scrollMsgsSoMsgIsInView:function(e,t,n,i,a){i=isNaN(i)?1e3:i;var s,r=TS.model.archive_view_is_showing;if(s=r?TS.client.msg_pane.getDivForArchiveMsg(e):TS.client.msg_pane.getCanonicalDivForMsg(e),!s.length)return void(a||TS.utility.rAF(function(){a=!0,TS.client.ui.scrollMsgsSoMsgIsInView(e,t,n,i,a)}));var o;t&&(o=s.prevAll().slice(0,20),o.css("opacity",0),s.next().scrollintoview({duration:0,offset:"top"}));!r&&n&&(TS.client.ui.active_highlight_count+=1),r?TS.client.archives.msgs_are_auto_scrolling=!0:TS.model.ui.msgs_are_auto_scrolling=!0,TS.model.ui.scrolled_to_msg_ts=e,clearTimeout(B),B=setTimeout(function(){TS.model.ui.scrolled_to_msg_ts=null},1e4),s.scrollintoview({duration:i,offset:"center_vertical",complete:function(){n&&(s.highlight(2500,"msg_highlighter"),r||setTimeout(function(){TS.client.ui.active_highlight_count-=1},2500)),setTimeout(function(){t&&o&&o.transition({opacity:1},300)},100),r?(TS.client.archives.msgs_are_auto_scrolling=!1,TS.client.archives.onMsgsScroll()):(TS.model.ui.msgs_are_auto_scrolling=!1,TS.client.ui.onMsgsScroll())}})},active_highlight_count:0,scrollMsgsSoFirstUnreadMsgIsInView:function(e){if(TS.client.ui.$msgs_unread_divider){var t=TS.client.ui.$msgs_unread_divider;TS.model.ui.msgs_are_auto_scrolling=!0,t.scrollintoview({duration:200,offset:"top",px_offset:50,complete:function(){setTimeout(function(){TS.model.ui.msgs_are_auto_scrolling=!1,TS.client.ui.onMsgsScroll(),e&&e()},1)}})}},afterHistoryFetch:function(e){var t;TS.boot_data.feature_initial_scroll_position?(TS.model.ui.last_top_msg&&(t=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts)),TS.boot_data.feature_scrollback_half_measures&&t&&t.length?(t=j(t),TS.ui.utility.preventElementFromScrolling(t,function(){TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(e?e.id:"unspecified"),!1)},function(){var e=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts);return e.length||TS.utility.msgs.isMsgRolledUp(TS.model.ui.last_top_msg)&&(e=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg._jl_rolled_up_in)),e=j(e)}),TS.model.prefs.start_scroll_at_oldest&&TS.client.ui.$msgs_unread_divider&&e.unread_cnt&&!TS.client.msg_pane.dont_check_unreads_til_switch&&TS.client.ui.isUserAttentionOnChat()&&TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()):(TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(e?e.id:"unspecified"),!1),TS.client.msg_pane.setInitialScrollPosition(-1))):TS.boot_data.feature_scrollback_half_measures&&e.scroll_top>0&&TS.model.ui.last_top_msg?(t=TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts),TS.ui.utility.preventElementFromScrolling(t,function(){TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(e?e.id:"unspecified"),!1)},function(){return TS.client.msg_pane.getCanonicalDivForMsg(TS.model.ui.last_top_msg.ts)})):TS.client.msg_pane.rebuildMsgsWithReason("afterHistoryFetch for "+(e?e.id:"unspecified"),!1);var n=!!TS.boot_data.feature_initial_scroll_position;TS.view.resizeManually("TS.client.ui.afterHistoryFetch",n),TS.client.ui.record_content_visible_metric_after_fetching_model_ob==e.id&&(TS.metrics.mark("content_visible"),TS.metrics.measure("client_content_visible_4","start_nav","content_visible"),delete TS.client.ui.record_content_visible_metric_after_fetching_model_ob),0===e.scroll_top&&TS.model.ui.last_top_msg&&(TS.boot_data.feature_initial_scroll_position||TS.client.ui.scrollMsgsSoMsgIsInView(TS.model.ui.last_top_msg.ts,!0),TS.model.ui.last_top_msg=null,setTimeout(function(){0===e.scroll_top&&(TS.info("TS.client.ui.afterHistoryFetch: we're still scrolled to the top, so we'll try to fetch more messages now"),TS.client.ui.maybeLoadScrollBackHistory())},1e3))},rebuildMemberListToggle:function(){var e,t;if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id){var n=TS.shared.getActiveModelOb();if(!TS.lazyLoadMembersAndBots())return t=!0,e=0,TS.isPartiallyBooted()||(e=_(n.members).map(TS.members.getMemberById).compact().reject(function(e){return TS.boot_data.page_needs_enterprise?n.is_shared?e.deleted:!(e.enterprise_user&&e.enterprise_user.teams&&e.enterprise_user.teams.length&&e.enterprise_user.teams.indexOf(TS.model.team.id)>-1):e.deleted}).value().length),void R(t,e);var i=TS.membership.getMembershipCounts(n);if(i.promise&&(d||(d=!0,i.promise.then(function(){if(TS.shared.getActiveModelOb().id===n.id){t=!0;var e=_.get(i,"counts.member_count");R(t,e)}}).catch(function(e){var t=n.id;TS.warn("Fetching membership counts for "+t+" failed; trying again in 10000 ms"),TS.logError(e),setTimeout(function(){var e=TS.shared.getActiveModelOb();e&&e.id===t&&TS.client.ui.rebuildMemberListToggle()},1e4)}).finally(function(){d=!1}))),t=_.has(i,"counts.member_count"),e=_.get(i,"counts.member_count"),n.is_mpim&&TS.shared.isModelObShared(n))return void U(t,e,n);R(t,e)}else $("#channel_members_toggle").addClass("hidden")},maybePromptForClosingGroup:function(e){var t=TS.groups.getGroupById(e);if(t.unread_cnt){var n=TS.model.group_prefix+t.name;TS.generic_dialog.start({title:TS.i18n.t("You have unread messages","client")(),body:TS.i18n.t("You have unread messages in the {group_name} private channel. Are you sure you want to close it?","client")({group_name:n}),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Yes","client")(),cancel_button_text:TS.i18n.t("No","client")(),onGo:function(){TS.groups.markMostRecentReadMsg(t,TS.model.marked_reasons.closed),TS.client.markLastReadsWithAPI(),t.is_open,TS.groups.closeGroup(t.id)}})}else TS.groups.closeGroup(t.id)},maybePromptForClosingIm:function(e){var t=TS.ims.getImById(e);t.unread_cnt?TS.generic_dialog.start({title:TS.i18n.t("You have unread messages","client")(),body:TS.i18n.t("You have unread messages from {im_name}. Are you sure you want to close the DM?","client")({im_name:t.name}),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Yes","client")(),cancel_button_text:TS.i18n.t("No","client")(),onGo:function(){TS.ims.markMostRecentReadMsg(t,TS.model.marked_reasons.closed),TS.client.markLastReadsWithAPI(),TS.ims.closeIm(t.id)}}):TS.ims.closeIm(t.id)},unread_checking_tim:0,channelOrImOrGroupDisplaySwitched:function(){if(TS.client.msg_pane.dont_check_unreads_til_switch=!1,TS.model.client.reads.length=0,TS.client.msg_pane.hideNewMsgsBar(),TS.client.ui.startUnreadCheckingTimer(),TS.client.ui.rebuildMemberListToggle(),TS.useReactMessages()||TS.shared.maybeFetchHistoryAndThenCheckConsistency(TS.shared.getActiveModelOb()),TS.apps.isAppSpaceEnabled()&&TS.client.ui.app_space.resetUI(),"files"===TS.model.ui_state.flex_name||"convo"===TS.model.ui_state.flex_name){if(!TS.model.ui_state.flex_extra)return;var e;if("files"===TS.model.ui_state.flex_name){e=$("#back_from_file_preview").data("origin"),"channel_page"!==e&&"group_page"!==e&&"im_page"!==e||TS.client.ui.files._rebuildBackFromFilePreview("")}else if("convo"===TS.model.ui_state.flex_name&&("channel_page"===(e=TS.ui.replies.activeConvoOrigin())||"group_page"===e||"im_page"===e)){TS.ui.replies.toggleBackButton(!1)}}},startUnreadCheckingTimer:function(){TS.client.ui.unread_checking_tim&&window.clearTimeout(TS.client.ui.unread_checking_tim);var e=1e3;TS.model.prefs&&TS.model.prefs.mark_msgs_read_immediately&&(e=0),TS.client.ui.unread_checking_tim=setTimeout(TS.client.msg_pane.checkUnreads,e)},isUserAttentionOnChat:function(){return!!TS.model.ui.is_window_focused&&(!TS.model.dialog_is_showing&&(!TS.model.menu_is_showing&&(!TS.model.coachmark_is_showing&&(!TS.model.overlay_is_showing&&(!TS.ui.msg_tab_complete.isShowing()&&(!TS.ui.fs_modal.is_showing&&(!TS.ui.react_emoji_menu.is_showing&&"hidden"!==document.visibilityState)))))))},previewMember:function(e,t){return TS.client.ui._displayMember(e,t).then(function(e){TS.client.flexDisplaySwitched("team",e)},_.noop)},_displayMember:function(e,t){return new Promise(function(n,i){var a=TS.members.getPotentiallyUnknownMemberById(e);if(!a)return void i(new Error("wtf: no member to display"));if(!TS.client.ui.flex._displayFlexTab("team"))return void i(new Error("wtf: failed to open team tab"));var s=function(){P(a,t),n(TS.boot_data.feature_name_tagging_client||TS.boot_data.feature_shared_channels_client?a.id:a.name)};a.profile&&a.profile.fields?TS.team.ensureTeamProfileFields().then(s):s()})},showTeamList:function(){TS.client.ui._displayTeamList(!0)&&TS.client.flexDisplaySwitched("team")},_displayTeamList:function(e){if(!TS.client.ui.flex._displayFlexTab("team"))return!1;if(TS.model.previewed_member_name="",TS.model.previewed_member_id="",TS.model.previewed_user_group_id="",$("#user_group_preview_container").hideWithRememberedScrollTop(),$("#member_preview_container").hideWithRememberedScrollTop(),$("#team_list_container").unhideWithRememberedScrollTop(),TS.view.resizeManually("TS.client.ui._displayTeamList"),TS.lazyLoadMembersAndBots()){var t=TS.SearchableMemberList.get("team_directory");if(t)t.maybeRerenderLongListView();else{new TS.SearchableMemberList({$container:$("#team_list_container"),id:"team_directory",triggered_by_user_action:e}).showInitial()}}else TS.view.triggerInitialTeamListLazyLoad();return!0},showGroupsList:function(){TS.client.ui._displayGroupsList()&&TS.client.flexDisplaySwitched("groups")},_displayGroupsList:function(){return!!TS.client.ui.flex._displayFlexTab("groups")&&($("#user_groups_container").unhideWithRememberedScrollTop(),!0)},previewUserGroup:function(e,t){if(!t&&TS.lazyLoadMembersAndBots()&&(t="groups"),TS.client.ui._displayUserGroup(e,t)){var n=TS.user_groups.getUserGroupsById(e);TS.lazyLoadMembersAndBots()?TS.client.flexDisplaySwitched("groups",n.id):TS.client.flexDisplaySwitched("team",n.id)}},_displayUserGroup:function(e,n){if(!t){t=!0;var i=TS.user_groups.getUserGroupsById(e);if(!i)return!1;if(TS.lazyLoadMembersAndBots()){if(!TS.client.ui.flex._displayFlexTab("groups"))return!1}else if(!TS.client.ui.flex._displayFlexTab("team"))return!1;TS.view.user_groups_members_list_lazyload&&(TS.view.user_groups_members_list_lazyload.detachEvents(),TS.view.user_groups_members_list_lazyload=null),TS.model.previewed_user_group_id=i.id,TS.info("TS.model.previewed_user_group_id:"+TS.model.previewed_user_group_id),TS.lazyLoadMembersAndBots()?$("#user_groups_container").hideWithRememberedScrollTop():($("#team_list_container").hideWithRememberedScrollTop(),$("#member_preview_container").hideWithRememberedScrollTop());var a,s,r=function(){$("#user_group_preview_container").unhideWithRememberedScrollTop(),s=i.users;var e;e=TS.lazyLoadMembersAndBots()?TS.members.ensureMembersArePresent(s):Promise.resolve(),e.then(function(){var e=[];for(a=0;a<s.length;a+=1)e.push(TS.members.getMemberById(s[a]));e.sort(function(e,t){var n=e._real_name_lc||e._name_lc,i=t._real_name_lc||t._name_lc;return n>i?1:i>n?-1:0});var r=i.prefs.channels,o=[];for(a=0;a<r.length;a+=1)o.push(TS.channels.getChannelById(r[a]));var l=i.prefs.groups,d=[];for(a=0;a<l.length;a+=1)d.push(TS.groups.getGroupById(l[a]));o=o.concat(d);var c=-1===i.date_delete,_=TS.permissions.members.canEditUserGroups()||TS.permissions.members.canCreateAndDeleteUserGroups(),u=TS.templates.user_group_preview({user_group:i,members:e,channels:o,show_user_groups_edit:_,is_user_group_deleted:c}),m=$("#user_group_preview_scroller");m.html(u),TS.utility.makeSureAllLinksHaveTargets(m),$("#user_group_menu_toggle").on("click",function(e){TS.menu.startWithUserGroupMenu(e,i.id)}),$("#edit_default_channels").on("click",function(){TS.ui.admin_user_groups.editInfo(i)}),TS.ui.tabs.create($("#user_group_tabs")),TS.model.last_previewed_user_group_id!=TS.model.previewed_user_group_id&&m.length&&(m[0].scrollTop=0),TS.model.last_previewed_user_group_id=i.id;var h=$("#user_group_members");h.bind("click.view",TS.view.onMemberListClick),h.on("click.toggle_list_item",".team_list_item",TS.members.view.onTeamDirectoryItemClick),TS.utility.makeSureAllLinksHaveTargets(h),TS.environment.supports_custom_scrollbar||m.find(".user_group_member_list").monkeyScroll(),TS.view.user_groups_members_list_lazyload=h.find(".lazy").lazyload({container:$(".user_group_member_list"),ignore_when_hidden_element:$("#user_group_members"),all_images_same_size:!0}),$(".user_group_member_list").trigger("resize-immediate");var p=$("#back_from_user_group_preview");return w(n,p),TS.client.flex_pane.stopLocalTimeInterval(),TS.view.resizeManually("TS.client.ui._displayUserGroup"),t=!1,!0})};return void 0===i.users?TS.user_groups.getUserGroupMembers(e,function(e){if(e&&e.users)return i=e,r()}):r(),!0}},getNextOpenChannelOrIMElements:function(e){var t=!1,n=!1;e||"hide_read_channels"!==TS.model.prefs.sidebar_behavior?e||"hide_read_channels_unless_starred"!==TS.model.prefs.sidebar_behavior||(t=!0):n=!0;var i="LI:not(.public_private_channel_list_separator):not(.hidden)";e?i="LI.unread:not(.hidden), LI.active":t?i="LI.unread:not(.hidden), LI.active, LI.show_in_list_even_though_no_unreads:not(.hidden), UL#starred-list LI":n&&(i="LI.unread:not(.hidden), LI.active, LI.show_in_list_even_though_no_unreads:not(.hidden)");var a=TS.client.channel_pane.$scroller.find(i);return a=a.filter(":not(.all_unreads):not(.all_threads):not(.app_space)"),a.length||TS.error('no $lis found for "'+i+'"'),a},getNextOpenChannelOrIM:function(e,t,n){var i=TS.client.ui.getNextOpenChannelOrIMElements(e);if(!i.length)return i;if(n=n||i.filter(".active"),!n.length)return TS.error("active li not found"),n;if(n.length>1)return TS.error("too many active $lis found"),n;var a;return t?(a=i.eq(i.index(n)-1),a.length||(a=i.last())):(a=i.eq(i.index(n)+1),a.length||(a=i.first())),a},gotoNextOpenChannelOrIM:function(e,t){function n(e){var t={};if(!e||!e.length)return t;var n,i,a,s,r;e.hasClass("all_unreads")?(i="data-action",n="channel_name",r="unread_view"):e.hasClass("channel")?(i="channel-id",n="channel_name",r="channel",a=TS.channels.displayChannel,s=TS.channels.getChannelById):e.hasClass("group")?(i="group-id",n="group_name",r="group",a=TS.groups.displayGroup,s=TS.groups.getGroupById):e.hasClass("member")?(i="member-id",n="im_name",r="im",a=TS.ims.startImByMemberId,s=TS.ims.getImByMemberId):e.hasClass("mpim")?(i="mpim-id",n="mpim_name",r="mpim",a=TS.mpims.displayMpim,s=TS.mpims.getMpimById):e.hasClass("all_threads")?(i="data-action",n="channel_name",r="threads_view"):e.hasClass("app_space")&&(i="data-action",n="channel_name",r="app_space_view");var o=e.find("."+n);return o&&o.length?t={id:o.data(i),type:r,displayMethod:a,byIdMethod:s}:t}var i;if(TS.client.activeChannelIsHidden()){var a=TS.client.ui.getNextOpenChannelOrIMElements(e);i=t?a.filter(":first"):a.filter(":last")}var s=TS.client.ui.getNextOpenChannelOrIM(e,t,i);if(!s||!s.length)return!1;var r;s&&(r=TS.client.ui.getNextOpenChannelOrIM(e,t,s));var o=n(s);return"unread_view"===o.type?void TS.client.unread.showUnreadView():"threads_view"===o.type?void TS.client.threads.showThreadsView():"app_space_view"===o.type?void TS.client.app_space.showAppSpaceView():o.id&&o.type&&o.displayMethod?(o.displayMethod==TS.ims.startImByMemberId?o.displayMethod(o.id):o.displayMethod({id:o.id}),function(){if(r&&r.length){var e=n(r);if(e){var t=e.id;if(t){var i=e.byIdMethod(t);!i||i._history_fetched_since_last_connect||i.history_is_being_fetched||TS.api.callFuncWhenApiQisEmpty(function(){TS.has_pri[L]&&TS.log(L,'pre-fetching history for next keyboard action "'+i.id+'"'),TS.shared.maybeFetchHistory(i)})}}}}(),!0):(TS.warn("WTF no result from getDataFromListItem for $next_li?",s),!1)},tryToJump:function(e,t,n){var i=TS.shared.getModelObById(e);if(!i)return TS.error("NO CHANNEL NO IM GROUP"),!1;if(!t)return TS.client.displayModelOb(i),!0;if(TS.ims.isImWithDeletedMember(i)&&!TS.boot_data.feature_deleted_dm_archives)return!1;var a=TS.utility.msgs.getMsg(t,i.msgs);return a&&TS.utility.msgs.isMsgReply(a)?(TS.ui.replies.openConversation(i,a.thread_ts,a.ts),!0):!a&&n?(TS.ui.replies.openConversation(i,n,t),!0):(TS.view.displayMsgInModelOb(i,t),!0)},sendChannelMsgThroughSlackBot:function(e,t,n,i){var a=TS.channels.getChannelById(e);if(a){var s=n.split(",");if(s.length){var r=TS.utility.msgs.getMsg(t,a.msgs);if(!r)return void TS.client.ui.addEphemeralBotMsg({channel:a.id,text:TS.i18n.t("Darn, it looks like that message no longer exists.","client")(),slackbot_feels:"sad_surprise"});var o=TS.i18n.t("<p>Would you like to have slackbot send {names_text} your message?</p>","client")({names_text:F(s)});o+=TS.templates.builders.msgs.buildHTML({msg:r,model_ob:a,standalone:!0}),TS.generic_dialog.start({title:TS.i18n.t("Send message to users not in #{channel_name}","client")({channel_name:a.name}),body:o,go_button_text:TS.i18n.t("Yes, send it","client")(),onGo:function(){for(var t=0;t<s.length;t+=1)TS.api.call("chat.sendMention",{channel:e,user:s[t],ts:r.ts});i&&("C"===e.charAt(0)?TS.channels.removeMsg(e,TS.utility.msgs.getMsg(i,a.msgs)):"G"===e.charAt(0)&&TS.groups.removeMsg(e,TS.utility.msgs.getMsg(i,a.msgs)))}})}}},promptForGroupOrChannelInvite:function(e,t,n){var i=TS.groups.getGroupById(e)||TS.channels.getChannelById(e);if(i){var a=t.split(",");if(a.length)return i.is_private||i.is_group?void TS.ui.invite.showInviteMembersPreSelected(e,a,n):void TS.generic_dialog.start({title:TS.i18n.t("Invite new members to #{channel_name}","client")({channel_name:i.name}),body:TS.i18n.t("<p>Would you like to invite {names_text} to #{channel_name}?</p>","client")({names_text:F(a),channel_name:i.name}),go_button_text:TS.i18n.t("Yes, invite them","client")(),onGo:function(){TS.api.call("channels.invite",{channel:e,users:t}),n&&TS.channels.removeMsg(e,TS.utility.msgs.getMsg(n,i.msgs))}})}},addEphemeralBotMsg:function(e){var t=e.channel||TS.shared.getActiveModelOb().id,n=e.text;if(n){var i;i=e.username?{type:"message",subtype:"bot_message",icons:e.icons||null,is_ephemeral:!0,username:e.username,ts:e.ts,text:n}:{type:"message",user:"USLACKBOT",is_ephemeral:!0,ts:e.ts,text:n},e.slackbot_feels&&(i.slackbot_feels=e.slackbot_feels),e.thread_ts&&(i.thread_ts=e.thread_ts);var a=g(t,i,e.ephemeral_type);TS.info(a)}},addOrFlashEphemeralBotMsg:function(e){var t=e.channel||TS.shared.getActiveModelOb().id,n=e.ephemeral_type,i=n?TS.utility.msgs.getEphemeralMsgsByCidAndType(t,n):null;if(e.thread_ts&&(i=_.filter(i,function(t){return t.thread_ts===e.thread_ts})),i&&i.length){var a=TS.shared.getModelObById(t),s=i[0];TS.utility.contenteditable.supportsTexty()?s.text=TS.format.cleanInternalMsg(e.text):s.text=e.text,TS.boot_data.feature_parsed_mrkdwn&&TS.utility.msgs.clearCachedFormatting(s),a.is_im?TS.ims.message_changed_sig.dispatch(a,s):a.is_mpim?TS.mpims.message_changed_sig.dispatch(a,s):a.is_channel?TS.channels.message_changed_sig.dispatch(a,s):a.is_group&&TS.groups.message_changed_sig.dispatch(a,s)}else TS.client.ui.addEphemeralBotMsg(e)},maybeHandleReactionCmd:function(e,t,n){if(!e)return!1;if((t.match(/:/g)&&t.match(/:/g).length)<2)return!1;var i=":[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?";TS.boot_data.feature_localization&&(TS.i18n.locale()!==TS.i18n.DEFAULT_LOCALE&&(t=TS.emoji.maybeGetCanonicalEmojiString(t)),i=_.get(TSF,"emoji_rx.r.source")||i);var a=new RegExp("^(\\+|-) {0,1}("+i+")\\s*$"),s=t.match(a);if(!s)return!1;var r=s[1],o=s[2];if("+"!==r&&"-"!==r)return!1;var l=TS.rxns.getRxnKeyByMsgType(e);if(!l)return TS.sounds.play("beep"),!0;var d="+"===r;if(!b(e)||!TS.emoji.isValidName(o)||TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(l),o)==d)return TS.sounds.play("beep"),!0;if(d&&TS.boot_data.feature_thanks){var c=TS.rxns.getHandyRxnsDisplayDataByRxnKey(l);if(c.restrict&&!c.items[TS.emoji.stripWrappingColons(o)])return TS.sounds.play("beep"),!0}return TS.rxns.changeRxnsFromUserAction(l,o,d),n&&n(),!0},sendMsgFromUserFromSSB:function(e,t,n){if(!e)return!1;if(!t)return!1;var i=!1,a=TS.shared.getModelObById(e),s=a&&TS.utility.msgs.getMsg(n,a.msgs);return!(!s||!TS.client.ui.maybeHandleReactionCmd(s,t))||(s&&!s.thread_ts&&(s=null),0==e.indexOf("C")&&TS.channels.getChannelById(e)?i=TS.channels.sendMsg(e,t,s):0==e.indexOf("G")&&TS.groups.getGroupById(e)?i=TS.groups.sendMsg(e,t,s):0==e.indexOf("G")&&TS.mpims.getMpimById(e)?i=TS.mpims.sendMsg(e,t,s):TS.ims.getImById(e)&&(i=TS.ims.sendMsg(e,t,s)),!!i||(TSSSB.warn("TSSSB.sendMsgFromUser failed, invalid c_id or possible permission failure"),!1))},shouldIgnoreClick:function(e){return TS.isPartiallyBooted()?(e.preventDefault(),TS.incremental_boot.userDidInteractWithUI(),!0):!!TS.newxp.inOnboarding()},maintainMessagePanePosition:function(e){var t,n;if(TS.model.archive_view_is_showing)n=TS.client.archives.$scroller;else if(TS.model.unread_view_is_showing)n=TS.client.ui.unread.$scroller;else if(TS.model.threads_view_is_showing)n=TS.client.ui.threads.$scroller;else if(TS.model.app_space_view_is_showing)n=TS.client.ui.app_space.$scroller;else{if(TS.useReactMessages())return void e();n=TS.client.ui.$msgs_scroller_div}if(t=n.find("ts-message"),!TS.client.activeChannelIsHidden()&&TS.client.ui.areMsgsScrolledToBottom())e();else{var i=n.offset().top,a=_.find(t.toArray(),function(e){return $(e).offset().top-i>=0});TS.ui.utility.preventElementFromScrolling($(a),function(){e()})}}});var e,t,n=!1,i=0,a=!1,s={},r=!1,o=0,l=!1,d=!1,c=function(e,t){TS.metrics.mark("_rebuildAllButMsgsForReal"),t=t||{};var n=["channels","ims","starred","apps"].filter(function(e){return!t["channel_pane_"+e]});n.length&&TS.client.channel_pane.rebuild.apply(void 0,n),TS.client.msg_pane.rebuildChannelMembersList(),t.channel_header||(TS.client.msg_pane.displayTitle(),TS.client.msg_pane.updateEndMarker()),t.user_current_status||TS.view.members.updateUserCurrentStatus(),e&&TS.client.channel_pane.makeSureActiveChannelIsInView(),TS.client.unread.isEnabled()&&TS.client.ui.unread.updateSidebarLink(),TS.client.ui.threads.updateChannelPaneActiveState(),TS.client.ui.app_space.updateChannelPaneActiveState(),TS.client.ui.did_rebuild_all_but_msgs_sig.dispatch(),(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))&&TS.metrics.measure("client_ui_rebuild_all_but_msgs","_rebuildAllButMsgsForReal")},u=function(e){TS.utility.enableFeatureForUser(10)&&TS.statsd.count("client_rebuild");TS.metrics.mark("client_ui_rebuild_all"),TS.client.ui.rebuildAllButMsgs(e,null,!1),TS.client.msg_pane.rebuildMsgsWithReason("rebuildAll",!1),TS.client.ui.did_rebuild_all_sig.dispatch(),W(),(TS.boot_data.feature_tinyspeck||TS.utility.enableFeatureForUser(5))&&TS.metrics.measure("client_ui_rebuild_all","_rebuildAllButMsgsForReal")},m=function(e){e===TS.model.active_cid&&(TS.client.ui.isUnreadDividerInView()&&TS.client.ui.forceMarkAllRead(TS.model.marked_reasons.sent),TS.model.overlay_is_showing&&TS.view.overlay.cancelFromSendingMessage(),TS.model.showing_welcome_2&&(TS.model.cancelled_welcome_2_this_session=!0,TS.view.unAdjustForWelcomeSlideShow(),TS.client.ui.instaScrollMsgsToBottom(!0)))},h=function(e){var t=$(e).closest(".member_details");t.hasClass("cropped_preview")?(t.removeClass("cropped_preview"),TS.model.ui_state.expand_member_images_in_flexpane=!0):(t.addClass("cropped_preview"),TS.model.ui_state.expand_member_images_in_flexpane=!1),TS.storage.storeUIState(TS.model.ui_state),TS.view.resizeManually("TS.client.ui._displayMember")},p=function(e){if(!TS.model.prefs.seen_single_emoji_msg&&TS.model.user.id===e.user){var t=TS.shared.getActiveModelOb(),n=e.text;if(b(e)){if(!((n.match(/:/g)&&n.match(/:/g).length)<2)){var i=n.match(/^\s*(:[a-zA-Z0-9-_+]+:(:skin-tone-[2-6]:)?)\s*$/);if(i){var a=TS.emoji.isValidName(i[1]);if(a){var s=TS.rxns.getRxnKeyByMsgType(e);if(s&&!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(s),a)&&!t.is_slackbot_im){var r=TS.model.is_mac?"cmd":"ctrl";TS.client.ui.addEphemeralBotMsg({channel:t.id,ts:TS.interop.datetime.makeTsStamp(),text:TS.i18n.t("Hey! Looks like you just posted an emoji response. Did you know you can also react to messages directly with emojis? Click *Add reaction ...* on any message to try it. You can also type `+:emoji_name:` or `{cmd_key}+shift+\\` to react without leaving the comfort of your keyboard. Enjoy! :sparkles:","client")({cmd_key:r}),thread_ts:e.thread_ts}),TS.model.prefs.seen_single_emoji_msg=!0,TS.prefs.setPrefByAPI({name:"seen_single_emoji_msg",value:!0})}}}}}}},g=function(e,t,n){TS.utility.contenteditable.supportsTexty()&&(t.text=TS.format.cleanInternalMsg(t.text)),t.ts=t.ts||TS.interop.datetime.makeTsStamp();var i=TS.utility.msgs.processImsg(t,e),a=TS.shared.getModelObById(e);a&&a.is_mpim?TS.mpims.addMsg(e,i):a&&a.is_group?TS.groups.addMsg(e,i):a&&a.is_im?TS.ims.addMsg(e,i):a&&a.is_channel&&TS.channels.addMsg(e,i);var s={c_id:e,ephemeral_type:n};return t.thread_ts&&(s.thread_ts=t.thread_ts),TS.utility.msgs.ephemeral_msgs_map[t.ts]=s,t.ts},f=function(e){var t=TS.model.mac_ssb_version||TS.model.win_ssb_version&&TS.model.is_mac,n=TS.model.win_ssb_version&&TS.model.is_win||TS.model.lin_ssb_version&&TS.model.is_lin,i=TS.model.win_ssb_version&&TS.model.win_ssb_version>2||2===TS.model.win_ssb_version&&TS.model.win_ssb_version_minor>=4,a=TS.model.lin_ssb_version&&TS.model.lin_ssb_version>2||2===TS.model.lin_ssb_version&&TS.model.lin_ssb_version_minor>=4,s=TS.model.mac_ssb_version||i||a,r=e.metaKey&&!e.shiftKey&&!e.altKey,o=!e.metaKey&&!e.shiftKey&&e.altKey,l=TS.utility.keymap,d=e.which==l.left_square_bracket||e.which==l.right_square_bracket,c=e.which==l.left||e.which==l.right,_=r&&c;TS.boot_data.feature_prev_next_button&&TS.client.nav_history.setDirection(e.which),t&&!s&&r&&d?S(e.which,l.left_square_bracket,l.right_square_bracket,_,e):n&&!s&&o&&c?S(e.which,l.left,l.right,_,e):r&&c?S(e.which,l.left,l.right,_,e):r&&d&&TS.clog.track("HISTORY_NAV_ACTION",{trigger:"keyboard_shortcut",action:"nav_prev_next"})},S=function(e,t,n,i,a){var s=TS.utility.contenteditable.isEmpty(document.activeElement);(TS.utility.isFocusOnInput()&&(s||!i)||document.activeElement==document.body)&&(TS.clog.track("HISTORY_NAV_ACTION",{trigger:"keyboard_shortcut",action:"nav_prev_next"}),e===t?window.history.go(-1):e===n&&window.history.go(1),a&&a.preventDefault())},T=function(){TS.model.client.last_user_active_timestamp=new Date},v=function(e){e.id==TS.model.active_cid&&(TS.client.msg_pane.displayTitle(),TS.client.msg_pane.rebuildChannelMembersList())},b=function(e){return e&&!TS.utility.msgs.isTempMsg(e)&&!e.is_ephemeral},w=function(e,t){t.unbind(),"file_list"===e||"file_preview"===e?t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Files","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("files")}):"search_results"===e?t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Search Results","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("search")}):"im_page"===e?t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("Conversation Details","client")()).bind("click.back",function(){TS.client.ui.flex.openFlexTab("details")}):"groups"===e&&TS.lazyLoadMembersAndBots()?t.html(TS.templates.builders.filePreviewBackIcon()+TS.i18n.t("User Groups","client")()).bind("click.back",function(){TS.client.ui.showGroupsList()}):t.html(TS.templates.builders.filePreviewBackIcon()+(TS.boot_data.page_needs_enterprise?TS.i18n.t("Organization Directory","client")():TS.i18n.t("Team Directory","client")())).bind("click.back",function(){TS.client.ui.showTeamList()})},y=function(e){x(e)},k=function(e){x(e)},A=function(e){x(e)},C=function(e){x(e)},M=function(e){x(e)},x=function(e){var t=$("."+TS.templates.makeSHRoomClass(e.id));t.length&&t.replaceWith(TS.templates.builders.buildSHRoomAttachment(e))},I=function(e,t){return t.hasClass("unseen_have_mentions")?e.find("li.mention"):e.find("li.unread:not(.all_unreads)")},E=function(){"team"===TS.model.ui.active_tab_id&&TS.model.previewed_member_id&&TS.client.ui._displayMember(TS.model.previewed_member_id)},B=null,D=function(){TS.shared.onDisplayEmailAddressesPrefChanged()},F=function(e){var t=e.map(function(e){return TS.members.getPrefCompliantMemberName(TS.members.getPotentiallyUnknownMemberById(e),!0)});return TS.i18n.listify(t,{strong:!0}).join("")},P=function(t,n){var i=$("#member_preview_container"),a=TS.model.previewed_member_id===t.id&&!i.find(".cropped_preview").length||"menu_member_header"===n||TS.model.ui_state.expand_member_images_in_flexpane;TS.model.previewed_member_name=t.name,TS.model.previewed_member_id=t.id,TS.info("TS.model.previewed_member_id:"+TS.model.previewed_member_id);var s,r,o=t.is_bot&&TS.model.user.is_admin;o&&(r="/services/"+t.profile.bot_id,r=TS.bots.configureUrl(t));var l={member:t,show_bot_configuration:o,hide_more_menu:!1,bot_configure_url:r,show_call_action:TS.utility.calls.isEnabled()&&!t.is_bot&&"USLACKBOT"!==t.id,team_name:TS.model.team.name,show_admin_info:t.is_admin&&t.team_id===TS.model.user.team_id,lazy_load_profile_fields:!0};if(e.clear(),e.add(t.id),TS.boot_data.page_needs_enterprise){var d=TS.model.team;if(d&&d.id!==t.team_id&&(l.show_call_action=!1),!t.is_self){var c=TS.enterprise.getTeamsForMember(t,!0);l.teams=c}}s=TS.templates.team_member_preview(l),$("#user_group_preview_container").hideWithRememberedScrollTop(),$("#team_list_container").hideWithRememberedScrollTop(),i.unhideWithRememberedScrollTop();var u=$("#member_preview_scroller");if(u.html(s),TS.utility.makeSureAllLinksHaveTargets(u),t.deleted&&(TS.boot_data.feature_deleted_dm_archives?$("#member_deleted_view_archives_btn").removeClass("hidden"):TS.api.callImmediately("im.list").then(function(e){e.data.ims&&_.find(e.data.ims,function(e){return e.user==t.id})&&$("#member_deleted_view_archives_btn").removeClass("hidden")})),TS.model.last_previewed_member_id!=TS.model.previewed_member_id){var m=$("#member_preview_scroller");m.length&&(m.get(0).scrollTop=0)}TS.model.last_previewed_member_id=t.id;var p=$("#back_from_member_preview");w(n,p),TS.view.resizeManually("TS.client.ui._displayMember"),u.find(".member_details .member_image").click(function(){return h(this),TS.clog.track("USER_PROFILE_CLICK"),!1}),u.find(".member_preview_menu_target").click(function(e){TS.menu.member.startWithMemberPreview(e,t.id,!1,!0)}),a&&h(i.find(".member_image")),t.is_self&&TS.client.ui.flex.registerCurrentStatusInput(),TS.members.fetchMemberObjectsForUserProfileFields(t).then(function(){O(t)})},O=function(e){if(TS.model.previewed_member_id===e.id){var t=TS.team.getVisibleTeamProfileFieldsForMember(e);$("#member_data_table_team_fields").html(TS.templates.team_profile_fields({fields:t})),e.is_restricted&&$("#member_data_table_guest_fields").html(TS.templates.guest_profile_fields({member:e}))}},R=function(e,t){var n=e?TS.i18n.number(t,"client"):"";$("#channel_members_toggle_count_count").text(n),$("#channel_members_toggle_count").removeClass("hidden")},U=function(e,t,n){t=e?TS.i18n.number(t,"client"):"";var i=_(n.members).map(TS.members.getMemberById).compact().filter(TS.utility.teams.isMemberExternal).value().length,a=TS.teams.getTeamNameById(n.shared_team_ids[0]),s=t+" ("+TS.i18n.number(i,"client")+TS.i18n.t(" from ","client")()+a+")";$("#channel_members_toggle_count_count").text(s),$("#channel_members_toggle_count").removeClass("hidden")},L=58,Q=82,H=142,N=888,G=function(){var e=$("#presence");1==e.css("opacity")?e.css("opacity",.98):e.css("opacity",1)},j=function(e){if(!e||!e.length||!e.is("ts-message"))return e;var t=e.find(".comment");if(t.length)return t;var n=e.find(".message_body");return n.length?n:e},z=function(e,t,n){if(!e||!e.length||!n)return null;t=t||0;var i=e.dimensions_rect();return n.top>i.top-t?"above":n.bottom<i.bottom+t?"below":"within"},K=function e(){if(TS.apps.isAppSpaceEnabled()&&!TS.model.prefs.seen_app_space_coachmark&&!TS.newxp.inOnboarding()){var t=$("#apps_header").get(0),n=$("#loading-zone").get(0);t&&!n?TS.prefs.setPrefByAPI({name:"seen_app_space_coachmark",value:!0},function(){TS.model.prefs.seen_app_space_coachmark=!0,t.scrollIntoView(),TS.coachmark.start(TS.coachmarks.coachmarks.apps)}):setTimeout(e,500)}},W=_.debounce(K,1500),V=function(){if(TS.boot_data.feature_keyboard_navigation){var e=$('<div tabindex="0"></div>');$("body").prepend(e),e.on("focus",TS.view.focusMessageInput),e.on("blur",function(){e.remove()})}}}()},2415:function(e,t){!function(){"use strict";TS.registerModule("client.ui.threads",{$channel_pane_item:$("#channels_scroller .all_threads"),$scroller:$("#threads_msgs_scroller_div"),$container:null,onStart:function(){TS.prefs.team_perms_pref_changed_sig.add(w),TS.prefs.emoji_mode_changed_sig.add(S),TS.channels.joined_sig.add(b),TS.channels.left_sig.add(b),TS.groups.left_sig.add(b),TS.channels.archived_sig.add(b),TS.groups.archived_sig.add(b),TS.channels.unarchived_sig.add(b),TS.groups.unarchived_sig.add(b),TS.client.threads.new_thread_reply_count_changed.add(g),TS.channels.read_only.list_updated_sig.add(u),t=new TS.PromiseQueue},showThreadsView:function(){$("#client-ui").addClass("threads_view_is_showing"),TS.client.ui.threads.$scroller.addClass("loading"),TS.client.ui.threads.$scroller.addClass("emojimode_"+TS.model.prefs.emoji_mode),$("#footer").addClass("hidden"),TS.client.archives.cancel(!0);TS.client.ui.rebuildAllButMsgs(!0),TS.useReactSidebar()&&TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vall_threads")),"details"===TS.model.ui_state.flex_name&&TS.client.ui.flex.hideFlex(!0);TS.client.msg_pane.hideNewMsgsBar(!0),TS.client.ui.threads.$container=$('<div id="threads_msgs"></div>'),TS.client.ui.threads.$container.appendTo(TS.client.ui.threads.$scroller),TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback"),TS.environment.supports_custom_scrollbar||TS.client.ui.threads.$scroller.monkeyScroll(),$("#threads_view_banner").removeClass("hidden"),TS.utility.msgs.startUpdatingRelativeTimestamps("#threads_msgs"),k(),TS.clog.track("THREADS_VIEW_OPEN",{view_session_index:i}),TS.client.ui.threads.incrementTrackingSeqId()},isThreadsViewDOMShowing:function(){return $("#client-ui").hasClass("threads_view_is_showing")},destroyThreadsView:function(){TS.client.ui.threads.resetUI(),TS.client.ui.threads.$scroller.off("scroll.threads_view_scroll"),TS.client.ui.threads.$scroller.empty(),$("#client-ui").removeClass("threads_view_is_showing"),T(),$("#footer").removeClass("hidden"),TS.client.ui.threads.$container=null,TS.utility.msgs.stopUpdatingRelativeTimestamps("#threads_msgs"),a||TS.client.ui.threads.trackThreadsViewClosed("OTHER")},resetUI:function(){t.clear(),f(),e&&(TS.ui.message_container.cleanup(e),e=null),TS.client.ui.threads.$container.empty(),$(".threads_alternative_view_wrapper").remove(),TS.client.ui.threads.$scroller.addClass("loading")},displayEmptyState:function(){if(TS.model.threads_view_is_showing){var e={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f331.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f331.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f331.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f331.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f331.png"},t={emoji:e[TS.model.prefs.emoji_mode],is_empty:!0};TS.client.ui.threads.displayAlternativeThreadsView(t)}},displayFatalError:function(){if(TS.model.threads_view_is_showing){var e={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f420.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f420.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f420.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f420.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f420.png"},t={emoji:e[TS.model.prefs.emoji_mode],is_error:!0};TS.client.ui.threads.displayAlternativeThreadsView(t)}},displayAlternativeThreadsView:function(e){TS.client.ui.threads.$scroller.find(".threads_alternative_view_wrapper").remove(),TS.client.ui.threads.$scroller.removeClass("loading"),TS.client.ui.threads.$scroller.removeClass("slow_loading"),TS.client.ui.threads.$scroller.find("#threads_msgs").empty(),TS.client.ui.threads.$scroller.append(TS.templates.threads_alternative_view(e))},isAlternativeThreadsViewShowing:function(){return TS.client.ui.threads.$scroller.find(".threads_alternative_view_wrapper").length>0},displaySlowLoadingMessage:function(){TS.client.ui.threads.$scroller.hasClass("loading")&&TS.client.ui.threads.$scroller.addClass("slow_loading");var e=$("#threads_msgs .and_more_end, #threads_msgs .and_more_beginning");if(e.length){var t=TS.i18n.t("Still loading... sorry for the long wait!","threads")();e.text(t)}},updateChannelPaneUnreadState:function(e,t){TS.client.ui.threads.$channel_pane_item.toggleClass("unread",e),TS.client.ui.threads.$channel_pane_item.toggleClass("mention",!!t);var n=TS.client.ui.threads.$channel_pane_item.find(".unread_highlights");t?(t>9&&(t="9+"),n.text(t)):n.empty(),n.toggleClass("hidden",!t)},updateChannelPaneActiveState:function(){TS.client.ui.threads.$channel_pane_item.toggleClass("active",!!TS.model.threads_view_is_showing)},startWithData:function(t,n){if(TS.client.ui.threads.$scroller.removeClass("loading"),TS.client.ui.threads.$scroller.removeClass("slow_loading"),t.length<1)return void TS.client.ui.threads.displayEmptyState();e={name:"threads",container:TS.client.ui.threads.$container,scroller:TS.client.ui.threads.$scroller,page_size:8,msg_order:"desc",skip_day_groupings:!0,has_more_beginning:!1,has_more_end:!!n,buildSection:function(e){return TS.templates.thread_view_section({is_old_section:"old_threads"===e.id,show_threads_notification_banner:y(e,t)})},buildMsgHTML:function(e,t){return d(e,t)},updateCallback:function(){c()},promiseToLoadMoreAtEnd:function(){return TS.client.threads.loadMoreThreads().then(l)}},e.sections=[];var i=_.filter(t,{grouping:"new"}),a=_.filter(t,{grouping:"old"});if(i.length){r().msgs=i}if(a.length){o().msgs=a}if(!TS.environment.supports_custom_scrollbar){var s=TS.client.ui.threads.$scroller.data("monkeyScroll");s&&s.updateFunc()}TS.ui.message_container.register(e),c(),p()},buildThreadMsgHTML:function(e,t,n){return TS.templates.builders.buildThreadMsgHTML(e,t,n)},maybeUpdateThreadWithMessage:function(e,n,i){t.addToQ(function(){var t=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+(n.thread_ts||n.ts)+'"]');t.length&&(TS.ui.thread.updateThreadWithMessage(t,e,n,i),TS.boot_data.feature_no_placeholders_in_messages||TS.client.ui.checkInlineImgsAndIframes("threads"))})},maybeRemoveNewRepliesBanner:function(){t.addToQ(function(){s&&f()})},maybeRemoveMessageFromThread:function(e,n){if(e&&n){if(n.ts===n.thread_ts)return void TS.error("Attempting to remove remove root msg from DOM instead of converting it to tombstone or deleting entire <ts-thread>");var i=TS.client.threads.getThread(e,n.thread_ts);i&&t.addToQ(function(){var e=TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+(n.thread_ts||n.ts)+'"]');if(e.length){return TS.ui.thread.removeMessageFromThread(e,i,n)}})}},maybeRemoveThread:function(n,i){n&&i&&t.addToQ(function(){_.forEach(e.sections,function(e){e.msgs=_.without(e.msgs,_.find(e.msgs,function(e){return n.id===e.model_ob.id&&i.root_msg.thread_ts===e.root_msg.thread_ts}))}),TS.ui.message_container.update(e)})},insertNewThread:function(n){t.addToQ(function(){if(TS.client.ui.threads.$scroller.removeClass("loading"),TS.client.ui.threads.$scroller.removeClass("slow_loading"),_.get(e,"sections")){var t;t="new"===n.grouping?r():o(),t.msgs.push(n),t.msgs.sort(TS.client.threads.threadCompare);var i=TS.client.ui.threads.$container.find("ts-thread:first");TS.ui.message_container.updateWithFocus(e,i)}})},jumpToTop:function(){TS.model.threads_view_is_showing&&TS.ui.message_container.jumpToTop(e)},revealNewReplies:function(e){t.addToQ(function(){var t=v(e);if(t.length)return TS.ui.thread.revealNewReplies(t,e).then(function(){TS.boot_data.feature_no_placeholders_in_messages||TS.client.ui.checkInlineImgsAndIframes("threads")})})},revealPreviousReplies:function(e,n){var i=v(e);return n.isPending()&&TS.ui.thread.showThreadLoadingSpinner(i),t.addToQ(function(){if(i.length)return TS.ui.thread.revealPreviousReplies(i,e,n).then(function(){TS.boot_data.feature_no_placeholders_in_messages||TS.client.ui.checkInlineImgsAndIframes("threads")})})},maybeRedrawThread:function(n){t.addToQ(function(){n.edited=Date.now(),TS.ui.message_container.update(e)})},hideCaughtUpDivider:function(){TS.model.threads_view_is_showing&&$("#threads_msgs .threads_caught_up_divider").addClass("hide_divider")},getThreadFromEl:function(e){if(e&&e.length){var t=e.closest("ts-thread"),n=t.attr("data-model-ob-id"),i=t.attr("data-thread-ts");if(n&&i){var a=TS.shared.getModelObById(n);return TS.client.threads.getThread(a,i)}}},incrementTrackingSeqId:function(){i+=1},trackThreadsViewClosed:function(e){var t=_.merge(TS.client.ui.threads.getTrackingData(),{num_threads_loaded:TS.client.threads.getThreadsLoadedCount(),view_exit_event:e});TS.clog.track("THREADS_VIEW_CLOSE",t),a=!0},getTrackingData:function(){return{view_session_elapsed_time:Date.now()-n,view_session_index:i}},rebuildMsgsIncludingMember:function(t){if(TS.model.threads_view_is_showing){var n=_.get(e,"sections");n&&_.each(n,function(e){_.each(e.msgs,function(e){TS.utility.msgs.messageIncludesMember(t,e.root_msg)&&TS.client.ui.threads.maybeUpdateThreadWithMessage(e,e.root_msg),_.each(e.replies,function(n){TS.utility.msgs.messageIncludesMember(t,n)&&TS.client.ui.threads.maybeUpdateThreadWithMessage(e,n)})})})}},rebuildMsgCurrentStatusIncludingMember:function(t){if(TS.model.threads_view_is_showing){var n=_.get(e,"sections");if(n){var i={member:t,for_message:!0};_.each(n,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(t,e.root_msg)){TS.client.ui.threads.$container.find('ts-message[data-ts="'+e.root_msg.ts+'"] .message_current_status').replaceWith(TS.templates.current_status(i))}_.each(e.replies,function(e){if(TS.utility.msgs.memberSentMessage(t,e)){TS.client.ui.threads.$container.find('ts-message[data-ts="'+e.ts+'"] .message_current_status').replaceWith(TS.templates.current_status(i))}})})})}}}});var e,t,n,i,a,s=!1,r=function(){if(e&&e.sections){var t=_.find(e.sections,{id:"new_threads"});return t||(t={id:"new_threads",order:0,msgs:[]},e.sections.unshift(t)),t}},o=function(){if(e&&e.sections){var t=_.find(e.sections,{id:"old_threads"});return t||(t={id:"old_threads",order:1,msgs:[]},e.sections.push(t)),t}},l=function(t){var n=t.has_more,i=t.threads;if(_.get(e,"sections")){var a=_.filter(i,{grouping:"new"}),s=_.filter(i,{grouping:"old"});a.length&&(r().msgs=a),s.length&&(o().msgs=s),e.has_more_end=!!n}},d=function(e){return TS.ui.thread.buildThreadHTML(e)},c=function(e){var t=TS.client.ui.threads.$container;if(t){var n=t.find("ts-thread");_.forEach(n,function(t){e&&$(t).data("input_rendered",!1),h($(t))})}},u=function(){c(!0)},m=function(e){var t=TS.client.ui.threads.$container.find("ts-thread[data-model-ob-id="+e.id+"]");t.data("input_rendered",!1),_.forEach(t,function(e){h($(e))})},h=function(e){if(e&&e.length&&!e.data("input_rendered")){var t=e.attr("data-model-ob-id"),n=e.attr("data-thread-ts");if(t&&n){var i=TS.shared.getModelObById(t);if(i){var a=TS.client.threads.getThread(i,n);if(!a)return void TS.error("Thread not found in TS.client.threads _thread_data");TS.ui.thread.renderReplyInput(e,a),e.data("input_rendered",!0)}}}},p=function(){var t=TS.client.ui.threads.$scroller;t.on("scroll.threads_view_scroll",_.debounce(function(){if(TS.model.threads_view_is_showing&&s&&0===t.scrollTop()){var n=TS.ui.message_container.getRange(e),i=_.get(n,"start");if(!i)return;if(-1===i.msg_ts)return void TS.client.threads.markAllNewThreads();var a=e.sections[0].msgs[0];a&&i.msg_ts!==a.ts||TS.client.threads.markAllNewThreads()}},150))},g=function(e){var t=$("#threads_view_banner"),n=TS.i18n.t("{new_thread_reply_count,plural,=1{{new_thread_reply_count} new reply}other{{new_thread_reply_count} new replies}}","threads")({new_thread_reply_count:e});t.find("#new_replies_info").text(n),t.removeClass("no_opacity"),TS.client.ui.threads.$container.addClass("new_banner_is_showing"),s=!0},f=function(e){s=!1,e&&$("#threads_view_banner").addClass("hidden"),$("#threads_view_banner").addClass("no_opacity"),TS.client.ui.threads.$container.removeClass("new_banner_is_showing")},S=function(){TS.model.threads_view_is_showing&&(T(),TS.client.ui.threads.$scroller.addClass("emojimode_"+TS.model.prefs.emoji_mode))},T=function(){TS.client.ui.threads.$scroller.removeClass(function(e,t){return(t.match(/(^|\s)emojimode_\S+/g)||[]).join(" ")})},v=function(e){var t=e.root_msg.ts,n=e.model_ob.id;return TS.client.ui.threads.$container.find('ts-thread[data-thread-ts="'+t+'"][data-model-ob-id="'+n+'"]')},b=function(e){TS.model.threads_view_is_showing&&t.addToQ(function(){m(e)})},w=function(e){TS.model.threads_view_is_showing&&e&&"who_can_post_general"===e&&t.addToQ(function(){var e=TS.channels.getGeneralChannel();m(e)})},y=function(e,t){return!TS.model.prefs.seen_threads_notification_banner&&"mentions"===TS.notifs.getGlobalNotificationSetting()&&!TS.model.prefs.threads_everything&&"new_threads"===e.id&&t.length>3},k=function(){n=Date.now(),i=0,a=!1}}()},2416:function(e,t){!function(){"use strict";TS.registerModule("client.ui.unread",{$channel_pane_item:$("#channels_scroller .all_unreads"),$scroller:$("#unread_msgs_scroller_div"),$loading_msg_container:null,$unread_msgs_div:null,$container:null,unread_groups:[],msgs_rendered_sig:new signals.Signal,started_sig:new signals.Signal,showUnreadView:function(){TS.channels.renamed_sig.add(S),TS.groups.renamed_sig.add(S),TS.inline_file_previews.collapse_sig.add(k),TS.inline_file_previews.expand_sig.add(k),TS.inline_others.collapse_sig.add(k),TS.inline_others.expand_sig.add(k),TS.inline_audios.collapse_sig.add(k),TS.inline_audios.expand_sig.add(k),TS.inline_videos.collapse_sig.add(k),TS.inline_videos.expand_sig.add(k),TS.inline_room_previews.toggle_sig.add(k),TS.inline_imgs.expand_sig.add(k),TS.inline_imgs.collapse_sig.add(k),TS.inline_attachments.expand_sig.add(k),TS.inline_attachments.collapse_sig.add(k),TS.boot_data.feature_sli_briefing&&TS.highlights_briefing.updated_sig.add(k),TS.client.highlights.updated_sig.add(TS.client.ui.unread.rebuildMsgsWithHighlights),TS.client.highlights.feedback_submitted_sig.add(TS.client.ui.unread.maybeRebuildMsgsWithHighlightsFeedback),TS.useReactSidebar()&&TS.redux.dispatch(TS.interop.redux.features.channelSidebar.selectItem("Vall_unreads")),TS.view.members.unknown_resolution_rebuild_sig.add(E),u=Date.now(),h=!1,$("#client-ui").addClass("unread_view_is_showing"),"details"===TS.model.ui_state.flex_name&&TS.client.ui.flex.hideFlex(!0);if(TS.client.msg_pane.hideNewMsgsBar(!0),TS.client.ui.unread.$scroller.html(TS.templates.unread_main()),TS.client.ui.unread.$unread_msgs_div=$("#unread_msgs_div"),p=!0,TS.client.ui.unread.displayLoadingMessage(),TS.environment.supports_custom_scrollbar?TS.client.ui.unread.$container=$("#unread_msgs_scroller_div"):(TS.client.ui.unread.$scroller.monkeyScroll(),TS.client.ui.unread.$container=$("#monkey_scroll_wrapper_for_unread_msgs_scroller_div")),$("#footer").addClass("hidden"),f(),TS.view.resize_sig.add(f),TS.client.ui.unread.$unread_msgs_div.on("click.unread",".bottom_mark_all_read_btn",function(){TS.client.unread.markAllAsRead()}),TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_mark",function(e){var t=$(e.target).closest(".unread_group").data("model-id"),n=TS.client.unread.getGroup(t);n&&!n.marked_as_read&&TS.client.ui.unread.markGroupAsRead(t)}),TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_undo > a",function(e){TS.client.ui.unread.markGroupAsUnread($(e.target).closest(".unread_group").data("model-id"))}),TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_header_name .channel_link, .unread_group_header_name .mpim_link, .unread_group_header_name .internal_im_link",function(){TS.client.unread.shouldRecordMetrics()&&TS.metrics.count("unread_view_channel_navigation")}),TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_new",function(e){var t=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));t.collapsed?(t.marked_as_read&&TS.client.unread.moveNewUnreadsOntoHiddenMsgs(t),TS.client.ui.unread.expandGroup(t)):TS.client.ui.unread.updateGroupWithNewMessages(t)}),TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_collapse_toggle",function(e){var t=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));if(t){var n={channel_id:t.id,channel_type:t.id[0]||"",request_id:TS.client.unread.last_request_id};if(t.collapsed)TS.client.ui.unread.expandGroup(t,{persist_state:!0}),TS.clog.track("UNREADS_EXPAND_GROUP",n);else{var i=w(t),a=i.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(t,a,{persist_state:!0}),TS.clog.track("UNREADS_COLLAPSE_GROUP",n)}}}),l=!1,$(window).on("keydown.unread",function(e){T(e)}),!TS.environment.supports_sticky_position){$("body").hasClass("banner_showing")&&A(),TS.ui.banner.show_hide_sig.add(A);var n=new signals.Signal;t=_.throttle(y,16,{leading:!0,trailing:!1}),TS.client.ui.unread.$scroller.on("scroll",t),n.add(k)}e={name:"unread",container:$("#unread_msgs_div"),scroller:$("#unread_msgs_scroller_div"),page_size:25,sections:[],has_more_beginning:!1,has_more_end:!1,updated_sig:n,promiseToLoadMoreAtEnd:function(){return TS.client.ui.unread.promiseToShowNextPage()},buildMsgHTML:function(e,t,n){var i=$(TS.templates.builders.msgs.buildHTML({msg_dom_id:TS.templates.makeMsgDomIdInUnreadView(e.ts),msg:e,model_ob:n.model_ob,prev_msg:t,container_id:"unread_msgs_div",enable_slack_action_links:!0,hide_actions:!1,from_all_unreads:!0}));return a&&i.css("opacity",0),i},buildSection:function(e){return TS.templates.unread_group(C(e))},buildDayDivider:function(e,t){var n=t.ts,i=TS.interop.datetime.toDateObject(n),s=TS.interop.datetime.isToday(i),r=$(TS.templates.unread_day_divider({ts:n,is_today:s}));return a&&r.css("opacity",0),r},updateCallback:function(e){var t=TS.client.unread.getAllGroups().map(function(e){return e.manually_marked_unread_msg});e.added.forEach(function(e){if(e.data("ts")){var n=e.data("ts");if(t.indexOf(n)>=0){var i=e.data("modelObId");I(n,i,e)}}}),TS.client.ui.unread.msgs_rendered_sig.dispatch(e)}},TS.boot_data.feature_sli_briefing&&_.assign(e,{afterPageDown:function(e){e||TS.highlights_briefing.hideBriefing()},afterPageUp:function(e){e&&TS.highlights_briefing.showBriefing()}}),TS.ui.message_container.register(e),g(),TS.boot_data.feature_keyboard_navigation||TS.client.ui.unread.$scroller.attr("tabindex","-1"),TS.boot_data.feature_keyboard_navigation||TS.client.ui.unread.$scroller.get(0).focus();TS.client.ui.rebuildAllButMsgs(!0),TS.client.ui.unread.promiseToShowNextPage().then(function(){if(TS.client.unread.shouldRecordMetrics()&&TS.metrics.measureAndClear("unread_view_time_to_display","unread_view_time_to_display"),TS.model.unread_view_is_showing)if(TS.client.unread.getAllGroups().length)x();else{TS.client.ui.unread.displayEmptyState(void 0,!0)}}),TS.client.ui.unread.$unread_msgs_div.on("click.unread",".message[data-ts]",function(e){if(e.altKey){var t=$(e.target).closest(".message"),n=t.data("ts"),i=$(e.target).closest(".message").data("modelObId");I(n,i,t)}}),$(".channels_nav_unread").scrollintoview({offset:"top",px_offset:50,scroller:TS.client.channel_pane.$scroller}),TS.clog.track("UNREADS_OPEN",{}),TS.client.ui.unread.started_sig.dispatch()},promiseToShowNextPage:function(){return o&&o.isPending()?o:o=TS.client.unread.promiseToGetMoreMessages().then(function(e){if(TS.model.unread_view_is_showing){if(m.unreads_page+=1,TS.client.ui.unread.updateHeaders(e.groups),TS.client.ui.unread.addMessageContainerGroups(e.groups),TS.client.ui.unread.setMessageContainerHasMoreEnd(!!e.has_more),f(),M(),d){var t=TS.client.unread.getActiveGroup(),n=TS.client.unread.moveActiveMarker(!1);v(n,t,{collapse_current_group:!1}),d=!1}return o=null,null}}).catch(function(e){TS.error(e)})},removeMessageContainerGroup:function(t){return e.sections=e.sections.filter(function(e){return-1===t.indexOf(e.id)}),e.has_more_end=!0,e},addMessageContainerGroups:function(t){_.forEach(t,function(t){var n=TS.client.unread.getGroup(t.id);-1===_.findIndex(e.sections,{id:n.id})&&e.sections.push(n)})},updateHeaders:function(t){_.forEach(t,function(t){var n=TS.client.unread.getGroup(t.id);-1!==_.findIndex(e.sections,{id:n.id})&&TS.client.ui.unread.updateHeader(n)})},setMessageContainerHasMoreEnd:function(t){e.has_more_end=t},restart:function(){TS.client.ui.unread.showOrHideRefreshButton(),TS.ui.message_container.cleanup(e),TS.client.ui.unread.$unread_msgs_div.empty(),e.sections=[],e.has_more_end=!1,TS.ui.message_container.register(e),p=!0,TS.client.ui.unread.displayLoadingMessage(),g(),h=!1,TS.client.ui.unread.promiseToShowNextPage().then(function(){if(TS.model.unread_view_is_showing)if(TS.client.unread.getAllGroups().length)x();else{TS.client.ui.unread.displayEmptyState(void 0,!0)}})},createLoadingMsgHTML:function(){var e=$('<div class="unread_msgs_loading"><div class="unread_msgs_loading_msg"></div></div>');TS.client.ui.unread.$scroller.after(e),TS.client.ui.unread.$loading_msg_container=e},displayLoadingMessage:function(e){TS.client.ui.unread.$loading_msg_container||TS.client.ui.unread.createLoadingMsgHTML(),TS.client.ui.unread.$loading_msg_container.removeClass("hidden");var t=TS.i18n.t("Loading messages...","unread")(),n=e||t;TS.client.ui.unread.$loading_msg_container.find(".unread_msgs_loading_msg").text(n)},hideLoadingMessage:function(){TS.client.ui.unread.$loading_msg_container.addClass("hidden")},displaySlowLoadingMessage:function(){if(p){var e=TS.i18n.t("Still loading... sorry for the long wait!","unread")();TS.client.ui.unread.displayLoadingMessage(e)}},isFatalErrorDisplaying:function(){return $("#messages_container .unread_error_state").length},displayFatalError:function(){TS.client.ui.unread.hideLoadingMessage(),TS.client.ui.unread.$scroller.addClass("invisible"),$("#messages_container .unread_empty_state_wrapper").remove(),$("#messages_container").prepend(TS.templates.unread_error({emoji:new Handlebars.SafeString(TS.emoji.graphicReplace(":tropical_fish:",{jumbomoji:!0}))})),$(".unread_error_state_refresh_button").on("click",function(){TS.client.unread.reload()}),_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning")})},displayEmptyState:function(e,t){TS.client.ui.unread.hideLoadingMessage(),TS.client.ui.unread.$scroller.addClass("invisible"),$("#messages_container .unread_empty_state_wrapper").remove(),$("#messages_container").prepend(TS.templates.unread_empty_state({line_one:n.line_one,line_two:n.line_two,emoji:n.emoji_url,marked_as_read_cnt:e})),_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning");var e=$("#messages_container .unread_empty_state_undo");e.length&&(e.addClass("unread_empty_state_undo_visible"),_.delay(function(){e.removeClass("unread_empty_state_undo_visible")},10300),$(".unread_empty_state_undo_action").one("click",function(){TS.client.unread.markAllAsUnread(),TS.client.ui.unread.updateChannelHeader()}))}),t?i=!1:(i=!0,_.delay(function(){i=!1,TS.client.ui.unread.showOrHideRefreshButton()},2e3)),TS.client.ui.unread.updateChannelHeader(),TS.client.ui.unread.showOrHideRefreshButton()},removeEmptyState:function(){$(window).off("keydown.unread_empty_state"),$("#messages_container .unread_empty_state_wrapper").remove(),$("#messages_container .unread_empty_state_undo").remove(),TS.client.ui.unread.$scroller.removeClass("invisible"),i=!1},showOrHideRefreshButton:function(){var e=TS.client.unread.getTotalNewUnreadCount(),t=$("#messages_container .unread_empty_state"),n=$(".unread_empty_state_refresh");if(e>0&&TS.client.unread.new_messages_in_channels.length?$("#channel_header_unread_refresh").removeClass("hidden"):($("#channel_header_unread_refresh").addClass("hidden"),n&&n.remove()),e>0&&t.length&&TS.client.unread.new_messages_in_channels.length&&!t.hasClass("unread_error_state")){if(n.length>0)n.html($(TS.templates.unread_empty_state_refresh({unreads_count:e})).html());else{if(i)return;t.append(TS.templates.unread_empty_state_refresh({unreads_count:e})),t.addClass("faded"),t.addClass("with_refresh"),$(window).on("keydown.unread_empty_state",function(e){TS.model.unread_view_is_showing&&e.which==TS.utility.keymap.enter&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&TS.client.unread.reload()})}$(".unread_empty_state_refresh_button").on("click",function(){TS.client.unread.reload()})}},destroyUnreadView:function(){if(TS.client.ui.unread.isUnreadViewDOMShowing()){$(window).off("keydown.unread"),o&&o.isPending()&&o.cancel(),TS.client.ui.unread.$scroller.removeAttr("tabindex");$("#client-ui").removeClass("unread_view_is_showing"),TS.ui.message_container.cleanup(e),e=null,TS.client.ui.unread.removeEmptyState(),TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_mark"),TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_undo > a"),TS.environment.supports_sticky_position||(TS.client.ui.unread.$scroller.off("scroll",t),TS.ui.banner.show_hide_sig.remove(A)),TS.client.ui.unread.$unread_msgs_div.empty(),p=!1,TS.client.ui.unread.hideLoadingMessage(),$("#footer").removeClass("hidden"),TS.view.resize_sig.remove(f),TS.channels.renamed_sig.remove(S),TS.groups.renamed_sig.remove(S),TS.client.ui.unread.unread_groups=null,s=null;var n=TS.client.ui.unread.getTrackingData();TS.clog.track("UNREADS_CLOSE",n),u=0,m={unreads_event_seq_id:0,unreads_elasped_time:0,unreads_page:0,unreads_page_message_index:0}}},isUnreadViewDOMShowing:function(){return $("#client-ui").hasClass("unread_view_is_showing")},collapseGroup:function(e,t,n){return n=_.extend({persist_state:!1,add_classname:!0,scroll_group:!0},n||{}),e.collapsed?Promise.resolve(e):(TS.client.unread.collapseGroup(e,n.persist_state),new Promise(function(i){var a=w(e),s=a.offset().top;a.addClass("collapsing"),TS.client.ui.unread.updateHeader(e),t.animate({opacity:0},300,function(){a.removeClass("collapsing"),n.add_classname&&a.addClass("collapsed"),TS.client.ui.unread.updateMsgs(),n.scroll_group&&s<0&&b(a),k(),TS.environment.supports_sticky_position||y(),t.css("opacity",1),i(e)})}))},expandGroup:function(e,t){t=_.extend({persist_state:!1},t||{});var n=w(e);return e.collapsed&&!n.hasClass("collapsing")&&n.hasClass("collapsed")?new Promise(function(i){TS.client.unread.expandGroup(e,t.persist_state),TS.client.ui.unread.updateHeader(e),n.removeClass("collapsed"),n.removeClass("marked_as_read"),n.removeClass("with_footer"),a=!0,TS.client.ui.unread.$unread_msgs_div.css("height",TS.client.ui.unread.$unread_msgs_div.height());var s=TS.client.ui.unread.updateMsgsWithFocus(n);a=!1,o?o.then(function(){TS.client.ui.unread.$unread_msgs_div.css("height","auto")}):TS.client.ui.unread.$unread_msgs_div.css("height","auto"),TS.client.ui.unread.updateNewMessagesMessage(e),s.added.forEach(function(e){e.animate({opacity:1},300)}),k(),TS.environment.supports_sticky_position||y(),i(e)}):Promise.resolve(e)},markGroupAsRead:function(e){var t=TS.client.unread.getGroup(e);if(t){var n={channel_id:t.id,channel_type:t.id[0]||"",unread_count:t.total_unreads,request_id:TS.client.unread.last_request_id};TS.client.unread.markGroupAsRead(t),TS.clog.track("UNREADS_MARK_GROUP_AS_READ",n),TS.client.ui.unread.updateChannelHeader();var i=w(t),a=i.find(".unread_group_msgs");if(t.new_unread_cnt<1&&i.addClass("marked_as_read"),a.length){if(t.new_unread_cnt||M(),!t.collapsed){var s={add_classname:t.new_unread_cnt<1};return TS.client.ui.unread.collapseGroup(t,a,s).then(function(e){e.new_unread_cnt>0?TS.client.ui.unread.updateGroupWithNewMessages(e):TS.client.ui.unread.updateHeader(e)})}TS.client.ui.unread.updateHeader(t)}else TS.client.ui.unread.updateMsgs();return Promise.resolve()}},markGroupAsUnread:function(e){var t=TS.client.unread.getGroup(e);if(t){var n={channel_id:t.id,channel_type:t.id[0]||"",unread_count:t.marked_as_read_cnt,request_id:TS.client.unread.last_request_id};TS.client.unread.markGroupAsUnread(t),TS.clog.track("UNREADS_MARK_GROUP_AS_UNREAD",n),TS.client.ui.unread.expandGroup(t),TS.client.ui.unread.updateChannelHeader()}},updateNewMessagesMessage:function(e){if(!e.has_more){var t=w(e),n=t.find(".unread_group_footer");e.collapsed?TS.client.ui.unread.updateHeader(e):e.new_unread_cnt>0&&e.new_unread_msgs?(n.find(".unread_group_new_text").text(TS.i18n.t("{new_unread_cnt, plural, =1 {# new message} other {# new messages}}","all_unreads")({new_unread_cnt:e.new_unread_cnt})),t.addClass("with_footer")):n&&t.removeClass("with_footer")}},updateHeader:function(e){w(e).find(".unread_group_header").html(TS.templates.unread_group_header(C(e)))},updateMsgs:function(){return TS.ui.message_container.update(e)},updateMsgsWithFocus:function(t){return TS.ui.message_container.updateWithFocus(e,t)},updateGroupWithNewMessages:function(e){var t=w(e),n=t.height();t.height(n),TS.client.unread.updateGroupWithNewMessages(e),a=!0;var i=TS.client.ui.unread.updateMsgsWithFocus(t);a=!1,t.css("height","auto");var s=t.height();t.removeClass("with_footer"),t.height(n).animate({height:s,margin:0},300,function(){t.css("height",""),t.css("margin",""),i.added.forEach(function(e){e.animate({opacity:1},300)}),k()}),t.removeClass("collapsed").removeClass("marked_as_read"),TS.client.ui.unread.updateHeader(e)},updateSidebarLink:function(){TS.model.unread_view_is_showing?($("#channels_scroller li.active").removeClass("active"),$('li[data-action="show_unread_view"]').addClass("active")):$('li[data-action="show_unread_view"]').removeClass("active")},toggleUnreadView:function(){TS.model.prefs.enable_unread_view?($(".channels_nav_unread").removeClass("hidden"),$("#channels_nav").addClass("unread_enabled")):($(".channels_nav_unread").addClass("hidden"),$(".all_unreads").removeClass("active"),$("#channels_nav").removeClass("unread_enabled"))},updateChannelPaneUnreadState:function(e){TS.client.ui.unread.$channel_pane_item.toggleClass("unread",e)},rebuildMsgFile:function(e,t){var n=TS.client.ui.unread.$unread_msgs_div.find("#"+TS.templates.makeMsgDomIdInUnreadView(e.ts));if(n&&n.length){var i=n.find(".file_container");if(i&&i.length){var a={file:t,is_message:!0,msg_dom_id:n.attr("id")};if("post"===t.mode||"space"===t.mode)i.replaceWith(TS.templates.file_post(a));else if("snippet"===t.mode)i.replaceWith(TS.templates.file_snippet(a));else if("email"===t.mode)i.replaceWith(TS.templates.file_email(a));else{if("arugula"!==t.mode)return TS.warn("Trying to rebuild message file, but cannot rebuild "+t.mode);i.replaceWith(TS.templates.file_arugula(a))}TS.utility.makeSureAllLinksHaveTargets(n),TS.ui.utility.updateClosestMonkeyScroller(n)}}},updateChannelHeader:function(){var e=TS.templates.unread_header_info({is_showing:TS.model.unread_view_is_showing,has_new_messages:TS.model.unread_view_is_showing&&TS.client.unread.new_messages_in_channels.length,messages_loaded:TS.client.unread.messages_loaded,total_unread_count:TS.client.unread.getTotalMessagesCount(),sort_order:TS.client.unread.getSortOrder()});TS.client.channel_header.updateChannelHeaderInfo(e)},setUnreadPoint:function(e){var t=TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+e+'"]');if(!t.length)return void(TS.boot_data.feature_sli_briefing&&TS.highlights_briefing.setUnreadPointOnMessage(e));var n=t.data("modelObId");I(e,n,t)},getTrackingData:function(e){var t={is_unreads_view:!0,unreads_event_seq_id:m.unreads_event_seq_id,unreads_elasped_time:Date.now()-u,unreads_page:m.unreads_page};return e&&(t.unreads_page_message_index=_(TS.client.unread.getAllGroups()).map(function(e){return e.msgs}).flatten().reverse().findIndex({ts:e.toString()})),t},incrementTrackingSeqId:function(){m.unreads_event_seq_id+=1},rebuildMsgsIncludingMember:function(t){TS.model.unread_view_is_showing&&e&&TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(t,e)})},rebuildMsgCurrentStatusIncludingMember:function(t){if(TS.model.unread_view_is_showing&&e){var n=$(e.container),i=e.sections;if(i){var a={member:t,for_message:!0};_.each(i,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(t,e)){n.find('ts-message[data-ts="'+e.ts+'"] .message_current_status').replaceWith(TS.templates.current_status(a))}})})}}},rebuildMsgsWithHighlights:function(t){if(TS.model.unread_view_is_showing&&e){var n=_.reduce(t,function(e,t){return _.each(t,function(t,n){e[n]=t}),e},{});TS.ui.message_container.maybeUpdateMessages(e,function(e){return n[e.ts]&&(n[e.ts].show_recap||n[e.ts].is_leaving_feedback||n[e.ts].left_feedback)})}},maybeRebuildMsgsWithHighlightsFeedback:function(t){if(TS.model.unread_view_is_showing&&e){var n=_.reduce(t,function(e,t){return _.each(t,function(t,n){e[n]=t}),e},{});TS.ui.message_container.maybeUpdateMessages(e,function(e){return n[e.ts]&&"positive"===n[e.ts].feedback?(TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+e.ts+'"] .sli_briefing__feedback_controls').addClass("gave_positive_feedback"),!1):n[e.ts]&&(n[e.ts].show_recap||n[e.ts].is_leaving_feedback||n[e.ts].left_feedback)})}}});var e,t,n,i,a=!1,s=!1,r=0,o=null,l=!1,d=!1,c=!1,u=0,m={unreads_event_seq_id:0,unreads_elasped_time:0,unreads_page:0,unreads_page_message_index:0},h=!1,p=!1,g=function(){var e=[{emoji:"tada",skintone:!1,line_one:TS.i18n.t("Ta-da!","all_unreads")(),line_two:TS.i18n.t("Youve read everything there is to read.","all_unreads")()},{emoji:"victory",skintone:!0,line_one:TS.i18n.t("All caught up.","all_unreads")(),line_two:TS.i18n.t("Whats next?","all_unreads")()},{emoji:"racecar",skintone:!1,line_one:TS.i18n.t("There.","all_unreads")(),line_two:TS.i18n.t("All caught up.","all_unreads")()},{emoji:"rocket",skintone:!1,line_one:TS.i18n.t("All done.","all_unreads")(),line_two:TS.i18n.t("The future is yours.","all_unreads")()},{emoji:"octopus",skintone:!1,line_one:TS.i18n.t("All done.","all_unreads")(),line_two:TS.i18n.t("The world is your oyster.","all_unreads")()},{emoji:"high5",skintone:!0,line_one:TS.i18n.t("Thats everything!","all_unreads")(),line_two:""},{emoji:"apple",skintone:!1,line_one:TS.i18n.t("Youve read all you needed.","all_unreads")(),line_two:TS.i18n.t("Take a moment.","all_unreads")()},{emoji:"sunglasses",skintone:!1,line_one:TS.i18n.t("All clear.","all_unreads")(),line_two:""},{emoji:"thumbup",skintone:!0,line_one:TS.i18n.t("Thats that.","all_unreads")(),line_two:TS.i18n.t("Youre good to go.","all_unreads")()},{emoji:"boom",skintone:!1,line_one:TS.i18n.t("Boom.","all_unreads")(),line_two:TS.i18n.t("Youre up to date.","all_unreads")()},{emoji:"bee",skintone:!1,line_one:TS.i18n.t("Youre up to date.","all_unreads")(),line_two:TS.i18n.t("Go forth and do great things.","all_unreads")()},{emoji:"clap",skintone:!0,line_one:TS.i18n.t("Everything unread is now read.","all_unreads")(),line_two:TS.i18n.t("Youve done it.","all_unreads")()},{emoji:"crystalball",skintone:!1,line_one:TS.i18n.t("All that was unread is now read.","all_unreads")(),line_two:TS.i18n.t("Whats next?","all_unreads")()},{emoji:"tada",skintone:!1,line_one:TS.i18n.t("Ta-da!","all_unreads")(),line_two:TS.i18n.t("Youre up to date.","all_unreads")()},{emoji:"tractor",skintone:!1,line_one:TS.i18n.t("Youre all read.","all_unreads")(),line_two:TS.i18n.t("Heres a tractor.","all_unreads")()},{emoji:"pony",skintone:!1,line_one:TS.i18n.t("Youre all read.","all_unreads")(),line_two:TS.i18n.t("Heres a pony.","all_unreads")()},{emoji:"chick",skintone:!1,line_one:TS.i18n.t("Everythings sorted!","all_unreads")(),line_two:TS.i18n.t("Lets start something new.","all_unreads")()},{emoji:"sun",skintone:!1,line_one:TS.i18n.t("Youre all caught up!","all_unreads")(),line_two:TS.i18n.t("Clear screens ahead.","all_unreads")()},{emoji:"balloon",skintone:!1,line_one:TS.i18n.t("There! Caught up.","all_unreads")(),line_two:TS.i18n.t("Set your mind to something new.","all_unreads")()},{emoji:"sweetpotato",skintone:!1,line_one:TS.i18n.t("Sweet potato!","all_unreads")(),line_two:TS.i18n.t("Youre all done.","all_unreads")()},{emoji:"leafs",skintone:!1,line_one:TS.i18n.t("Done and done.","all_unreads")(),line_two:""}],t={default:{tada:cdn_url+"/3976a/img/unread/empty/default/tada.png",victory:{1:cdn_url+"/3976a/img/unread/empty/default/victory_1.png",2:cdn_url+"/3976a/img/unread/empty/default/victory_2.png",3:cdn_url+"/3976a/img/unread/empty/default/victory_3.png",4:cdn_url+"/3976a/img/unread/empty/default/victory_4.png",5:cdn_url+"/3976a/img/unread/empty/default/victory_5.png",6:cdn_url+"/3976a/img/unread/empty/default/victory_6.png"},racecar:cdn_url+"/9bf3f/img/unread/empty/default/racecar.png",rocket:cdn_url+"/3976a/img/unread/empty/default/rocket.png",octopus:cdn_url+"/3976a/img/unread/empty/default/octopus.png",high5:{1:cdn_url+"/3976a/img/unread/empty/default/high5_1.png",2:cdn_url+"/3976a/img/unread/empty/default/high5_2.png",3:cdn_url+"/3976a/img/unread/empty/default/high5_3.png",4:cdn_url+"/3976a/img/unread/empty/default/high5_4.png",5:cdn_url+"/3976a/img/unread/empty/default/high5_5.png",6:cdn_url+"/3976a/img/unread/empty/default/high5_6.png"},apple:cdn_url+"/3976a/img/unread/empty/default/apple.png",sunglasses:cdn_url+"/3976a/img/unread/empty/default/sunglasses.png",thumbup:{1:cdn_url+"/3976a/img/unread/empty/default/thumbup_1.png",2:cdn_url+"/3976a/img/unread/empty/default/thumbup_2.png",3:cdn_url+"/3976a/img/unread/empty/default/thumbup_3.png",4:cdn_url+"/3976a/img/unread/empty/default/thumbup_4.png",5:cdn_url+"/3976a/img/unread/empty/default/thumbup_5.png",6:cdn_url+"/3976a/img/unread/empty/default/thumbup_6.png"},boom:cdn_url+"/3976a/img/unread/empty/default/boom.png",bee:cdn_url+"/3976a/img/unread/empty/default/bee.png",clap:{1:cdn_url+"/3976a/img/unread/empty/default/clap_1.png",2:cdn_url+"/3976a/img/unread/empty/default/clap_2.png",3:cdn_url+"/3976a/img/unread/empty/default/clap_3.png",4:cdn_url+"/3976a/img/unread/empty/default/clap_4.png",5:cdn_url+"/3976a/img/unread/empty/default/clap_5.png",6:cdn_url+"/3976a/img/unread/empty/default/clap_6.png"},crystalball:cdn_url+"/3976a/img/unread/empty/default/crystalball.png",tractor:cdn_url+"/3976a/img/unread/empty/default/tractor.png",pony:cdn_url+"/3976a/img/unread/empty/default/pony.png",chick:cdn_url+"/3976a/img/unread/empty/default/chick.png",sun:cdn_url+"/3976a/img/unread/empty/default/sun.png",balloon:cdn_url+"/3976a/img/unread/empty/default/balloon.png",sweetpotato:cdn_url+"/3976a/img/unread/empty/default/sweetpotato.png",leafs:cdn_url+"/3976a/img/unread/empty/default/leafs.png"},google:{tada:cdn_url+"/42c04/img/unread/empty/google/tada.png",victory:{1:cdn_url+"/42c04/img/unread/empty/google/victory_1.png",2:cdn_url+"/42c04/img/unread/empty/google/victory_2.png",3:cdn_url+"/42c04/img/unread/empty/google/victory_3.png",4:cdn_url+"/42c04/img/unread/empty/google/victory_4.png",5:cdn_url+"/42c04/img/unread/empty/google/victory_5.png",6:cdn_url+"/42c04/img/unread/empty/google/victory_6.png"},racecar:cdn_url+"/9bf3f/img/unread/empty/google/racecar.png",rocket:cdn_url+"/42c04/img/unread/empty/google/rocket.png",octopus:cdn_url+"/42c04/img/unread/empty/google/octopus.png",high5:{1:cdn_url+"/42c04/img/unread/empty/google/high5_1.png",2:cdn_url+"/42c04/img/unread/empty/google/high5_2.png",3:cdn_url+"/42c04/img/unread/empty/google/high5_3.png",4:cdn_url+"/42c04/img/unread/empty/google/high5_4.png",5:cdn_url+"/42c04/img/unread/empty/google/high5_5.png",6:cdn_url+"/42c04/img/unread/empty/google/high5_6.png"},apple:cdn_url+"/42c04/img/unread/empty/google/apple.png",sunglasses:cdn_url+"/42c04/img/unread/empty/google/sunglasses.png",thumbup:{1:cdn_url+"/42c04/img/unread/empty/google/thumbup_1.png",2:cdn_url+"/42c04/img/unread/empty/google/thumbup_2.png",3:cdn_url+"/42c04/img/unread/empty/google/thumbup_3.png",4:cdn_url+"/42c04/img/unread/empty/google/thumbup_4.png",5:cdn_url+"/42c04/img/unread/empty/google/thumbup_5.png",6:cdn_url+"/42c04/img/unread/empty/google/thumbup_6.png"},boom:cdn_url+"/42c04/img/unread/empty/google/boom.png",bee:cdn_url+"/42c04/img/unread/empty/google/bee.png",clap:{1:cdn_url+"/42c04/img/unread/empty/google/clap_1.png",2:cdn_url+"/d90ef/img/unread/empty/google/clap_2.png",3:cdn_url+"/42c04/img/unread/empty/google/clap_3.png",4:cdn_url+"/42c04/img/unread/empty/google/clap_4.png",5:cdn_url+"/42c04/img/unread/empty/google/clap_5.png",6:cdn_url+"/42c04/img/unread/empty/google/clap_6.png"},crystalball:cdn_url+"/42c04/img/unread/empty/google/crystalball.png",tractor:cdn_url+"/42c04/img/unread/empty/google/tractor.png",pony:cdn_url+"/42c04/img/unread/empty/google/pony.png",chick:cdn_url+"/42c04/img/unread/empty/google/chick.png",sun:cdn_url+"/42c04/img/unread/empty/google/sun.png",balloon:cdn_url+"/42c04/img/unread/empty/google/balloon.png",sweetpotato:cdn_url+"/42c04/img/unread/empty/google/sweetpotato.png",leafs:cdn_url+"/7fa97/img/unread/empty/google/leafs.png"},twitter:{tada:cdn_url+"/42c04/img/unread/empty/twitter/tada.png",victory:{1:cdn_url+"/42c04/img/unread/empty/twitter/victory_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/victory_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/victory_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/victory_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/victory_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/victory_6.png"},racecar:cdn_url+"/9bf3f/img/unread/empty/twitter/racecar.png",rocket:cdn_url+"/42c04/img/unread/empty/twitter/rocket.png",octopus:cdn_url+"/42c04/img/unread/empty/twitter/octopus.png",high5:{1:cdn_url+"/42c04/img/unread/empty/twitter/high5_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/high5_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/high5_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/high5_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/high5_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/high5_6.png"},apple:cdn_url+"/42c04/img/unread/empty/twitter/apple.png",sunglasses:cdn_url+"/42c04/img/unread/empty/twitter/sunglasses.png",thumbup:{1:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_6.png"},boom:cdn_url+"/42c04/img/unread/empty/twitter/boom.png",bee:cdn_url+"/42c04/img/unread/empty/twitter/bee.png",clap:{1:cdn_url+"/42c04/img/unread/empty/twitter/clap_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/clap_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/clap_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/clap_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/clap_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/clap_6.png"},crystalball:cdn_url+"/42c04/img/unread/empty/twitter/crystalball.png",tractor:cdn_url+"/42c04/img/unread/empty/twitter/tractor.png",pony:cdn_url+"/42c04/img/unread/empty/twitter/pony.png",chick:cdn_url+"/42c04/img/unread/empty/twitter/chick.png",sun:cdn_url+"/42c04/img/unread/empty/twitter/sun.png",balloon:cdn_url+"/42c04/img/unread/empty/twitter/balloon.png",sweetpotato:cdn_url+"/42c04/img/unread/empty/twitter/sweetpotato.png",leafs:cdn_url+"/7fa97/img/unread/empty/twitter/leafs.png"},emojione:{tada:cdn_url+"/42c04/img/unread/empty/emojione/tada.png",victory:{1:cdn_url+"/42c04/img/unread/empty/emojione/victory_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/victory_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/victory_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/victory_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/victory_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/victory_6.png"},racecar:cdn_url+"/9bf3f/img/unread/empty/emojione/racecar.png",rocket:cdn_url+"/42c04/img/unread/empty/emojione/rocket.png",octopus:cdn_url+"/42c04/img/unread/empty/emojione/octopus.png",high5:{1:cdn_url+"/42c04/img/unread/empty/emojione/high5_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/high5_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/high5_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/high5_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/high5_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/high5_6.png"},apple:cdn_url+"/42c04/img/unread/empty/emojione/apple.png",sunglasses:cdn_url+"/42c04/img/unread/empty/emojione/sunglasses.png",thumbup:{1:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_6.png"},boom:cdn_url+"/42c04/img/unread/empty/emojione/boom.png",bee:cdn_url+"/42c04/img/unread/empty/emojione/bee.png",clap:{1:cdn_url+"/42c04/img/unread/empty/emojione/clap_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/clap_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/clap_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/clap_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/clap_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/clap_6.png"},crystalball:cdn_url+"/42c04/img/unread/empty/emojione/crystalball.png",tractor:cdn_url+"/42c04/img/unread/empty/emojione/tractor.png",pony:cdn_url+"/42c04/img/unread/empty/emojione/pony.png",chick:cdn_url+"/42c04/img/unread/empty/emojione/chick.png",sun:cdn_url+"/42c04/img/unread/empty/emojione/sun.png",balloon:cdn_url+"/42c04/img/unread/empty/emojione/balloon.png",sweetpotato:cdn_url+"/42c04/img/unread/empty/emojione/sweetpotato.png",leafs:cdn_url+"/42c04/img/unread/empty/emojione/sweetpotato.png"}},i=e[Math.floor(Math.random()*e.length)],a=TS.model.prefs.emoji_mode;"as_text"===a&&(a="default");var s=TS.model.prefs.preferred_skin_tone||"1",r=i.skintone?t[a][i.emoji][s]:t[a][i.emoji];i.emoji_url=r,(new Image).src=i.emoji_url,n=i},f=function(){TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.unread.$scroller),TS.environment.supports_sticky_position||(A(),k(),y())},S=function(e){var t=TS.client.unread.getGroup(e.id);t&&TS.client.ui.unread.updateHeader(t)},T=function(e){var t;if(!TS.ui.react_emoji_menu.is_showing&&-1!==[TS.utility.keymap.left,TS.utility.keymap.right,82].indexOf(e.which)&&!(e.metaKey||e.ctrlKey||e.shiftKey)&&(!o||!o.isPending())&&!l&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()&&!$("#messages_container .unread_empty_state").length&&!p&&!TS.client.ui.unread.$scroller.hasClass("transitioning")&&!TS.client.ui.unread.$unread_msgs_div.find(".collapsing").length){var n=TS.client.unread.getActiveGroup();if(e.which===TS.utility.keymap.right||e.which===TS.utility.keymap.left){h=!0,e.preventDefault();var i=e.which===TS.utility.keymap.left;if(t=TS.client.unread.moveActiveMarker(i))v(t,n,{collapse_current_group:!i});else if(!TS.client.unread.areAllMessagesFetched()&&!i){var a=_.last(TS.client.unread.getAllGroups());if(a.id===n.id){d=!0;var s=w(n),r=s.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(n,r)}}}else 82===e.which&&(h=!0,n&&(n.marked_as_read?TS.client.ui.unread.markGroupAsUnread(n.id):(l=!0,TS.client.ui.unread.markGroupAsRead(n.id).then(function(){n.marked_as_read?(t=TS.client.unread.moveActiveMarker(),v(t,n)):l=!1}))))}},v=function(e,t,n){n=_.defaults(n,{collapse_current_group:!1,scroll_and_expand:!0});var i=function(){var i=w(e);if(i.toggleClass("active",e.active&&h),TS.client.ui.unread.updateHeader(e),e.marked_as_read||n.scroll_and_expand&&TS.client.ui.unread.expandGroup(e),n.scroll_and_expand){var s=i.prev();t&&s.length&&s.data("model-id")===t.id?(c=!0,b(a)):b(i)}return l=!1,null};if(e)if(d=!1,l=!0,t){var a=w(t);if(n.collapse_current_group){var s=a.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(t,s,{scroll_group:!1}).then(function(){a.toggleClass("active",t.active&&h),TS.client.ui.unread.updateHeader(t),i()})}else a.toggleClass("active",t.active&&h),TS.client.ui.unread.updateHeader(t),i()}else i();else l=!1;return null},b=function(e){if(e.length){var t=e.closest(".monkey_scroller");t.length||(t=e.closest(":scrollable(vertical)")),t.is("html")&&(t=$("body")),t.scrollTop(Math.round(e[0].offsetTop-8))}},w=function(e){return TS.client.ui.unread.$unread_msgs_div.find("[data-model-id="+e.model_ob.id+"]")},y=function(){var e=TS.client.ui.unread.$scroller.scrollTop(),t=TS.client.ui.unread.unread_groups.toArray();if(t.length){var n=t.reduce(function(t,n){return e+TS.client.ui.CLIENT_HEADER_OVERHANG>=n.y?n:t});if(TS.boot_data.feature_sli_briefing){if(t.length&&TS.client.ui.CLIENT_HEADER_OVERHANG<t[0].y&&e<t[0].y)return void(s&&(s.find(".unread_group_header").css({top:"0",right:"auto"}),s.removeClass("currently_sticky"),s=null,TS.highlights_briefing.$briefing_header&&(TS.highlights_briefing.$briefing_header.addClass("sticky"),TS.highlights_briefing.$briefing_view.addClass("sticky"))));!s&&TS.highlights_briefing.$briefing_header&&TS.highlights_briefing.$briefing_view&&(TS.highlights_briefing.$briefing_header.removeClass("sticky"),TS.highlights_briefing.$briefing_view.removeClass("sticky"))}if(n){var i=r-1;if(s||(s=n.$node,s.find(".unread_group_header").css({top:i,right:$("#col_flex").outerWidth()}),s.addClass("currently_sticky")),s!==n.$node&&(s.find(".unread_group_header").css({top:"0",right:"auto"}),s.removeClass("currently_sticky"),s=n.$node,s.find(".unread_group_header").css({top:i,right:$("#col_flex").outerWidth()}),s.addClass("currently_sticky")),!l&&!c){var a=TS.client.unread.getActiveGroup();if(a&&s.data("model-id")!=a.id){var o=TS.client.unread.getGroup(s.data("model-id"));o=TS.client.unread.setActiveGroup(o),v(o,a,{collapse_current_group:!1,scroll_and_expand:!1})}}c=!1}}},k=function(){var e=TS.client.ui.unread.$scroller.find(".unread_group");TS.client.ui.unread.unread_groups=e.map(function(e,t){return{$node:$(t),y:t.offsetTop}})},A=function(){r=$("#banner").height()},C=function(e){return{model_ob:e.model_ob,model_ob_id:e.model_ob.id,has_new_unreads:e.new_unread_cnt>0,unread_cnt:e.total_unreads||0,new_unread_cnt:e.new_unread_cnt,marked_as_read_cnt:e.marked_as_read_cnt||0,show_footer:e.new_unread_cnt>0,im_member:e.model_ob.is_im?TS.members.getMemberById(e.model_ob.user):{},marked_as_read:e.marked_as_read,collapsed:e.collapsed,active:h&&e.active,is_channel:e.model_ob.is_channel,is_group:e.model_ob.is_group,is_mpim:e.model_ob.is_mpim,is_im:e.model_ob.is_im,im_user:e.model_ob.user?TS.members.getMemberById(e.model_ob.user):null,supports_sticky_position:TS.environment.supports_sticky_position}},M=function(){if(TS.client.unread.areAllMessagesFetched()){var e=TS.client.unread.getAllGroups(),t=!0;e.length&&(t=_.reduce(e,function(e,t){return e&&t.marked_as_read},e[0].marked_as_read)),t&&TS.client.ui.unread.displayEmptyState()}},x=function(){p=!1,TS.client.ui.unread.hideLoadingMessage(),TS.client.ui.unread.$scroller.addClass("transitioning"),TS.client.ui.unread.updateChannelHeader(),TS.client.ui.unread.updateMsgs(),TS.client.ui.unread.$scroller.removeClass("transitioning")},I=function(e,t,n){var i=TS.client.unread.getGroup(t),a=i.model_ob,s=TS.utility.msgs.getMarkMsgTSForUnreadPoint(e,i.msgs,a),r=_.findIndex(i.msgs,{ts:s}),o=n.closest(".unread_group");if(o.find(".unread_divider").remove(),o.find(".unread_day_container").removeClass("unread_day_container"),!s)return!1;if(i.manually_marked_unread_msg=e,TS.shared.markReadMsg(i.model_ob.id,s,TS.model.marked_reasons.back),TS.client.markLastReadsWithAPI(),e!==parseFloat(i.msgs[i.msgs.length-1].ts)){var l=TS.templates.messages_unread_divider({label:TS.i18n.t("unread messages","all_unreads")()});TS.client.ui.unread.$unread_msgs_div.find('ts-message[data-ts="'+i.msgs[r].ts+'"]').after(l);var d=n.closest(".unread_group").find(".unread_divider");return(d.next(".day_divider").length||d.is(":last-child"))&&(d.addClass("adjacent_to_date"),d.closest(".day_container").next(".day_container").addClass("unread_day_container")),!0}},E=function(t){TS.model.unread_view_is_showing&&TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(t,e)})}}()},2417:function(e,t){!function(){"use strict";TS.registerModule("client.ui.user_groups",{onStart:function(){TS.lazyLoadMembersAndBots()&&TS.client.login_sig.addOnce(n)},clearUserGroupFilter:function(){var n=t.find("#user_group_filter"),i=n.find("input.member_filter"),a=n.find(".icon_close");e=void 0,TS.view.rebuildUserGroupList(),setTimeout(function(){i.focus()},0),i.val(""),a.addClass("hidden")},getUserGroupQuery:function(){return e}});var e,t,n=function(){t=$("#user_groups_container"),t.html(TS.templates.user_groups_flexpane_tab({can_user_edit_user_groups:TS.permissions.members.canEditUserGroups(),can_user_create_and_delete_user_groups:TS.permissions.members.canCreateAndDeleteUserGroups()})),i()},i=function(){var n=t.find("#user_group_filter"),i=n.find("input.member_filter"),a=n.find(".icon_close");i.bind("keyup update-user-group-filter",function(){e=i.val().trim().toLocaleLowerCase(),TS.view.rebuildUserGroupList(),a.toggleClass("hidden",!e.trim())}),t.delegate("#user_groups_list .clear_members_filter","click",function(){TS.client.ui.user_groups.clearUserGroupFilter()}),a.bind("click",TS.client.ui.user_groups.clearUserGroupFilter)}}()},2418:function(e,t){!function(){"use strict";TS.registerModule("client.unread",{switched_sig:new signals.Signal,switched_away_sig:new signals.Signal,fetched_unreads_sig:new signals.Signal,marked_group_as_read_sig:new signals.Signal,marked_group_as_unread_sig:new signals.Signal,marked_all_as_read:new signals.Signal,marked_all_as_unread:new signals.Signal,new_messages_in_channels:[],messages_loaded:!1,last_request_id:"",onStart:function(){TS.prefs.enable_unread_view_changed_sig.add(C),TS.prefs.enable_unread_view_changed_sig.add(M),TS.channels.message_received_sig.add(v),TS.groups.message_received_sig.add(v),TS.ims.message_received_sig.add(v),TS.mpims.message_received_sig.add(v),TS.channels.message_changed_sig.add(b),TS.groups.message_changed_sig.add(b),TS.ims.message_changed_sig.add(b),TS.mpims.message_changed_sig.add(b),TS.channels.message_removed_sig.add(w),TS.groups.message_removed_sig.add(w),TS.ims.message_removed_sig.add(w),TS.mpims.message_removed_sig.add(w),TS.files.team_file_changed_sig.add(k),TS.channels.deleted_sig.add(A),TS.groups.deleted_sig.add(A),TS.client.login_sig.add(I),TS.client.login_sig.add(O),TS.prefs.all_unreads_sort_order_changed_sig.add(O)},isEnabled:function(){return!!TS.model.prefs.enable_unread_view},shouldRecordMetrics:function(){return!!e},debug:function(e,t){p.push({msg:e,data:t}),TS.boot_data.feature_tinyspeck&&TS.info("[ALL_UNREADS] "+e,t)},showUnreadView:function(t,i,a){if(!TS.client.unread.isEnabled())return!1;t=!!t,i=!!i;var r=!i&&t;return!!TS.client.unreadViewActivated(i,r)&&(TS.client.unread.switched_sig.dispatch(),TS.msg_edit.editing_in_msg_pane&&TS.msg_edit.resetEditUI(),s=a,e=TS.utility.enableFeatureForUser(1),e&&TS.metrics.mark("unread_view_time_to_display"),x(),n=TS.interop.datetime.makeTsStamp(null,{padder:"0",uniqueNum:9}),TS.client.ui.unread.showUnreadView(),e&&TS.metrics.count("unread_view_displayed"),e&&TS.metrics.mark("unread_view_time_spent"),h&&(h=!1,TS.metrics.count("unread_view_coachmark_conversion")),!0)},destroyUnreadView:function(){TS.client.ui.unread.isUnreadViewDOMShowing()&&(e&&TS.metrics.measureAndClear("unread_view_time_spent","unread_view_time_spent"),TS.client.ui.unread.destroyUnreadView(),x(),TS.client.unread.switched_away_sig.dispatch())},reloadIfPendingMessages:function(){TS.client.unread.getTotalNewUnreadCount()>0&&TS.client.unread.new_messages_in_channels.length&&TS.client.unread.reload()},reload:function(){s=void 0,TS.client.ui.unread.removeEmptyState(),x(),TS.client.ui.unread.restart()},getGroup:function(e){return _.find(o,{model_ob:{id:e}})},getAllGroups:function(){return o},collapseGroup:function(e,t){return t&&TS.api.call("unread.collapse",{channel:e.id}),e.collapsed=!0,e.hidden_msgs=e.msgs,e.msgs=[],u&&u.id===e.id&&(o=o.concat(l),TS.client.ui.unread.addMessageContainerGroups(l),D()),e},expandGroup:function(e,t){if(e.collapsed=!1,t&&TS.api.call("unread.expand",{channel:e.id}),e.msgs.length>0&&(e.new_unread_msgs=e.msgs,e.new_unread_cnt=e.new_unread_msgs.length,e.msgs=[]),e.msgs=e.msgs.concat(e.hidden_msgs),T(e,"msgs"),e.hidden_msgs=[],e.has_more){var n=_.findIndex(o,{id:e.id});l=o.splice(n+1),TS.client.ui.unread.removeMessageContainerGroup(_.map(l,"id")),u=e,i=c,c=!1}return e},markGroupAsRead:function(t,n){return t.previous_read_ts=t.model_ob.last_read,t.marked_as_read_cnt=t.total_unreads,t.marked_as_read=!0,t.total_unreads=0,t.manually_marked_unread_msg=null,n||(TS.shared.markReadMsg(t.model_ob.id,TS.client.unread.getMarkerTS(t),null),e&&TS.metrics.store("unread_view_mark_model_read",t.marked_as_read_cnt,{is_count:!0})),TS.client.unread.marked_group_as_read_sig.dispatch(t),t},markGroupAsUnread:function(e){return TS.shared.markReadMsg(e.model_ob.id,e.previous_read_ts,null),e.marked_as_read=!1,e.manually_marked_unread_msg=null,d=e.id,e.total_unreads=e.marked_as_read_cnt,e.marked_as_read_cnt=0,TS.client.unread.marked_group_as_unread_sig.dispatch(e),e},markAllAsRead:function(){var t={},n=0;o.forEach(function(e){t[e.id]=TS.client.unread.getMarkerTS(e),TS.client.unread.markGroupAsRead(e,!0),n+=e.msgs.length}),e&&TS.metrics.count("unread_view_mark_all_read"),e&&TS.metrics.store("unread_view_mark_all_read_count",n,{is_count:!0}),c?(TS.api.call("unread.markRead",{markers:JSON.stringify(t)}),TS.client.ui.unread.displayEmptyState(n),TS.client.unread.marked_all_as_read.dispatch()):TS.api.call("unread.markRead",{markers:JSON.stringify(t)}).then(function(){TS.model.unread_view_is_showing&&(TS.client.unread.reload(),TS.client.unread.marked_all_as_read.dispatch())});var i={unread_count:n,request_id:TS.client.unread.last_request_id};TS.clog.track("UNREADS_MARK_ALL_AS_READ",i)},markAllAsUnread:function(){o.forEach(function(e){TS.client.unread.markGroupAsUnread(e)}),TS.client.ui.unread.removeEmptyState(),TS.client.unread.marked_all_as_unread.dispatch(o);var e={request_id:TS.client.unread.last_request_id};TS.clog.track("UNREADS_MARK_ALL_AS_UNREAD",e)},getMarkerTS:function(e){var t=TS.client.unread.getNewestMsgTs(e);return(!t||t<n)&&(t=n),t},updateGroupWithNewMessages:function(e){return e.new_unread_msgs&&(e.msgs=e.new_unread_msgs.concat(e.msgs),T(e,"msgs"),e.total_unreads+=e.new_unread_cnt,e.new_unread_cnt=0,e.new_unread_msgs=[],e.marked_as_read=!1,e.collapsed=!1,TS.client.unread.new_messages_in_channels=_.without(TS.client.unread.new_messages_in_channels,e.id),TS.client.ui.unread.showOrHideRefreshButton()),e},moveNewUnreadsOntoHiddenMsgs:function(e){return e.collapsed&&e.marked_as_read&&e.new_unread_msgs.length&&(e.hidden_msgs=e.new_unread_msgs,T(e,"msgs"),e.new_unread_cnt=0,e.new_unread_msgs=[],e.msgs=[],e.total_unreads=e.hidden_msgs.length,e.marked_as_read=!1,TS.client.unread.new_messages_in_channels=_.without(TS.client.unread.new_messages_in_channels,e.id),TS.client.ui.unread.showOrHideRefreshButton()),e},getNewestMsgTs:function(e){return e.msgs&&e.msgs.length?e.msgs[0].ts:null},promiseToGetMoreMessages:function(){return TS.client.unread.debug("promiseToGetMoreMessages"),s||d||TS.client.unread.getAllCurrentlyUnreadGroups().length||(TS.client.unread.debug("DONE FETCHING: First fetch, not from boot, nothing in global model is unread, marking all msgs as fetched"),c=!0,f()),c?(TS.client.unread.debug("NO FETCHING: All messages are fetched"),Promise.resolve({groups:[],has_more:!1})):(clearTimeout(a),a=setTimeout(function(){TS.client.ui.unread.displaySlowLoadingMessage()},5e3),t=new Promise(function(t,i){TS.experiment.loadUserAssignments().then(function(){var s,r=[];if(d&&e&&TS.metrics.count("unread_view_scroll"),u){var o=u.id;s={channel:u.id,oldest:TS.client.unread.getNewestMsgTs(u)||u.model_ob.last_read,latest:n,always_asc:!0,ignore_replies:!0,include_pin_count:!!TS.boot_data.feature_lazy_pins},TS.client.unread.debug("Backfilling using api_args: ",_.clone(s)),TS.api.call(TS.shared.getHistoryApiMethodForModelOb(u.model_ob),s).then(function(e){if(clearTimeout(a),TS.model.unread_view_is_showing){if(TS.client.unread.last_request_id=e.request_id,u||u.id!=o){var n={channels:[{channel_id:u.id,messages:e.data.messages,has_more:e.data.has_more}],channels_count:1,total_messages_count:null};e.data.has_more||(n.groups=l);var s=S(n,r);e.data.has_more||(D(),s.has_more=!c),t(s)}else i(new Error("channels.history rejected because we are no longer backfilling or we are backfilling a different group"));return null}}).catch(function(e){TS.console.logError(e,"all_unreads_fatal_error"),clearTimeout(a),TS.client.ui.unread.displayFatalError()})}else{if(s={timestamp:n,sort:TS.client.unread.getSortOrder()},d){s.current_channel=d;var m=TS.client.unread.getGroup(d);m&&(m.collapsed?(s.current_channel_timestamp=n,r.push(d)):TS.client.unread.getNewestMsgTs(m)&&(s.current_channel_timestamp=TS.client.unread.getNewestMsgTs(m)))}(e||TS.boot_data.feature_tinyspeck)&&TS.metrics.mark("unread_history_sort_marker"),TS.client.unread.debug("Regular fetch using api_args: ",_.clone(s)),TS.api.call("unread.history",s).then(function(n){if((e||TS.boot_data.feature_tinyspeck)&&TS.metrics.measureAndClear("unread_history_sort_"+s.sort,"unread_history_sort_marker"),clearTimeout(a),TS.model.unread_view_is_showing)return TS.client.unread.last_request_id=n.request_id,u?i(new Error("unread.history rejected because we are now backfilling")):t(S(n.data,r,!d)),null}).catch(function(e){TS.error(e),clearTimeout(a),TS.client.ui.unread.displayFatalError()})}return null})}))},getMessage:function(e,t){if(!TS.model.unread_view_is_showing)return null;var n,i;return n=TS.client.unread.getGroup(e.id),n&&(i=TS.utility.msgs.getMsg(t,n.msgs)),!i&&TS.boot_data.feature_sli_briefing&&TS.highlights_briefing&&(i=TS.highlights_briefing.getMessageFromCache(e.id,t)),i||null},getTotalMessagesCount:function(){return o.reduce(function(e,t){return t.marked_as_read?e:e+t.msgs.length},0)},getCurrentModelID:function(){return d},areAllMessagesFetched:function(){return c},getAllCurrentlyUnreadGroups:function(){return TS.channels.getUnarchivedChannelsForUser().concat(TS.groups.getUnarchivedGroups(),TS.model.mpims,TS.model.ims).filter(function(e){return e.unread_cnt>0})},getTotalNewUnreadCount:function(){var e=o.reduce(function(e,t){return t.new_unread_msgs?e+t.new_unread_msgs.length:e},0);return m&&(e=Object.keys(m).reduce(function(e,t){return e+m[t].length},e)),e},moveActiveMarker:function(e){var t=0,n=_.findIndex(o,{active:!0});if(-1!=n&&(t=e?n-1:n+1),t>=0&&o[t])return o[n]&&(o[n].active=!1),o[t].active=!0,o[t]},setActiveGroup:function(e){var t=TS.client.unread.getActiveGroup();return t&&(t.active=!1),e.active=!0,e},getActiveGroup:function(){return _.find(o,{active:!0})},getSortOrder:function(){return r},getHighlightsForMessages:function(e){_.map(e.channels,function(e){var t=TS.shared.getModelObById(e.channel_id);e.messages.length&&e.total_unreads>=10&&TS.client.highlights.getHighlightsForMessages({channel:t,timestamps:_.map(e.messages,"ts"),channel_open_ts:n})})},test:function(){var e={_current_model_ob_id:null,_processResp:S,_resetData:x,_messageReceived:v,_appendNewUnreadToGroup:y,_messageChanged:b,_messageRemoved:w,_toggleUnreadView:C,_groups:[],_all_messages_fetched:!1,_more_messages_p:void 0,_init_timestamp:void 0};return Object.defineProperty(e,"_processResp",{get:function(){return S},set:function(e){S=e}}),Object.defineProperty(e,"_resetData",{get:function(){return x},set:function(e){x=e}}),Object.defineProperty(e,"_current_model_ob_id",{get:function(){return d},set:function(e){d=e}}),Object.defineProperty(e,"_groups",{get:function(){return o},set:function(e){o=e}}),Object.defineProperty(e,"_all_messages_fetched",{get:function(){return c},set:function(e){c=e}}),Object.defineProperty(e,"_more_messages_p",{get:function(){return t},set:function(e){t=e}}),Object.defineProperty(e,"_messageReceived",{get:function(){return v},set:function(e){v=e}}),Object.defineProperty(e,"_messageChanged",{get:function(){return b},set:function(e){b=e}}),Object.defineProperty(e,"_messageRemoved",{get:function(){return w},set:function(e){w=e}}),Object.defineProperty(e,"_appendNewUnreadToGroup",{get:function(){return y},set:function(e){y=e}}),Object.defineProperty(e,"_toggleUnreadView",{get:function(){return C},set:function(e){C=e}}),Object.defineProperty(e,"_init_timestamp",{get:function(){return n},set:function(e){n=e}}),Object.defineProperty(e,"_backfilling_for_group",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(e,"_excluded_groups",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(e,"_orphan_new_msgs",{get:function(){return m},set:function(e){m=e}}),Object.defineProperty(e,"_direct_from_boot",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(e,"_sortAndDedupe",{get:function(){return T},set:function(e){T=e}}),Object.defineProperty(e,"_backfilling_was_all_fetched",{get:function(){return i},set:function(e){i=e}}),e}});var e,t,n,i,a,s,r,o=[],l=[],d=null,c=!1,u=null,m={},h=!1,p=[],g=[],f=function(){if(!s){var e=TS.client.unread.getAllCurrentlyUnreadGroups(),t=[];e.forEach(function(e){-1===g.indexOf(e.id)&&TS.shared.getOldestUnreadTsForId(e.id)<n&&t.push(e)}),t.length>0&&(TS.metrics.count("unread_view_consistency_fail"),TS.metrics.count("unread_view_consistency_fail_count",t.length),TS.client.unread.debug("Consistency check: Init timestamp",n),TS.client.unread.debug("Consistency check: Unread models",_.map(e,"id")),TS.client.unread.debug("Consistency check: Mismatched models: ",_.map(t,"id")),TS.client.unread.debug("Consistency check: Mismatched model timestamps: ",_.map(t,function(e){return TS.shared.getOldestUnreadTsForId(e.id)})),t.forEach(function(e){var t=TS.shared.getOldestUnreadTsForId(e.id),n=e.msgs.filter(function(e){return e>=t});TS.client.unread.debug("Mismatch details",{id:e.id,oldest_unread_ts:t,mismatch_msg_cnt:n.length,msgs_details:_.map(_.take(n,10),function(e){return{type:e.type,subtype:e.subtype,ts:e.ts}})})}),1===t.length&&TS.shared.getActiveModelOb()&&TS.shared.getActiveModelOb().id===t[0].id&&TS.metrics.count("unread_view_consistency_fail_last_active"),t.length>2&&TS.logError(p,"all_unreads_consistency_debug"))}},S=function(t,n,i){n=n||[];var a={groups:[],has_more:!0};if(TS.info("Received unread view response: "+t.channels_count+" channels; "+t.total_messages_count+" total messages ("+(i?"first fetch":"subsequent fetch")+")"),TS.client.unread.debug("Process response starting info:",{first_fetch:i,skip_channels:n,channels_count:t.channels_count,total_messages_count:t.total_messages_count,channels:t.channels.map(function(e){return{channel_id:e.channel_id,msg_count:e.messages?e.messages.length:null,collapsed:e.collapsed,total_unreads:e.total_unreads,has_more:e.has_more}})}),i&&(e&&TS.metrics.count("unread_view_fetched_channels_first",t.channels_count),e&&TS.metrics.count("unread_view_fetched_messages_first",t.total_messages_count)),t.channels.length&&n.length&&_.remove(t.channels,function(e){return-1!==n.indexOf(e.channel_id)}),0===t.channels.length||1===t.channels.length&&!t.channels[0].has_more&&(!t.channels[0].messages||0===t.channels[0].messages.length))return c=!0,a.has_more=!1,TS.client.unread.debug("DONE FETCHING: API response had no messages",t.channels.length),f(),a;if(1===t.channels.length&&0===t.channels[0].messages.length&&t.channels[0].collapsed&&TS.client.unread.getGroup(t.channels[0].channel_id)&&TS.client.unread.getGroup(t.channels[0].channel_id).collapsed&&0===TS.client.unread.getGroup(t.channels[0].channel_id).msgs.length)return c=!0,a.has_more=!1,TS.client.unread.debug("DONE FETCHING: Received only one collapsed group with zero messages"),f(),a;var r=_.last(t.channels),l=r.has_more;return t.channels.forEach(function(e){d=e.channel_id;var t=TS.shared.getModelObById(d),n=TS.client.unread.getGroup(d),r=[];if(g.push(e.channel_id),n)r=e.messages.map(function(e){return TS.utility.msgs.processImsg(e,t.id)}),r=n.msgs.concat(r),n.collapsed?(n.hidden_msgs=n.hidden_msgs.concat(r),n.marked_as_read_cnt=n.hidden_msgs.length):n.msgs=r,n.has_more=e.has_more,n.has_more||(n.total_unreads=r.filter(function(e){return!e.no_display}).length);else{if(!e.has_more&&!e.collapsed&&!e.messages.length)return TS.warn("Received model_ob with no messages for unread view: "+d),void TS.client.unread.debug("all_unreads_ignored_channel no msgs",{current_model_ob_id:d,unread_obj_id:e.channel_id,has_more:e.has_more,collapsed:!!e.collapsed,msg_count:e.messages.length});if(!(i&&s||0!==t.unread_cnt))return void TS.client.unread.debug("all_unreads_ignored_channel model_ob has no unreads",{current_model_ob_id:d,unread_obj_id:e.channel_id,model_ob_id:t.id,model_ob_unread_cnt:t.unread_cnt,first_fetch:i,direct_from_boot:s});r=e.messages.map(function(e){return TS.utility.msgs.processImsg(e,t.id)}),n={id:d,order:o.length,msgs:r,hidden_msgs:[],model_ob:t,marked_as_read:!1,new_unread_cnt:0,collapsed:e.collapsed,total_unreads:e.total_unreads,has_more:e.has_more},n.has_more||(n.total_unreads=r.filter(function(e){return!e.no_display}).length),o.push(n)}!n.has_more&&m[n.id]&&(m[n.id].forEach(function(e){y(n,e)}),delete m[n.id]),T(n,"msgs"),TS.client.unread.messages_loaded=!0,a.groups.push(n)}),t.groups&&t.groups.forEach(function(e){o.push(e),a.groups.push(e),l=e.has_more}),l||(c=!0,a.has_more=!1),i&&o.length&&!TS.client.unread.getActiveGroup()&&(o[0].active=!0),TS.client.unread.debug("Process response, processed data",{has_more:a.has_more,touched_groups:a.groups.map(function(e){return{channel_id:e.id,has_more:e.has_more,msg_count:e.msgs.length,marked_as_read:e.marked_as_read,collapsed:e.collapsed}}),all_groups:o.map(function(e){return{channel_id:e.id,has_more:e.has_more,msg_count:e.msgs.length,marked_as_read:e.marked_as_read,collapsed:e.collapsed}})}),l||(TS.client.unread.debug("DONE FETCHING: Last group has no more messages"),f()),TS.client.unread.getHighlightsForMessages(t),a},T=function(e,t){return t=t||"msgs",TS.utility.msgs.sortMsgs(e[t]),e[t]=_.uniqBy(e[t],"ts"),e},v=function(e,t){if(TS.model.unread_view_is_showing&&!TS.utility.msgs.isMsgHidden(t)&&!(t.is_ephemeral||t.user===TS.model.user.id||_.startsWith(t.subtype,"sh_room")||TS.utility.msgs.isMsgHidden(t)||TS.utility.msgs.msgMightBeRolledUp(t))){var n=e.is_channel&&e.is_archived||TS.notifs.isCorGMuted(e.id);if(!n&&TS.client.ui.unread.isFatalErrorDisplaying())return void TS.client.unread.reload();var i=TS.client.unread.getGroup(e.id);i?TS.client.ui.unread.updateNewMessagesMessage(y(i,t)):e.is_channel&&n||(m[e.id]||(m[e.id]=[]),m[e.id].push(t)),n||-1===_.indexOf(TS.client.unread.new_messages_in_channels,e.id)&&TS.client.unread.new_messages_in_channels.push(e.id),TS.client.ui.unread.showOrHideRefreshButton()}},b=function(e,t){if(TS.model.unread_view_is_showing){if(m[e.id]){var n=_.findIndex(m[e.id],{ts:t.ts});m[e.id].splice(n,1,TS.utility.msgs.processImsg(t,e.id))}var i=TS.client.unread.getGroup(e.id);if(i){var a=_.findIndex(i.msgs,{ts:t.ts}),s=_.findIndex(i.new_unread_msgs,{ts:t.ts});s>=0&&i.msgs.splice(s,1,TS.utility.msgs.processImsg(t,e.id)),a>=0&&(i.msgs.splice(a,1,TS.utility.msgs.processImsg(t,e.id)),TS.client.ui.unread.updateMsgs())}}},w=function(e,t){if(TS.model.unread_view_is_showing){m[e.id]&&(_.remove(m[e.id],{ts:t.ts}),m[e.id].length||delete m[e.id]);var n=TS.client.unread.getGroup(e.id);if(!n)return m[e.id]||_.pull(TS.client.unread.new_messages_in_channels,e.id),void TS.client.ui.unread.showOrHideRefreshButton();var i=_.findIndex(n.msgs,{ts:t.ts}),a=_.findIndex(n.new_unread_msgs,{ts:t.ts});a>=0&&(n.new_unread_msgs.splice(a,1),n.new_unread_cnt=n.new_unread_msgs.length,TS.client.ui.unread.updateNewMessagesMessage(n)),i>=0&&(n.msgs.splice(i,1),n.total_unreads-=1,0===n.msgs.length?A(n.model_ob):TS.client.ui.unread.updateMsgs())}},y=function(e,t){return _.find(e.msgs,{ts:t.ts})?e:(e.first_new_unread_ts||(e.first_new_unread_ts=t.ts),t=TS.utility.msgs.processImsg(t,e.id),e.new_unread_msgs||(e.new_unread_msgs=[]),e.new_unread_msgs.push(t),T(e,"new_unread_msgs"),e.new_unread_cnt=e.new_unread_msgs.length,e)},k=function(e){if(TS.model.unread_view_is_showing){var t=_.intersection(_.map(o,"id"),e.channels.concat(e.ims,e.groups));t.length&&t.forEach(function(t){var n=TS.client.unread.getGroup(t);n.msgs.forEach(function(t){if(e.is_deleted||"file_share"!==t.subtype&&"file_mention"!==t.subtype&&"file_comment"!==t.subtype||!t.file||t.file.id!=e.id){if(!(t.attachments&&t.attachments.length&&TS.inline_attachments.getAttachmentBySlackFileId(t.attachments,e.id)))return}else;if("hosted"===e.mode||"external"===e.mode){if(!e.comments.length&&e.is_tombstoned)return;b(n.model_ob,t)}TS.client.ui.unread.rebuildMsgFile(t,e)})})}},A=function(e){if(TS.client.unread.getGroup(e.id)){if(TS.client.ui.unread.removeMessageContainerGroup([e.id]),_.remove(o,{id:e.id}),d===e.id){var t=_.last(o);t&&(d=t.id)}TS.client.ui.unread.updateMsgs()}},C=function(){TS.client.ui.unread.toggleUnreadView(),!TS.model.prefs.enable_unread_view&&TS.model.unread_view_is_showing&&(TS.client.displayModelOb(TS.shared.getActiveModelOb()),TS.client.unread.destroyUnreadView())},M=function(){TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{enable_unread_view:TS.model.prefs.enable_unread_view.toString()}})},x=function(){u=null,i=void 0,l=[],c=!1,d=null,o=[],t=void 0,n=TS.interop.datetime.makeTsStamp(null,{padder:"0",uniqueNum:9}),TS.client.unread.new_messages_in_channels=[],m={},a&&(clearTimeout(a),a=null),p=[],g=[]},I=function(){TS.channels.unread_changed_sig.add(B),TS.groups.unread_changed_sig.add(B),TS.ims.unread_changed_sig.add(B),TS.mpims.unread_changed_sig.add(B)},E=function(){TS.channels.unread_changed_sig.remove(B),TS.groups.unread_changed_sig.remove(B),TS.ims.unread_changed_sig.remove(B),TS.mpims.unread_changed_sig.remove(B)},B=_.throttle(function(){F();var e=TS.model.all_unread_cnt>0&&TS.client.unread.getAllCurrentlyUnreadGroups().length>0;TS.client.ui.unread.updateChannelPaneUnreadState(e),TS.useRedux()&&TS.redux.all_unreads.updateHasUnreads(e)},1e3),D=function(){u&&(l=[],u=null,c=i,i=void 0,TS.client.ui.unread.setMessageContainerHasMoreEnd(!c))},F=function(){if(!TS.client.unread.isEnabled()&&!TS.model.prefs.seen_unread_view_coachmark){if(TS.client.unread.isEnabled()||TS.model.prefs.seen_unread_view_coachmark)return void E();if(TS.model.all_unread_cnt>100){TS.client.unread.getAllCurrentlyUnreadGroups().length>10&&(E(),P())}}},P=function(){TS.client.unread.isEnabled()||TS.model.prefs.seen_unread_view_coachmark||(TS.model.prefs.seen_unread_view_coachmark=!0,TS.prefs.setMultiPrefsByAPI({enable_unread_view:!0,seen_unread_view_coachmark:!0},function(){TS.metrics.count("unread_view_coachmark_displayed"),h=!0,$("#channels_scroller").scrollTop(0),TS.coachmark.start(TS.coachmarks.coachmarks.unread_view)}),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{enable_unread_view:"true"}}))},O=function(){TS.model.prefs.all_unreads_sort_order?r=TS.model.prefs.all_unreads_sort_order:TS.experiment.loadUserAssignments().then(function(){if(""!==TS.model.team.plan){var e=TS.experiment.getGroup("all_unreads_sort_order");r="default_alphabetical"===e?"alphabetical":"default_sli"===e?"priority":"alphabetical"}else r="alphabetical"})}}()},2419:function(e,t){!function(){"use strict";TS.registerModule("client.whats_new",{onStart:function(){TS.client.login_sig.add(l),TS.prefs.whats_new_read_changed_sig.add(g),TS.client.flexpane_display_switched_sig.add(u)},updateIcon:function(){T()},getNewestID:function(){return i}});var e,t=$("#whats_new_updates"),n=$("#what_new_read_cb"),i=-1,a=0,s=!1,r=!1,o=Math.round(Date.now()/1e3),l=function(){s=!0,t.find(".whats_new_content").each(function(){var e=$(this);e.hasClass("html")||e.html(TS.format.formatNoHighlightsNoInlineImgs(e.html()))}),i=t.children().first().data("whats-new-id")||i,g(),n.bind("change",function(){c(!!$(this).prop("checked"))}),d()},d=function(){t.find("a.whats_new_content").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"heading_link",page_url:$(this).attr("href"),step:i})}),t.find("div.whats_new_description").find("a").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"description_link",page_url:$(this).attr("href"),step:i})}),t.find("a.whats_new_more").on("click",function(){TS.clog.track("WHATSNEW_ACTION",{action:"view_update",trigger:"read_more_link",page_url:$(this).attr("href"),step:i})})},c=function(e){var t=-1;e?(t=i||Math.floor(Date.now()/1e3),TS.clog.track("WHATSNEW_ACTION",{action:"opt_in",step:i,trigger:"checkbox_whats_new"})):TS.clog.track("WHATSNEW_ACTION",{action:"opt_out",step:i,trigger:"checkbox_whats_new"}),TS.prefs.onPrefChanged({name:"whats_new_read",value:t}),TS.prefs.setPrefByAPI({name:"whats_new_read",value:t}),g()},_=function(){-1!=TS.model.prefs.whats_new_read&&(TS.prefs.onPrefChanged({name:"whats_new_read",value:i}),TS.prefs.setPrefByAPI({name:"whats_new_read",value:i}),a=0)},u=function(){if(s){var e=TS.model.ui_state.flex_name;if(!TS.model.ui_state.flex_visible||"whats_new"!==e)return void(r=!1);r=!0,p(),m()}},m=function(){if(!r)return void clearTimeout(e);b()||(e=setTimeout(function(){_()},1e3))},h=function(){a=0,t.children().each(function(){var e=$(this),t=e.data("whats-new-id");t&&TS.model.prefs.whats_new_read<t&&(a+=1)})},p=function(){t.children().each(function(){var e=$(this),t=e.data("whats-new-id");t&&TS.model.prefs.whats_new_read<t?e.find(".ts_icon_presence_online").removeClass("hidden"):e.find(".ts_icon_presence_online").addClass("hidden")})},g=function(){h(),m(),S(),f(),T()},f=function(){n.prop("checked",-1!==TS.model.prefs.whats_new_read)},S=function(){if(b()||!v()||w())$("#client-ui").removeClass("whats_new_showing");else{var e=a>9?"9+":a;$("#whats_new_toggle").addClass("exp_expanding"),a>1?($("#whats_new_toggle").find(".num_only").removeClass("hidden").text(e),$("#whats_new_toggle").find(".num_updates").removeClass("hidden").text(TS.i18n.t("{num_updates} Updates","whats_new")({num_updates:e}))):($("#whats_new_toggle").find(".num_only").addClass("hidden"),$("#whats_new_toggle").find(".num_updates").addClass("hidden")),$("#client-ui").addClass("whats_new_showing"),TS.clog.track("WHATSNEW_ACTION",{action:"do_badge",trigger:i,step:i})}},T=function(){var e=$("#whats_new_count");a&&v()?(e.removeClass("hidden"),e.text(a<10?a:"9+")):e.addClass("hidden")},v=function(){return-1!==TS.model.prefs.whats_new_read&&!1!==TS.model.team.prefs.whats_new_badges},b=function(){return TS.model.prefs.whats_new_read>=i},w=function(){return o-i>=691200}}()},2420:function(e,t){!function(){"use strict";TS.registerModule("client.windows",{open_log:"WINDOWS OPENED:",win_became_key_sig:new signals.Signal,win_resigned_key_sig:new signals.Signal,win_crashed_sig:new signals.Signal,win_will_close_sig:new signals.Signal,win_began_loading_sig:new signals.Signal,win_estimated_progress_changed_sig:new signals.Signal,win_finished_loading_sig:new signals.Signal,onStart:function(){TS.client.login_sig.add(TS.client.windows.onLogin),TS.ui.window_unloaded_sig.add(o),u=TS.utility.throttleFunc(c,2e3)},onLogin:function(){var n,i,a=!1,s=TSSSB.call("listWindows");if(TS.has_pri[S]&&TS.log(S,"listWindows windows_str:"+s),s&&(n=JSON.parse(s),TS.has_pri[S]&&TS.dir(S,n,"listWindows wins:"),_.each(_.keys(n),function(s){e[s]=n[s],i=e[s],i.token=s,"screenhero"!==i.windowType&&"calls"!==i.windowType&&(a=!0),i.no_spinner=!0,t(i)})),a)return void f();var r=TS.storage.fetchClientWindows(),o=Object.keys(r).length;if(o){setTimeout(function(){var e=function(){_.forOwn(r,function(e){TS.client.windows.openWindow(e)})};TS.generic_dialog.start({unique:"reopen_windows",title:TS.i18n.t("You previously had {window_count} {window_count, plural, =1{window}other{windows}} open","client_window")({window_count:o}),body:TS.i18n.t("Would you like to re-open {window_count, plural, =1{it}other{them}}?","client_window")({window_count:o}),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Yes, re-open {window_count, plural, =1{it}other{them}} please","client_window")({window_count:o}),go_button_class:"btn_success",cancel_button_text:TS.i18n.t("No thanks","client_window")(),onGo:_.once(function(){setTimeout(e,1e3)}),onCancel:function(){TS.storage.storeClientWindows({})}})},3e3)}},openFileWindow:function(e,t){if(!TS.model.supports_spaces_in_windows)return!1;var n=TS.files.getFileById(e);return n?a(n,t):TS.files.fetchFileInfo(e).then(function(e){return a(e,t)})},openWindow:function(t){if(isNaN(t.x)||isNaN(t.y)||isNaN(t.width)||isNaN(t.height)){var n={x:0,y:0,w:1024,h:768},i=m();TS.has_pri[S]&&TS.dir(S,i,"sizer_win"),i&&(n.x=i.x,n.y=i.y,n.w=i.width,n.h=i.height),(isNaN(t.width)||isNaN(t.height))&&(t.width=n.w,t.height=n.h),(isNaN(t.x)||isNaN(t.y))&&(t.x=n.x+22,t.y=n.y+22)}t.no_spinner||(t.destination_url||t.url&&(t.destination_url=t.url),window.winssb&&(t.url="data:text/html;charset=utf-8,"+l(t))),TS.has_pri[S]&&TS.dir(S,t,"calling openWindow");var a=_.cloneDeep(t);return a.url=a.url&&a.url.substr(0,100),TS.client.windows.open_log+="\n\n"+JSON.stringify(a,null,2),t.token=TSSSB.call("openWindow",t),e[t.token]=t,f(t.token),TS.has_pri[S]&&TS.log(S,"new window:"+t.token),window.last_win=t,t.token},closeFileWindow:function(e){var t=TS.client.windows.getWinByProp("file_id",e);t&&TSSSB.call("closeWindow",t.token)},getWinByToken:function(t){return e[t]},getWinByProp:function(t,n){if(!t)return null;var i=null;return _.forOwn(e,function(e){if(e[t]==n)return i=e,!1}),i},distributeMsgToWins:function(t){_.forOwn(e,function(e,n){e&&("screenhero"!==e.windowType&&"calls"!==e.windowType||TS.utility.calls.isSupportedMessage(t.type)&&TS.ssb.distributeMsgToWin(n,t))})},closeAll:function(){_.each(_.keys(e),function(e){TSSSB.call("closeWindow",e)})},windowWithTokenBecameKey:function(e){TS.has_pri[S]&&TS.log(S,"windowWithTokenBecameKey token:"+e);var t=TS.client.windows.getWinByToken(e);if(!t)return void TS.error("windowWithTokenBecameKey: no win for token:"+e);f(t.token),TS.client.windows.win_became_key_sig.dispatch(e)},windowWithTokenResignedKey:function(e){if(TS.has_pri[S]&&TS.log(S,"windowWithTokenResignedKey token:"+e),!TS.client.windows.getWinByToken(e))return void TS.error("windowWithTokenResignedKey: no win for token:"+e);TS.client.windows.win_resigned_key_sig.dispatch(e)},windowWithTokenCrashed:function(e){TS.has_pri[S]&&TS.log(S,"windowWithTokenCrashed token:"+e),TS.client.windows.win_crashed_sig.dispatch(e)},windowWithTokenWillClose:function(t){if(TS.has_pri[S]&&TS.log(S,"windowWithTokenWillClose token:"+t),!TS.client.windows.getWinByToken(t))return void TS.error("windowWithTokenWillClose: no win for token:"+t);delete e[t],f(),TS.client.windows.win_will_close_sig.dispatch(t)},windowWithTokenBeganLoading:function(e){if(TS.has_pri[S]&&TS.log(S,"windowWithTokenBeganLoading token:"+e),!TS.client.windows.getWinByToken(e))return void TS.error("windowWithTokenBeganLoading: no win for token:"+e);TS.client.windows.win_began_loading_sig.dispatch(e)},windowWithTokenEstimatedProgressChanged:function(e,t){if(TS.has_pri[S]&&TS.log(S,"windowWithTokenEstimatedProgressChanged token:"+e+" progress:"+t),!TS.client.windows.getWinByToken(e))return void TS.error("windowWithTokenEstimatedProgressChanged: no win for token:"+e);TS.client.windows.win_estimated_progress_changed_sig.dispatch(e,t)},windowWithTokenDidChangeGeometry:function(e){f(e)},windowWithTokenFinishedLoading:function(e,n){TS.has_pri[S]&&TS.log(S,"windowWithTokenFinishedLoading token:"+e+" doc:"+n);var i=TS.client.windows.getWinByToken(e);if(!i)return void TS.error("windowWithTokenFinishedLoading: no win for token:"+e);i.document&&TS.warn("windowWithTokenFinishedLoading: win already has document? token:"+e);var a=function(){t(i,n),TS.client.windows.win_finished_loading_sig.dispatch(e,n)};i.no_spinner?a():setTimeout(a,50)}});var e={},t=function(e,t){window.macgap?(t=t||TSSSB.call("getDomForWindowWithToken",e.token),i(e,t)):n(e)},n=function(e){TS.has_pri[S]&&TS.log(S,"_setUpWindowForAtomSSB: win.token: "+e.token),TS.ssb.setUpAtomSSBWin(e)},i=function(e,t){if(TS.has_pri[S]&&TS.log(S,"_setUpWindowForMacgapSSB: win.token: "+e.token),!t)return void TS.error("_setUpWindowForMacgapSSB called with !doc");if(e.document=t,e.window=t.defaultView,t.ssb_main=t.ssb_main||{},t.ssb_main.TS=TS,e.window.is_in_ssb=!0,!e.no_spinner){var n=l(e);e.document.write(n)}e.no_spinner=!0,e&&e.window&&e.window.addEventListener&&(e.window.addEventListener("unload",s),e.window.addEventListener("resize",r))},a=function(e,t){if(e||e.id){var n=e.id;if("space"!==e.mode&&"arugula"!==e.mode)return!1;var i=TS.client.windows.getWinByProp("file_id",n);if(i)return TSSSB.call("focusWindow",i.token)||TS.generic_dialog.alert("window already open; but you need to get a new build of the app. ask in #triage-mac-ssb "),!0;t=(t?"?"+t.substr(1):"?")+TS.getQsArgsForUrl();var a=TS.model.team&&TS.model.team.name,s=_.unescape(e.title);i={file_id:n,title:a?a+": "+s:s,destination_url:e.permalink+t,url:e.permalink+t,worth_saving:!0},i.no_spinner=!0;var r=TS.client.windows.openWindow(i);return r||(TS.error("no window token!"),!1)}},s=function(e){var t=TS.client.windows.getWinByProp("window",e.currentTarget);if(!t)return void TS.warn("unknown win in _macSSBWinUnloaded");t.window=null,t.document=null},r=function(e){var t=TS.client.windows.getWinByProp("window",e.currentTarget);t?f(t.token):(TS.warn("unknown win in _macSSBWinResized"),f())},o=function(){_.forOwn(e,function(e){e.window&&(delete e.document.ssb_main.TS,e.window.removeEventListener("unload",s),e.window.removeEventListener("resize",r))}),f()},l=function(e){var t,n="",i="";if(!e.skip_css)for(t=0;t<document.styleSheets.length;t+=1)if(document.styleSheets[t])if(document.styleSheets[t].cssRules)for(var a=0;a<document.styleSheets[t].cssRules.length;a+=1)n+=document.styleSheets[t].cssRules[a].cssText;else document.styleSheets[t].href&&(i+='<LINK href="'+document.styleSheets[t].href+'" rel="stylesheet" type="text/css">');var s,r=e.destination_url?"document.location.href = '"+e.destination_url+"'":"",o=TS.i18n.t("Loading...","client_window")();s='<img onload="'+r+'" src="data:image/gif;base64,R0lGODlhUABQAPdqAOn38njO398JXN4GWarg6////7Xk7fP7++mmGvjI2mnI27Di0v326P7///XXmEi9lzC0ieiiD94DV/POgPTSjD65kaHd6Du4kDK1iupck/jjt+mnHffdp2TH2uARYJTYwvOfv+H0+GvJ2+Msc+ijE////jW2jP/+/d8NXje3jfSpxlLAnOEeaYnU4/768W/LrTq4j/WzzeU4e//+/4DRt/LJdNnx9vzi7OmoIOT18PrV47/o8G/L3u/BX27K3OAVYzO1i+v49P7//vzq8fDEaef2+ehTjHfOsu+9VWzJ3OtlmfD69v/+++IkbeikFv76/J/cyOyzO/3w9v/8/edJhvzy3OZAgPCNtMbq8f74+t/z7WTHp++Fru22RKngztLv5tfx6crs4eqqJc/u9MLp3Pf8/HLN4H/Q4WbH2u35+7jl11rEoYnVvO5+qZbZ5ve90+uvM/StyfGVuP789/n9/f3+/vv+/eqsKu1zovrpxkC7kvvu0uEZZu65TPz+/mzK3P70+C6ziP/9/vCKseEVZc7x5eAQY+qrIGrH2DpraOGmILmbHiaaieEVaCmihTUON27G0WWKKza+kV6AEla6wfFMim/O5r4UWtdDfr65beL3/qU8bdEfEf2hw8qCojemnm24p+cVZS+jkPKzOGWCEx+XgF6DHDq8kWWFHOF7GBqSfGWvluqvHvOwMPT3827I1UwPPTWui+uxIecPYWjK4uaXGT22kM0NC9ikIuigH+2pINwSTuMVZNMPJz6/lGXF0z2cgskKVz6qpZ+TGj1WXmaPOSSggrJYgekVZfGqIDSoh4CMG23J2d0UVTqJd9QKWdLDetcRO12/yj7DluWFSOWnIFC2uTcxSdUUYHUQSNlMFGmfZKURU8+hHm3EyvCoGucKXtQxEnvKx+I1aqyrU9wHTpHgxbqSpvFclOmpFemSWtknQzrAk9k1djS8j6jGotufE+HCbGPUrvJTj5Tc8NnCzOqtJ32Jj+yqc+6rjNMHWOJcWLzx3/CfkQAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFFABqACwAAAAAUABQAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjyrwoREuYMABEHghho0iDkV9eVEiR4gGNIB6LWAigQAGPFjZCkqkA5EKFChcwrMjBMUSADiJ8iEWjAMtHAA9SXF1bAcILji0UiJ3rQwSPIh0bQIHAti+YjA1ChKU7twMBjy9M9F2LwYvGHWgIz1XQwuMWtYupfnjcQbJYyh6PAMlcobHGMXI9d7CQdwHfxRcu/M1Y5kxquklERO24ZIXivhBo/DwNlq6IDgZAhnmAweoFGBC2LNn4E4uZDmjQdAiwQ6QWGg+srv+AcqCExzQ7CFjAcmA4yAZCloDR0j5kA/cz8+vfz7+///8ABijggAQWaOCBCCao4IIMNujggxBGKOGEFFbYoBQ3DCGSCxpMMAEHDIyUQAYjsNCEETF8pEEUJLRIghgOhBTDDxJ4YKMAAnDRkQYbOIHDjzggEAEFH93QBAo/JJmkBwOocIJGLkThI5A/boBDFeZxdMUASnaJggxPZHSCBiRQSSUJRHZkhABdtqmDRhOUaeaPTvTgERVstrlkAnDKOacTSHikBJd6JvlmRhz4aSYJNXikAqFtCmDFkxlVIYaVf2rg0RRUSNAmCk1yNEEEc0Zgp0cnDEHFADgKIEETIHQ4xEQNLSKAgBOmuhBSFiooQYURXNwAkgZEdBFFDxwwMdIMM5h0grIWRivttNRWa+212Gar7bYVBQQAIfkEBQUAAAAsDgARADQAMgAACP8AAQgcSLCgwYMICR4YI1BEwocQIwpscMBCgA4SER7JCPHAmQ5JfHAseEFPjpEI3XTwIRIlQSALhLgkGIIly5kDTbzAORDLyps8S57kuQONTYgFvAA5WKECEDU8AYwxevRhDj0VDDbF4EUmzgMBRNhsmfCFiaYAmqp9GhXAjg5/xvpQgHABBrVpmwptC8CAiA4K0HTg4WbHwSAPUqhVG+gDX4EhCLgpXKRBQjJ6MFyocCEFhCNlLD8G0EA0RDBHHlTQs8aLndE4l4DJQacE7Nu4c+vezbu379/AgwsfTry48ePIkytfzry58+fG52igMIEDgxPH83RxQoJEhDsUbCennHIjgY4ssPOIcYKjPQ4EESYg1HHFCh8UP2TImcKXSR/27rW3AQ57GETFDwOg4MEPP6AwgBLi8ZQHgAG2RwIFBXkwAIMcciiBHG05QIJ7BOHgRB8RHtQhCiOgx5MDEbSH0B4FPNThDzpEpQF7bTHoQQJRMQAHAlH5yMcNUZVABF8/CEAFXxoU2aQHb/AlJJEueSDAADJUidwALBgBAiDJZQDicjMgFxAAIfkEBQIADAAsDwARADIAMgAACP8AGQgcSLCgwYMIC7pJyLChQ4EHsAhEg+ZhwRcWE4awEKCiiIwEK8D4ArLgmD8dRPgoWRDDhwIsGRw4o2BlTIIw1vhh2QBLBx9ALZpAKJIkSwtogNpsuIChy5hIlT4E8AAGwhRr6LA08FNqwwZHElZIYRRkCJVKlzL4U9EgkIMVKmCA0oAlgQ5/0to0w0AiTIIXDMYFwiamHwIiOlDswKNvmr8Fj5iIyyCu5bl1Y4YgYMHCjjQMMh9Ug4Gy5bhkbw5sIJphmTVATseFEFY1SzArIMC4cCEFhC1BbMcEwGZFBT0roBwoITxmiQNatJRpTr269evYs2vfzr279+/gw4vyH0++vPnzGV1ooEBBgwvzGqKQmB8BDofxJTQgcIKjPw4EEdwXngtw8OdffwiIUUVDJUihww1PqFYCByQceCAJDiBUwBAqZNAEIXzIcEUWN9VQYX8E4eAEEswRNEQcHgoggAc/eICCBEZIEZOJKB604EBKNCHjQD8UWaQEeJzAkgMVJuQAEwL9wIAHBxnpAR86sLQHDhswBFlCRv4ggAox9YEAdUUOAEJMTDKUoUNGChCDICxVIUaXqlnJwhA3IeGEbUV6IAEXqr150w83snCFkjdVwWVJiE5pxSA3MDqeB1ZwoQOd5RnRRgJ0zjBDeV+OFxAAIfkEBQIASAAsDwARADIAMgAACP8AkQgcSLCgwYMIC1pAoiChw4cQkYwR2KFDxIJHLiI8MFEgGo0FYTwAAHJgEQsB0HwsaRDIApYhAnQQ4YPlQRMvCoCk0wKNj5oggSC8oCcHyDEdfgK96MWhS40NCCT9CTKHngoIceq8aMEnVY0FXiQkajRiHQNTlxr00TCol60QbShQ+nVgQx5IdiBpMLBsVrEX61hIq7ShmRY7ivA1CPggWSEXy7jpgEaBgqQtkBQpANfgAqEHKzzV6GeMmxZuDGyOCOABDIMVKmD4YHPv4ohCjpiIzZs3hqa1S6rBEBtJ7wopvgQH2SDIgxTHK0BovFyjGhO7Y1+AsMJv9Yh8yaz/gYFdDw2S31naAaOGTI4Gt9PLn0+/vv37+PPr38+/v80qFPTQwwR5+FeQA2JE4IQTJDhRwxwGIsEBCQjgYKGFEdRQgn8M3FHhhRZugEMV/k0IIogkOHBCfxOQcCFBODjRh0ZT6PBGAkPMUBIFLuJgkIh7PHSCDldY8YMAKLCAxxAanaCBEz4iRAFCMxBJxQ8DoPDDlh5IIMMQK0bU4QYJ9dEZElZiicQPa27p5gAZaFQCEQ8FOdCVA6x5kJtb6qCRBg9RsJUHeibE5wAqaMQAHAg4tKFGbgoAAkhEkJAQmSBF+oacTzo0JaQ/oDCCFCAt2uh3W6IgaUkFVJqeAAOMNRBDmCB1WpsHsCJhBAik2uQCoyXhigQfuyJxJktTYnoRH1TIccMMOlb3KEhX3BAhQifQ6l9AACH5BAUCABAALA8AEQAzADIAAAj/ACEIHEiwoMGDCAu6gSAiocOHEAViEYgGTUSDLy5G7KDRYAUYYDoKPDBGJEQMHzqGsBCgokmHKbbUuWjDTAcRPl5CMIHw45eIZc4o8JHz5YKHKSFiQUO06MsHMBCmWOMHIgGmRHUKOZLQJ0QLWJ06tCgSJUQDHZpCNANhYkEAMNfQeRgCp9qDPBamKYCQa08YPx8S6PCnaVYIPASmadAgoRA1Ds06bEDHgoIOFdO22KHz4NQyEW0QcOPGQJECfDXyBfI3zEXGnQWyPlhBcuyIqS94rACExu2OXCsMrECcN5vfFwuoAVK8eW3IyCMeWGHCeQUTa8qUiB4xjB4gF4hf/8DwIDD3iGBeXK/+Qsv5jkK0kCGjpfH7+/jzD9xDoUcPClXo9xAFG0TghBMR4ECBgAeVQEEEG+AgIQ4bkLAggwTtQeGEEyIgBgMnYAiBgwlyOCEJDogoEBEkTFiQE0ikxmAJLEp4kBgqQuBAgg7J2NEQCegwxEUabpAQEh0VMEQcGTTxgyFNKHFDRH044VAVIfa4pBJNQCCABx784MEATegAkQMkJBRBiggVIEUcXAowgAcC/WCnnQNYkcVDexziEBJZEiRFDHFCQKdBd/4wQBwPFVBlQn4WpMQIAhgKEZ54nPmQAzMM9IOlEd05QKYOnVAFhT3qJCoXgR5pJUI4dGd2JwoJQFQAmg6xKZKdHkigxEVViGFkQtt19OkAfLSx50VIvHrbpxD8QIUcN7R6ZpqyohCtFVfoIIggnXYU7LDGauuBFVzoMMVtE0AQa0ceyMBFAoL4qJO9F7WRwBMQoJajQf7+C0FAACH5BAUCAAQALA4AEQA0ADEAAAj/AAkIHEiwoMGDCA1aCKAgocOHEAeOEdihQ8SDR4Rc3MiR4AU9WjqK5OilQYGTKFOmPDBx5EaVME+GWIgGjcuBQCro3Knzo5aYKcfw6CDCx00CGh9CAXoyDUMfRo8K1MOzqoktTAsY6AA16tECLxyCZNpCQdezaNP6aDhyacwGZbtu5OFmxwGYOR5ifesGjdyHXh2GTVgBDNCtaA9GLVLgYYEFSoGWOeMXrYIOPFoYkGpwb8wQZzooEHH5TwuBJrO+PWKialXDQA8YaHFGc4gGnB1CSc10Bm/VqgE4vJo099EKF74AX768+MEKJtwynw40yIMLrnUCYUO9e0zW2StA/5DuvbyanNlNhPnNvIoDIkQo7Jm+ZEXrqkC21PHuQEwEEiREgAAFJzBHRgVAYIccBCv81J0DTiCAw4Q4bBDBBNN98QJ0JuhBQw7dncDAHRJSOOEGYlQxnR9akBEGiOU5QIKJJpLgQHcNsEddDTPSOKETSJQnZAE1OOHjiSmWMCR1J3Awo3FSVSHGBg4VuCR1SDiREA6cTaFDDDHoIEhWHECkpHcn6DCIFT8IIMAPVCTAlJQO9dHdDDpcQcUPA6Dww59t8vEGUz2Q4NB8y+W55wBvAuooCiNIERMTZR51gxyL+unopn8OoIKVKlVhT51npnTCpVQQwiinrP4pAB6EOnrEpUFGqNpoq62+CqpKlSZEQWMDeTAArsR2egVQJYz4UAmc/enBDzpk1YNDVDaLwgBtqNYrQhRIJcAATYAAnLIOAcuRBwKxYAQIki43LZQC8bHuDd1te9O3fFAhB73ljYiAS9/Cue8J8HL0gxVXRHsCwQVfNIiYDT8UEAAh+QQFAgAaACwPABEAMwAxAAAI/wA1CBxIsKDBgwgLutEgIqHDhxAFYhGIBk3EghheNLjIsePACim+eBzJ8UMBkigdrrHz8MCYgR1S0khYAUaYhCEsBLCYcqAahxg+HGwwRkQHET56DgTw4ALCFGvKGCzCQ4GPpEoHHgGS0KZBAh2uYu34h2fBnw7ZGGyB9CrHJBbNaJhYMMjDqAVbWHUbEQ2PuQ6POExxk6AbNGIh8liYRsPJhGpMJASiluCOsIkPyt2RZmNEu04PwlghdSCdFpjFYk26Q0MJj0JocEVoorDABmlQo1GgIKzAIo9RSkZIObhAOljctHBjIIRxlEs0wEA4+gDCBp6zCpSdsLYQ7Q/rkP8ZfhBCZY4lqlAgQsQBg4vRu6448DpiCQobIpAgEeEOByYRcXdQBSaQwdEEEWyAw4I4IEACBxGNh1AFGJz3UB4bKMjgggjA8V5E0xVUAYEvRDQDghtu+GCAJowo0IgjAkHDdxAh4QSDBOHgRA8RAlGBBjDCCMECF9m44EF3fOiQH1tgEOSIJqwQH0QUkIBDQv9BBMYDGFww4gVA6CHSRXkgcKVSORyhRwom6PGCFtlBxEQXCCR0h2P2ARBGGDmMVMAED0EI3kN7mOnQcyg9kYAcV8QxREElnNBFQjiIkVUCbcjgwQADCMCCHCcUVOVDiEIkSAJcaDoAChr84KoHErTUQdAJeyiYEBIdTYGqFR4Y5OqrKCQgyECS1omQGFVANIUGXPCqAasH/frDAEoQVAAFDpHg0Ak6DOJsRL+iYEVBe5yJEBLPFaDDFVb88CxH4VJhUB8OIVsQFe5C29Gv1IZKELYOOTDorwLEUFAB5TqErnb5SoBHfQXRS2kVEKPUqwAjgDDsQQAnJHBPAmigRBxSOFSFuYMK1EQGjkL0msRZ9aoBCxmoMIS/F32ckswsGAGCBoLM4FF6OGwwksx8+JyyR4RQIccNQZe69EFX4DmD0FMfFBAAIfkEBQIAEwAsDgARADQAMQAACP8AJwgcSLCgwYMIDVpIyLChQ4JlxjxkCGFCgYkHywxUgAYjwgpgPArUKHIilAYTSU5QUPLhFiENVU7o2FLgEYYXQmaUeGZmTYINFlCEYrAIgQBoaP4smENPwxkEbQTooMDH0oMlJphImHPggTNofFit6YPlQaEMPww00EHsWI9lJ/CYsGMCyoENADCEMcGOXTdhxYrsYKZF3Z8XvghsUVXwRB8tJhR5uABIQgxqGwB269CqgSIXJ+pNmGJNHbodknA+mGSCAbslCxzZihDGlwZfA7sdK0JgiLs/LSPE7HuqAhEiOojo2Rd4FQc1iDiogjHIhAsIS9Oxe4BAiwAtCIT/8NMA+AQHYiKQWC/GAcbZCfmGnjCDjp3y5s9HQICjPw4EEbjnUANqCHcQcQ6VUIUY/PnXHwJ3MPCQdaStQcd8CVFAgoMOksDBCQ/dFF8YDxGxYX8E4eAEEhOpkcJVE5iIYkEbiEHdQw9UKBNCGuKAUAQeGVhQBSmQ2NAeOGyQEIsPqUGbQRUAoVZDJfTBkI0PLfEAdkNGSQOM52GYEA1AVFCBQGaaCQQbDyGp5FVkYJDmnFGSkVVDBfThREJiPFQCHWuYQGcFGGyxnUMnCJiQog198QAGF5h5AQQr6ESQIDqoAMIbgKT4JkJ3OqTFEXqkAIMeNORA0Ak6XGHFDwII/4DCCCpYlGdCn2KUQxhhUGhRq1T8MAEKPxT7AwoDXCEQo2AOVIAOcgQ7gQAEGfuDBx4kMEMVSSZkpUfPRisstQdZOwAeFiGxJ0I+gtjQCTdEy8e0DhkrABUTlMBsQUAyVEC8RsxL7kPGokAFiDd6exC8IAQ8rQciGTuAEgMxeVB/exjksAAQtyRxDAPtWxAFB3X807ESUDzQggx92+wEHggwQBNXTFGQxQjtIWZNMrOQgQpDHCQyQSRfNQALRoAwhLsI9fmyQMJOwEfSNzh0Ec5XRf0DFXLcIAhUE3EA47ETbC2HDgXsjOcETpdE9g9WXIH20x55YAUXOpygNt0JcQiRgCC28o1QQAAh+QQFAgAEACwOABEANAAxAAAI/wAJCBxIsKDBgwgNuknIsKFDggewPJxIseCBgWg6VDyY4stGAhc/PvxQYGJIAmhEOlxjp+FJAhpVCjSREMYXIQdDBoApc2AJNQwxfLA4xkLPhAAewGBIR6ANCwHQoBFx9GADAkBqhpmxI6MIH0f/SD2oBkPDEAq+glWZROrOMQRKbmyhwIfdijx4iCUQwA2WlxtTSDNjd21DHpYsSbVE7+/VhkATAhFG+O5hAqu2LSMXbw/FIAxhMGLGozBDWpC2LYL3LVkEBBRKUMx6UI8xSpUNF+RBYEefCN906cKBY0MEBxRp1o4lrHRhuwoI+GhBoEgBDk50bSDOHcEdBg4bLP8hsPRgBVs80ChY3yEJAQPWCxQoQYQE9/s4SHCYSIP2wQtqGNDCGW4YEEID8slFQB9OcEcQDk708JCCCJnAhkANZIgQg8QZtAFF49W0wgGyMTSBfQxRmBANDKVAhkN5IIBDQhI+RIZyB2U1Q0NzdOFEQt+d8NAKIgJ20AQMkVCRWRW+2FAe29FYIkMNOLmiQyd00RB4Q5ZnEAwrhGhiQxwwcVQFJliJ0I4yVkVACghVAAQbODHEhJZVHbCClwNVUEEKWxz0RAJXtCGHDgSkk1AE+z3EBgZ+CuSnnya8UCcBg7YhAwoDdNqIESQckqKNJkxqqpzmECBIApp6MAAKP8T/+oMHAoSDgKg90bFGqZPq4cs0etTDhRUeGCTrD41Eo40suMoUhh5AVPArDMAQswkyBKCAkKyG7BLOjAghQREY8rgDTCLXPMINCsUyFCshhvRSS7MFiRGXQwXowMUm3GTDDTahPCQrH9HMi5CSDM2gwxVU/CAAOLPMgkzAAsdqyDiH0FsQElMOlC/DPwgUMgGE8MILRbJKcEWNB31YhUENi3zUD5waIQgBETDkQMcyH+WqACPI8UQJe4DrJkUCEKBEDFIQ1EdDVQjppgBNEBDHQVLrfHQGKtybkNFHE9AuCwIN4ZBsT4ctEB9GgBBXATPs6BByVSXNh0A3yAT2RkkTEUCFHGp/FPIVXgdeEaKGNxQQACH5BAUCAAYALA4AEQA0ADEAAAj/AA0IHEiwoMGDCA1aSMiwocOCYx5KnFiwzEAFaCgavFABjEYDFj8+hDIxpAEFIh1uKdDQpIGMKQUCSdiRpUGTGGMObLCgIUmCLnUezKHnQsItDUBGPCmRBw+KBV6YSKiHDIEALx/ysGTJKdeCPgx0OLhg6kE9yoTRShLWoVNQ24oV2waqqw8FHZ5iMZB0YIEcCPUAUcXIx1O3kLaRIoVqsalttJ7uSNNwZkE9xlSpmshDMWNUpkyhWpYpjZ++CXsatFVKs0RLoBiHRmVgWDcErRg8BGAABkE9rF0fZmhp26TRw3DpMpBMFwkOE80ODK5ZWsOM22zrSmYAh0AcTnpM/7Q8ELPmzWaGCxRhQMQZA5qQfPvWveAGA1UcFghiwGj5WOcxkgQPPvjA3h9nEBBCHQJREIF3Qh1hEFrnUcJDBwokaIMfBe2xAYQIleCQEAZI919mwrRAgA102FQQEw7l5xB/Z+lhwhpluIgQBQ7N8JCECV3whUN74HAfQkhIpAZDGHyAGkIF9MGQGFXoeFBSDySUwhp0OMRjQk44MJ6WYRBpZEJIWHlQAUsmBMEH+knJkIwOPeDfQTiKyJCYe6qp0QUplMlQCVXIIsshQpXYkJ8CCaIDCPukUsshiB6kZ0INLMEQDCsEZUABOhhgxQ8D9HLLLdpsUOlAJPDpEA00Bf9K4qc6XEHFDwag8AMhzZx6SziUGnQppgxV4I45oMpxqwECEPTDD6aemoosKS2xgm8DVSCQL8Dcs2yzCfnKyZEFDZsQDUBou60BiVzzSDbgNMSruJMWJKdDZLgzjS8EPeJvNrPwwtCuBviay6rf7THiAau06+/D/mIjsLwF/ypSATeAMA83EEPMDTIPzYsqtQbdS9AJQ4BgBAu5IsMNLBDD8rFEhBjyq6oIKVxQBiwb4MFAyPDCDTfZXIINyA55IIAAI+xzcEIUqPmzQaEgY3UoEzPUbBMZxAEIA/YkhIAB5iZqwAAsZKDCEAQlydAejH6EthEgIAQdQ1+mhKsBfNBLfUNDYphd0N58UCHH34saIJ7gA/1geKifxk3Q3UKhYMAPVlyhg48alcDAHWOLZLkHVgxigCA6lT3Rz22czrhIbSQwxQwnnPA6QwEBACH5BAUCAAAALA4AEQAzADEAAAj/AAEIHEiwoMGDCBEqSMiwocOCHTo8LIgBQIOJBw8MjIjRYAUTXzoK1Cjy4QchE0kCQFPS4Ro6DVUCkNgSAA2GKcIgVMlyIA9Llnj8tPSwgBqGQNgQvMiQB4BV24oV2+YtqMMgDxLCWFOmBE+EPCAVI0UWFSlUq8w4FEIDyEE9ekx4eSh0LKq7d8muIirwz0qDRw3qieVI1ScAIhpaWnUWL15SkV7xQINGLYAyBZcAgEFQjzJVqgQicmjJLl4AeCftBYBFZkEaJgYOBh0aAKWGPJgVc5yxQIGEQsjEFqjHGO2JTu0WXITrGwAXDjVfEGir1HHRirdNMiVwUTeBunA4/9FQwmFb6tZBD7zNkBaoZQJxGCRB5KFw9NcBHPZRcOGfFgDkEAUAyRyEABwMRLcCZ8XlB8BoAi0kQgsGWCRQDSQwpMFDNwEQF221ETQhACHUUVAeTiREn0MFkCFbLCCGdphAfhxUwhxRIIDQgQnGtCBxJjhSypDG6JGGQxNE0NBvDNWhlGx6yJaCiwyVkAcC8h20okNUIgQEDUwmhKOOCN3RY0JeraDVCppVOUFDHDz0JEImkIESQ1dmeVAPa4WRQkIYdMjQHF2QeZCZDh3wI0IPLBEmQm/KIqmkhxAUp0NzegRAYAkxsQcOqWgjaioAsDIQnw75yRAN5SH0RAJtcP9yy6yzclJLpQAgylABmCV0wQNBGDQFrDJ4AEA0AtE6660CXdoQG27RqQaTw3JR7ECN7DKQsuHIIlAPjx5UgKoISULDCQBwYYWxKDCkLLMAnJlQGWv8qWkimMwCQLsOKZuKtwA4yxAbFQ1UAUGPcINMQ9omS2sqpgKAxENhnJLQI9l4QAhDPxBEay64moluQiNfDAsAvDDUSC8O36JNxABEIPBBV1SSDUKPPAJLyhPVWosYBCERriA3yEFFyuBwkzPCOWO8cEPt3sKJNtXgOpAYVRRkRMcAdMxLKLA0LXbOl4QyUSq1yAIzQQ4YxLVAvCBzydhNK9yQEjFIscchVhd05ITQDsmdjdiwcIPNQQIIFEdBfTCE9UNmcyO54aFsXFAGKohLQUNtT4RMKI3wkrKxArAg0BCClFzQpyrWNJARIGDUuOsM3SCIIDNMtDntBFEhBwDhPjRDFThs4HrHVwAwQ+41Bd8RFwCozntJ0APv2/QPBQQAIfkEBQIAAQAsDwARADMAMgAACP8AAwgcSLCgwYMID4pIyLChw4Jo0DwsCCFAgYkHywxUIBGjQRhgPAZoQEfgGVq0RDK86BHUtmLFtnnjwUNlQRgB/DTUKPDXNlKTTKEiRWqVpZoNj5hIeOELQp4BFAT4s20SKVRYsRZFynABQwwfCLI0aGnV1axaSUWCxBVhjgA4D6bIWQCq1IKWfp7FGgBVgKKWGjZQmtCWV4Y0i50t6HebwQ4GDw/Uo8fWQGEOeRTja9CvN4GQBR4YGwBAgAsC9cRyVIpgEsR5rz5Mk/BIamWqVIm0BMpvQnIjGzBUA0R1bt0imSEcNpCBQ9MBSh03uNDjMFwCkwUgwYE0wiOBjiP/tylQl0EnPR6qwT29IGaErwOE6CIQh8ENdwKUaBjElviGC/1xhkB+CDdBQxw8dMR/CSkwoA3BEYRAQuh5d5AaxjBI0HsMMUEfQvg9tMQDGYqXm0APBDCDQyQ0tB9DDdBggjKlSFeKI7FYBkMYDZ2wR0PpPVRcALakYAtlA7HhkIdOJCRGFYKNmJoeBx3QkIUFtfgQDQ5hSdCPDCHhUB1kLJWQkgyVcEIATQZwiCyyHMJKnAFA2dCIqCG0wgEvJkRBm7mkok044aRSSzoBrNkQlwyRcWUAuQh0y6SUcpLKRGUyxEYdCQHyhhIGUTrppUzcyRAMKyxhkKd4jICCAAhR/xqOA1s2RIZwAbDqKkHNHCRqFII4lOlBp7jDxhMJtPqqBxNReqlDB6wQV2rTEOkMMe2gEACzHjlLq5ACVRvAteQRNCknEWAkibXEHITMDypNqg0rONiZkBBZANNuQtg0REg0BU0aTi6HkPDtQVMkwIUMDT3CTSjdWurmQIoOVIDCVjA7S8PZIONRKjiwQpB9BWUsgLYBhAJvQo/AAvFB2qLA8MR0GlTqQLASBG82CD3ySDa8GDQACiPgkcAMDMjCUB8OIXOJzwT57HPHBRX9RhYqztAnQjiA2RAsUoft8yUbCzCCEm8AYlAJB5cbytNi+8wNOE0oEYMUBRSwokFViFJBoX5NXwK21LBwg04cUkwkZrkDIeNBMNxwc4wKQ+TtpUFt2+QBrCwYAcIQdXDq0UV+q7S5AHx4fkPejJPHBxUgrN4643LcsObes5N3QsW5TxQQACH5BAUCAAAALA4AEQA0ADIAAAj/AAEIHEiwoMGDCBEqSMiwocE5Gogg6UGBQYMyWAR26ODwIAYADToKZICEBIlvJCIsemdJZMMUYUS66EMimaJFw1CZmgSqpcuEbEQ6gIdTpylUqEgV88Hj58EUAMowDImFHClTR5ECQEqqZ0c2HxHCDGnwwMBfWJGiMrjNUtOpZEwkBBJ0IFmCf5gVI7W2INJirzouWZEQxgqpZgWiKWhpG9++BkF1LEADiEE9Ak14aWgJFF+RSQAsNkgGqkDMA40B+NSQB6RICZW++iM6gIUxZe4CKHFgBQw9emwBUE0QEUMfHUEFADAmMcKgsYyVckqQFMNMAAoU0G0wjCNVqqgP/3x9cJEiAKPmdMRSCjzCUsZ/LgKQDIAuAE40OPTT4lN48aINtAguB5FQg0NFmEHJfwixhhByO+QwCgA4HIQAHC4UwJANfyDCiEsL+dACAEVoB8CBCeXXUBF/mCFMQ9YIlEQLBhTRgIkC6ZeQgQ35cQYPCzLEmgEhcCdQAXNEkdCFLjSERQceMliQIxVk11ANTqSogYYJ1WEALf6BJ2WVKZDR0Ax5ZIlQBChOZYM4qpRSiiOxVEkQDQ4liQBCTJbQUAFlrCDXUwAs0dAJDanY0QdhHQSEGg6ladAhrMiSTg1MOFRAGDDMhWdDeg7ECoWpaGOqHDc4ZMcaph30wBJcJv80AQmjVggAJ7fkeks5LKgww1SMJmQCpAxlCkAttxaUay+GCBBHQ1+0ehANQiQ0RQJchMPQLT+gMIIUDNHBakIPBGHQFDpwYYUhA/SybTSNCBBDQx8w9CiXgugwiBUeELRLQ700MoAc0HZ6EGY0FKDDFVb8MAAKTt3iwQAg9LhGQRX4AoAewCSCCS8AQIyQuwndEo0hCQhCb1gac5yIS41se0svVKgMLTsA+NLxQf0CqGsCxiZUAB2rvIzQIw41QrKynGgTgY4IFXCDHJUASFDMBmmTSi6W9uBnQSfcAIIRfAAAziUOheKStrkAwMohAt3BgEFkDyBAv7yAzNAjlyDOwzMAAowgELIIcRCrQAP0LJDee3PjN0ECCNBEBnEMsQfcCfVgNUGPZEPQACxkoMIQ2RVwQhd7IiT31wnxonZCj8DyDOhGgEC6QRQ0xEFHyHBzdOy1pyrQrwXtYWuBRIh0ySNID8T8NYmAYqRBJfSx+UC8ZMP884kAcwo7hYiU+/XdBvMI9MDoMc0pGEAhEqLHO9Vt4lYMksAR7KQARAorqFGtSKyjDgqs0AYdCKIBfgCAFtSwgDA453oOaUMCnjCDEyAKguKZwQxwhEGXBAQAIfkEBQIAAQAsDAAOADgANwAACP8AAwgcSLCgwYMEmbhwgbChw4cQA7ig0AUOnB4aImrcaHBPlAhOECAg4aTGiYINynBcWdBFFCc4YsbcEIHCQJUBzohgyfKEgwgyZer61srVmJwK0PAkCCFAgYhIYMbUlSyZogDDQNFaivACGIgnoiCgGqCawGUCt3FtCEUIxD7frgpEFcCUwEje1ho0scVtwwINMg1Di3AVyyMmGsL48tSgSgJnQE2C6GNjgQVAHH4g+NQG0gC0XjkkFQnSyhwPGqZYMyMAHc9nFLA0zFEIYoMVBNpSk1MvwcodHi7AMDD3QEcBhEFkVowUQlSovPFQ0IGHGywH/gJ4cEFgd+S/fa//shRgRxqNRzKDNygtIt2G5NI0aND4YRFxqvT6KHZwGK4ArTCwERY8tOcQI0msNEwAugSQTAAkcBBRAzaIkIQZEBmI0FYCDdPNQU70oFELClRmzUPKGbTTTgaE0IWDB21wBwMlODRDGjz44AMPv5Ty0E4C7SQbASHYMd8EDkUIkQ1J6FjZJw9RIpACZxBggx0CNSBQHhs0FCJEITjpgxknOqSclXQgdEIXTiAko4AO0aGTjjz6iJAxqUFEAQkNRVhjQzPs0IGTGCJkSwAXhPEQE3t0iZATSEDkhwUdlEhmAPkZE8ChBLEBERNsuilGFfUhFOgZPOToiDKcFgRDADg1/1SCTX1KGJEfaRThBw2JIZRCGH41tAcCB8kSQC3UKEEFFXjoIAhEavSKkKeL9tGmQLKwkotAnNxSDgooSODBIBAtwV1DKxzwZ0M2GbutQdE08sMPHgwgx0MF0JBZQ4o+VEUAqThEyLw/oNDEEA+RIe1BbJRaECBv4MHJQ80MPK8AMZzU0BIrvIpQugZBjMcIAgQQTUQE2wsRDQ6ZQMZAWUQ8AgoBeCBQMxAR/MMAIECkMEKnSMLGEwngIQPNNq9U8bwe6FDuCgXpMc2mzhBz9EMnPySvBEZEVAcbmekhUAVVb0QIzg+hMAAVN2hEhiQBkE3MQcj4Ng4IWWgkRBbAzP+NECwQEZI1Qqk4oNEUOrRhRUR1N0RIQ4cEwEofDheEOBdW2DwLNxA1HpE2AeAgi7ECibGHQ5kHgMIPAYTC+kPY8HIQzQHIINC7Bzmg8UECvC6Q7zyNoMQbgDAgCw4N9eHbQaEMJEATSsQAiEAzlBBVQzjsUXlDP2Dz0CMBPK9EHFLk7lAEhq+UjUOPHBMHwk5VXoUYXorIETKcN6QMtQ4VEOnyAuHFDwBXkFhMYxqSWIOWHpI+AHoAHOsTiDKm5osKVCAFW4DIU+jnm5L9oBKeUIYvpuELPVjQghhgmQaXx7p7NYAOWzDBCU94ARP0C4AOGYQOSlCAHgYgDDCQIQ0xA/GBOuDwL5XTEhlWgIEmYqACUPDDEZdyADV8gA1e0MJ8priU+fTwi2AMoxjHOMaAAAAh+QQFBQAhACwKAAsAPQA9AAAI/wBDCBxIsKDBgwWZuGBSAqHDhxAjEizBYEIXOFGI5JHIsSPEPHciOEGAgAQCBx5TqqxyxwmOly83RNCgsqbEGhFg6nTShaHNnwVLzImCQKdOBBsJFjgAtCaDOxteFsRBYsJApm4CNFXpAk5RhKOWCAyAZmtBDCEaRCRCAgfEDmYPpggD8YQGlwMVCUQVNyKbAhBdtCpoKgTfEMVe9TWYYg2dhyXK7HUIqikNIA7nImRqIcSqxQaFkDHxkE3BA2NCaIULKdLhg4mBLlmRAiGMFZJRqy6bsrJBBRwbXDaoR6AJL6r7igiB5kzH0QOLDzQW4lPE1q8LkioG6Q8aNAEs2P8oA1ji7IG2QlAniGgrqDMWxpRpoNYjGwjqEVKSSMrhsExMlddRA2XYYNYrkRB02CKKIDCKCyk1YIMFASgA10OltOcRg8mEoEsITtDkkQUdlOWDRPsh5N1AHBpEQg0eGdCBDzQKlKJD1v0WAg9u7ADAKB4ehAAcLgj4UBpmiFCjQIgwApGGIQDnQ49pFGAljA6FyNEYMy4pkDAQWSOQDy3sUEQBapWnAQIOkUAERzug4aWNEH3ihgFnIjQUm0ISKREWctJ4IpNOIuRICEFEVIMTWYoIURE+JCEoQWAeVEEIJpAB0Qx58HmQmxyRKOiSNx4q3UA0RLQnQkMyINEBbnT/oEASSYjQgQhnxBLLpYyFINZDJ1jVaAhPJNBGBka0kYBBdBjQghlmnEGADQV88BAQahh5UB6MTsUKiOoMIgMKAwggwAAo4DGFQX4ckMZjaYVRm0OpQrRqCDiwIksItQw0QAg/BCywBHhIRMca8x70wBLaGmTVt26FEA5CAv/ggQfLQlTHB2g5pAZEJeyBQL8TH9TIQBUPwIVEYcDwEA1COCSIDlyU7FDAKAcsgBISlYEwQhc8kGhBM+gwiBUn9+KRwAMULBHHDmE7UNFXUPFDCCh0dLJATIMgSERCfOHyQXq4Q0MBOshhdQgCAKVzE0NwZMfPA1XgSwi+AJMIJnyw/+2Q0hL9gIIETbzRUbVo8Zp3IlrvEpEhWMvQxg0pfXEK3nof5AEhTY2ARwJZqNQAHaswjtAjETUCOGgF3ADCPBKF8tDWB+XCSjo9eNQ6CEawEAI4l0Qk+82QCzSx7d8O5CpHGfgugAch8CLRJchoLtAIAvWLr0EcMMHRANAPJL1NAzSRQRxD7HHIIQiRkDtoBcGCzPgDsJCBCkOcEIKVfTwkRhU/4cX4HAKLYISABUYAwQ0EoT+CUOAhJOAA/AqyiU5QziF7iNin9mcT6QXPIY44gkT6N0GBDJAgwCiOL/SQg4g8sIQnDEEKCVIBDCygLtsDTdY8YAUZ2uJuvBJIBXpM8IKINESHMuBCAqbwtYTVrQJB+1UJD6KsJxAEChgIYggqwMXbSHGKU5tBaLQARS5ycYtD3AIYPfICIJjxjRC44Ro5ooUHuNGMF4CACOfYETBswQQYAAIGLsCGMhyRj0akQxg+wAYvgAGRolNLA6xEyUpa8pKYxGRAAAAh+QQFMgAgACwGAAgAQwBDAAAI/wBBCBxIsKDBgwhLzGGCsKHDhxAhunDQB06XGntORNzIsWOVKCScIEAQAYGDjihTGnQBEodLlxtIcFBJEyWFCC9zIogyp6ZPiH2c5MzpRMPPowddwEHgsiAOEjWQSh3IpIvQgwjguCgw1WCDHF++LNlYgAgJHAiLGiwDIkQarjXBHNEDAwYINmMhariKsEYJgWwtgPAhAoSbmmH0YBgIA8KaIA//QnSF8E8HEWNSLllhwiCEI0IgRoWIJslBBWbShN5Yx4vDL5EbLuNoAOWRxQg/RBxVEBUIUyBQRYLkEI0bPxyFvOjc0I7DAs67bsR90C5CtgRAgArukIfD7B3VAP9piEE3wTI2QJwBgQYEIhCkGg5HKOJPCJQAHlg3mGINHRBsqQdCB0gVtkMDKR1xUAUCpbCAegpI9ceAAWBBk3gDMTiQIyAIA9ErDgnnjXcdmOEGFgfUFMQDBXFIUGE/rWLJiW/BVRMNArkoHQizvYUUHfchVQxBwAmECwitMPDTfwSs98tDjKQ0DC66gICWTDWF0CQaBILgXU0+RCjQMN0c5AQRNO0gwmUFWfOQhwgl0YIBIUQBQjIHbXCHkihhgYYIPvhgUCkcFabAnCHUAQITEziEZUd0nKFAoAd98hAlAilwhgE2IIegQHk40ZATPXTUgA2TUmqQmw+1QIANdnz/SlAJDDWkJ58b+RmooAcRipAxtqT40AQkNCSTjRCNgQalvBZkaUMwhPEQsmaWetAJGhVUhA9/7HoQqwNdUBAbij5kFUJ6gpAtCEPEoYQVVigRA0ENWNDBrviypwAPoihjS3UgCNsQtQalM5MUMSjRhAACoIDCAAIoAchAB7RwWaAioIFGABaMUQcbGOiBkAlkRISAQYfIAkIt1OCxsAAe/CDzzBIocR4BARAWwIkHICgEGczRVEBVA6UsUCoDlWOIQTP/4EECBZURQggCD7TZfgatsJETKuciECcQNT0AFx2xMV5DJT8HQi5Ig30QIQfNPAAeHQE9bUNZvIGH2w01/9MI0zIP0AZHJRywAtYG5UXQE3rLgIIA0ag0swDzlu1Q0CBkkQAejhO0C0RwFySzBFZk0VEBdh90yl1TJNBG5ygc9cPDVuiQkuFY6zENCLY4Q0w7HkgQO0KRczSAB1bI8QRNZoMgsvO+cxT6Q7EjD4IO66oUhiQgMEjMQbz88NM4gwsCwgwz1FTAE8B8XxMhxe9YkCA6cGFFRMg4NP1BKiMhmUr0G4QVxLeR/DWEEMMDgTYEIguVDaQKNaGC+FBAQGxABBu8+IkDCAaRN/ABBAQ8igBAIC9AVIEVo+pDSobgk2yETyACaAII4iCFgpwMIWjJHkTkcEALOuQR+hBIBv9UMIQCIIuDBTlJRzLwk2Owq1wHgSBaEEKE/0XECA35QSgiIiuVkMBaHRlhFhGyO3Y8AABdPIgSETIBK0KkcgjxgEF8UZCzqU0MDckDSmaARYT8gAoCOcXuDgKaaVEABBswCJpQwhUsDmAgyBuEDqCzBofoIQcQKcEERCUQEpBgkSqZwryMkAEu2I4g5lkQEB4UkTxEpQtEMIpPjGhEbBGkAF+AgYYKUgETKCgiJXCj/ATihzWkYEH9ic4wafIBDOyyexWoAAzWAMVlpgQMuoymNqOJARxZkyYNeIEzt1mBC5hAWt+kiRYeMM5owiAQH1hNOlUChi2YAAMYAIIeoJAdxnmihA5hgAIUFgAAfyKlAQ2gpUIXytCGOpSWAQEAIfkEBQUAAAAsBgAIAEMAQwAACP8ACwgcSLCgwYMImQBYyLChw4cQI0qcKJEBhYVRiORByLGjx48c90SJwJCEEwogU6pUySBiBA4nKMqcSZOmkyguVurcSbALAhxAgwIlUbOo0aNIkyqdeIKn05Q1JhJ9+LRqwTwUiQz0k6ZIGasfZc6JEhHHt1YuQhhoYYZHAAtFwAr0A4ZMmCADZzoRiiNZMhzdFprpoODPHxEdeIwBG2bLhRQmHrBZAjLPz75/AwNAJVFBgDRVF0CuQBpGoDV4Pc5ZCHjYsoakAHiD2MFAA6da9MAgzbsChCMgoblGZcrUw1UQFbR4ygZDb94XLoBB2EBtCwDFjSp3KmRLColQClb/X/unAy1mxSjOdojGjVM6a75H3HK7jvXyCooiZ79YIFITEtlCxg4t4LfUQkl0YEFoEFVggiOlLJSfRD4Ug8qFGGbIGUM8EFBHVTk0VAEQyjjkw0Q81NTCDgcydIQJsZQIkTQzbRgROS0uVABXOaYI0TDdfJNjA0WsxQONFPlIkXEMaZZMi0W24ANhPpghE5IR0eIQDhD14JQBU054IGIinGGADX3I1JRKDWDRQRIQ/SITnA2VSUAIfjTQwEU5MnRAACIohSUABNhgRwF6CrTHBhSVsNIYaCwlzBkL0ZFQH05MVMVKLE4k50QPHDDDbRzxOdEMKmGBlDGx2FIBDF94/1TCHjgwGhESCAkiiEEh+HCiTKosZEtDGHwgxEdpSiTGpg2pkIEMMmQQxxQEuRERna840pAevaWwhqUemfqQrQAMEUcGLAzAkAADZCDFQGlQylASaKBhhhtY0EGDCc91G8ZHtJILkRIAqCvRmgUcsJAIIlgJAGgCqTERBB+AhKlDtSx0y0wovFHQASGEkAZED1ww0VfhpsNKQxsX1cZKNEyUwr8eVcFQy0YJQHCfALDRESBv7EwRIRPhweYSE8GwAsoDlQC0EiMIkKMKOsUs0czHFgA0HlEL4MFCzcj0w9hkkz2ADIDwrAcA5jzxBtdS5+gBuzIghTRFI3gwwNctsv/LhxEgAMJTHQxVMM00wxoV9kyEGCHHDVaRIawzESFT9uVjE02RFY9Ta5UQaU8Ey1LhAFCLAycg7NQUCbRRN88YcwlAskkJpIIMes/CDeymsyLLIQzhsEdVcggQNwA/UDR6RCgMgIIVCx0iy8oPoeSUDj94UDZSKBgvQxsJFOCCLAI7hKtTbRjc0O4UWd49CiPgkQAggqBaAhJ78QWUE304utMJRhDA5UKRPNE9QwDxewMgUlcQB0iEBF5yChWOZxQFzgBVB2GAGC7DFxJw4ClKGADmkME+h1zjGs4IhM8+QoEIbIAvEUCC6nQSAwpOhHILOcUDKCOrCTiBBAhAgBOrItAHBvjPKRmQAEViMQ2HmEANIDlBHojQhSgggQNzAAsglNA8dg2ABeg4BxMP1y8gWI0iBShBCZiQRTXKpQAJ4IIS8ACCG2wrIjt8I1hq8kQ9vrEBYUhBv3iDARr48Y10SNoamHbIpzRgIib4ViPB8gVBDhIIRyDVJKuyBSBckgybBAsY9MAv6KgwlHL5whqAgIFW6uEDfuCdLAFABiiwYQE5OCIqwaLJXQYEACH5BAUCAA4ALAoACwA8AD0AAAj/AB0IHEiwoMGDCAcWSMiwocOHAhFEYQKxosWHCPJc3Mix4IQCIEOKHEmypMmTIOdEQZAwyhyUMGPKLECEoZM8M3PqBMmhYY2dQGMygINQl4NRrjSFOBC06ciaBI06ULRIoKUkASykcepUgxMcUqk6QGWKoIgOAUJwDeqi1dSqqATGFfhqIJoWdJz60UKGTI6ZdjKNNWVqLkFQBDuMaQrmxQUTJvQc0XKyzBgLZ1ZNMnzQko/PHQg02CkkTAUMFypUuIDhAZiRdC6fUaCA1qtIqHLr3h0Jkl0LQJesMKG6eAUgW+wUsIwZDRoRFhEL7LBjtE4vEBCa8EJg9vOOAhUE/9i684iJgrZiOVL1iVYShpBw757fm5YCLEFfpNCjJ72jgtAl5ANEZywWFBsQqIcQJQ+RwlAmB1inEx02gEeQbwctgstRLkxoA2YK/OIQIg9NMpCGAumCgxMazBQCiN89xGBCaBCEi1QFETGTCGi8RxAlqgQp5JDsHaRABz60sEMOoySEABwMLMQRiQ1R6cCRSbRgQBENjFZDQxpY6NCMImgZQh0jaYAADmy22SYJUHUEJJFEftICAWeapNKabrb5pAvgIcIIQ7YIBNMEETQkpZgDORJLBXrAQIZDefDZJ5twWjhnKQJVQBAQNMS0Z0J3RBmSFDEo0VCAAYgSy0DGVf8AwwpLwHTCBGAWAEiqIwiQEI9oZDVGCWykEKtxQKgRU6U4IJQoHr06JGwZIJVm7LGqmRAqTHN0wRJBuQjEiUAePBShhAUcsAIMCT1Q66EkyELQuIwKxEZDyqJUwh7f0mtQI+CFkQJDNJRwUhYJ4OGQBz9wVEIZayR0wQNBkIQwHjKgMEC9DN2bkAn5FvBEAm1kPAAKAu3iEMAdCYxtBadIQoMgJGfM8Q8oPwTxwAT54kAFwDiAySwn16uxBzLIIZMQH2AAqc8OBG2Ryg0ZIgAKMrSRwBQ5FXLKz1IbxPAPZJdtdsMNjaD1EzudcMAqDD2yci+31G133eOm4kBTOlT/8lAoHKUSrgM/AZUACxJc4hDgD93igOCssCIQnEA9YYWvDslNyNlkeyCAACMIVIsshxziJgkTGKxTDAL8wAtHngvQRAZxSLEHK6ZfehNQXGws0CWPBC/88I/A4gAvng/AQgYqDCESERFcGoGOOwnSxgBkv+5QMMpnAILzJLnQQwROIIAACST00CFQckhg0Sad3GArBz1EEUUPHDDB9w/l/k688A5IhCOOoJM5vGQtbZBA/w6SiJ4BAF1rkckT2qAxzA0EGHooCBAWEEGgzIBkRnCAJ4BxAQf44lgmeEEHudKALVwLW3r4ywqbAgWGYMALHAMPGFLzshTOsCktZMgKH5TzQ6DUECE8y2FHwOCphBQxKHV4gRKnKJAvUBEhAQEAIfkEBQIAAQAsCgALADwAPQAACP8AAwgcSLCgwYMIB55IyLChw4cCnURxAbGixYckNFzcyLFgjQIgQ4ocSbKkyZMgmXRxkhAOA5QwY8o8MYFhRpk4c47Mg4AhEZ1Acc6JghBHADgugipFOYEEjqdPkyXDgQueBiZLs+5EEHVqt2HLUJEKYKCM1rMqA+D4uszUQFQBvLVI0+BsVmhgTek1uIpWi7p2c9YJYaAFqL0M0YwJHNMP4RZJOtBKUowUqsuYL4/11oEA4wM5ctARObiwiA4KLPa1YBcAmxV69KzxQqdI4cgKfOjWzUMgXIa0DJwF8wDDBT0VAhj79EpB6oQ8KmeejsqbJq1L1qSoYKLgJzO7w+//7u3w3VkvgRJKe/j74LAeSxuE2PGp40BLCIcJvPMyp/zCPnTASEPkNeSWQPoJNBUJHOBkWwsB5lagesAR1M1BJMAnE24FWaPKhyCGqIowZvAg3mkinGGAJn0ktMEdVdj3i0M+DITiGQSEUEcDDVDQEAf2PbReAArgaIMfI+2BwwZQNYmDEz0s1JGHIooojJGjlVRCH044CdWLMXb0SykMPVAGYCdRQEJDMwRpkDEB2ILcFzEpyaSXTyIRJJWqCGQLQRh8gOZJXCYkRhUiDaFCBg0lIdArjigzEHIVVJrCGnQ45MCPBQwRRwZNMJQEGmiY4cYYdNBgQqWstgpDGHUu/4lQLQEo0cQAD7mBxQEF1KXGqq22CsQHMhVKEK0B3CKQIQ+lQdISD1wQLKuX0lECTJsWpKybA9HA0KsOVZGLQNsaRIh9ZAA7bQUYsIESIG8o4VAz527UwBIrJFQtSfAqMYIAAnDbkLf6wgoSvHj8K4AHAjXj0A8dNZDuuhXo4Y45T7yRMMDmchTwQ/jCUNA009jiDDEycCywAAMQQgUIONEARKXTCOSMRY043BAKA3hAxRU66JRuyTcfhMwPSCet9A/1JtSLFYPocAJQJRywQtEHwfJQNAzhc9Y9DiHDC0eHsJLHtUtJsUnYDRnSyy2cCISDLKxEUAPaS6kgQUOwYMfDy9JIoyAACiPgkU8u6bBCAgkITDCHVnW0AY59hb+RxQwFVEFBDz1MsAfeWeEBDjcNZXO0QAKMoMQbgMyAuZagLyUHONg49IwATSgRgxSMyXQDC7M4dMzuU/eO0xWjI0RMAMq4azxQcvBxkDK+CLTCEs/rNMMN9xCzvDI1F0RG9tqHIQk7JE8LBA2Dko9SCWWsoe/17uf0AQQUc6eGwEGGkQJDNKgfTuggP4TsS4AwacAH+MdAg3zhfw2MYAG2EMEKgqGCCAkIACH5BAUCAA4ALAoACwA8ADsAAAj/AB0IHEiwoMGDCAcWSMiwocOHBOdAnEjxoZM8Jypq3DjQCcePCKMgSBhlTgmQKAsQYTgSpUsNJBjWcImSAZyECKLQREnE40BdQHXh8Lhw50YNHnUJVOQAV7VkJGoUKGqUootWDhQtcoCq67JhG0a5mEq1qkM7mbgKRCXQlKllTjSQNduwzBgLZ1ZNQmhqWI0SU+ketItXgQIHryLxRYVrbFmQZMsSPoMGjQiIphbJfbwx8ty7ASpfJuhDICmEkxZJ5VzRsx0bBAIosMwQUiS2BjO3YsB6Ilk6NixAktaBB4/SCZEffIuDhAaUdmN/KiWQkTBExx2eJmgKVTddJFZq/2wAHO8faYwMMvrlENLBbslwIIDjgmL5M7P/+BCFUFSSh3sJtMhTOODgQFwZORRCYbT5YIY1DFHC0GEC4pLMQeI5dNloAjkoDEOfOKCcQIfx0MIOAIzigFIGzccARz7wECJDiAw0mw8nFkHWTAn59NGHEf4hYgsG6FhQHk4YeFB4ve1EZAislTCHSAi5+FGNCTmixwEzNDSBQ01u5IgDFTiQAhkO5YGAkgf1QBN1ZBIEBA1hOjBlSwfd8eJAUsSAR0OXJRGAMrGUGedAMKywREMlfIkQm4D4OYIDAyB0mQJnWGBDAWwwZAIZQjSkJpsFkaAOHiOgMAAKDGU6Bh0OLP+EZkIY0MAoE13gKVAuAnFCURkGHbACDAjB8MASdU7gBCsE+bpTpwkBMStDe2zQK0KNfBRGCtHS0EBCTyTwp0PZalQAsAldcKxBUyTQhgweCFYQG0AkZIIaA4X7rgerCrQLudpye1AFktCZABfwVlrQDw1F0wjDBLH6ELoEVeALmcAk0g4vCm8UDSEQs+qBDHJAxAYGAlnsCzAUEfJvQs0QIhAKMrSRwBQThQFDBRVMo8xBhjRU7kHRrCoDHglkoVEZa6QwDTDXGPSIQ4Q00otBvYyAxxuAgPQBBL4Qk1AoEB/0Q9W7XN3LOhlwPUNgHDUQxiksj83QDx4IIEATSsS4IAVgc31UAB1rOJPQ1DIbFO/efUshyNuRQVZAA+YkotEATWQQxxALeQa35IUYfvdAA7CQgQqc9/a54AXYsULUCD0SjAMsGAHCDTN0KS9BZFXO0Cad3FCnYFMVMo3lBUXtyBG7P9T6GuzEkojYDtTtwAM5NN/QVB8A4Ysv0xy0gPbbg3EBz4YSZMILw+9egO4IVaBH9uQ3ZAKtXtSfUAnmM/SC/gmpwxbud5BE2QGACIECAjfSv/oFBAAh+QQFAgAAACwKAAsAOwA7AAAI/wABCBxIsKDBgwgHnkjIsKHDhwNdQJxI8aGGAhUzahRIYqPHjHAkfhxZg6GTkSgBIGBIJKVHF1EYwnHpsUbHgThy4hhYgqZHHLp06czppKXPinNGAcChSJGuZDoRwGFwdGKJOtAALEO1bNmioDlvVm3oJwSBFqAGmlo7rJpQEkbHGixroEUSNAKLEWQLVSpVuQLpthDRAW9DXEJPMhkrOEkHBRBNLYIK92idEAbO/HnMkFkxUnu/4thwx+XluiIAKPChUTJUgRw+nh782Idt2w9RqV3mlGiPjAUaYLZb2wcPM2Z43G7ITC2AyTkBkP77UDhqzraRI5ImTURy3BCh7//kyAFjwyJ1N0MGcNvML2GlSgFgJAyRGdYIaQ0cJjD6QCe/OZSEagVlJw0jBjHyS0KpGRBCFwmRBkBPGRmHCIIHiaKcQIRBRkAIdjQAwAQMiVWhGdY0xINqZxBgQx0GbZAQgBv5YMYnDrnox0EFMAEhQhJqZJwoCRnzQBrmfUQhTbYAAEMYDc2wh4wImfiRMQA0SRAbDvl4EkJiVEHQECpkwNCACrwiijJaHlSGQxQ8NEQcGTQBgAAHDYhGAG6M4QcNAOiBUApQNrQHQ7VQo0QTAgjgQUJ8YnGAQDAyBASXDvXx5UC1CHTLRGkYtMQDFyS0wgFLIkQBCbKMBWhCKTj/hFEunh5FhgkMsVHpQYC8oURDvRDyg0ZLMATDqQYBEgMeI6DgUDSNDKvRqwmRMVCvzDo7UDMM7SKsRgXcitApALAhyBvZ4lkQIdEgBO0P0mY0qUEV+AKAM8QAMAsAjx4Eb7sF9QIvvAX9YMVDMwAAxEAVVDCNMxMN3EwvFPeySyPCEsyvFVzoIAhEZMQKQMO+AFMQMg3BSwjGPzQS7Q/aAsAFAB9TdMAKMDRc7zUEweLQwECjMAAKMrSRwBMesYEBySYbhDJDA3sw9AhGZzGSEACk0PA0iRz0NENT4/FGFoIkjNLNOT+MEC8MjQDAG4AUkGRKBbABRL0QQyTACErEmQAIYACEobUeFfBsUCgDCdCEEnFIAbhAJdDhpMN5F/TMAE1kEMcQcj++5d2UGz7QMQAM4TlCgjeshy+xOJNIvgBQe7pBb2qtui++TAOAvUHMfhDWS+vcMEFq+H6Q4AkBcYTxBkme0AUP9M58QRgkr4aI0wNQQBgwMLR89oGt0T1Ca7wJfgEfJIQr+AN9MT5CDcgt//z0119/QAAh+QQFAgAAACwKAAsAPgA8AAAI/wABCBxIsKDBgwgHFkjIsKHDhwW7MIFIsSJFBHksatx4cALHjwjnNIzCZCHIkwBKEGGIEaVLDk4YenR5kgEchlFE0gS5MiFGkzs1niCIA0fBCDODbnRxE0DRogRzllCq0U48eDiSPYUKwElGqhDp2BhIatmiarq2CqwBFOxBsQTOKOgAwFskU6aWoX0qMKdbg3DlohFx0NSwtHwB5Bn6N7ACAIQb4kJsFEANt3ABPI6MEFIkVABMLaIMAEEUF0EdQ7YoWitXBBpcquZMkVTo0YlJXP44W6CP3z4ges67t3Lp0xp7+wbOnOIi1wWdxKYYIu7mgsyzB0/4GMBzrgR1V/8kTHtgdh5mzPAAjjD4DlejEBgniACOi7YbmaNHJE3ar/TbaQZAcAYUUUAJJeyGkHQoAWcGIsIwIlApn/z3WBItGBACfhogkJBujH30mxm/SFhQKdIAoGEdIUXhk30n/caDKAmV4VANMS04nYhmUHJQBQCkQIZDeXiYUE88CiOQIwAASRANDs0RhZEG1ccAR4Sh0YI1AFxwUAoALNHQCUkhtCMALAzQEGcWpAQFBk4aBIQa+BmUR44IqSOQmg4lAYAFY9iYUhhgJgRlQ1JSaVA0AnhA0QGArVHoQQ8sUWdBE+Ap0C0DRdPIDyAJ8QEGCZmgBpEMeUAIqCAVMulBNAj/kZAUAq2DkKc/sMqbpAhd8EAQBU31hhIACDCAAL0sumquKI2a0JwHCdAoAD8QQsguvWTbSzOf5qorR0J8AQNCFWBwqEDGGpSrtdU20i2z0VZkB68FAckOMJgI4JC3/H47kL6EUAECADM8VICzBFVQgS/KVNSvtwZRcQXBBVP0hZcDKVzBNMQI5Oi+zMLrsRWD6DBFxRUVUAe9TVagRywCPfKRB1YAoIMgzQIhkMa+AENQKBChIJAMAglSwAwoc1TAxTsr3PPPDaGgLwBtJPBEAZd+5AevGuthC0GXIHOQ0ELjkYBASe9UwpstK8zxQ3i8kQXSfwkEhpdAOm3LNQLBioIMLwONAEAMgNBdt0AFCLEFmBovrEzHsAQDDgBKxEDr4Qix3bbLPTtzzhuYO3R3012f4o48oTvUwBYmZNy4lzmkzlABUDCEwQKyMwRGBRgbZMILuSdUAOsJ6RF78AfVnhAGXmQtuxBa8J4Q8MgbNHzrCK1gR/UGKf8l9wdpoUfv1oNPUAMvkJp6QAAh+QQFAgAUACwKAAsAPgA8AAAI/wApCBxIsKDBgwgHlkjIsKHDhwWjzIFIsSJFJxosatx4sAbHjwiZNITjAqTJgQUcZjx5cmVCjyxBnijJkGRMkzARYrz5cSFDEjl5ckSQ0KZQiwVK1CBBAQdCl0cdNqDToIAGJziyOi1IJGrDOhQMtDjTgoCWUQi0bh1o1CtBPyEotBDRAY0IBR0oZCKh1qAGn17rxG2RhIICg7QoLErWd6CTrlEFG6DwB42CPwl/LVO7ViAcBjzhyhVh2CEPgd10aS3IlKVkCkksY67YbcNqroA1NgghljTHPyJwfbtN8LNGyXNLf0RDbwLWzgQ5WBRb+LBJBT405UmbEDLE6g59iP/30TCAjQZzoiTccAf0zfHwyRf0nabqiQk/pceMH580aQIUNFBQHk4k5EQPKZ0UHw9mmOGDZWcQYIMfB+V2EHvumTQeg79II80rBoRAh0MTtHYQCRwk+NGGv3zCiEAPsLGEigjReJATQXFEFw+/iKJMCgJdAMEKWjzURYEn1mAjBUpQpEAAFoyxBpAFYbCFHQ0tSRAJDqioRBMUDFDRAQWQYUJCZDy0wQYGsUJBHjEIJICYDZHmBgUHCFRAAWxg8NGeNURw0D4jCKBbQQUccSZCKzw0h0duCsRJLxII0MgPJvHZUJpZAtIPBZP2Uk4jl/6AqUmcMqSlQIBQgMcIhsT/Gmuppp5UwgErwIBQCissgahAeAzkAamkmmrsTWwAAdETA6FAJwXGRlvrTWFQmdCeOlBBgQAeHFTrsQ2hMGauCMHwwAFDyPAsSOJ6IIMcFKxqULIHVVCBCfzgIQFLKMjARQKCyHtQtfVW4A4oI8zCUbf9tpHAEwInVAa5BNlbwQPAfITCCHgkkMUMJrFhkMW+ZIwMRN1SwPEbWVBrrUAWnwIBBQoz1K2hSrzRqlBljGzxNMQ8w8tBNzehRJzxRuXHBz5XcIoym4BzkNFxSLGnWwIRXLHFkoAyjwcDiNlEBioMcTXWA9GxRtMXB6EDCHLEMQTaCTHdNBALnE03QjMUR6KrzyYcsbdDar9sEAACDl43Q8oqztAXMFTg+EZ2TJnQA5PX3fhBeGduUAGQS8654J4XVIflpVNkd+oQgRE56w8VsMXmdAcEACH5BAUCABQALAoACwA7ADwAAAj/ACkIHEiwoMGDCAcWSMiwocOHArswgUixokMEeSxq3DgwwgSOIAvOaRhlZMiTDjOiBMmh4YQTKzcWYEDSZEyNRBhiLHHTIsyeQB9GobAwqEOeORMiMOqwgFOBJBjWYHrQzwE6TguUcAGH4VCqAunYoHAmwBk3NrJObVgUqFiyaCiImItGgQGtGpzgQEhi7U2xBCgo6CDCR8E/HbAU4Lo0oYuVb88okMtQxBk/J2qQ2HvQyUnAggkbfhiiQF7OB/1WBCx5o4i0jBk+hsh6sgiOPIo41cxQA0QCrW+D7OAma96Enh/eFh4SjZnSTmcjRADHxU+wAs9AX1hAtUEnvqlO/za84wCFBgQ1ND5IwgHPmD7iD/bRwoDug235OsgPUn6HJC0IxF9qyOVxHUgidKBAfSHU8dRDTmzwnUQDWmSZASHY0UBWDzLUXQQSDhRhHiVUmEFDHZBFgA1+NLBhCWUcIERWTX1Ewo0kRJEHjQOdKIAACCl4xop0EOVUA2S8sMIKW0BxwHseFlCFAzVMoIELJZQ4BAUnUgBkQmdYYEORChVgBw0YmAADDCZAsEYOD3GYZQlSxKFEExSVMaBTHwRiEAZbkBmlU1LEcOePHvwQUgFa6HHBQUCoAZGhTSD6g6InFbAABgxBiZASXgqQ6KUr8cnpQRc8EIRBT1AAqpcUXP9Kak9QUOTUDVT8iB1RFMCQkAlHCFgAIFYMsOtAdKyRAkKPBpGVHBKs9IMVDzXwwamQquFUCbmG5AG1OlD0ha8IAesUICN4YBEKA3FBgSAW2aEssw8AUMATI7BbkQxtUPBEhQ9di1AFQCzgVAZfQpTAux1qNO7AQBxRwAkxGIvQAOziQUEWN9nBUKr2FoCHBPoSNAIFbxgFsEAVmGCwU3LkSwEKJ8cACFhfPFruETOem0AMb0jhKVMr90pByDweKxAUECTEKXpKF9QAGDoj9ELUB9VhNEJ65FA0drVibREYFYhdUQFbJFSBHmYXBAW2f3rR9kBk/3r13ESljbdDYe8NzZAWFVTtt0FC3I1dQAAh+QQFAgA3ACwKAAsAOwA8AAAI/wBvCBxIsKDBgwgHlkjIsKHDhwKjzIFIsaJDJxosatw4kESNAiBDihxJsqTJkwWYNITjAqXLly9P1GCIEabNmyI1kGA4k6NPhS5WtsRJ9GVPhDWLKjX5s2nFDQlZllhKVeTRgzudNnXCkMjUqlVdRGEIhwFYmDNIam1ax4aBFi3cGDgw8kSehkTOjvQTgkALER0UKEDT4YwNkREbmj3L18AZwAoMogmQZqRDDlUbn0kSmGEHAg1E3u2qlK9fERQVnKETMjHCDXcWwzT9F42CPxSTBDgQOuQEhyodvk1ie6OI1SJL5EGQkMQEmJzR/PzcO+TE5s8LrE2ogDLJE78Rkv/QoH07wjMhTO5BALWgE6nlzUMWSLfk1AkR2gt0klR+h+MG2OBHdSdRIEYEJCQIhwYntLbWGQQISOBLVThQwwQcMPBVfBzZBqENrFVVwoYgHRSHEg1Jd4MFIOqlVkExoMgQGpNZMEZBLpIkRYwPBWBjGTmetKMSI1BUn0sNHLBEHUoBEgMeRa4Vkh8LbLHCCltAASRMUrwBpQADoLAdSAccAYEJMMBgAgRbAIDSFF4KFKZ5AoFEAwQV5KknBC9MGNIQGYBJJ45fwJAQGX4+QYUEgxrUABR46ikpEDSUJAejjeLIBgaSSgrDCktMSIUAP3kgg1YpDBQSICOIqREKMrTXkcAUNoVhQqeT0kAiqx5A1KtAeCSQBU4llLGCoQktIdIJRpDK0K8j4PEGIFSxAQRDaoykwgAJCeDstGeFkQKueppQp0hKSPCrQN6OoEQMUjSol7EwkFsBDA8oK9ITXLDgrQBNvCtFkCGxwRAQ2ZI0RAwgxDAEwSOFUa+9QBwB8U3FMnTBA0FcfNMHB6shhMcwicuQxSS/RMcaqSL0gJspo9QAyJlq9UXLCB0xcswnrZwQvjDzbBLNCS0g9EmFnny0SX6sgWzNPxENtU+FVjC1TwVscfUNAQEAIfkEBQIADgAsCQALADoAPAAACP8AHQgcSLCgwYMICRZIyLChw4cOupSASLFiww17JlrcyDEChQIgQ4ocSbKkyZNzGDrpwuSky5cwQZYgwhBHnpg4c4bk4IQhhRk6g75koJKl0KMmaSZEcBOpU5AnHE54SpUBHAQJu8yh+lQpQqYcwx4kwXAqV6RWGUZpedZlWLBiGZZp4LKEhoZm29KxIfBMCwJp6II0CEft1qcN9hI4g0agCAUdzIwxGZUhU6eKGXcQ4aOzZwU8ipi8y5CD0MwKHHawILJgYYQkTONEvdmz7ds+RJwpY7LG0j0nXjYIsRgyZ9zIO4sIcGA0CRzQo+Mg0afEwoYiaiffnvsMnZNEImz/kO7E5uC4DTsQOFliTg0EJOKTiNL0OnqEHc40f7mHQo0aHMxhXUj3GYRGBy2IFlMJA7ZW4ECQ+dDCDt899WCELRigIFX3QfZHhiG05ZAKGTDUgQIg1vFgQ3GUmNBmZxgQgh0NrJhQHA4lcQYBNvjRgGBtjVSZA00IMIBDdgR5khQOKGGjQE9N8YaTDgjggY1PSZHBAANc+aQDIy2xRJIxZSDBlwOF1AAZLzzwwBofBPHSGwKgCSVIfrABgQkwwJACBCuAcdIJeBxpJ5gFQBHIBRU02qgJaxzQ4EhG1GlnAQ0A8AAMjnYKgUEhnZCBpRVxoZMaGHTaqQlHnDSIoQ+1t5HAE0FBgQFDAJh0AwsoHNTrQAlkAZRQC9ya0AInqeABqQ7A6kAWBcwwrFBgqKoqEAeJ9AYVfKDw6xuABLlFCtY2esEDObgkiA5vJIAmFA0hq6ROWlTAaLkmvDBvUFuYkJAe6e6LExTYHntoQ0JooccFCekrME5bMATwwzDV4UVDXlAMk8IMI+SwxifV8YIJ5TaqhxYgu+TFpwllnLJJHDf88kkjHyxWA14UbDNHOeixs1gvGGtnQAAh+QQFAgASACwKAAwAPAA7AAAI/wAlCBxIsKDBgwgFRpmTsKHDhxAHOslzIqLFixAnFNjIsaPHjyBDitzIpCGChSVGqlzJ0iECDSxjyvSogUTDGgUw6tw58KQLnkAPOknoBObMoytLPMSJtKnInw3hQA1K1WHRqlWHJqyR0qlXjiWmIpSKtaxQo1/TPnSQdmbDDQhJOOjatkERA25auNlRJmnDonXvtvCBRoHhDmdCrMxj06CThV+L7BjcQYGPy5jRBEgzsgSTGhHg9nzpVDJlNJhTY+5AoIHKORMQkJhNAo4GujHTGKBsWbVvHyLO0FFZosQeCkRqcGCAOybh3r9/J9ncNqaI6Nh9TO/r1GzCDha+ev8/qMBMEaTjEYroEMDGxvRA1ys4QyANfJ4iCp+xYIPO/Z1ooLHfGP79VxALAzQUYAAWjMFddSINEUcGEInA4BgHQChSCVLEMZAAER3QgGsafgSIQE0IkKCBF210gxUrsojRRlNQESOLTcVx431fKQGigV/NYIQAPxRp5JFIFvmjRR0JsUQQw8WUAZFJVqkiH1SAgJQfC2zxwANrfLDESjPIsSNCP1Ahhw5NlXEEBCZccEEKEKyhxUpDjEAlkigM8IMVV+gwg1dsBFLBoYgCsUaUI72BoAeQCuSBFVzoIEhaWsiJ6KYYqCHESjooMQIfLMjARQInQOgFBptuaoJDHQl2IsUNNzxRYgEfYNAQADKdUJGMBHV6K1JfwFBBQkd8OqxMdqyRQquIwvAAr8vKlCus1cZU7LHA7uTHGjAk9EC3CeHaEAYLZBsTGBdwS+5FMzjbUA7qsgRFQ0C8e1AD7LqrL0QNbJHCvxdBoSvBEbGLsEVb5CtjQAAh+QQFAgABACwKAAwAPAA7AAAI/wADCBxIsKDBgwgDkEBSIKHDhxAjCtyAY09DiRgzPiThoIDHjyBDihxJsqTHOQ6d9DHJsqXLAiUcbhBj8aXNmwU4OHHo4ITGn0AHqrwYtGhBEjiSKk1KsSbOpyWZQKQAtSpJBin7xDTKFWLFrl2RLl3qRIPVsyCxJiRhFizXCGOZVkRLt4QGsWMX0t3LBAlcsjQ/ug1QByqDHk5IKCYRJc9ej3RsEGhxxs0OOjhP5JlApAYHF3sjEziDRqAINB1apHlaokRoyaQ7iPBBu3ZqzI9thhitQHbt37Z35LYpwjfw4z7QuBn+Mgny5wpagBw8WLlg6m47YLmOnWsHN7i7c/9VgKbFAY/ig/b20QKLH6LpMa5vYaAI/PgBlDQRkLD3H/r2MTeSFDEoIdAADv1nQAiFCSjSGz816GBIU+CBIH5AfdSGBBhm6NENfHjQ4U8eCQLChSNmpCGKKUYE0iAD/CDjjDTSiEJRZ70hQI08ojCABzLIMaFJU1DBYkEoyNBGAlMMyZIOI0jgwQ8eeDBAkngkkMVeDSwBQBlQ3aDflCPg8QYguanxwgMPrMCGFlANoYMOaA7HBgYmXHBBChA8EMZTM8wgIBQQGGTCA0s04KRLSzwAA0ILLOoSGSYk9IKkLDWwABAIXaBHDpiaRAanDgkR6kgN5KDHBS2S+EIKCek60epBmpJ6EBBenEoSAI7OquILlSYEp64iLRDsQRh40YCvBPHKKrMuHnEstKWqYSu1DjmLLURHFNphQAAh+QQFAgAAACwJAAsAPAA8AAAI/wABCBxIsKDBgwgJlkjIsKHDhwKdRJkDsaJFhzic5DlxsaNHgjU+ijTIhCGCKC5GqgRQgCEOBBpWqtRAgmGNljJzFtwAJ6XOj04Qvtz48yJOhg6KdvSJkASHo0ofngh5cAOAPVCjOszjxGrBCD0KZNXKsMCECAgIRoBTRSzZigUc3CFBFwGStm7fOhRbgIEGBw72nOCrFyLfEiX4Ev6Z16hixTofL4YrWWaDIgbcuCFgowFkx5Yxt/CBRoGCDmjcHPhceGAB0T4AKDDYwY3nxq0Fkp6dsAOWybkBiHCYGnhwhwpaGD/OsPZy5gg7GHgOvSCaM2VwVzc4/EwR7dsFiv8ofYbAgeAZWAxIOP66BRt0CmcBkAHAAAEMRZyxMCZ+4QJSGLEeROe1xpcSEoRX1gk6eKBgQnzJMeCDBSnWxoQUEsTXFRhmKJBYMySAgocV8mVEggbh94MV1Sl2gxUSoOCBgwB4YMUgOizUIl9SDCJDE01YwYUOU8jEmkWPPTHEEFOcwNFKko310JFGRillQ+BBaSV1wSkGBhtbbHGEGnRceRxfUFyAQQopAAHBFkE8KFYDC0BwQUEYbOFfeAUs8QAMB2GghoIFCEEGEAgBcQSFUGCQ0ANyeuFoQgs8+MUFFZBoUB1rpMBQDg9+gGiilfJ5aaaaElTHFgytQYeOLX4RMKlBJmQIBqYJNUDhFqO+FRAAIfkEBQUAAQAsCQALAD0APAAACP8AAwgcSLCgwYMICRZIyLChw4cE+yyESLGiww049ky0yLHjQAoFQoocSbKkyZMoRc5h6ERiypcwYxYo0RBHFZk4c4rk4ASHz58/neQ54bGoRaEbjSoNQALoTwR3GOicGpNmBKc+SdSgyvVliR4RMP6M0MXFjK5oTc6ZIIaE2w1EpKadW7IKBwocNNLda7IE37+AAwseTLiw4cOIE4ukY4NAixYWbDRQ/LJBCAJnFAgUgUaBBTojlxoV0UGEj9OoO1gILdpjEtSwTycJIbK17YEdDNS+bRvN6pC8beeenDT4aBu7jRtVnVx5wThKHKJRDVrxGyVNBDBU0IFHizFCKA/PQjGA4esWO4pQDgligAeHRRrIX59FBgrnRUXOSHAff/6QcWjnn0civSHggByJNAQL7yFY0UiCtCGBgwmGBIgREqDggQfkeSDDFeullMUVMvDBhwxtJPBEiDBlcUMAK7IY01ky1mjjjTjmqKNJDdSxY0lafLDFGi9AcYBfOy6gBwQmpGACBGuAsSMZKcBQkAkrLJHjDGuYcBAEXuQIxgUUdlSAGl4mpAWOVCaEQZg35vAAmWVaVMALDK1gB44LAIFQCnUmBMADViKk4xEQIBgQACH5BAUUAAAALAkADAA9ADsAAAj/AAEIHEiwoMGDCAd2YZKwocOHEAfiQADgRMSLGCE64ZCxo0eDGj6KzLhBTJUCKFOqXMmypcuXKjWQwEGzJo4IRErA3MmzZ8oTNSJssEkCzkmfSJOuZDJBDImnCJAcVUpVaRUOFBzkOVG1q9evYMOKHUu2rNmzaNOqXcu2rdu3cOPKXVnEgAULBoqsHMm3oA80gDv4MKCyr2GDIjoQTnm4scAkPvSidOxYMWPKh9FYKIy5LxoClzvzRTNmLsopcTI47ODGNEolEhombnHA9ZXYCEWIOGOgjGspTVA0DEHHNco3wkWPVBlHgHK+Kd84fy4S5Qngyal3VDkIt/aMKqfgdBkgwIOH7xdVnohjZMQIK3KM8wQkRZD8+/jz69/Pv7///wAGWJUQdgQIBg1brPGCF7XxB0UFGKSQggkQrJGDEPkJoQYQF1TgoYdArNHgfQeskMKHKEKAnkMNhGHCih8tgAGMHqlBo0daVHDBjRgJ8QIQ3wUEACH5BAUFAAEALAcACABCAEMAAAj/AAsIHEiwoMGDCBMqXMiwocOHECNKnEix4kAmLpiUsMjRYQkGE7rAiUIkT8eTCfPcieAEAQISCBygnDmwyh0nOHLm3EBCA82ZNSLoHOqkz8afFkvMiYJgqNMqSDkyuLPBqU4neU5EpVjCBZymVnFg3WoRCU6rCO4wIFuRg1CrJGqwrViiR4SqOiN0cTFjLsU5E8SQGLyByFq/FqtwoMBhD+KZRx9Lnky5suXLmDNrLtBgDIEWLSzYaLBZoYUOHRSIQKPAAp3SBw108EG7dgcLsAumMSOitu8kIXIPHDPbt20DwgXuQGO8NhrcybEwb+6jgwHSwov4SEJdhI3kAk83/78NXuABN6mTJEFz+7XkBG0yGGmTYCEdAy3MmGkxRsjkQSgMIIAAA6CAxxQL+bHEAZWBMIAHP0QYoQR4lJeFDChIKKEHHtQn3AwJZKihhANwAV4cAowooQBKgPdGiir+MECFyQ3BAoQqDgCCIMkJ0oYEKgrQxBDlAWKEBChw6MEATbzRl4VXyMAHH03gcUN5BWVxgw5SYOnll2CGKeaYEdVRx5iF0LDFGkeoYYeXDXyQAgYppGACBC8sgSUUgVxQwZ9/4lleDnr4CSigQIQB3gIYHHooBmwkJ8QHjTr6pwkvgAcFBJZemqlwDZBhQqcVQPABeGWskIKlF1wARnlq1CN5KAwQQOElGStgoCsGD3jhH5YNLKHGB2wsAACZyCarLGUBAQAh+QQFAgAAACwKAAsAPQA8AAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpxI8SATFy4qamzogkIXOHB6aNhI0uCeKBGcIEBAwkmNEyVLuojiBIdNmxsiOIAZs+IJBxFuCkUAJ2PPikhqCr3pJA+ToxNPREGw9CYJB1Ap9lFalQSHrBNrkKiKYwOOPWAl5kFgdmmEHmknTohA9WYEOFXiTnRwh4RfBEjy6p3IQIMDB3t4Dp5YosTix5AjC5yRxoAbNwRsNJDcEAuPDgoUdEDj5gDnhA1siBDho3XrDm42nz7YQoHr2x2wzC5Imcft26R3F7SR5LdrBS2EEwxh3DVs5QPpnGFtvIMB6JN3dDCO5kwZ7AL9WP8A3VpEhzNFwA+cseOM7zMETKsn6CdNke+Ds6jIYIUKHh2CzFeAFEZIIAAKKAzgwSACKiHBDxBC6MEAcoB3gg4eRKghCk0MAZ4cA2iooQAxKCZcGyGKCCGF4F2RoooDgIDdDAmgoKKEOqhXoIoSGDHfDVZIgIIHHiRIxQ0CSjGIDE00YQUITwg40BNDDDGFlFhmqR4YbGyxxRFq0CElFBdgkEIKQECwRRDqNbAABBdUIKecGGxhB3hLPADDnHwCoQZ2QpABBJ990gAeFBgQOmcKa4DnRaKKVpDCFuB9kUKkFWBgKHZ1rGGCoheYEIZ6YcDw6ZwXBPJBHfORsQIGsCYWCoUfUh6gxgdseKFFA7IJyKuWwCoXEAAh+QQFAgAZACwMAA4AOAA3AAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSpy4kIkLFxQzJizBYEKUO3B6aNBIcmAeOBEQbEBAwsmEkhk5wnGCo2bNDRE4wKQ4IYLNn06iMCmxEyKTLjR/2kSwpyhEF3AQKLVJQgMTpw7nRJE6FYeTkVgdEiHRdYOYKmEdaiA7NUKNtA9rpLSJMwoDoiQb1JlYgsIdEoA3EGFQ0oaFFmfc7KAjkYEGBxya4s1oAE0HBSIst0gD1yEWNH98iBbdoQXjzgrrtFAwunWHHagVFgndejQaN7ET2hBRe7SCFrkRzu4t+nbwg37OsO7dAcvxg1g6MHdz+nlBAmjQiMiMpsUB6wjHuP8JEKAFFj/gFdIpMyO9+/cOE7RRokTODfgDp+ARMEAA/yYqnIBfGxL8YKCBKAgQB3w38OHBgQeiMIIU7gkCwgAQQihADO+1gWGGBg4gx3uDfAjiACC894YAICKYgCDuTUGFiQcOYAWM7+kwggQPeuCBBCPoICCDSjRhYBNtDFHSFzRssQUNZFA0hA46KNleRnZ8kAIQKaSAgQk0lCHRDIIMSdIHgVxQwZprBkIDfFpUoCaba14AAxjvQYEBnXRiAIUQ7tEABJ9sAnHEe2wMSmgFhronhBqKEgoBFO8F8QAMhMKghxbweYEBpmzCAIEX+BWwwAMYAAEEBg940UADpQYQ4QUbbHgBQKm45qrrrgsFBAAh+QQFAgAAACwQABEAMQAwAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjSjTIhIGLExMzEnRBocsdOH04YNQYsUSVKBGcIEDgJAKROSQhzulCAofNmxEmjIy5kAmHCDeDIhDDgGfDHjWD3iTBwSjDPk6U3nRCwelCJFGl4iDhIGIIAm5aWBjjpyEFoFoR5IG4Q0EHNArQdHBzoMHCPTg2SCWBBOIYNEl8CPaRZG4dhg5IIAhKAs6ehw1aoBlMuQOWhhyikNiMAEkVyEUoi0bjxqGLPA447Nnp0IYI0YMVtHhYQmOIwLB9kLaqkM4ZBbk77OCdsMGODrA7tKBDvLiFDgr+/HHbIk1zhQ2wtDDDo4UB5tcX1v9Jk8ZO+PPo06tf3xCQCiVUMsgZwn7gDSsSBKAQMKDJm/pTUDHADwQSiMIPCbAXx4AFFigAFewpIUCDBXrAxw2CpDeDERNSaGCCEQmxRBDgNZRBhx56AKJDfiywxQMPrPHBEgzNIAeDFKIwghQPlXEEBCZccEEKEKyhBUNDjIBigRK0McVDbARSwZRUArFGiQm9wcIAHnTJXwaAPKSFkFSWCYQaDemgxAh8sGCFCqwx5AUGZZpJg0OCSHHDDU9G9AGddU5pwhYQnRCnQ1AAGmgKL6z3RQqBTgkBFEKoJ8QWQAQKgx45sPeFHplSaUIKalS6XglabAEDEECksAYZ9Q0QVAcYCywQRhmx5qrrrgsFBAAh+QQFAgAAACwSABQALAAqAAAI/wALCBxIsKDBgwgTKlzIsKHDhxAjIpzDwMUJiRhPMJgQ5c4dJBxKYIS4B04EBBs2OCFRg0nEOmUaNGQAhwSOmzc3RKDwMISFFmdaEEgjMyGFCDiTIoDjQuRCLCI6KBChoIOZMQr7OEmalEQehiFEiPBBlqwCHkUQMomCgCtOEhxcKnTToazdDhYQltDq9ibchWXOjLVLVsSZMghr2HS7AUeVGQkbHAiQhHDhAAcQ5kHpNgIRhnQEW/ZhmI7Rk0kjRGHgVKGFupY7EFBYggOclTaJsG4YgocCwh3OZF7oIo8DDVWYlGi9cAwPqVQ7tEjL0OlyiUUInAm6w/RIiDJn2P/5Tr68+fPo06tfz179lARc8LSJAah9QSkZBAzYL8CKDkEQ1bHEEnU4lIEEPySY4ABN6OBQGV5s8cADW3hBB3MGvSGAghwOkAGGBwWxBQQmXHCBCYG8sERCJ+AxAIcKesDHDQy9AEEFOOYYyBEKGbEhjAmikACACZFhQo5IVpACGAidkB+QQSawEBtAJJkjBlAkNMiLQHrQxBAXJXTEkVZWAAQNCd3AAgpASqAEQzSQaSUQbCikggc//oCCBFbQSJsaGJRZAQZqLPQGFYSggMIIXNTH0BIPpGClCSscAGJBJ+jwRgJSQOaQGinIaWYFYdg3EBlrmIABBils8YUQpgoRVAIdYXjhxRfexarrrrxCFBAAIfkEBQIAKgAsFQAXACYAJAAACP8ACwgcSLCgwYMIEypcyBDhjIYQDxYh0KKFGwMHGs5hwIBJwzE+OihQgKbDGRsKXUzoIuZOFwdzFIbwIcKHTZtoAqRBWCVKBAQbNjiJgMRFQgsdbirtQKCBQSZ9SOCYSjUCEYRlztRUalPBGToGOUSgSjZolYMHAmzlmiTAAacEiUglS5WEg4Nl1HK1KeKrQSRO6NadgNANmr0hmxqUK3gqCQoHZ4QQsbarzoMOxjYmkSchFhEdRCRRYDIEQgZ3EAgm0YdJCYQNQrg5E+AMRoUcnASue2dPQzoH/DTU0AUBCRIbkFQ5ETEikzwcOOx53by69evYs2vfDvvAkjrcEfr2WbBlxYotUMqEJ3jgCAQTMGCYgLAFgEIpIJRkwBPjyUIaEFQg4IAQvICQIDqMMIAAAixIxQ0JfQHDgBRWYEIYBw2h4A8ccjiADFIwV1ADUARYoYAYfGDQDFxI0OGLEnCBEBsYnCigCUcIYZAVArzYIQoy+DfiBzXaiKNBUozggY8cetDEEAeRYYKNFUDgBXUDZaEkkz84GaJBZawwZYUpPGCfQRkMwKUAVCRExgVj3piCGgglgMKSPkoAgkJhrGECBhiYsAYZDhVwBYNLesAgHiImREcYXngRRhlYIhQDFXz8wAcVMaxnkCA3JHDDFJ4q9FCp1QUEACH5BAUCAA8ALBYAGAAkACIAAAj/AAsIHEiwAJ0DdgoqXMiwoA03ZwKcsVCkoUWGdXagQSOiYwceYy6KHGiDo4+TJ0X4KNJg5EU3aFDK7GDBpcUDAZLIRCniDJ2WCl0wYMDkYpqcO1MGOKCQQY0oYu50cVCUIZ0zCpL6UHAG6MA9cCIg2LDBSYQeLhpa6KC1gwGCJVxEIYGjrt0INRoW4ZF1ZosyBR1EsEt4wx0GJRiOMdNBgQI0HdykUYjECWHCTjhYTEOgRQs3WOx4HdjH8uW6JBzMuNhgNGXTp1PbbEhh8OkNCPbMXliiCg4Ep8/ubujACewNEeBU4X2A6WwNURCQoEuEgcIyXrasWPFCjR+bc/Jw8dBQpURiggC2QDABAwYQDEcAD1dY5wWECvjzB2IzX6EaDPkFeEEFOfRHEA1ABBggBgsYKFB9JiiYHwYfLJRFAoO0IYcOFx2RoIQVUOjaDVQIMMCJHighxQkMQXEfiECQUVAWVkjww403SkBFFgzloMeACpqwBh3nCSSHjTjiKMEVDXkBRAoBmqBHGAWVUGKSOKIgA4sMqbHCexiksMUXCgEyggdY3uhBE0OsxhwZUHgRBh0LPTECCmn+sOYQDgqUgQB5omBFnwWcEMMAeS5JqEB4SIDnjShIYASPixYgx50CoDCCHE9UOhAgCcTwhhQWBQQAIfkEBQIAAAAsFQAXACYAJQAACP8ACwgcSLBgAzoNCipcyHBhEQMtzrSwEKKhxYs2AnRAI0JBhz87LooseOAMGh8oUYpAM2akSwMdUspU0CKhS4sN3JyUKbPIzYstFPBMKcLGz4Y5dw714fMowx0dkgxF46aO04UNSipFKbTiwhMnnIbQqKBjhwA2bA4soYFIly5ENJS4mZVAiwAtDKRRK3AOERIkEDgBTGTO0Rl07DTgK7BGBByQI0eocZVhHgQbIkfesKGKwgZlysy9OYGEZs0kHIwu4GfBixUrXiywM7LE39ORSVAWuOQFBhMpYJiA8OLA6oaOcUPWPfAIhArQoweiMdKBaeUkOAgMkyK69wswwIj1ZCAGAW4EcBgUaPABg3fvGKBUj2A+smDtAo+YeB8dCPWRHNwBGGBw4CcQDUDwBx0GbNRWAgMcTDABBy4UtECCCmKwQGUKBfFAd++ZsMISHCqkBnDemQADGYwNAQIeSlyhQ1gjNVAHGSuYgMFva4RR0AlvNDGAAAIM4AEeWdB1ABlQQEFGGQrpQAgKP1T5gwcSKFFiQYJkMICVYAoQw5YDDcGCB2BaOYASx1U2gw5oplmlAFSQKZCUcs5JxQx2AiIDlXIOgIedAl0hgZweoJAAoQU8kYEEgP4gAApXMCrQE1eMkOgPVLxhKUFS6JDAjJ/+SKNLAQEAIfkEBQIAAAAsFAAWACgAJgAACP8ACwgcSLAgwTJpDhhcyLBhQRtuzpgJ4GaMw4sOG4xJgkZEEhFoFBDASLJgETOIfKhc2QFLyZcEOqycKeKMnZckW4iYybNIA5wXWyjguTKJDaAX3aAh6iOJmTRIHe6QSRSNm6gO6bSguhJNAKhYGTZIszUkmg4tioS9SAeLmxZusND5GbVBGTprSZbxsmXFmiNk1jJhwjDHFggmYMAAAoSNEKBMOPSI0oWIhoJ0tmCowLlzICiPS7pAQsIJAgQkSNQgLHDB5s6dYTwI8rJHBBy4c0eYMPAIENiwTZCpQ1IDidzIN9xhUELIlhTAO0OAQvJEjePIc5PgIPDF7+gVMFD1J4nESXbtvBt8eB09RZiSPcyfx0GCgkAwMC5EB7LlJkkK2J1HwmUCfQABDLABoccXL+2BwwbnORHFHAR58QAGGJqwBYM4URABAsiZRiBBQagBBRRh4IWUA3eklloUeTTUAF1YMcDBBBRo4EIJJQA1QxYJyHFFHEM4xGOPUelghQADDCAAC3KckNdCN4wwwA9Y/uCBBG1MaZASV2aJpQcoJCCIlwJJ0YQHYmY5gBJoCqRDm2KiYEWcBcxJJ5YoUIEnICOgsOebUsbZhgR7ChADngVIQYUEbPIpAR5I4jkEHnwIIAAKI4BwJqMCnXBDHCq8IQVSAQEAIfkEBQIAAAAsEwAVACoAKAAACP8ACwgcSLCgQYF1Dtg5yLChw4EhCJwJcMaCjYcYH47h0UFBEhEdd9TJSJJgmgAKfKhUCXJMyZcGOqycqaBFg5ckW6ScObMITowNdPJcKSLEzZ8NG7hBM9RHEh5pkD6M2bSDG6kPy5xhStOMT5x0Fj4McaajCAUdzhgtaUfNizVrjpB5eMBAizMtdhx4ueQFBBMpUgDBQEOswxkFGhzNKOQIhAqQI0Ngg9UhGSCRM1/Qk6PywTpsMGTOjGGB54MvTIyOjIHy6YJHVK+uAOQDViZMDkIRPRuImp8lNPSIEgUJh9wCheTQA2N1ihV7X86pQYIEAgROSCBxQXB388gmLszxxVkjAo7z6CP0KLjgAYb3QNaE+blnwwb0+BHkKRhEzQcoZBxQwk8UkIAffiRQcMJrBFF3IHokEMEgQRMY+CAOEQ444QkaWPhgBA5MOJALcDjxIAJ3MKChiBw4gUB+JHCwIkY3qNBGGyoMgVhDGsBRXXVwcPASCCwMYOQATYDgUAkuaEDBBBpwV1IMKKDww5U/oDAACAs2VMKAX5b0hAwCYIklCizcIKJACVhpJpYDyLHmCSqU+eaVA+CxZgFx2HlnnnvqcCecSu6ZgQR3oqnmnjeMIIEHV3oggAcq7DnQDUqwUOUPRiRgaUE3vPGGDp4FBAAh+QQFAgAAACwRABQALAAqAAAI/wALCBxIsKBBgw3KFElj56DDhxAJhrAQgAePMzvoRNwYcUYIHh1E+EiioIObMhxTGixzRoGPlzA7WFBJUyCWDjBzJuFRpKZKAjhzwkSDxWdKC2iEDt1hlKOBoEoV2GiQ0k4dlSFEKkXTws/GMl5erFlD40sJjkD/5HQ5NWKOLRBMwEiBIQWUjQ3oWCiJBk2HMza+rsFQoXDhCxC8pLRBwI0bLCg3eoFguHKKFZHxUlX5wkRly2GaQixRZg2Mz4aBKBb9UMiaFKgLY1jA+uEJNoRjw/hS+2EYz6iBbOn9sAGbQBcqA3kAhvhDPx/0YJhuYgsYIc4h5vDyAUoYjdk5NvoY73zOnPARmXBAEiVKDw5M0Bt00SOCEwQInJDo4UL+wBJERIDDgARGUIN/AuVBAoEMbrDBHv6dMMGCDBJIggMI9kBhhTiQcKB/RGxYYQQTIMiBgBx2yAFHgCQAAggJZLEREwzcgQCHCMDRX0RvyIDCAAOgIMMbG5Vw4o0E3qfBRgkQIsAPUP4gAAoxRHQWB3CQoKUTUSy5ERUDRBklCk0MwZELGlBAgQbnRSSIDh6IKeYAIHBUwlk0qfCknFAOgMcM/sWxJ59+Iggnn33KIYh8gILJZ5w6IFiADiyEOeYAV0g6wxQ6UPHjAALIEIekA83whItyvAEIcQEBACH5BAUCAEAALBEAEwAuACwAAAj/AAsIHEiwoMGDA+2kOdAAocOHEAUCIXAmQIAWWOpE3BgxRIAOIpKIQNPBAh2OKA3SaYHGh0uXfzoQSElT4JgOL3Mm4ZGmJsoGBHDmfNlhTMQDOXKcpGmh5VCXaHY8BMBmhR49a6As3VjHgNCnaGw4BPMAA4wKFVJAeHGgBEcbCp76UHCGTsOCJQ6sMIG2bwUINFDWsfDVpQIRYhF6geC37wU9OVCWcdMBjQIFHQKMaXDX4Au+jdGaWJDSzxg3LdwYOABxS4rQaDF88FmAc8TPsCtg8EKbIxQMuVN86b0xh56zjdcS56jGBOgKFyCsiLwcYkMya2A410MDQHWUdsCo/yGTw/b38+jTq1/Pvr379/BrzpnjNj5BDT3gROnjgH58JjWQ4AQCCDgRQRcMxDdBBDg06GAEfTDxXhU4bODghSRo8J4DJFyIYQ3vTdChhw06gQREN6jAxRVvPEETBSOS6EQP9R10BR8D5IiCFQmgNEMeTpDYYAQUOCSHBB78oOQPArDQI0dzRBGkhwiIUcVBM9zAQpJLKikAFSdwxEQeG0zZYIEOOATCAF12icKTG5WQRxdOkGAnHBw8hAebbXoJAkpuuZCHAxRo4AJEbfDZpwB/0lRCjRCpoGibb74nxQgCLCrDFPDF4EGmSw7AB5zvJWDFp5lmoEMBM8A3wwxTJAcQRxyrrhcQACH5BAUCAAEALBAAEgAwAC4AAAj/AAsIHEiwoMGDB9OEKEIHocOHEAnacGMmiY8zBspE3MhxjI8Of3z4UNChxQGOKBEeOKNApMuPFh6WOJAjSJ2UBRtg6fDSpcUiCLXQWKHnwRY1QnAOtICmp0s0WA6S0QMBxoULJiCwuamUqVORUA3meJCigtmzEKAoLWCA51cFNgyygXC2booVGnGGEPEVTQuDftaUrXs2xZekOAmAfInGTAiDS1bAIHwWg5q1fgiI6ICmQ8nHBukIpmzWBJkGawuEIGDBwpiGCGlgIH1BD4DUA1FDDJPiAmWtXHFz/ABhcIULgbYsEY5zwYoUQEzoYbOcecqZYdSQuW09dQPd3cOL/x9Pvrz58+jTq1/Pvr379/DjCyzhwoV8JhyQwIGDxMEc9y70EIETCCDgRARIMMDeCTVEgMODEEbQA3t5ILABhBg6kYdDgCSgQhw3CEeBgxhGSAFCcYzggQAC/JDBDSesVQMJJUJIAhElFDRDHCig8MOPHkgwQog4lTABjTXicKNBQ4zg449QDmCEIEppgGSNEThQ0AkqDADllz94kECRLsDhRI0IwKFgQW14CeaPA4CwlgZOnAlhnRrESNAMbb75owByzhmFEySQ4EQUGuRoEAhuvinAG7jNkYcDDmjw30EnDNHEk1+iMAIguJUgakQzgCAApz+cqkJ7JagwggADDBAggBWQvidFHFdc8UYW6QUEACH5BAUCACwALA8AEQAyADEAAAj/AAsIHEiwoMGDCAfSSZOGTsKHECMWaHCAwBkzPM4QOPCwDIAgdSSKPHCmg4g/f0R0OFPkIAA2Kx482LIgpMiHbjr42MmzQ4sGBb88gADjwgUTEGg4vHkwBM+nO9GMIRhkhYkKWLMG+sD0IBadUKMSIAgFQtazMB4sAdp14A40YaNaILjl6tmsJsi0JTgGbtwOOxSuSXE3KwYvbPceCCAirAgzaegSLlwByIK9BHd0+PNUBJrABD+YLWwUDGaCBlQqQNPBDJbEAsEYLQzhyOmCIQi4cWMg8kEoQCZXuABhTY7bBhvAPqhmRQogQCrQAIAc84EwC9TkELK8uvfv4MOL/x9Pvrz58+jTq1/Pvr379/Djy59Pv7598C5cMJGvAQmcO11QwIB7J9RAghMIbOBEBFHsgdANKsihgg7gURABDhhmSEIXLhSURRt8CDCAAD8oMQRyJzAgxgYZthgBBwXhIYEHP9TogQRWSFHCbRyQ0GKLJBCxo0BvkFjjkT9IgMdtJzhw4Y8YOtEHQXgMgOSRHjSh42kO+AglDlISRIWRV9aYwG17sPglCROIiUKZNp55Wx9etsiigwNVCWeWJ6IpRp04IECCAwUl4AGNV0qQgXd79CHogXDAaBAXM2IpwQg3fMfEHg44oEGHCMnRhAAilnhDCSd8NyREJUgRAwgT0gZ3QqrsBQQAIfkEBQIABgAsDQAQADUAMgAACP8ACwgceCDIkoEIEypcyFBgGhs20jTUQmPFgwcvyDTcyLFACDdmFCgw46aIQjJ6MMC4cAGIiQ8dYyIMEaDDHx8+kqAxEwKhFj0pKggVegHDApkyWyjAydQHmjN2BtKAMLRqijV1kG5sEEJE06YdxggsswJG1bNahGhtuAPNV6YdCBRoAODBhbNDTWhcy3BHh7c44wo8UBav0BRh+DIcsxRwBywNCgg5AsQwjAcHFSssc6ZxUwUBDgwkQxUvBDaaF3fwylRBErECGwhhE8gsUQhbRKdOGBmLmQ5ogp+xodAPlAcmgADRwybz7oVpdhAgMKYMwwZLyCxQk+M5xwbgI3v/H0++vPnz6NOrX8++vfv38OPLn0+/vv37+PPr38+/v///AAYo4AkuuMDERoAkEEMCUqh3Agd9wHFHFxS4sBAII3ggAApNcJHFeXMQEYETG2zgRARdVJHQIBKg8MOLHkhgxIfl1RABDjjmSEIfBwqkgwcevCjkDxJwUd4eOGyQ45IkaCCQIG0MMKSQKIzQ4HgOkLAkkzUMZIQAUwrpgQ6CjDeBllvi6AQSA1EBZpg/eJAAeRSgmaYTPQyEh5RhesDHDeTl4USaOEZAgUAnvPHmlAMYQV4JTHQx6JYI3MEAQnhIEKSQAvCRwAzl5YGDnTg44QQHBZSAaBZt/DDAqwJQITHneXn0gQAJJDgRhZML6SBHG1y88YR6TOTBgQN5WDhQQAAh+QQFAgBjACwNABAANQAzAAAI/wDHCBQoREuYMAAGKlzIsKHDMQdCjCnSwOGXFxVSpHhAI8jDjyCLWAggkEcLGw0rALlQocIFDCtygJzpUIRAH2MUYFEI4AHDChBe0Bz6UASPIgIbQHHYEgzRpwwJCCzwwoRDDF4KQN2qoMWYAgW2pHAI5MNWrl6/HgFy1cvZrRa0NlgAoeGFC07fDk0iAqXAJSusMqRRUe9MER0MDAQb5gGGC2MuwPhreGaHADsYFtBC4wHLFVAOlKj80QKWA4UZClkCRgtq0iDBwp5Nu7bt27hz697Nu7fv38CDCx9OvLjx48iTK1/OvLnz59CjwwYr+2EBKTeGaMVdwIWGCRM4MMnYvjBBhhEsmhiJQX52AQ1RSMgnIcZB+zExfkjwwF+AAC73VabBBk4ohEAEFJB3QxMoLOTBACqcMJsLURS40AY4VDFaAVc8JMMTsJ2gwUcU0PTDV731INwEHyExkBIO/fCDDrNxQIJDJNQwlQoDNCSAFRKSVkAVYmzAEA5OjCjQFFSMceJAKEAYoF4TRICDQjhEoCJ5Q1AxgH8CSNAECLYxUYN8CCAwhpYuMJSFCkpQYQQXN+SmARFdRNEDB0w4NMMMv53ABHXUBQQAOw==" alt="'+o+'" /><br />';var l=e.content_html?e.content_html:'<div class="loading_hash_animation">'+s+o+"</div>",d='<base href="https://'+document.location.hostname+'" target="_blank">\n<style>'+n+"</style>\n"+i+"\n"+l;return TS.dir(439,e,"_getSpinnerHtml html: "+d),d},d=function(e){TS.has_pri[S]&&TS.dir(S,e,"_storeLastWindowSize token: "+e.token),TS.model.prefs.ssb_space_window=JSON.stringify({token:e.token,x:e.x,y:e.y,width:e.width,height:e.height}),u()},c=function(){TS.prefs.setPrefByAPI({name:"ssb_space_window",value:TS.model.prefs.ssb_space_window})},u=function(){c()},m=function(){return TS.utility.parseJSONOrElse(TS.model.prefs.ssb_space_window,null)},h=function(e,t){window.macgap?g(e,t):p(e,t)},p=function(e,t){var n;try{n=TSSSB.call("getGeometryForWindow",e.token)}catch(t){TS.warn('TSSSB method getGeometryForWindow threw error with token of "'+e.token+'"',t)}n&&(e.x=n.x,e.y=n.y,e.height=n.height,e.width=n.width,setTimeout(t,0))},g=function(e,t){e.window&&(e.x=e.window.screenX+22,e.y=e.window.screenY-23+22,e.width=e.window.innerWidth,e.height=e.window.innerHeight),e.document&&(e.title=e.document.title),t()},f=function(t){var n={};if(!Object.keys(e).length)return void TS.storage.storeClientWindows(n);_.forOwn(e,function(i,a){i.worth_saving&&h(i,function(i){return function(){var a=e[i];a&&(n[i]={token:i,x:a.x,y:a.y,width:a.width,height:a.height,file_id:a.file_id,title:a.title,destination_url:a.destination_url,url:a.url,no_spinner:a.no_spinner,worth_saving:a.worth_saving},TS.has_pri[S]&&TS.dir(S,n[i],"_storeWins LS_win token: "+i),TS.storage.storeClientWindows(n),i==t&&d(n[i]))}}(a))}),Object.keys(n).length||TS.storage.storeClientWindows("")},S=438}()},2470:function(e,t){!function(){"use strict";TS.registerModule("key_triggers",{onStart:function(){TS.boot_data.special_flex_panes&&_.forOwn(TS.boot_data.special_flex_panes,function(e){e.keycode&&function(e,t){TS.key_triggers[e.toString()]={func:function(){TS.client.ui.flex.openFlexTab(t)}}}(e.keycode,e.flex_name)})},220:{isDisabled:function(e){var t=$(e.target).closest("#reply_container").length>0,n=$(e.target).closest(".reply_input_container").length>0;return!(t||n)&&TS.client.activeChannelIsHidden()},shift_optional:!1,func:function(e){var t=TS.shared.getActiveModelOb();if(t){var n,i=$(e.target).closest("#reply_container.has_focus").length>0,a=$(e.target).closest(".reply_input_container.has_focus").length>0;if(i){var s=_.clone(TS.ui.replies.getActiveMessages());n=_.reverse(s),e.target=$("#reply_container")}else if(a){var r=$(".reply_input_container.has_focus"),o=TS.client.ui.threads.getThreadFromEl(r),l=o.replies&&o.replies.length?_.clone(o.replies):_.clone(o.root_msg);l=_.dropRightWhile(o.replies,function(e){return e.ts>o.max_visible_ts}),n=_.reverse(l),e.target=r}else n=TS.utility.msgs.getDisplayedMsgs(t.msgs),e.target=TS.client.ui.$msg_input;var d=_(n).take(5).find(function(e){return!e.is_ephemeral});if(d&&(!d._jl_rolled_up_in||(d=TS.utility.msgs.getMsg(d._jl_rolled_up_in,t.msgs)))){var c=TS.rxns.getRxnKeyByMsgType(d),u=TS.utility.msgs.getMsgActions(d,t);if(!u||!u.add_rxn&&!u.add_file_rxn&&!u.add_file_comment_rxn)return void TS.sounds.play("beep");var m=function(){$(e.target).find("textarea").addBack().focus()};TS.ui.react_emoji_menu.start({e:e,rxn_key:c,callback:m})}}}},77:{isDisabled:function(){return TS.model.is_chrome_desktop||TS.model.is_chrome_mobile},func:function(){TS.model.ui_state.flex_visible&&"mentions"===TS.model.ui_state.flex_name?TS.client.ui.flex.hideFlex():TS.client.ui.flex.openFlexTab("mentions")}},83:{shift_optional:!0,func:function(e){TS.boot_data.feature_star_shortcut&&e.altKey?TS.stars.toggleStarOnActiveModelObject():e.shiftKey&&(TS.model.ui_state.flex_visible&&"stars"===TS.model.ui_state.flex_name?TS.client.ui.flex.hideFlex():TS.client.ui.flex.openFlexTab("stars"))}},85:{isDisabled:function(e){return!!e.altKey||TS.client.activeChannelIsHidden()},no_shift:!0,func:function(){TS.client.ui.files.$upload.trigger("click")}},69:{isDisabled:function(){return!!TS.model.is_FF},func:function(){TS.model.ui_state.flex_visible&&"team"===TS.model.ui_state.flex_name?TS.client.ui.flex.hideFlex():(TS.client.ui.flex.openFlexTab("team"),TS.client.ui.showTeamList())}},65:{isDisabled:function(){return!TS.client.unread.isEnabled()},func:function(){TS.model.unread_view_is_showing?TS.client.unread.reloadIfPendingMessages():TS.client.unread.showUnreadView()}},73:{isDisabled:function(e){return!TS.model.is_our_app||(!(!window.loadSettings||!window.loadSettings.devMode)||(!!e.altKey||!!TS.client.activeChannelIsHidden()))},func:function(){TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name?TS.client.ui.flex.hideFlex():TS.client.ui.flex.openFlexTab("details")}},70:{isDisabled:function(e){return!(TS.model.is_our_app||TS.model&&TS.model.prefs&&TS.model.prefs.f_key_search||TS.boot_data.feature_focus_mode&&e.altKey)},no_shift:!0,func:function(e){if(TS.boot_data.feature_focus_mode&&e.altKey)TS.ui.focus_mode.start();else{if(!TS.client.ui.isUserAttentionOnChat())return!1;TS.clog.track("SEARCH_OPEN",{open_method:"key"});var t;TS.client.activeChannelIsHidden()||(t="in:"+TS.shared.getActiveModelOb().name+" "),TS.search.setInputVal(t)}}},74:{isDisabled:function(){return!TS.environment.is_apple_webkit},no_shift:!0,func:_.noop},75:{isDisabled:function(e){return e.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model||!TS.model.is_our_app&&!TS.model.prefs.k_key_omnibox},no_shift:!0,func:function(){TS.model.prefs.no_omnibox_in_channels&&TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut_no_btn",action:"opened"}),TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"opened"}),TS.model.prefs.k_key_omnibox_auto_hide_count<5&&TS.prefs.setPrefByAPI({name:"k_key_omnibox_auto_hide_count",value:TS.model.prefs.k_key_omnibox_auto_hide_count+1}),TS.ui.jumper.start()}},76:{isDisabled:function(e){return e.metaKey||e.altKey||e.shiftKey||!e.ctrlKey||!TS.model.is_mac||(e.preventDefault(),e.stopPropagation()),e.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model},shift_optional:!1,func:function(){TS.ui.channel_browser.start()}},84:{isDisabled:function(e){return e.altKey||!TS.client.ui.isUserAttentionOnChat()||!TS.model||!TS.model.is_our_app},no_shift:!0,func:function(){TS.model.prefs.no_omnibox_in_channels&&TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut_no_btn",action:"opened"}),TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"opened"}),TS.model.prefs.k_key_omnibox_auto_hide_count<5&&TS.prefs.setPrefByAPI({name:"k_key_omnibox_auto_hide_count",value:TS.model.prefs.k_key_omnibox_auto_hide_count+1}),TS.ui.jumper.start()}},188:{isDisabled:function(){return!TS.model.is_mac||!!TS.model.active_im_id},shift_optional:!1,func:function(){TS.ui.channel_prefs_dialog.start(TS.model.active_cid)}}})}()},2490:function(e,t){!function(){"use strict";TS.registerModule("newxp",{onboarding:{cancel:{step_name:"onboarding_cancelled",pref_name:"onboarding_cancelled",show:"#unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",hide:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #in_skip_messaging",unstyle:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function(){return new Promise(function(){$("#end_display_onboarding").on("click.cancel_onboarding",".skip_tutorial_link",l)}).finally(function(){return TS.view.unAdjustForWelcomeSlideShow(),TS.client.ui.$msg_input.focus(),c(TS.newxp.onboarding.cancel),TS.client.ui.slowScrollMsgsToBottom(),$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding").on("click.take_onboarding",d),$("#end_display_onboarding").off("click.cancel_onboarding"),TS.prefs.setPrefByAPI({name:"onboarding_cancelled",value:!0})})}},loading:{step_name:"onboarding_loading",pref_name:"",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container, #pre_skip_messaging",hide:"#banner, #in_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function(){return new Promise(function(){TS.view.adjustForWelcomeSlideShow(),c(TS.newxp.onboarding.loading)})}},start:{step_name:"onboarding_start",pref_name:"seen_onboarding_start",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging",hide:"#in_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function(){return new Promise(function(e){TS.view.adjustForWelcomeSlideShow(),c(TS.newxp.onboarding.start),$("#explore_btn_container > .btn").on("click",function(){TS.metrics.mark("onboarding_btn_click"),TS.clog.track("GROWTH_ONBOARDING",{action:"onboarding_btn_click",step:r})}),$("#explore_btn_container > .btn").on("click.start_onboarding",e)}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_start",value:!0})}).finally(function(){return $("#explore_btn_container > .btn").off("click.start_onboarding"),TS.prefs.setPrefByAPI({name:"seen_welcome_2",value:!0})})}},complete:{step_name:"onboarding_complete",pref_name:"seen_onboarding_complete",show:"#star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",hide:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #in_skip_messaging, #unskip_messaging",hide_admin:".coachmark_invite_people",unstyle:"#client_header .channel_header, #client_body, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",promiseTo:function(){return Promise.resolve().then(function(){return c(TS.newxp.onboarding.complete),$("#end_display_onboarding").off("click.cancel_onboarding"),$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding"),TS.client.ui.slowScrollMsgsToBottom(),TS.client.ui.$msg_input.focus(),TS.ims.message_received_sig.has(v,TS.newxp)&&TS.ims.message_received_sig.remove(v,TS.newxp),TS.prefs.setPrefByAPI({name:"newxp_slackbot_step",value:"A2"})})}},slackbot:{step_name:"onboarding_slackbot_conversation",pref_name:"seen_onboarding_slackbot_conversation",show:"#team_menu_overlay, #col_channels_overlay, #active_channel_name_overlay, #in_skip_messaging",hide:"#explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging, #star_container, #channel_header_info, #client_header .channel_title_info, #client_header .flex_header",style:"#client_header .channel_header, #details_toggle, #channel_actions_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div, #col_channels_footer",unstyle:"#client_body",promiseTo:function(){var e=null,t=function(e,t,n){S(t,n)&&e()};return Promise.resolve().then(function(){c(TS.newxp.onboarding.slackbot),TS.view.unAdjustForWelcomeSlideShow(),TS.view.focusMessageInput(),$("#footer_overlay").css("opacity",0),TS.ims.message_received_sig.add(T,TS.newxp)}).delay(400*$("#footer_overlay").css("opacity")).then(function(){$("#footer_overlay").addClass("hidden"),TS.client.ui.slowScrollMsgsToBottom()}).then(function(){return TS.model.prefs.onboarding_slackbot_conversation_step?a?Promise.resolve():new Promise(function(n){return e=t.bind(null,n),TS.ims.message_received_sig.add(e,TS.newxp),TS.prefs.setPrefByAPI({name:"greeting_step",value:"go"})}).finally(function(){TS.ims.message_received_sig.remove(e,TS.newxp)}):Promise.resolve()}).then(function(){return TS.model.prefs.onboarding_slackbot_conversation_step>1?Promise.resolve():new Promise(function(n){return e=t.bind(null,n),TS.ims.message_received_sig.add(e,TS.newxp),TS.metrics.measure("sending_api_call_to_queue_slackbot","onboarding_btn_click"),TS.metrics.mark("onboarding_api_call"),TS.prefs.setPrefByAPI({name:"greeting_step",value:"start"})}).then(function(){return TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"Type something"),TS.prefs.setPrefByAPI({name:"onboarding_slackbot_conversation_step",value:1})}).finally(function(){TS.metrics.measure("received_first_slackbot_msg_from_onboarding_button","onboarding_btn_click"),TS.metrics.measure("received_first_slackbot_msg_from_api_call","onboarding_api_call"),TS.metrics.clearMarks("onboarding_btn_click"),TS.metrics.clearMarks("onboarding_api_call"),TS.ims.message_received_sig.remove(e,TS.newxp)})}).then(function(){var n=Promise.resolve().then(function(){var n=TS.model.prefs.onboarding_slackbot_conversation_step>1?0:3e4;return Promise.delay(n).then(function(){return new Promise(function(n){return e=t.bind(null,n),TS.ims.message_received_sig.add(e,TS.newxp),TS.prefs.setPrefByAPI({name:"intro_step",value:"notyping_1"})}).then(function(){return TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"Type something"),TS.client.ui.$msg_input.addClass("onboarding"),TS.client.ui.files.$file_btn.addClass("onboarding"),TS.prefs.setPrefByAPI({name:"onboarding_slackbot_conversation_step",value:2})}).delay(2e3).finally(function(){TS.ims.message_received_sig.remove(e,TS.newxp),TS.client.ui.$msg_input.removeClass("onboarding"),TS.client.ui.files.$file_btn.removeClass("onboarding")})})}).delay(6e5).then(function(){return new Promise(function(n){return e=t.bind(null,n),TS.ims.message_received_sig.add(e,TS.newxp),TS.prefs.setPrefByAPI({name:"intro_step",value:"notyping_2"})}).then(function(){l(),s.cancel()}).finally(function(){TS.ims.message_received_sig.remove(e,TS.newxp)})}),i=function(e,t,n){S(t,n)&&-1!=n.text.indexOf("Let me show you a couple things about Slack")&&e()},a=function(e,t){f(e,t)&&n.cancel()},s=new Promise(function(e){return TS.ims.message_received_sig.add(a,TS.newxp),i=i.bind(null,e),TS.ims.message_received_sig.add(i,TS.newxp),TS.prefs.setPrefByAPI({name:"greeting_step",value:"expecting"})}).then(function(){return TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,""),TS.prefs.setMultiPrefsByAPI({onboarding_slackbot_conversation_step:10,seen_onboarding_slackbot_conversation:!0})}).finally(function(){TS.ims.message_received_sig.remove(i,TS.newxp),TS.ims.message_received_sig.remove(a,TS.newxp)});return Promise.any([s,n]).finally(function(){s&&s.cancel(),n&&n.cancel()})}).finally(function(){return TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,""),TS.client.ui.$msg_input.removeClass("onboarding"),TS.client.ui.files.$file_btn.removeClass("onboarding"),TS.ims.message_received_sig.remove(T,TS.newxp),TS.ims.message_received_sig.add(v,TS.newxp),setTimeout(function(){TS.ims.message_received_sig.has(v,TS.newxp)&&TS.ims.message_received_sig.remove(v,TS.newxp)},18e4),TS.prefs.setMultiPrefsByAPI({intro_step:"",greeting_step:""})})}},channels:{step_name:"onboarding_channels",pref_name:"seen_onboarding_channels",show:"#active_channel_name_overlay, #in_skip_messaging, .coachmark_next_tip",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#col_channels_footer",promiseTo:function(){var e=$("#starred_div, #direct_messages, #channel_list_invites_link, #quick_switcher_btn");return new Promise(function(t){TS.client.ui.$msg_input.blur(),c(TS.newxp.onboarding.channels),TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.channels,{resolve:t,reject:l})),e.addClass("translucent")}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_channels",value:!0}),null}).finally(function(){e.removeClass("translucent")})}},direct_messages:{step_name:"onboarding_direct_messages",pref_name:"seen_onboarding_direct_messages",show:"#active_channel_name_overlay, #in_skip_messaging",show_member:".coachmark_got_it",show_admin:".coachmark_next_tip",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging, .coachmark_invite_people",hide_member:".coachmark_next_tip",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#col_channels_footer",promiseTo:function(){var e=$("#starred_div, #channels, #channel_list_invites_link, #quick_switcher_btn");return new Promise(function(t){c(TS.newxp.onboarding.direct_messages),TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.direct_messages,{resolve:t,reject:l})),e.addClass("translucent")}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_direct_messages",value:!0}),null}).finally(function(){e.removeClass("translucent")})}},invites:{step_name:"onboarding_invites",pref_name:"seen_onboarding_invites",show:"#active_channel_name_overlay, #in_skip_messaging",show_admin:".coachmark_invite_people",hide:"#in_skip_messaging, #team_menu_overlay, #col_channels_overlay, #explore_btn_container > .btn, #pre_skip_messaging, #unskip_messaging, .coachmark_next_tip",style:"#client_header .channel_header, #details_toggle, #recent_mentions_toggle, #stars_toggle, #flex_menu_toggle, #search_container, #channel_members_toggle, #rxn_toast_div",unstyle:"#quick_switcher_btn",promiseTo:function(){var e=$("#starred_div, #channels, #direct_messages");return new Promise(function(t){c(TS.newxp.onboarding.invites),TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.invites,{resolve:t,reject:l})),e.addClass("translucent")}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_invites",value:!0}),null}).finally(function(){e.removeClass("translucent")})}},recent_mentions:{step_name:"onboarding_recent_mentions",pref_name:"seen_onboarding_recent_mentions",promiseTo:function(){var e,t;return new Promise(function(n,i){e=$("#recent_mentions_toggle"),k(e),t=e.find(".starburst"),C(TS.coachmark.start.bind(null,$.extend({},TS.coachmarks.coachmarks.recent_mentions,{resolve:n,reject:i.bind(null,new Error("Click-tick onboarding cancelled"))})),e,t)}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_recent_mentions",value:!0}),null}).finally(function(){M(e,t),A(e)})}},starred_items:{step_name:"onboarding_starred_items",pref_name:"seen_onboarding_starred_items",promiseTo:function(){var e,t;return new Promise(function(n,i){e=$("#stars_toggle"),k(e),t=e.find(".starburst"),C(TS.coachmark.start.bind(null,$.extend({},TS.coachmarks.coachmarks.starred_items,{resolve:n,reject:i.bind(null,new Error("Click-tick onboarding cancelled"))})),e,t)}).then(function(){return TS.prefs.setPrefByAPI({name:"seen_onboarding_starred_items",value:!0}),null}).finally(function(){M(e,t),A(e)})}}},onStart:function(){TS.client&&(TS.client.login_sig.add(TS.newxp.onLogin,TS.newxp,-1),TS.prefs.seen_welcome_2_changed_sig.add(TS.newxp.setSeenWelcome2))},setSeenWelcome2:function(){TS.model.seen_welcome_2=TS.model.prefs.seen_welcome_2},onLogin:function(){void 0!==TS.boot_data.prefs_seen_welcome_2?TS.model.seen_welcome_2=TS.boot_data.prefs_seen_welcome_2:TS.model.seen_welcome_2=TS.model.prefs.seen_welcome_2,TS.newxp.startOnboarding()},shouldShowFirstWelcome:function(){if(TS.boot_data.incremental_boot_data&&(!1===_.get(TS.boot_data.incremental_boot_data,"self.prefs.seen_welcome_2",void 0)||!1===TS.boot_data.prefs_seen_welcome_2))return!0;if(TS.model&&TS.model.seen_welcome_2)return!1;if(!(TS.model&&TS.model.welcome_model_ob&&TS.model.welcome_model_ob.id))return!1;var e=TS.shared.getActiveModelOb();return!!e&&e.id==TS.model.welcome_model_ob.id},inOnboarding:function(){return e},startOnboarding:function(){TS.model.seen_welcome_2||(I(),TS.model.seen_welcome_2||(x()&&TS.ims.startImByMemberName("slackbot"),TS.experiment.loadUserAssignments().then(function(){E()}),TS.model.prefs.onboarding_cancelled?(c(TS.newxp.onboarding.cancel),$("#unskip_messaging > .take_tutorial_link").off("click.take_onboarding").on("click.take_onboarding",d),$("#end_display_onboarding").removeClass("hidden")):(TS.model.seen_onboarding_this_session=!0,s=!TS.client.ui.$banner.hasClass("hidden"),c(TS.newxp.onboarding.loading),d())))},cancelOnboarding:function(){TS.newxp.shouldShowFirstWelcome()||$("#end_display_onboarding").addClass("hidden"),l()},getCurrentStepName:function(){return r},canIncludeInviteCTA:function(){return B()},test:function(){return{deferredCancel:l,startOnboarding:d,goToStep:c,getBaseSteps:u,getUserSteps:m,composeUserOnboarding:h,composeCancelOnboarding:p,acceptIMMessage:f,isSlackbot:S,onSkipOrStop:T,restartOnGo:v,waitAllOrCancel:b,enableScrollFadeOut:w,disableScrollFadeOut:y,addClickTickStarburst:k,removeClickTickStarburst:A,addClickTickInteractions:C,removeClickTickInteractions:M,shouldDirectToSlackbotForOnboarding:x}}});var e=!1,t=null,n=null,i=null,a=!1,s=!1,r="",o=!1,l=function(){n?(n.finally(function(){n.isCancelled()&&i&&i.cancel()}),n.cancel()):i&&i.cancel()},d=function(){l(),TS.model.ui_state.flex_visible&&TS.client.ui.flex.hideFlex(),TS.model.prefs.onboarding_cancelled&&TS.prefs.setPrefByAPI({name:"onboarding_cancelled",value:!1}),TS.prefs.onPrefChanged({name:"onboarding_cancelled",value:!1}),w(),n=h(),i=p(),TS.model.user.is_restricted||t||(t=g()),$("#end_display_onboarding").removeClass("hidden")},c=function(e){r=e.step_name,$(e.show).removeClass("hidden"),$(e.hide).addClass("hidden"),$(e.style).addClass("onboarding"),$(e.unstyle).removeClass("onboarding"),TS.ui.admin_invites.canInvite()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26?($(e.hide_admin).addClass("hidden"),$(e.show_admin).removeClass("hidden")):($(e.hide_member).addClass("hidden"),$(e.show_member).removeClass("hidden")),TS.clog.track("GROWTH_ONBOARDING",{action:"enter_step",step:r})},u=function(){var e=["start","slackbot","channels","direct_messages","complete"];return TS.ui.admin_invites.canInvite()&&TS.members.getActiveMembersWithSelfAndNotSlackbot().length<26&&e.splice(4,0,"invites"),e},m=function(){return u().filter(function(e){return!TS.model.prefs[TS.newxp.onboarding[e].pref_name]})},h=function(){return e=!0,TS.experiment.loadUserAssignments().then(function(){var t;return m().forEach(function(e){t=t?t.then(TS.newxp.onboarding[e].promiseTo):TS.newxp.onboarding[e].promiseTo()}),t?(n||TS.client.ui.$banner.addClass("hidden"),TS.ui.banner.close(),t.finally(function(){e=!1,s&&(TS.ui.banner.show(),TS.client.ui.$banner.removeClass("hidden")),t.isCancelled()||(TS.model.seen_welcome_2=!0,$("#end_display_onboarding").addClass("hidden"),TS.client.msg_pane.updateEndMarker(),y())})):e=!1,t})},p=function(){return TS.newxp.onboarding.cancel.promiseTo()},g=function(){var e=["recent_mentions","starred_items"].filter(function(e){return!TS.model.prefs[TS.newxp.onboarding[e].pref_name]}).map(function(e){return TS.newxp.onboarding[e].promiseTo()});return b(e)},f=function(e,t){return e.id==TS.model.active_im_id&&TS.members.getMemberById(e.user).is_slackbot&&t&&TS.members.getMemberById(t.user).is_self},S=function(e,t){return e&&t&&e.user==t.user&&TS.members.getMemberById(e.user).is_slackbot},T=function(e,t){S(e,t)&&-1!=t.text.indexOf("Okay, we can skip this conversation")&&l()},v=function e(t,n){S(t,n)&&-1!=n.text.indexOf("Lovely, where were we? Ah, yes...")&&(TS.ims.message_received_sig.remove(e,TS.newxp),TS.model.prefs.onboarding_cancelled&&TS.newxp.shouldShowFirstWelcome()&&(d(),a=!0))},b=function(e){return Promise.all(e).then(_.noop,function(){e.forEach(function(e){e.cancel()})})},w=function(){var e=$("#onboarding_fade_out_mask").removeClass("hidden");TS.client.ui.$msgs_scroller_div.on("scroll.onboarding",function(){TS.client.ui.$msgs_scroller_div[0].scrollTop>300?e.hasClass("hidden")||e.addClass("hidden"):e.hasClass("hidden")&&e.removeClass("hidden")})},y=function(){TS.client.ui.$msgs_scroller_div.off("scroll.onboarding"),$("#onboarding_fade_out_mask").addClass("hidden")},k=function(e){e.append($("<div class='starburst_wrapper'><span class='starburst'></span></div>"))},A=function(e){e.find("> .starburst_wrapper").remove()},C=function(e,t,n,i,a){t=t||$(),n=n||$(),a=a||t,i=i||n,t.on("mouseenter.onboarding",function(){a.hasClass("onboarding")||(n.css("opacity",1),e&&e())}).on("mouseleave.onboarding",function(){t.hasClass("onboarding")||TS.coachmark.is_showing&&TS.coachmark.is_small&&(TS.coachmark.end(),n.css("opacity",0))}).addClass("jquery_hover"),i!=n&&i.css("height",t.outerHeight(!0)).css("width",t.outerWidth(!0)),i.on("click.onboarding",function(e){e&&e.stopPropagation(),TS.coachmark.expand()})},M=function(e,t,n){t=t||$(),n=n||t,e.off("mouseenter.onboarding mouseleave.onboarding").removeClass("jquery_hover"),n.off("click.onboarding")},x=function(){return!TS.newxp.shouldShowFirstWelcome()&&!TS.model.prefs.onboarding_cancelled},I=function(){var e=TS.newxp.shouldShowFirstWelcome();(!e&&(TS.model.prefs.onboarding_cancelled||TS.model.prefs.seen_onboarding_start)||e&&(TS.model.prefs.onboarding_cancelled||TS.model.prefs.seen_onboarding_start)&&!TS.model.seen_onboarding_this_session)&&(TS.model.seen_welcome_2=!0,TS.client.msg_pane.updateEndMarker())},E=function(){var e={complete:{show:".coachmark_got_it"},invites:{show:".coachmark_got_it"}};_.forOwn(e,function(e,t){_.each(_.keys(e),function(n){TS.newxp.onboarding[t][n]+=", "+e[n]})}),"invite_cm_invite_people"===TS.experiment.getGroup("update_invite_coachmarks_cta")&&(o=!0)},B=function(){return o}}()},2510:function(e,t){!function(){"use strict";TS.registerModule("search.autocomplete",{last_input_blur_logged:"",input_events:{},onStart:function(){TS.search.search_dispatched_sig.add(TS.search.autocomplete.startSpinner,TS.search.autocomplete),TS.search.all_search_results_fetched_sig.add(h),TS.search.message_search_results_fetched_sig.add(U),TS.search.file_search_results_fetched_sig.add(L),TS.client&&(TS.search.search_channel_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete),TS.search.search_group_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete),TS.search.search_member_set_sig.add(TS.search.autocomplete.updateInput,TS.search.autocomplete),TS.client.flexpane_display_switched_sig.add(Q),TS.boot_data.feature_texty_search||TS.client.login_sig.add(function(){TS.utility.contenteditable.isEmpty(e,!0)||TS.search.autocomplete.setUpMenu()})),TS.web&&TS.search.quick_search_results_fetched_sig.add(TS.search.autocomplete.stopSpinner,TS.search.autocomplete),TS.search.autosuggest_search_results_fetched_sig.add(m),TS.search.autocomplete.bindUI(),u()},search:function(n,i){TS.boot_data.feature_texty_search||H("preventMenuOnNextFocus"),TS.utility.contenteditable.value(e,n),TS.utility.contenteditable.focus(e),TS.boot_data.feature_texty_search||e.removeClass("placeholder"),i&&t.submit()},bindUI:function(){t=$("#header_search_form"),n=$("#search_container"),e=$("#search_terms"),TS.boot_data.feature_texty_search||e.one("focus",TS.search.autocomplete.setUpMenu),TS.search.autocomplete.bindForm()},setUpMenu:_.once(function(){var t=w();TS.boot_data.feature_texty_search?e.autocomplete({append_to:"#header_search_form",data:t,registerInputEvents:function(e){TS.search.autocomplete.input_events=e}}):(e.highlighter({modifiers:t.modifiers}),e.autocomplete({append_to:"#header_search_form",data:t}))}),triggerInputEvent:function(e,t){if(e)return _.isFunction(TS.search.autocomplete.input_events[e])?void TS.search.autocomplete.input_events[e](t):void TS.warn('TS.search.autocomplete: input event "'+e+'" not found')},onInputFocus:function(){TS.utility.contenteditable.isEmpty(e,!0)||("search"!==TS.model.ui_state.flex_name&&H("preventMenuOnNextFocus"),TS.search.searchSessionExpired()?TS.search.view.maybeResetSearch():(TS.search.view.showResults(),TS.search.view.maybeRebuildResults())),TS.boot_data.feature_texty_search||TS.utility.contenteditable.setCursorAtEnd(e)},bindForm:function(){var n,i=$("#client-ui"),a=!1,s=!1,r=!1;TS.client&&(t.bind("submit",function(){return n=!TS.utility.contenteditable.isEmpty(e,!0),n&&(d(!0),TS.boot_data.feature_texty_search||e.trigger("change")),!1}),TS.boot_data.feature_texty_search||e.bind("focus",TS.search.autocomplete.onInputFocus)),i.on("transitionend",function(){a===s&&TS.model.ui_state.flex_visible===r||(s=a,r=TS.model.ui_state.flex_visible,u())}),$("#search_clear").bind("click.clear_input",function(){TS.search.autocomplete.clearInput()}).bind("mousedown.clear_input",function(e){e.preventDefault()}),TS.boot_data.feature_texty_search||(e.bind("focus.set_cursor",function(){e.setCursorPosition(e.val().length)}),e.bind("keyup change focus blur",function(){$(this).val()?t.addClass("active"):t.removeClass("active")}),e.bind("focus",function(){i.addClass("search_focused"),a=!0}).bind("blur",function(){i.removeClass("search_focused"),a=!1}),e.hover(function(){i.addClass("search_hover")},function(){i.removeClass("search_hover")}))},maybeLogSearchInputBlur:function(){var e=TS.search.last_search_query;e&&TS.search.autocomplete.last_input_blur_logged!=e&&(TS.search.autocomplete.last_input_blur_logged=e,TS.search.saveSearch({terms:e}))},clearInput:function(){c(),TS.utility.contenteditable.clear(e),TS.boot_data.feature_texty_search||e.trigger("change"),H("hide"),H("preventMenuOnNextFocus"),TS.utility.contenteditable.focus(e)},updateInput:function(){TS.search.query&&(TS.utility.contenteditable.value(e,TS.search.query_string),TS.boot_data.feature_texty_search||e.trigger("change"))},startSpinner:function(){clearTimeout(a),a=setTimeout(function(){if(!$("#search_spinner").length){t.find(".icon_search").addClass("hidden");var e=$("#header_search_form .icon_search"),n=TS.templates.loading_indicator({id:"search_spinner"});e.after(n)}},200)},stopSpinner:function(){clearTimeout(a),$("#search_spinner").remove(),t.find(".icon_search").removeClass("hidden"),i&&i.stop()}});var e,t,n,i,a,s,r,o,l="",d=function(t){c();var n=TS.utility.contenteditable.value(e).trim();if(t||n!==TS.search.query)return l===n?void TS.search.view.showResults():void(""===n?"files"===TS.search.filter&&TS.search.view.switchBackToFiles():(n.length>=2||t)&&(l=n,TS.search.searchAll(n)))},c=function(){clearTimeout(TS.search.autocomplete.key_tim)},u=_.throttle(function(){n&&TSSSB.call("updateNoDragRegion",{id:"search",width:n.outerWidth(),height:n.outerHeight(),top:n.offset().top,left:n.offset().left})},250),m=function(e,t){var n=t.query,i=e.suggestions,a=s;a&&a(n,i)},h=function(){l=null,TS.search.autocomplete.stopSpinner()},p=[TS.i18n.t("monday","search_menu")(),TS.i18n.t("tuesday","search_menu")(),TS.i18n.t("wednesday","search_menu")(),TS.i18n.t("thursday","search_menu")(),TS.i18n.t("friday","search_menu")(),TS.i18n.t("saturday","search_menu")(),TS.i18n.t("sunday","search_menu")(),TS.i18n.t("yesterday","search_menu")(),"monday","tuesday","wednesday","thursday","friday","saturday","sunday","yesterday"],g=[TS.i18n.t("january","search_menu")(),TS.i18n.t("february","search_menu")(),TS.i18n.t("march","search_menu")(),TS.i18n.t("april","search_menu")(),TS.i18n.t("may","search_menu")(),TS.i18n.t("june","search_menu")(),TS.i18n.t("july","search_menu")(),TS.i18n.t("august","search_menu")(),TS.i18n.t("september","search_menu")(),TS.i18n.t("october","search_menu")(),TS.i18n.t("november","search_menu")(),TS.i18n.t("december","search_menu")(),"january","february","march","april","may","june","july","august","september","october","november","december"],f=[TS.i18n.t("today","search_menu")(),TS.i18n.t("week","search_menu")(),TS.i18n.t("month","search_menu")(),TS.i18n.t("year","search_menu")(),"today","week","month","year"],S=p.concat(f,g),T=function(e){return R(e)},v=function(e){return R(e,!0)},b=[{modifier:"after:",name:TS.i18n.t("after:","search")(),keywords:p.concat(g),dynamic_keywords:[T],keyword_placeholder:TS.i18n.t("a date","search")()},{modifier:"before:",name:TS.i18n.t("before:","search")(),keywords:S,dynamic_keywords:[v],keyword_placeholder:TS.i18n.t("a date","search")()},{modifier:"during:",name:TS.i18n.t("during:","search")(),keywords:S,dynamic_keywords:[T],keyword_placeholder:TS.i18n.t("a month or year","search")()},{modifier:"from:",name:TS.i18n.t("from:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("team member","search")()},{modifier:"to:",name:TS.i18n.t("to:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("a channel, group or direct message","search")()},{modifier:"has:",name:TS.i18n.t("has:","search")(),keywords:[TS.i18n.t("star","search")(),TS.i18n.t("link","search")(),TS.i18n.t("reaction","search")()],keyword_placeholder:TS.i18n.t("star, link, or reaction","search")()},{modifier:"in:",name:TS.i18n.t("in:","search")(),keywords:[TS.i18n.t("me","search")()],keyword_placeholder:TS.i18n.t("a channel, group or direct message","search")()},{modifier:"on:",name:TS.i18n.t("on:","search")(),keywords:S,dynamic_keywords:[T],keyword_placeholder:TS.i18n.t("a date","search")()}],w=function(){return r||(r={modifiers:b,modifiers_by_name:{},users:function(){return TS.members.getMembersForUser()},usersStarred:function(){var e,t=[];return TS.model.ims.forEach(function(n){!n.is_slackbot_im&&n.is_open&&(!(e=TS.members.getMemberById(n.user))||e.deleted||e.is_self||n.is_starred&&t.push(n))}),t.sort(y),t.map(function(e){return TS.members.getMemberById(e.user)})},usersOpen:function(){var e,t=[];return TS.model.ims.forEach(function(n){!n.is_slackbot_im&&n.is_open&&(!(e=TS.members.getMemberById(n.user))||e.deleted||e.is_self||n.is_starred||t.push(n))}),t.sort(y),t.map(function(e){return TS.members.getMemberById(e.user)})},channels:function(){return TS.channels.getChannelsForUser()},channelsOpen:function(){var e,t,n=TS.channels.getChannelsForUser(),i=[];for(e=0;e<n.length;e+=1)t=n[e],t.is_starred||t.is_archived||t.is_member&&i.push(t);return i.sort(k),i},groups:function(){return TS.model.groups},groupsOpen:function(){var e,t,n=TS.model.groups,i=[];for(t=0;t<n.length;t+=1)e=n[t],e.is_archived||e.is_starred||i.push(e);return i.sort(k),i},conversationsStarred:function(){var e=[],t=r.usersStarred(),n=[];TS.channels.getChannelsForUser().forEach(function(t){!t.is_archived&&t.is_starred&&t.is_member&&e.push(t)}),TS.model.groups.forEach(function(e){!e.is_archived&&e.is_starred&&n.push(e)});var i=e.concat(t,n);return i.sort(TS.client.channel_pane.modelObSortByStarredOrder),i},history:function(e,t){e=e||"",s=t,TS.search.searchSuggest(e)},deleteHistoryItem:function(e){TS.api.call("search.delete",{terms:e})},triggerSearch:function(){d(!0)},triggerDelayedSearch:function(e){TS.search.autocomplete.key_tim=setTimeout(function(){d()},e||3e3)},cancelSearch:function(){c()},openProfile:function(e){TS.client.ui.previewMember(e)},openBotProfile:function(e,t){TS.apps.promiseToGetFullAppProfile(e,t).then(function(n){TS.client.ui.app_profile.openWithApp(n,e,t)})}},r.modifiers.forEach(function(e){if(e.keyword_testers=[],e.keywords.length>0){var t=new RegExp("^("+e.keywords.join("|")+")$","i");e.keyword_testers=[function(e){return t.test(e)}]}switch(e.modifier){case"from:":e.keyword_testers.push(A),e.keyword_testers.push(x);break;case"before:":e.keyword_testers.push(function(e){return R(e,!0)});break;case"after:":case"during:":case"on:":e.keyword_testers.push(R);break;case"in:":case"to:":e.keyword_testers.push(A),e.keyword_testers.push(C),e.keyword_testers.push(M),e.keyword_testers.push(I),e.keyword_placeholder=TS.i18n.t("channel or direct message","search")()}r.modifiers_by_name[e.modifier]=e,r.modifiers_by_name[e.name]=e})),r},y=function(e,t){var n=TS.ims.getDisplayNameOfUserForImLowerCase(e),i=TS.ims.getDisplayNameOfUserForImLowerCase(t);return n>i?1:i>n?-1:0},k=function(e,t){var n=e._name_lc,i=t._name_lc;return n<i?-1:n>i?1:0},A=function(e){return"@"===e.charAt(0)&&(e=e.substring(1)),TS.members.getMemberByName(e)},C=function(e){return"#"===e.charAt(0)&&(e=e.substring(1)),TS.channels.getChannelByName(e)},M=function(e){return TS.groups.getGroupByName(e)},x=function(e){var t=E().name_map;return e=_.toLower(e),t[e]},I=function(e){if(-1===e.indexOf(","))return!1;var t=e.split(",");return _.every(t,function(e){return"@"===e.charAt("0")&&(e=e.substring(1)),!!TS.members.getMemberByName(e)})},E=function(){if(TS.lazyLoadMembersAndBots&&TS.lazyLoadMembersAndBots(),Date.now()-0>3e4){var e={},t=[];TS.model.bots.forEach(function(n){var i=_.toLower(n.name);n.deleted||e[i]||"slackbot"===i||(e[i]=!0,t.push(n))}),o={bots:t,name_map:e}}return o},B=/^(\d\d?)[-\/](\d\d?)[-\/](\d\d\d\d)$/,D=/^(\d\d\d\d)[-\/](\d\d?)[-\/](\d\d?)$/,F=/^(\d\d)[-\/](\d\d?)[-\/](\d\d?)$/,P=/^\d\d\d\d$/,O=/^(\d\d\d\d)[-\/](\d\d?)$/,R=function(e,t){var n,i,a,s,r=new Date;if(P.test(e))return n=parseInt(e,10),!(!t&&n>r.getFullYear())&&(!(n<1900)&&!(t&&n>2999));if(s=B.exec(e),s&&(n=s[3],i=s[1],a=s[2]),s=!n&&D.exec(e),s&&(n=s[1],i=s[2],a=s[3]),s=!n&&F.exec(e),s&&(n=s[1],i=s[2],a=s[3]),s=!n&&O.exec(e),s&&(n=s[1],i=s[2],a="1"),!n)return!1;if(n=parseInt(n,10),i=parseInt(i,10),a=parseInt(a,10),n<1||i<1||a<1)return!1;if(n<100&&(n+=2e3),!t&&n>r.getFullYear())return!1;if(n<1900)return!1;if(t&&n>2999)return!1;if(i>12)return!1;if(!t&&n===r.getFullYear()&&i>r.getMonth()+1)return!1;if(a>31)return!1;if(!t&&n===r.getFullYear()&&i===r.getMonth()+1&&a>r.getDate())return!1;if(a>30&&(4===i||6===i||9===i||11===i))return!1;if(2===i&&a>29)return!1;if(2===i&&29===a){if(n%4!=0)return!1;if(n%100!=0)return!0;if(n%400!=0)return!1}return!0},U=function(){"messages"===TS.search.filter&&TS.search.autocomplete.stopSpinner()},L=function(){"files"===TS.search.filter&&TS.search.autocomplete.stopSpinner()},Q=function(){TS.model.ui_state.flex_visible&&"search"===TS.model.ui_state.flex_name||c()},H=function(){TS.search.autocomplete.setUpMenu(),e.autocomplete.apply(e,arguments)}}()},2512:function(e,t){!function(){"use strict";TS.registerModule("search.view",{latest_msg_search_results:null,added_to_history_last_ms:0,search_results_lazy_load:null,last_terms:"",filter_delay_ms:6e4,onStart:function(){if(TS.search.search_filter_set_sig.add(TS.search.view.renderResults,TS.search.view),TS.search.search_filetype_filter_set_sig.add(TS.search.searchAll,TS.search),TS.search.search_sort_set_sig.add(r),TS.prefs.messages_theme_changed_sig.add(TS.search.view.messagesThemeChanged,TS.search.view),TS.search.message_search_results_fetched_sig.add(a),TS.search.file_search_results_fetched_sig.add(s),TS.client){if($("#flexpane_tabs a").bind("click.setSearchFilter",function(){"files"===$(this).data("tab-id")||$(this).data("filetype")?TS.search.setFilter("files"):TS.search.setFilter("messages")}),$("#search_results_items").bind("click.view",function(e){0!==$(e.target).closest("A").length&&1==$(e.target).closest(".file_list_item").length&&TS.search.view.maybeLogSearchInteraction("files")}),$("#search_tabs").html(TS.templates.search_tabs({messages_count:0,files_count:0})),$("#search_clear").bind("click.switch_to_files",function(){"files"===TS.search.filter&&TS.model.ui_state.flex_visible&&setTimeout(function(){TS.search.view.switchBackToFiles()},50)}),$("#search_results").scroll(function(){i(),TS.menu.search_filter_is_showing&&TS.menu.end()}),!TS.boot_data.feature_texty_search){var e=$("#search_terms");e.on("click",function(){TS.search.view.searchIsVisible()||e.select()}),e.on("keyup",function(t){t.which==TS.utility.keymap.esc&&e.blur()}),e.on("blur",TS.search.autocomplete.maybeLogSearchInputBlur)}TS.client.login_sig.add(TS.search.view.loggedIn,TS.search.view)}TS.web&&(TS.web.login_sig.add(TS.search.view.loggedIn,TS.search.view),TS.search.all_search_results_fetched_sig.add(TS.search.view.updateHistory,TS.search.view),TS.search.search_filter_set_sig.add(TS.search.view.updateHistory,TS.search.view),$(window).bind("popstate",function(e){TS.search.view.onPopState(e.originalEvent)}))},loggedIn:function(){TS.client&&("timestamp"===TS.search.sort?$("#search_sort_timestamp").addClass("active"):"model"===TS.search.sort&&$("#search_sort_model").length?$("#search_sort_model").addClass("active"):$("#search_sort_score").addClass("active")),TS.web&&(TS.boot_data.filter&&TS.search.setFilter(TS.boot_data.filter),TS.boot_data.query&&(TS.search.query=TS.search.truncateQuery(TS.boot_data.query),TS.search.searchAll(TS.search.query)))},pageMessagesForward:function(){var e=TS.search.results[TS.search.query_string];!e.messages||TS.search.view.current_messages_page+1>e.messages.paging.pages||(TS.search.view.current_messages_page+=1,TS.search.view.renderResults(),TS.search.separateMessagesAndFiles()&&TS.search.view.current_messages_page<=e.messages.paging.page||($("#search_results_team").addClass("hidden"),TS.search.view.current_messages_page<e.messages.paging.page||(TS.search.separateMessagesAndFiles()?TS.search.getNextPageOfMessageResults(TS.search.query_string,TS.search.view.current_messages_page):TS.search.getNextPageOfSearchResults(TS.search.query_string,TS.search.view.current_messages_page+1))))},pageMessagesBack:function(){TS.search.view.current_messages_page-1<1||(TS.search.view.current_messages_page-=1,TS.search.view.renderResults())},pageFilesForward:function(){var e=TS.search.results[TS.search.query_string];!e.files||TS.search.view.current_files_page+1>e.files.paging.pages||(TS.search.view.current_files_page+=1,TS.search.view.renderResults(),TS.search.separateMessagesAndFiles()&&TS.search.view.current_files_page<=e.files.paging.page||($("#search_results_team").addClass("hidden"),TS.search.view.current_files_page<e.files.paging.page||(TS.search.separateMessagesAndFiles()?TS.search.getNextPageOfFileResults(TS.search.query_string,TS.search.view.current_files_page):TS.search.getNextPageOfSearchResults(TS.search.query_string,TS.search.view.current_files_page+1))))},pageFilesBack:function(){TS.search.view.current_files_page-1<1||(TS.search.view.current_files_page-=1,TS.search.view.renderResults())},searchFetched:function(e,t){1==t.page?(TS.search.view.current_messages_page=1,TS.search.view.current_files_page=1,TS.search.view.waiting_on_page=-1,TS.search.view.renderResults(),TS.search.view.messageSearchResultsFetched(e,t),TS.search.view.searchMembers()):t.page==TS.search.view.waiting_on_page&&TS.search.view.renderResults()},waiting_on_page:-1,waiting_on_messages_page:-1,waiting_on_files_page:-1,current_messages_page:1,current_files_page:1,renderResults:function(i){if(!n&&(i&&(e=null),TS.search.view.updateOptions(),TS.search.results[TS.search.query_string])){var a,s=TS.search.results[TS.search.query_string],r="",l=[],d=!1,c=!1,u=TS.i18n.t("Loading","search")();if("messages"===TS.search.filter){if(s.messages&&s.messages.matches){var m=s.messages.pages[TS.search.view.current_messages_page-1];m&&(l=s.messages.matches.slice(m.start,m.start+m.count))}if(l.length||(TS.search.separateMessagesAndFiles()?TS.search.view.waiting_on_messages_page=TS.search.view.current_messages_page:TS.search.view.waiting_on_page=TS.search.view.current_messages_page),c=_.get(s,"modules.experts")&&TS.sli_expert_search&&TS.sli_expert_search.isEnabled()&&1==TS.search.view.current_messages_page,c&&(r+=TS.sli_expert_search.render(TS.search.query,s.modules.experts,s.modules.channels)),d="timestamp"===TS.search.sort&&s.messages.modules&&s.messages.modules.score&&s.messages.modules.score.top_results&&1==TS.search.view.current_messages_page){var h=s.messages.modules.score.debug||{};r+=TS.templates.search_top_results_message_results({results:s.messages.modules.score.top_results,page:s.messages.modules.score.top_results,module_name:"score_top_results",module_order:s.messages.modules.score.order,show_feedback:s.show_feedback,for_search_display:!0,debug:h})}if((d||c)&&(r+='<div class="search_module_header"><p><span>'+TS.i18n.t("All Results","search")()+"</span></p></div>"),l.length)r+=TS.templates.search_message_results({results:s,page:l,current_page:TS.search.view.current_messages_page,paging_html:s.messages?new Handlebars.SafeString(TS.templates.messages_search_paging({current_page:TS.search.view.current_messages_page,pages:s.messages.paging.pages})):"",module_order:s.messages.order||0,is_enterprise:TS.boot_data.page_needs_enterprise,search_global:!TS.model.prefs.search_only_current_team,show_feedback:s.show_feedback});else if(!s.messages||s.messages.total>0){var p=TS.i18n.t("loading page {page_num}...","search")({page_num:TS.search.view.current_messages_page});r+='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+u+'" /><br />'+p+"</div>"}else r=TS.templates.search_results_none({query_string:TS.emoji.maybeGetLocalizedEmojiString(TS.search.query_string),filter:"messages",error:s.error});if(TS.boot_data.team_limit_ts>0){var g=TS.experiment.getGroup("search_pane_msg_lim_copy");"control"===g?$("#search_results_message_limit").removeClass("hidden"):"free_plan_learn_more"===g?$("#search_results_message_limit_learn_more").removeClass("hidden"):"free_plan_see_pricing_plans"===g?$("#search_results_message_limit_see_pricing_plans").removeClass("hidden"):$("#search_results_message_limit").removeClass("hidden"),$("#search_results_team").addClass("no_margin"),TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"search_pane",action:"impression",ui_element:"message_search_link_top"}}})}$("#search_results_file_limit").addClass("hidden")}else if("files"===TS.search.filter){if($("#search_tabs").slideDown(500),a=(TS.search.view.current_files_page-1)*TS.search.per_page,s.files&&s.files.matches&&(l=s.files.matches.slice(a,a+TS.search.per_page)),l.length||(TS.search.separateMessagesAndFiles()?TS.search.view.waiting_on_files_page=TS.search.view.current_files_page:TS.search.view.waiting_on_page=TS.search.view.current_files_page),l.length){var f=TS.templates.files_search_paging({current_page:TS.search.view.current_files_page,pages:s.files.paging.pages}),S={for_search:!0,is_enterprise:TS.boot_data.page_needs_enterprise};$.each(l,function(e,t){r+=TS.templates.builders.fileHTML(t,S)}),r+=f}else if(!s.files||s.files.total>0){var T=TS.i18n.t("loading page {page_num}...","search")({page_num:TS.search.view.current_files_page});r+='<div class="loading_hash_animation"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="'+u+'" /><br />'+T+"</div>"}else r+=TS.templates.search_results_none({query_string:TS.emoji.maybeGetLocalizedEmojiString(TS.search.query_string),filter:"files",error:s.error,filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype]});$("#search_results_file_limit").removeClass("hidden"),$("#search_results_message_limit").addClass("hidden"),$("#search_results_message_limit_learn_more").addClass("hidden"),$("#search_results_message_limit_see_pricing_plans").addClass("hidden")}if($("#search_results_items").find(".search_jump_maybe").tooltip("destroy"),$("#search_results_items").html(r),TS.view?TS.utility.makeSureAllLinksHaveTargets($("#search_results_items")):TS.utility.makeSureAllExternalLinksAreRefererSafe($("#search_results_items")),$("#search_results_items").find(".search_jump_maybe").tooltip({delay:{show:450,hide:150},container:"body",placement:"left"}),TS.client){try{n=!0,TS.search.view.showResults()}finally{n=!1}$("#search_results").scrollTop(0),TS.client.ui.checkInlineImgsAndIframes("search")}TS.search.view.search_results_lazy_load&&TS.search.view.search_results_lazy_load.detachEvents&&TS.search.view.search_results_lazy_load.detachEvents(),$("#search_results_container").find(".lazy").lazyload({container:$("#search_results"),throttle:200}),"messages"===TS.search.filter?(o(s),e&&$("#search_results").scrollTop(e)):t&&$("#search_results").scrollTop(t)}},showResults:function(){var e=TS.model.ui.active_tab_id,t=TS.model.previewed_file_id;TS.model.ui_state.flex_visible&&"search"===TS.model.ui_state.flex_name||TS.client.ui.flex.openFlexTab("search"),TS.clog.track("SEARCH_OPEN",{open_method:"search_box",click_module_name:TS.search.filter,click_module_position:0,request_id:"messages"===TS.search.filter?TS.search.last_request_id:TS.search.last_files_request_id}),"messages"===TS.search.filter?($("#search_tabs").show(),$(".search_sort_container").show()):"files"===TS.search.filter&&($("#search_tabs").slideDown(500),$(".search_sort_container").hide(),"files"!==e||t||TS.model.active_file_list_filter===TS.search.filetype||TS.search.setFiletypeFilter(TS.model.active_file_list_filter))},maybeRebuildResults:function(){var e=$("#search_message_results");e.length&&e.children().length||TS.search.search_filter_set_sig.dispatch()},cleanResults:function(){TS.search.view.search_results_lazy_load&&TS.search.view.search_results_lazy_load.detachEvents&&TS.search.view.search_results_lazy_load.detachEvents(),$("#search_results_team").empty(),$("#search_results_items").empty()},clearFiletypeFilter:function(){TS.search.setFiletypeFilter("all")},maybeResetSearch:function(){TS.search.view.searchIsVisible()||TS.search.setSort("timestamp",!0)},searchIsVisible:function(){return TS.model.ui_state.flex_visible&&"search"===TS.model.ui_state.flex_name},updateOptions:function(){var e={search_filter:TS.search.filter,sort_filter:TS.search.sort,search_only_my_channels:TS.model.prefs.search_only_my_channels,menu_is_showing:TS.menu.search_filter_is_showing},t=TS.search.results[TS.search.query_string],n=TS.i18n.t("everything","search")(),i=TS.model.prefs.search_only_my_channels,a=TS.model.prefs.search_exclude_bots,s=TS.model.prefs.search_only_current_team,r=!1;t&&t.ignored_exclude_bots_pref&&t.messages&&t.messages.total>0&&(r=!0);var o="";if(r){var l=m(TS.search.query_string);o=TS.i18n.listify(l)}var d="messages"===TS.search.filter?"messages":"files";if(i&&a?n=r?"messages"===d?TS.i18n.t("only channels I have joined, messages from {names}","search")({names:o}):TS.i18n.t("only channels I have joined, files from {names}","search")({names:o}):TS.i18n.t("only channels I have joined, no bots or integrations","search")():i&&!a?n="messages"===d?TS.i18n.t("only messages from channels I have open","search")():TS.i18n.t("only files from channels I have open","search")():!i&&a&&(n=r?"messages"===d?TS.i18n.t("messages from {names}","search")({names:o}):TS.i18n.t("files from {names}","search")({names:o}):"messages"===d?TS.i18n.t("only messages from people","search")():TS.i18n.t("only files from people","search")),TS.boot_data.page_needs_enterprise){var c=TS.model.enterprise.name,_={org_bots_allchannels:TS.i18n.t("everything I can access in {org_name}","search")({org_name:c}),org_bots_openchannels:TS.i18n.t("only messages from channels I have open in {org_name}","search")({org_name:c}),org_nobots_allchannels:TS.i18n.t("only messages from people in {org_name}","search")({org_name:c}),org_nobots_openchannels:TS.i18n.t("messages from people in all channels I have open in {org_name}","search")({org_name:c}),noorg_bots_allchannels:TS.i18n.t("everything on this team","search")(),noorg_bots_openchannels:TS.i18n.t("only messages from channels I have open on this team","search")(),noorg_nobots_allchannels:TS.i18n.t("only messages from people on this team","search")(),noorg_nobots_openchannels:TS.i18n.t("messages from people, in only channels I have open, on this team","search")()};s||i||a?s||!i||a?s||i||!a?!s&&i&&a?n=_.org_nobots_openchannels:!s||i||a?s&&i&&!a?n=_.noorg_bots_openchannels:s&&!i&&a?n=_.noorg_nobots_allchannels:s&&i&&a&&(n=_.noorg_nobots_openchannels):n=_.noorg_bots_allchannels:n=_.org_nobots_allchannels:n=_.org_bots_openchannels:n=_.org_bots_allchannels}e.include_text=n;var u=TS.templates.search_options(e);if($("#search_options").html(u),TS.search.results[TS.search.query_string]){var h=t&&t.initial_messages_total?t.initial_messages_total:0,p=t&&t.initial_files_total?t.initial_files_total:0;$("#search_tabs").html(TS.templates.search_tabs({messages_count:TS.i18n.number(h),files_count:TS.i18n.number(p)}))}"files"===TS.search.filter?($("#search_heading").html(TS.templates.search_files_heading({filetype:TS.search.filetype,filetype_label:TS.model.file_list_type_map[TS.search.filetype]})),$("#search_file_list_heading").bind("click.show_menu",function(e){e.preventDefault(),TS.menu.file.startWithFileFilter(e,!0)}),$("#search_file_list_clear_filter").bind("click.clear_filter",function(e){e.stopPropagation(),TS.search.view.clearFiletypeFilter()})):$("#search_heading").html(TS.i18n.t("Search Results","search")()),$(".search_filter_menu_target").click(TS.menu.startWithSearchFilter)},switchBackToFiles:function(){if(TS.search.results[TS.search.query_string]){(Date.now()-TS.search.results[TS.search.query_string]._time_of_search)/1e3<60?(TS.client.ui.files.filterFileList(TS.search.filetype),TS.search.member?TS.client.ui.files.toggleFileList(TS.search.member.id):TS.client.ui.files.toggleFileList("all")):(TS.client.ui.files.filterFileList("all"),TS.client.ui.files.toggleFileList("all"))}$("#search_tabs").slideUp(250,function(){setTimeout(function(){TS.client.ui.files.showFileList()},100)})},searchMembers:function(){var e=TS.search.query_string,t=$("#search_results_team"),n=new RegExp("\\b"+TS.utility.regexpEscape(e)+"\\b","i");t.removeClass("hidden");var i=e.toLowerCase(),a=TS.members.getMembersForUser(),s=$.grep(a,function(e){if(!e.deleted)return e._name_lc==i||e.profile.real_name_normalized&&n.test(e.profile.real_name_normalized)||e._real_name_lc&&e._real_name_lc==i});if(0===s.length){var r,o,l=/from:@?(\S+)/gi;do{if((r=l.exec(i))&&r.length>1)for(o=0;o<a.length;o+=1)if(!a[o].deleted&&a[o]._name_lc===r[1]){s.push(a[o]);break}}while(r)}s.length>0?t.html(TS.templates.search_team_results({matches:s})):t.empty()},updateHistory:function(){var e={filter:TS.search.filter,query:TS.search.query,channel_id:null,member_id:null};TS.search.channel&&(e.channel_id=TS.search.channel.id),TS.search.group&&(e.group_id=TS.search.group.id),TS.search.member&&(e.member_id=TS.search.member.id);var t="/search/";if(t+=TS.search.filter,t+="?q="+encodeURIComponent(TS.search.query_string),TS.qs_args)for(var n in TS.qs_args)TS.qs_args.hasOwnProperty(n)&&"q"!==n&&(t+="&"+n+"="+TS.qs_args[n]);t===window.location.pathname+window.location.search?window.history.replaceState(e,null,t):window.history.pushState(e,null,t)},onPopState:function(e){var t=e.state;t&&(t.filter&&TS.search.setFilter(t.filter),t.query&&(TS.search.query=t.query),t.channel_id?TS.search.channel=TS.channels.getChannelById(t.channel_id):TS.search.channel=null,t.group_id?TS.search.group=TS.groups.getGroupById(t.group_id):TS.search.group=null,t.member_id?TS.search.member=TS.members.getMemberById(t.member_id):TS.search.member=null,TS.search.searchAll(TS.search.query))},messageSearchResultsFetched:function(e,t){TS.search.view.latest_msg_search_results=e;var n=Date.now(),i=n-TS.search.view.added_to_history_last_ms,a=i<5e3;TS.search.view.added_to_history_last_ms=n,TS.client&&TS.client.flexDisplaySwitched("search",t.query,a)},search_interactions_logged:{},maybeLogSearchInteraction:function(e){var t=TS.search.last_search_query;t&&(TS.search.view.search_interactions_logged[e+"__"+t]||(TS.search.view.search_interactions_logged[e+"__"+t]=!0,TS.search.saveSearch({type:e,terms:t})))},messagesThemeChanged:function(){"search"===TS.model.ui_state.flex_name&&TS.search.view.renderResults()},msgHasExtracts:function(e){if(e.extracts&&e.extracts.length>0)return!0;var t;if(e.attachments)for(var n=0;n<e.attachments.length;n+=1)if(t=e.attachments[n],t.extracts&&Object.keys(t.extracts).length>0)return!0;return!1},resultHasExtracts:function(e){return TS.search.view.msgHasExtracts(e)||e.previous&&TS.search.view.msgHasExtracts(e.previous)||e.previous_2&&TS.search.view.msgHasExtracts(e.previous_2)||e.next&&TS.search.view.msgHasExtracts(e.next)||e.next_2&&TS.search.view.msgHasExtracts(e.next_2)},determineMessageResultType:function(e,t){return TS.search.view.msgHasExtracts(e[t])?"extract":t-1>=0&&TS.search.view.msgHasExtracts(e[t-1])?"context":t+1<e.length&&TS.search.view.msgHasExtracts(e[t+1])?"context":"extra"},getMatchForSearchResult:function(e){var t=e.closest(".search_message_result");if(!t.length)return null;var n=t.data("channel"),i=t.data("ts")+"";return"score_top_results"===t.data("module-name")?TS.search.getMatchByQueryAndChannelAndTsAndModule(!0,TS.search.view.latest_msg_search_results.query,n,i,"score"):TS.search.getMatchByQueryAndChannelAndTs(TS.search.view.latest_msg_search_results.query,n,i)},firstResultWithExtracts:function(e){return h(e)},toggleExtractsForMatch:function(e,t){var n=$(e.target),i=t.match,a=n.closest(".search_message_result"),s=a.data("module-name")||"",r=a.data("module-order")||0,o=n.closest("ts-message"),l=o.data("iid")||"",_={click_target_type:i.extracts_expanded?"collapse":"expand",click_position:t.index,click_user_id:i.user,click_channel_id:i.channel.id,click_timestamp:i.ts,click_module_name:s,click_module_position:r,click_sort:TS.search.sort},u=n.closest("ts-message");u.length&&(_.click_target_user_id=u.data("memberId"),_.click_target_timestamp=u.data("ts")+""),TS.search.last_request_id&&(_.request_id=TS.search.last_request_id),l&&(_.click_iid=l),TS.clog.track("SEARCH_CLICK",_),i.extracts_expanded?c(i,n.closest(".search_result_with_extract, .search_result_for_context, .search_result_for_extra_context")):d(i,n.closest(".search_result_with_extract, .search_result_for_context, .search_result_for_extra_context"))}});var e,t,n=!1,i=function(){"search"===TS.model.ui_state.flex_name&&(TS.client.ui.checkInlineImgsAndIframes("search"),"files"===TS.search.filter?t=$("#search_results").scrollTop():e=$("#search_results").scrollTop())};i=_.debounce(i,250);var a=function(t,n){e=null,1==n.page?(TS.search.view.current_messages_page=1,TS.search.view.waiting_on_messages_page=-1,"messages"===TS.search.filter?(TS.search.view.renderResults(),TS.search.view.messageSearchResultsFetched(t,n),TS.search.view.searchMembers()):TS.search.view.updateOptions()):n.page==TS.search.view.waiting_on_messages_page&&"messages"===TS.search.filter&&TS.search.view.renderResults()},s=function(e,n){t=null,1==n.page?(TS.search.view.current_files_page=1,TS.search.view.waiting_on_files_page=-1,"files"===TS.search.filter?(TS.search.view.renderResults(),TS.search.view.messageSearchResultsFetched(e,n),TS.search.view.searchMembers()):TS.search.view.updateOptions()):n.page==TS.search.view.waiting_on_files_page&&"files"===TS.search.filter&&TS.search.view.renderResults()},r=function(e){"timestamp"===TS.search.sort?($("#search_sort_timestamp").addClass("active"),$("#search_sort_score").removeClass("active"),$("#search_sort_score").removeClass("flash"),$("#search_sort_model").removeClass("active")):"model"===TS.search.sort&&"model"===TS.experiment.getGroup("search_ranking")?($("#search_sort_timestamp").removeClass("active"),$("#search_sort_score").removeClass("active"),$("#search_sort_score").removeClass("flash"),$("#search_sort_model").addClass("active")):($("#search_sort_timestamp").removeClass("active"),$("#search_sort_score").addClass(e?"active flash":"active"),$("#search_sort_model").removeClass("active"))},o=function(e){if(e.messages){var t=[];if(e.messages.matches.forEach(function(e){e._dom_id=TS.templates.makeMsgDomIdInSearch(e.ts,e),t.push(e),["previous_2","previous","next","next_2"].forEach(function(n){e[n]&&(e[n].channel=e.channel,e[n]._main=e,e[n]._dom_id=TS.templates.makeMsgDomIdInSearch(e[n].ts,e),t.push(e[n]))})}),_.has(e.messages,"modules.score.top_results")&&_.forEach(e.messages.modules.score.top_results,function(e){e._dom_id=TS.templates.makeMsgDomIdInSearchTopResults(e.ts,e,"sort_top_results"),e._dom_container_id="search_module_results",t.push(e)}),!TS.model.prefs.full_text_extracts){var n={};t.forEach(function(e){if(TS.boot_data.page_needs_enterprise){var i=TS.utility.msgs.allUnknownUsersInMessage(e);i.length&&i.forEach(function(t){n[t]||(n[t]=e)})}l(t,e,!1)}),_.keys(n).length&&TS.members.ensureMembersArePresent(_.keys(n)).then(function(){_.keys(n).forEach(function(e){var i=n[e];l(t,i,!0)})})}}},l=function(e,t,n){_.isUndefined(n)&&(n=!1);var i,a;if(TS.search.view.msgHasExtracts(t)){var s=t._dom_container_id?"#"+t._dom_container_id:"#search_message_results";t._main&&t._main.ts&&!t._dom_container_id&&(s+=' [data-ts="'+t._main.ts+'"]'),s+=" #"+t._dom_id,i=$(s),0!==i.length&&(a=TS.templates.search_message_extracts({message:t}),n?i.find(".message_body.extract_content").replaceWith(a):i.find(".message_body").before(a))}},d=function(e,t){e.extracts_expanded=!0;var n,i=t.closest(".search_message_result"),a=i.data("module-name");n="score_top_results"===a?$("#search_results_items").find("#"+TS.templates.makeMSRDomIdWithModule(e,a)):$("#search_results_items").find("#"+TS.templates.makeMSRDomId(e)),u(n,t)},c=function(e,t){e.extracts_expanded=!1;var n,i=t.closest(".search_message_result"),a=i.data("module-name");n="score_top_results"===a?$("#search_results_items").find("#"+TS.templates.makeMSRDomIdWithModule(e,a)):$("#search_results_items").find("#"+TS.templates.makeMSRDomId(e));u(n,t,!0)},u=function(e,t,n){TS.ui.utility.preventElementFromScrolling(t,function(){e.toggleClass("extracts_expanded",!n)})},m=function(e){var t,n,i=/from:@?(\S+)/gi,a=/bot:?(\S+)/gi,s=[];do{(t=i.exec(e))&&t.length>1&&s.push(t[1])}while(t);do{(n=a.exec(e))&&n.length>1&&s.push(n[1])}while(n);return s},h=function(e){for(var t,n=[e.previous_2,e.previous,e,e.next,e.next_2],i=0;i<n.length;i+=1)if((t=n[i])&&t.extracts&&t.extracts.length)return t;return e}}()},2534:function(e,t){!function(){"use strict";TS.registerModule("typing",{typing_self_lasts_ms:5e3,typing_lasts_ms:6e3,started_sig:new signals.Signal,ended_sig:new signals.Signal,map:{},onStart:function(){TS.useRedux()&&(e=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getTypingByKey),t=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getNumberOfRecords),n=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getTyperIdsInChannel),i=TS.redux.bindSingleArgSelectorToStore(TS.interop.redux.features.typing.getAllTyping))},test:function(){return{getNumberOfRecords:t}},maybeStartTimer:function(){a||(a=setInterval(TS.typing.checkMap,1e3))},userStarted:function(t){if(TS.model.ms_connected&&t){var n=TS.model.user,i=t.id+"_"+n.id;if(TS.useRedux()){if(e(i))return}else if(TS.typing.map[i])return;var a={type:"typing",channel:t.id};TS.isSocketManagerEnabled()?TS.interop.SocketManager.send(a):TS.ms.send(a),TS.typing.memberStarted(t,TS.model.user)}},memberStarted:function(t,n){var i=t.id+"_"+n.id,a=Date.now();if(TS.useRedux()){var r=!e(i),o=TS.interop.redux.features.typing.updateTyping({key:i,started:a,model_ob_id:t.id,member_id:n.id,member_is_self:n.is_self});TS.redux.dispatch(o),r?(TS.typing.started_sig.dispatch(t,n),TS.has_pri[s]&&TS.log(s,"added "+i)):TS.has_pri[s]&&TS.log(s,"updated "+i)}else TS.typing.map[i]?(TS.typing.map[i].started=a,TS.has_pri[s]&&TS.log(s,"updated "+i)):(TS.typing.map[i]={started:a,model_ob:t,member:n},TS.has_pri[s]&&TS.log(s,"added "+i),TS.typing.started_sig.dispatch(t,n));TS.typing.maybeStartTimer()},userEnded:function(e){if(e){var t=TS.model.user;TS.typing.memberEnded(e,t)}},memberEnded:function(e,t){var n=e.id+"_"+t.id;TS.typing.expungeMember(e,t),TS.has_pri[s]&&TS.log(s,"removed "+n)},expungeMember:function(e,t){var n=e.id+"_"+t.id;if(TS.useRedux()){var i=TS.interop.redux.features.typing.clearTyping({key:n});TS.redux.dispatch(i)}else delete TS.typing.map[n];TS.typing.ended_sig.dispatch(e,t)},checkMap:function(){var e=Date.now(),n=0;if(TS.useRedux()){var r=i(),o=TS.interop.redux.features.typing.removeOldTypingRecords({maxDurationForSelf:TS.typing.typing_self_lasts_ms,maxDurationForOthers:TS.typing.typing_lasts_ms,now:e});TS.redux.dispatch(o);var l=i();_.difference(Object.keys(r),Object.keys(l)).forEach(function(e){var t=r[e],n=TS.members.getMemberById(t.member_id),i=TS.redux.channels.getEntityById(t.model_ob_id);TS.typing.ended_sig.dispatch(i,n),TS.has_pri[s]&&TS.log(s,"removed "+e+" after it exceeded its maximum duration")}),n=t()}else _.forOwn(TS.typing.map,function(t,i){var a=t.member.is_self?TS.typing.typing_self_lasts_ms:TS.typing.typing_lasts_ms,r=e-t.started;n+=1,r>=a&&(TS.typing.memberEnded(t.model_ob,t.member),TS.has_pri[s]&&TS.log(s,"removed "+i+" after "+r))});n<1&&(clearTimeout(a),a=null)},getTypersInChannel:function(e){var t=[];return TS.useRedux()?t=_.map(n(e),TS.members.getMemberById):_.forOwn(TS.typing.map,function(n){n.model_ob.id!=e||n.member.is_self||t.push(n.member)}),t.sort(function(e,t){return TS.members.getPrefCompliantMemberNameLowerCase(e)<TS.members.getPrefCompliantMemberNameLowerCase(t)?-1:TS.members.getPrefCompliantMemberNameLowerCase(e)>TS.members.getPrefCompliantMemberNameLowerCase(t)?1:0}),t}});var e,t,n,i,a=null,s=47}()},2536:function(e,t){!function(){"use strict";TS.registerComponent("ui.PdfViewer",{_constructor:function(e,t){if(!t||!e||!e.length)return void TS.error("TS.ui.PdfViewer missing either the file or iframe");if(!TS.files.fileIsPDF(t))return void TS.error("Non-PDF given to TS.ui.PdfViewer");TS.metrics.count("pdf_viewer_open"),this.file=t,this.$iframe=e,this.$image_wrapper=this.$iframe.parent(),this.$pdf_loading_spinner=$("#pdf_loading_spinner");var n=TS.boot_data.abs_root_url;_.endsWith(n,"/")&&(n=n.substring(0,n.length-1)),this.iframe_origin=n,this.iframe_ready=!1,this.addLoadingSpinner(this.$pdf_loading_spinner),this.loadData(),this.boundOnMessage=this.onMessage.bind(this),$(window).on("message",this.boundOnMessage)},addLoadingSpinner:function(e){e.removeClass("hidden").html(TS.templates.infinite_spinner({color:"blue",size:"medium",speed:"fast"}))},removeLoadingSpinner:function(e){e.addClass("hidden")},destroy:function(){this.xhr&&this.xhr.abort(),$(window).off("message",this.boundOnMessage)},loadData:function(){this.xhr=new XMLHttpRequest,this.xhr.onload=this.onLoad.bind(this),this.xhr.onerror=this.onError.bind(this),this.xhr.open("GET",this.file.url_private_download),this.xhr.responseType="arraybuffer",this.xhr.withCredentials=!0,this.xhr.send()},addFallBackImage:function(){this.$image_wrapper.addClass("broken_image")},onError:function(){TS.metrics.count("pdf_viewer_xhr_error"),TS.warn("Error requesting PDF data!"),this.removeLoadingSpinner(this.$pdf_loading_spinner),this.addFallBackImage()},onLoad:function(){4===this.xhr.readyState&&200==this.xhr.status&&(this.buffer=new Uint8Array(this.xhr.response),this.iframe_ready&&this.sendBuffer()),this.xhr=null},onMessage:function(e){var t=e.origin||e.originalEvent.origin;if(t){var n=e.data||e.originalEvent.data;if(_.includes(["pdf_iframe_ready","corrupt_pdf","close_file_viewer"],n))return t!==this.iframe_origin?void TS.warn(n+" from unexpected origin: "+t):void("pdf_iframe_ready"===n?(this.iframe_ready=!0,this.$iframe.focus(),this.buffer&&this.sendBuffer()):"corrupt_pdf"===n?(TS.metrics.count("pdf_viewer_corrupt_pdf"),this.addFallBackImage()):"close_file_viewer"===n&&TS.ui.fs_modal_file_viewer.canClose()&&TS.ui.fs_modal.close())}},sendBuffer:function(){TS.model.is_our_app?this.$iframe[0].contentWindow.postMessage(this.buffer,this.iframe_origin,[this.buffer.buffer]):this.$iframe[0].contentWindow.postMessage(this.buffer,this.iframe_origin),this.removeLoadingSpinner(this.$pdf_loading_spinner)}})}()},2540:function(e,t){!function(){"use strict";TS.registerModule("ui.apps_browser",{onStart:function(){},start:function(){if(TS.apps.isAppSpaceEnabled()&&!TS.client.ui.checkForEditing()){if(TS.isPartiallyBooted())return void TS.incremental_boot.userDidInteractWithUI();var t=TS.templates.apps_browser({showTutorial:TS.model.prefs.seen_app_space_tutorial});TS.ui.fs_modal.start({body_template_html:t,onShow:n,onEnd:i,disable_esc:!0,enter_always_gos:!1,modal_class:"fs_modal_internal_scroll p-apps_browser_modal"}),e=document.getElementById("apps_browser_container"),TS.interop.mountAppsBrowser(e)}},routeAppOpen:function(e){TS.ui.fs_modal.close(),e.bot_user_id?TS.ims.startImByMemberId(e.bot_user_id).then(function(){TS.client.ui.app_space.toggleView("messages")}):e.bot_id?TS.apps.startFlexPaneByBotId(TS.model.team.id,e.bot_id,!0):TS.apps.startFlexPaneByAppId(TS.model.team.id,e.app_id,!1)},showAppTutorial:function(){TS.ui.card_carousel.start({cards:t,onShow:a,onEnd:s}),TS.model.prefs.seen_app_space_tutorial||TS.prefs.setPrefByAPI({name:"seen_app_space_tutorial",value:!0},function(){TS.model.prefs.seen_app_space_tutorial=!0,$("[data-view_tutorial_link]").removeClass("display_none"),TS.useRedux()&&TS.redux.dispatch(TS.interop.redux.features.prefs.forcePrefRefresh())})}});var e,t=[{image:"",animation:"",title:"Integrate software you use",text:"Sync your documents and send important notifications to the right channels."},{image:"",animation:"",title:"Get more done in Slack",text:"Schedule meetings, create tasks, or file expenses without switching tools."},{image:"",animation:"",title:"Have a little more fun",text:"Send kudos, create polls, or express yourself with just the right GIF."}],n=function(){$("[data-view_tutorial_link]").click(function(){TS.ui.apps_browser.showAppTutorial()}),$(window.document).on("keydown",r)},i=function(){TS.interop.unmountAppsBrowser(e),$(window.document).off("keydown",r)},a=function(){$(window.document).off("keydown",r)},s=function(){$(window.document).on("keydown",r)},r=function(e){e.which!=TS.utility.keymap.enter&&e.which!=TS.utility.keymap.esc||TS.ui.fs_modal.close()}}()},2541:function(e,t){!function(){"use strict";TS.registerModule("ui.at_channel_warning_dialog",{$div:null,showing:!1,onKeydown:function(e){if(TS.ui.at_channel_warning_dialog.showing)switch(e.which){case TS.utility.keymap.esc:TS.ui.at_channel_warning_dialog.cancel();break;case TS.utility.keymap.enter:e.preventDefault(),TS.ui.at_channel_warning_dialog.go()}},start:function(i,a,s,r,o,l){if(TS.ui.at_channel_warning_dialog.$div||TS.ui.at_channel_warning_dialog.build(),!TS.ui.at_channel_warning_dialog.showing){var d=TS.ui.at_channel_warning_dialog.$div;t=o,e=i;var c=TS.format.cleanMsg(a),_="";if(TS.model.everyone_regex.test(c)?_=TS.templates.builders.atLabel("everyone"):TS.model.channel_regex.test(c)?_=TS.templates.builders.atLabel("channel"):TS.model.group_regex.test(c)&&(_=TS.templates.builders.atLabel("group")),s<n)return void TS.ui.at_channel_warning_dialog.go();var u=TS.templates.at_channel_warning_dialog({keyword:_,member_count:s,timezone_count:r});d.html(u),l?d.addClass("fullsize"):d.removeClass("fullsize"),d.modal("show"),TS.ui.a11y.saveCurrentFocusAndFocusOnElement(d),d.find(".dialog_cancel").click(TS.ui.at_channel_warning_dialog.cancel),d.find(".dialog_go").click(TS.ui.at_channel_warning_dialog.go),$(window).bind("resize",TS.ui.at_channel_warning_dialog.position),TS.ui.at_channel_warning_dialog.position(),TS.prefs.setPrefByAPI({name:"last_seen_at_channel_warning",value:Date.now()})}},startInMessagePane:function(e,t,n){var a,s,r=TS.shared.getModelObById(e);if(r&&!r.is_im){var o=new Promise(function(e){TS.lazyLoadMembersAndBots()?i(r).then(e):(a=_(r.members).map(TS.members.getMemberById).compact().sortBy(TS.members.memberSorterByName).value().filter(TS.utility.members.isMemberNonBotNonDeletedNonSelf),s=_(a).map("tz_offset").uniq().value().length,e({member_count:a.length,timezone_count:s}))}),l=function(){TS.view.clearMessageInput(),TS.shared.sendMsg(e,t,n)},d=TS.client.ui.$msg_input;TS.client.msg_input.populate(t),o.then(function(e){TS.ui.at_channel_warning_dialog.start(d,t,e.member_count,e.timezone_count,l,!0)})}},startInFlexPane:function(e,t,n){if(!e)return void TS.error("no file to warn about!");var a,s,r=function(){TS.client.ui.files.submitFileComment(!0)},o=$("#file_comment_form #file_comment");new Promise(function(n){if(TS.lazyLoadMembersAndBots())i(e).then(n);else{var r=_(t).map(TS.shared.getModelObById).compact().reject({is_im:!0}).value(),o=_(r).map("members").flatten().uniq().value(),l=_(o).map(TS.members.getMemberById).compact().sortBy(TS.members.memberSorterByName).value();a=l.filter(TS.utility.members.isMemberNonBotNonDeletedNonSelf),s=_(a).map("tz_offset").uniq().value().length,n({member_count:a.length,timezone_count:s})}}).then(function(e){TS.ui.at_channel_warning_dialog.start(o,n,e.member_count,e.timezone_count,r,!1)})},position:function(){var t=TS.ui.at_channel_warning_dialog.$div,n=e.offset();t.css({top:n.top-t.height()-8,left:n.left})},go:function(){TS.ui.at_channel_warning_dialog.$div.modal("hide"),t()},cancel:function(){TS.ui.at_channel_warning_dialog.$div.modal("hide"),TS.ui.a11y.restorePreviousFocus()},end:function(){TS.model.dialog_is_showing=!1,TS.ui.at_channel_warning_dialog.showing=!1,$(window.document).unbind("keydown",TS.ui.at_channel_warning_dialog.onKeydown),$(window).unbind("resize",TS.ui.at_channel_warning_dialog.position)},build:function(){$("body").append('<div id="at_channel_warning_dialog" class="modal hide fade"></div>'),TS.ui.at_channel_warning_dialog.$div=$("#at_channel_warning_dialog");var e=TS.ui.at_channel_warning_dialog.$div;e.on("hide",function(e){e.target==this&&TS.ui.at_channel_warning_dialog.end()}),e.on("show",function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.at_channel_warning_dialog.showing=!0)}),e.on("shown",function(e){e.target==this&&setTimeout(function(){$(window.document).bind("keydown",TS.ui.at_channel_warning_dialog.onKeydown)},100)})}});var e,t=function(){},n=5,i=function(e){var t,n=!1,i={timezone_count:!0,display_counts:!0};return e.is_group?(t="groups.info",i.channel=e.id):e.is_channel?(t="channels.info",i.channel=e.id,TS.membership&&TS.membership.lazyLoadChannelMembership()&&(i.no_members=!0)):(n=!0,t="files.info",i.file=e.id),TS.api.call(t,i).then(function(t){var i,a;return n?(i=_.get(t,"data.display_counts.display_counts")||1,a=t.data.timezone_count):(i=(e.is_group?_.get(t,"data.group.display_counts.display_counts"):_.get(t,"data.channel.display_counts.display_counts"))||1,a=e.is_group?t.data.group.timezone_count:t.data.channel.timezone_count),i-=1,{member_count:i,timezone_count:a}}).catch(function(){return{member_count:0,timezone_count:1}})}}()},2542:function(e,t){!function(){"use strict";function e(){if(!("macgap"in window))return!1;try{return"1"===TSSSB.call("isAppStoreBuild")}catch(e){return TS.logError(e,"macgap.app.isAppStoreBuild() failed","macgap error"),!1}}TS.registerModule("ui.banner",{show_hide_sig:new signals.Signal,onStart:function(){TS.client.login_sig.add(TS.ui.banner.loggedIn,TS.ui.banner),TS.ui.growls.permission_changed_sig.add(TS.ui.banner.growlsPermissionChanged,TS.ui.banner)},loggedIn:function(){var t=!1;if(_.forOwn(TS.qs_args,function(e,n){var i=/^show_([\w_]+)_banner$/;if(i.test(n)&&"1"===e){var a=n.replace(i,"$1");if($("#"+a+"_banner").length>0)return TS.ui.banner.show(a),t=!0,!1}}),!t){var n="nothing"===TS.notifs.getGlobalNotificationSetting();if(!TS.model.is_iOS&&!TS.ui.growls.no_notifications&&TS.ui.growls.shouldShowPermissionButton()&&"denied"!==TS.ui.growls.getPermissionLevel()&&"1"!=window.readCookie("no_growl_banner")&&!n)return void TS.ui.banner.show("notifications");var i=TS.model.mac_version&&TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8")<=0,a=TS.model.is_our_app&&TS.model.is_mac&&i,s=e(),r=TS.model.is_mac&&"macgap"in window&&!s&&!TS.model.prefs.no_macelectron_banner,o=TS.model.is_mac&&!i&&!TS.model.mac_ssb_version&&!TS.model.prefs.no_macssb1_banner,l=TS.model.is_win_7_plus&&!TS.model.win_ssb_version&&!TS.model.prefs.no_winssb1_banner;return a?void TS.ui.banner.show("macssb_osx_deprecated"):r?void TS.ui.banner.show("macelectron2"):o?void TS.ui.banner.show("macssb1"):void(l&&TS.ui.banner.show("winssb1"))}},showSSBUpdateBanner:function(e,n,i){if(!(t&&TS.utility.compareSemanticVersions(e,t)<=0)){t=e;var a=$("#ssb_new_version_available_banner");a.length&&(a.find(".old_version_number").text(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch),a.find(".new_version_number").text(e),a.find(".can_update").toggleClass("hidden",!n),a.find(".can_not_update").toggleClass("hidden",n),a.find(".update_link").off("click").on("click",function(e){e.preventDefault(),TSSSB.call("quitAndInstallUpdate")}),a.find(".learn_link").attr("href",i),TS.ui.banner.show("ssb_new_version_available"))}},closeSSBUpdateBanner:function(){TS.ui.banner.close()},growlsPermissionChanged:function(e,t){"default"!==t&&TS.ui.banner.close()},growlsPermissionPrompt:function(){TS.ui.growls.promptForPermission(function(e,t){"granted"===t&&e&&(TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("Nice, notifications are enabled!","prefs")()),TS.model.prefs.growls_enabled||(TS.prefs.setPrefByAPI({name:"growls_enabled",value:!0}),TS.model.prefs.growls_enabled=!0))})},show:function(e){e=e||n,n=e;var t=TS.client.ui.$banner;t.removeClass("hidden"),$("body").addClass("banner_showing"),t.css("display","block"),t.children(".banner").addClass("hidden"),TS.ui.banner.show_hide_sig.dispatch("show");var i,a=!1;if("no_banner"===e)$("#notifications_banner").addClass("hidden"),$("#notifications_dismiss_banner").addClass("hidden");else if("notifications_dismiss"===e)$("#notifications_dismiss_banner").removeClass("hidden"),t.unbind("click").bind("click",function(){TS.ui.banner.close(),TS.ui.banner.show("no_banner")}),a=!0,i="recommend_desktop_notifications_banner";else if("notifications"===e)$("#notifications_banner").removeClass("hidden"),t.unbind("click").bind("click",function(e){if(0!==$(e.target).closest('[data-action="dismiss_banner"]').length)return $("#notifications_banner").addClass("hidden"),void TS.ui.banner.show("notifications_dismiss");TS.ui.banner.growlsPermissionPrompt(),TS.ui.banner.close()}),a=!0,i="enable_desktop_notifications_banner";else if("macelectron2"===e)$("#macelectron2_banner").removeClass("hidden"),t.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedMacElectronLink(this,!0);else if(!$(e.target).hasClass("update_link")){var t=$(this).find(".update_link");t.click()}}),TS.prefs.setPrefByAPI({name:"no_macelectron_banner",value:!0}),a=!0,i="mac_electron2_banner";else if("macssb1"===e)$("#macssb1_banner").removeClass("hidden"),t.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedMacSSB1Link(this,!0);else if(!$(e.target).hasClass("apps_page_link")){var t=$(this).find(".apps_page_link");TS.utility.openInNewTab(t.attr("href"),t.attr("target")),t.click()}}),a=!0,i="mac_ssb1_banner";else if("winssb1"===e)$("#winssb1_banner").removeClass("hidden"),t.unbind("click").bind("click",function(e){if($(e.target).closest('[data-action="dismiss_banner"]').length)TS.ui.banner.onClickedWinSSB1Link(this,!0);else if(!$(e.target).hasClass("apps_page_link")){var t=$(this).find(".apps_page_link");TS.utility.openInNewTab(t.attr("href"),t.attr("target")),t.click()}}),a=!0,i="win_ssb1_banner";else if("macssb_osx_deprecated"===e)$("#macssb_osx_deprecated_banner").removeClass("hidden"),t.unbind("click").bind("click",function(){TS.ui.banner.close()}),a=!0,i="mac_ssb_osx_deprecated_banner";else if("ssb_new_version_available"===e){var s=$("#ssb_new_version_available_banner");s.removeClass("hidden"),s.find('a[data-action="dismiss_banner"]').unbind("click").bind("click",function(){TS.ui.banner.close(),TSSSB.call("closeAllUpdateBanners")}),a=!0,i="ssb_new_version_available_banner"}else{var r=t.find("#"+e+"_banner");if(!r.length)return void TS.error("Tried to show a banner called "+e+", but cant find an element with that as its ID");r.removeClass("hidden"),r.find('a[data-action="dismiss_banner"]').unbind("click").bind("click",function(){TS.ui.banner.close()}),a=!0,i="generic_banner"}a&&TS.clog.track("BANNER_ACTION",{contexts:{ui_context:{action:"impression",ui_element:i}}}),TS.view.resizeForBanner("TS.ui.banner.show")},onClickedMacElectronLink:function(e,t){TS.ui.banner.close();var n=$(e);n.closest(".banner").hasClass("hidden")||TS.clog.track("BANNER_ACTION",{click_target:"get_mac_electron_banner",trigger:n.parent().attr("id"),page_url:n.attr("href"),action:t?"banner_dismiss":"banner_click",contexts:{ui_context:{action:t?"close":"click",ui_element:"mac_electron2_banner"},referring_ui_context:{ui_element:n.parent().attr("id")}}})},onClickedMacSSB1Link:function(e,t){TS.ui.banner.close(),TS.prefs.setPrefByAPI({name:"no_macssb1_banner",value:!0});var n=$(e);n.closest(".banner").hasClass("hidden")||TS.clog.track("BANNER_ACTION",{click_target:"get_mac_ssb_banner",page_url:n.attr("href"),action:t?"banner_dismiss":"banner_click",contexts:{ui_context:{action:t?"close":"click",ui_element:"mac_ssb1_banner"}}})},onClickedWinSSB1Link:function(e,t){TS.ui.banner.close(),TS.prefs.setPrefByAPI({name:"no_winssb1_banner",value:!0});var n=$(e);n.closest(".banner").hasClass("hidden")||TS.clog.track("BANNER_ACTION",{click_target:"get_win_ssb_banner",page_url:n.attr("href"),action:t?"banner_dismiss":"banner_click",contexts:{ui_context:{action:t?"close":"click",ui_element:"win_ssb1_banner"}}})},closeNagAndSetCookie:function(){TS.ui.banner.close(),window.createCookie("no_growl_banner","1",3650)},closeNagAndOpenPrefs:function(){TS.ui.banner.close(),setTimeout(function(){TS.ui.prefs_dialog.start("notifications")},500)},close:function(){var e=TS.client.ui.$banner;e.slideUp(200,function(){e.addClass("hidden"),$("body").removeClass("banner_showing");var t=TS.client&&TS.client.ui.areMsgsScrolledToBottom();TS.view.resizeForBanner("TS.ui.banner.close"),TS.ui.banner.show_hide_sig.dispatch("hide"),t&&TS.client.ui.instaScrollMsgsToBottom(!1)})}});var t,n="notifications"}()},2544:function(e,t){!function(){"use strict";TS.registerModule("ui.channel_browser",{onStart:function(){TS.channels.list_fetched_sig.add(f),TS.view.members.unknown_resolution_rebuild_sig.add(S)},start:function(){if(!TS.model.user.is_ultra_restricted&&!TS.client.ui.checkForEditing()){if(TS.isPartiallyBooted())return void TS.incremental_boot.userDidInteractWithUI();TS.metrics.mark("start_channel_browser_show");var e,t=TS.permissions.members.canCreateChannels()||TS.permissions.members.canCreateGroups();if(TS.model.user.is_restricted)e=TS.i18n.t("Browse channels","channel_browser")();else{var n,i;TS.useRedux()?(n=_.reject(TS.redux.channels.dangerouslyGetChannelsForUser(),"is_archived").length,i=_.reject(TS.redux.channels.dangerouslyGetGroups(),"is_archived").length):(n=TS.channels.getUnarchivedChannelsForUser().length,i=TS.groups.getUnarchivedGroups().length),e=TS.i18n.t("Browse all {channel_count, number} channels","channel_browser")({channel_count:n+i})}var a=TS.templates.channel_browser({can_create:t,title:e});TS.ui.fs_modal.start({body_template_html:a,onShow:m,onEnd:p,modal_class:"fs_modal_internal_scroll"}),TS.metrics.measureAndClear("channel_browser_show","start_channel_browser_show")}},test:function(){return{onShow:m,onEnd:p,channelsListFetched:f,filterList:w,sortChannels:C}}});var e,t,n,i,a,s,r,o,l=!1,d=!1,c=null,u=null,m=function(){l=!0,t=$("#channel_browser"),n=t.find("#channel_list_container"),i=t.find("#channel_browser_filter"),a=t.find("#channel_browser_sort"),o=t.find("#show_which_channels"),r=$("#new_channel_container"),I(),TS.model.ui_state&&TS.model.ui_state.sort_channel_browser_by&&a.find('option[value="'+TS.model.ui_state.sort_channel_browser_by+'"]').prop("selected",!0),TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels)&&(b({},TS.model.ui_state.channel_browser_show_which_channels)&&(TS.model.ui_state.channel_browser_show_which_channels="all",TS.storage.storeUIState(TS.model.ui_state)),o.find('option[value="'+TS.model.ui_state.channel_browser_show_which_channels+'"]').prop("selected",!0)),g(),h()?(e=!1,TS.channels.fetchList()):f()},h=function(){return!e||_.some(TS.model.channels,function(e){return!e.is_member&&void 0==e.num_members})},p=function(){l=!1,d=!1,c=null,u=null,TS.kb_nav.end(),t&&t.remove(),t=null,n=null,i=null,a=null,o=null,r&&r.remove(),r=null,E(),TS.ui.new_channel_modal.end()},g=function(){o.hide().lazyFilterSelect({classes:"show_which_channels_selector",onItemAdded:function(e){if(l&&d){var t=$(e),n=t.val();"archived"===n?(a.lazyFilterSelect("update",_.toArray(a.children()).filter(function(e){return"members_low"!==e.value&&"members_high"!==e.value})),"members_low"!==TS.model.ui_state.sort_channel_browser_by&&"members_high"!==TS.model.ui_state.sort_channel_browser_by||a.lazyFilterSelect("setValue","name")):a.lazyFilterSelect("update"),TS.model.ui_state&&(TS.model.ui_state.channel_browser_show_which_channels=n,TS.storage.storeUIState(TS.model.ui_state)),w(n)}},template:function(e){var t=$(e);return new Handlebars.SafeString(t.text())},tokenTemplateSingle:function(e){var t=$(e),n=TS.i18n.t('<span class="greigh">Show:</span> {value}',"channel_browser")({value:t.text()});return new Handlebars.SafeString(n)},listItemClass:function(){return"capitalize"}}),a.hide().lazyFilterSelect({classes:"channel_browser_sort",onItemAdded:function(e){if(l&&d){var t=$(e),n=t.val();TS.model.ui_state&&(TS.model.ui_state.sort_channel_browser_by=n,TS.storage.storeUIState(TS.model.ui_state)),C(n);var i=null;TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels)&&(i=TS.model.ui_state.channel_browser_show_which_channels),w(i)}},template:function(e){var t=$(e);return new Handlebars.SafeString(t.text())},tokenTemplateSingle:function(e){var t=$(e),n=TS.i18n.t('<span class="greigh">Sort:</span> {value}',"channel_browser")({value:t.text()});return new Handlebars.SafeString(n)}}),n.on("click",".channel_browser_row",function(e){F($(this),e)}),i.on("textchange",function(){if(l&&d){var e=null;TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels)&&(e=TS.model.ui_state.channel_browser_show_which_channels),w(e)}}).on("keydown",function(e){e.which===TS.utility.keymap.esc&&TS.ui.fs_modal.close()}),s.on("click",".about_channels",function(e){e.preventDefault(),TS.ui.fs_modal.close(),setTimeout(function(){TS.coachmark.start($.extend({},TS.coachmarks.coachmarks.channels,{ui_click:!0}))},500)}),t.on("click",".new_channel",B),t.on("click",".clear_filter_icon",function(){i.val("").trigger("textchange").focus()})},f=function(){if(e=!0,l&&!d){var t,s;TS.useRedux()?(t=TS.redux.channels.dangerouslyGetChannelsForUser(),s=TS.redux.channels.dangerouslyGetGroups()):(t=TS.channels.getChannelsForUser(),s=TS.model.groups),u=t.concat(s),C(TS.model.ui_state&&TS.model.ui_state.sort_channel_browser_by?TS.model.ui_state.sort_channel_browser_by:a.val()),c=u,n.empty(),v();var r=null;TS.model.ui_state&&!_.isUndefined(TS.model.ui_state.channel_browser_show_which_channels)&&(r=TS.model.ui_state.channel_browser_show_which_channels),w(r),0===c.length&&k(),_.defer(function(){i.focus()})}},S=function(e){if(d){if("unknown_members"===TS.experiment.getGroup("unknown_members_perf",TS.members.unknown_members_perf_exp_metrics)){var t=function(){n.longListView("getCurrentVisibleItemsInView").forEach(function(t){t.creator===e.id&&n.longListView("itemUpdatedById",t.id)})};n.longListView("isScrolling")?n.longListView("getCurrentVisibleItemsInViewSignal").addOnce(t):t()}}},T=function(e,t){var n=[];return e.length>0&&(n.push({is_divider:!0,name:TS.i18n.t("Channels you can join","channel_browser")()}),n=n.concat(e)),t.length>0&&(n.push({is_divider:!0,name:TS.i18n.t("Channels you belong to","channel_browser")()}),n=n.concat(t)),n},v=function(){n.longListView({items:c,approx_item_height:60,preserve_dom_order:!0,approx_divider_height:35,pin_dividers:!0,makeElement:function(e){var t=$(TS.templates.channel_browser_row({is_shared:TS.boot_data.feature_shared_channels_client}));return e.$icon=t.find(".channel_browser_type_icon"),e.$name=t.find(".channel_browser_channel_name"),e.$creator=t.find(".channel_browser_created_by"),e.$date=t.find(".channel_browser_created_on"),e.$purpose=t.find(".channel_browser_channel_purpose"),e.$external_shared_channels_icon=t.find(".shared_channels_icon"),e.$member_count=t.find(".channel_browser_member_count"),e.$open=t.find(".channel_browser_open"),e.$preview=t.find(".channel_browser_preview"),e.$joined=t.find(".channel_browser_joined"),e.$shared_channel_icon=t.find(".shared_channel_icon"),e.$teams=t.find(".channel_browser_teams"),t},makeDivider:function(){return $("<div>").addClass("channel_browser_divider")},renderItem:function(e,t,i){TS.shared.isModelObOrgShared(t)?(i.$shared_channel_icon.removeClass("hidden"),i.$external_shared_channels_icon.addClass("hidden")):TS.shared.isModelObShared(t)?(i.$external_shared_channels_icon.removeClass("hidden"),i.$shared_channel_icon.addClass("hidden")):(i.$external_shared_channels_icon.addClass("hidden"),i.$shared_channel_icon.addClass("hidden")),t.is_group?i.$icon.removeClass("ts_icon_channel_pane_hash ts_icon_archived_channel").addClass("ts_icon_lock"):t.is_archived?i.$icon.removeClass("ts_icon_lock ts_icon_channel_pane_hash").addClass("ts_icon_archived_channel"):i.$icon.removeClass("ts_icon_lock ts_icon_archived_channel").addClass("ts_icon_channel_pane_hash"),i.$name.text(t.name);var a=n.longListView("isScrolling"),s=TS.members.getMemberById(t.creator,a);s?(i.$creator.removeClass("hidden"),i.$creator.find(".channel_browser_creator_name").text(TS.members.getPrefCompliantMemberName(s))):i.$creator.addClass("hidden"),i.$date.text(TS.interop.datetime.toCalendarDate(t.created));var r=x(t);if(i.$member_count.text(r),t.purpose&&t.purpose.value){var o=TS.utility.formatTopicOrPurpose(t.purpose.value);o=o.replace(/<a .*?>(.*?)<\/a>/g,"$1"),i.$purpose.removeClass("hidden").html(o)}else i.$purpose.text("").addClass("hidden");if(t.is_member||t.is_group?(i.$open.removeClass("hidden"),i.$preview.addClass("hidden"),i.$joined.removeClass("hidden")):(i.$open.addClass("hidden"),i.$preview.removeClass("hidden"),i.$joined.addClass("hidden")),t.is_group?(e.removeClass("channel_link").removeAttr("data-channel-id"),e.addClass("group_link").attr("data-group-id",t.id)):(e.removeClass("group_link").removeAttr("data-group-id"),e.addClass("channel_link").attr("data-channel-id",t.id)),TS.boot_data.feature_shared_channels_client&&TS.shared.isModelObShared(t)){var l=TS.templates.shared_channel_list_team_icon({model_ob:t});i.$teams.html(l),i.$teams.parent().length||e.append(i.$teams)}else i.$teams.remove()},renderDivider:function(e,t){e.text(t.name)},calcItemHeight:function(e){return e.outerHeight()}}),"unknown_members"===TS.experiment.getGroup("unknown_members_perf",TS.members.unknown_members_perf_exp_metrics)&&n.longListView("getCurrentVisibleItemsInViewSignal").add(function(e){e.forEach(function(e){e.creator&&TS.members.ensureMemberIsHydrated(e.creator)})}),TS.environment.supports_custom_scrollbar||n.monkeyScroll(),d=!0,TS.kb_nav.start(n.find(".list_items"),".channel_browser_row",n,{use_data_ordering:!0,px_offset:35,scrollToStartImmediately:function(){n.longListView("scrollToTop",!0)},scrollToEndImmediately:function(){n.longListView("scrollToEnd",!0)}}),TS.kb_nav.setAllowHighlightWithoutBlurringInput(!0),TS.kb_nav.setSubmitItemHandler(function(e){F($(this),e)})},b=function(e,t){return"all"===t?!e.is_archived:"local"===t?!e.is_shared&&!e.is_archived:"org_shared"===t?e.is_org_shared&&!e.is_archived:"ext_shared"===t?e.is_shared&&!e.is_org_shared&&!e.is_archived:"archived"===t?e.is_archived:"private"!==t||e.is_group&&!e.is_archived},w=function(e){e||(e="all");TS.metrics.mark("start_channel_browser_search");var t,a,s=$.trim(i.val());if(""!==s&&-1!==s.indexOf("#")&&(s=s.replace("#","","g"),s=$.trim(s)),s?(i.closest(".channel_browser_filter_container").addClass("active"),c=y(u,s,e)):(i.closest(".channel_browser_filter_container").removeClass("active"),c=u.filter(function(t){return b(t,e)})),"archived"!==e&&"private"!==e){var r=_.partition(c,function(e){return e.is_member||e.is_group});a=r[0],t=r[1],c=T(t,a)}d&&n.longListView("setItems",c),0===c.length?k(s):A(),n.scrollTop(0),TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(n)}),s?TS.kb_nav.highlightFirstItem():TS.kb_nav.clearHighlightedItem(),TS.metrics.measureAndClear("channel_browser_search","start_channel_browser_search")},y=function(e,t,n){n||(n="all"),t=TS.i18n.deburr(TS.utility.regexpEscape(t)).toLocaleLowerCase();var i,a=new RegExp(t,"i"),s=-1,r=e.filter(function(e,r){var o=b(e,n);return(i=e.name_normalized||e.name.toLocaleLowerCase())===t&&o?(s=r,!1):i.match(a)&&o});return-1!==s&&r.unshift(e[s]),r},k=function(e){var t=$("#channel_browser_empty"),n=t.find(".channel_browser_empty_message");e?n.html(TS.i18n.t("No matches found for <strong>{query}</strong>","channel_browser")({query:TS.utility.truncateAndEscape(e,50)})):n.text(TS.i18n.t("No channels","channel_browser")()),t.removeClass("hidden")},A=function(){$("#channel_browser_empty").addClass("hidden")},C=function(e){M(u,e)},M=function(e,t){var n=["name","creator","created","members_high","members_low"],i="name";-1!==n.indexOf(t)&&(i=t),"name"===i?e.sort(function(e,t){return e._name_lc>t._name_lc?1:t._name_lc>e._name_lc?-1:0}):"creator"===i?e.sort(function(e,t){var n,i;return n=TS.members.getMemberById(e.creator),i=TS.members.getMemberById(t.creator),n&&i?n._name_lc>i._name_lc?1:i._name_lc>n._name_lc?-1:0:n&&!i?-1:!n&&i?1:0}):"created"===i?e.sort(function(e,t){return e.created<t.created?1:t.created<e.created?-1:0}):"members_high"===i?e.sort(function(e,t){var n=x(e),i=x(t);return n<i?1:i<n?-1:0}):"members_low"===i&&e.sort(function(e,t){var n=x(e),i=x(t);return n>i?1:i>n?-1:0})},x=function(e){return e.num_members||_.get(e,"active_members.length")||0},I=function(){s=$(TS.templates.channel_browser_footer()).appendTo("#fs_modal")},E=function(){s&&s.remove(),s=null},B=function(){var e=$.trim(i.val());TS.ui.new_channel_modal.startInContainer(r,e),t.addClass("hidden"),$("#fs_modal").removeClass("fs_modal_internal_scroll"),r.removeClass("no_opacity"),s.addClass("hidden"),TS.ui.fs_modal.bindBackButton(D),TS.ui.fs_modal.showBackButton()},D=function(){TS.ui.fs_modal.unbindBackButton(),TS.ui.fs_modal.hideBackButton(),r.addClass("no_opacity"),$("#fs_modal").addClass("fs_modal_internal_scroll"),t.removeClass("hidden"),s.removeClass("hidden"),TS.ui.new_channel_modal.end(),i.focus(),d&&n.longListView("resizeImmediately"),TS.ui.utility.updateClosestMonkeyScroller(n)},F=function(e,t){if(e.hasClass("channel_link")){var n=e.data("channel-id");TS.view.onChannelReferenceClick(t,n)}else{var i=e.data("group-id");TS.view.onGroupReferenceClick(t,i)}TS.ui.fs_modal.close()}}()},2545:function(e,t){!function(){"use strict";TS.registerModule("ui.channel_invite_modal",{onStart:function(){l=TS.boot_data.page_needs_enterprise||TS.lazyLoadMembersAndBots()},startInviteToChannelModal:function(e,n){if(!TS.isPartiallyBooted()){var i=TS.shared.getModelObById(e);if(!i)return void TS.error("TS.ui.channel_invite_modal.startInviteToChannelModal no channel or group found with id "+e);t=i,n=n||[];var a,s;l?(h=n.map(function(e){return p[e]=!0,TS.model.getMemberById(e)}),d=[]):(i.is_group?(a=TS.groups.getActiveMembersNotInThisGroupForInviting(i.id,!0),s=TS.model.user.is_admin?a:TS.groups.getActiveMembersNotInThisGroupForInviting(i.id)):(a=TS.channels.getActiveMembersNotInThisChannelForInviting(i.id,!0),s=TS.model.user.is_admin?a:TS.channels.getActiveMembersNotInThisChannelForInviting(i.id)),d=TS.channels.makeMembersWithPreselectsForTemplate(s,n),m=s.length!=a.length);var r={channel_name:i.name,is_private:!!i.is_group||!!i.is_private,is_shared:TS.shared.isModelObShared(i),is_org_shared:TS.shared.isModelObOrgShared(i),async_data:l};l&&(r.preselected=h);var o=TS.templates.channel_invite_modal(r);if(TS.ui.fs_modal.start({body_template_html:o,onShow:S,onEnd:T,modal_class:"fs_modal_internal_scroll"}),TS.model.user.is_admin){var c=TS.i18n.t('Or, <a class="do_admin_invite" data-channel-id="{channel_id}">invite a new person to your team</a>',"channel_modal")({channel_id:e}),_='<div class="channel_modal_footer">'+c+"</div>";$("#channel_invite_modal").append(_)}}}});var e,t,n,i,a,s,r,o,l,d=[],c=!0,u=!0,m=!1,h=[],p={},g={},f=TS.boot_data.feature_shared_channels_client?58:64,S=function(){e=$("#channel_invite_modal"),e.on("click",".no_create_channel",function(){u=!1,b()}),e.on("click",".yes_show_history",function(){u=!0,b()}),e.on("click",".do_admin_invite",function(){TS.ui.fs_modal.close();var e=$(this).data("channel-id");setTimeout(function(){TS.ui.admin_invites.start({initial_channel_id:e})},500)}),t.is_channel&&w()},T=function(){e=null,t=null,d=[],c=!0,u=!0,m=!1,n=null,i=null,a=null,s=null,r=null,o=null,h=[],p={},g._searcher_p&&g._searcher_p.cancel(),g={},l&&TS.kb_nav.end(),$(window).off("resize",K)},v=function(){var e;if(l){if(!h.length)return}else if(!(e=$("#channel_invite_container").lazyFilterSelect("value"))||!e.length)return;if(u||t.is_channel){var n=t.is_group?"groups.invite":"channels.invite";if(l)_.chunk(Object.keys(p),30).forEach(function(e){TS.api.call(n,{channel:t.id,force:!0,users:e.join(",")})});else{for(var i=[],s=0;s<e.length;s+=1)i.push(e[s].member.id);TS.api.call(n,{channel:t.id,users:i.join(",")})}TS.ui.fs_modal.close()}else{a&&a.start();var r;r=l?Object.keys(p):e.map(function(e){return e.member.id}),TS.groups.createChild(t.id,r,function(e,t){if(a&&a.stop(),e)TS.ui.fs_modal.close();else if(t&&"restricted_action"===t.error){var n=TS.i18n.t("You dont have permission to create new private channels.","channel_modal")();TS.permissions.members.canArchiveChannels()||(n=TS.i18n.t("You dont have permission to archive channels.","channel_modal")());var i=TS.i18n.t("Talk to your Team Owner.","channel_modal")();setTimeout(function(){TS.generic_dialog.alert("<p>"+n+"</p><p>"+i+"</p>")},500)}else alert("failed! "+t.error)})}},b=function(){$("#private_channel_invite_step_one").addClass("hidden"),$("#channel_invite_container").removeClass("hidden"),l&&e.find(".channel_invite_filter_container").removeClass("hidden"),w()},w=function(){l?I():j(),z()},y=function(){A(),M()},k=function(){C(),x()},A=function(){var e=document.getElementById("channel_invite_spinner");e&&e.classList&&e.classList.remove("hidden")},C=function(){var e=document.getElementById("channel_invite_spinner");e&&e.classList&&e.classList.add("hidden")},M=function(){if(!o)return o=$("#monkey_scroll_wrapper_for_channel_invite_container"),r=$("<div>",{class:"monkey_scroll_mask"}),void o.append(r);r.removeClass("hidden")},x=function(){r&&r.addClass("hidden")},I=function(){s=$("#channel_invite_container"),s.longListView({items:[],approx_item_height:f,preserve_dom_order:!0,makeElement:function(){return $('<div class="channel_invite_row"></div>')},renderItem:function(e,t){e.data("member-id",t.id),e.toggleClass("disabled",!!p[t.id]),e.html(TS.templates.channel_invite_member({member:t.member}))}}),s.monkeyScroll(),O(),s.on("click",".channel_invite_row",function(e){U($(e.currentTarget))}),e.on("keydown","#channel_invite_filter",function(e){var t=$(e.currentTarget).val();return e.which===TS.utility.keymap.del&&""===t?void Q():e.which===TS.utility.keymap.enter&&""===t?void(TS.kb_nav.getHighlightedItem()||v()):void(e.which===TS.utility.keymap.esc&&TS.ui.fs_modal.close())}).on("input",function(e){W(),B($(e.target).val().trim()).then(F).then(P)}),e.on("focus","#channel_invite_filter",function(){$("#channel_invite_tokens").addClass("active")}).on("blur","#im_browser_filter",function(){$("#channel_invite_tokens").removeClass("active")}),e.on("click","#channel_invite_tokens",function(e){var t=$(e.target).closest(".member_token");t.length?L(t):$("#channel_invite_filter").focus()}),setTimeout(function(){TS.kb_nav.start(s.find(".list_items"),".channel_invite_row",s,{use_data_ordering:!0,no_blur:!0,scrollToStartImmediately:function(){s.longListView("scrollToTop",!0)},scrollToEndImmediately:function(){s.longListView("scrollToEnd",!0)}}),TS.kb_nav.setAllowHighlightWithoutBlurringInput(!0),TS.kb_nav.setSubmitItemHandler(function(e){U($(this)),e.preventDefault()}),$("#channel_invite_filter").focus()}),B("").then(F).then(P)},E=function(){if(!(t.is_shared&&g&&g.include_org&&TS.model.enterprise&&TS.model.enterprise_teams.length!==g.org_team_ids.length))return Promise.resolve(!1);var e={query:g.query,include_org:g.include_org,include_slackbot:g.include_slackbot,include_self:g.include_self,max_api_results:1,org_team_ids:_(TS.model.enterprise_teams).map("id").xor(g.org_team_ids).value()};return TS.members.promiseToSearchMembers(e).then(function(e){return Promise.resolve(!!e.num_found)})},B=function(e){y();var n=e;if("@"===e.charAt(0)&&(n=e.substring(1)),g.query!==n){if(g.query=n,g.include_org=!!t.is_shared,g.include_slackbot=!1,g.include_self=!1,g.not_member_of=[t.id],t.is_shared){var i;i=t.is_global_shared?_.map(TS.model.enterprise_teams,"id"):t.shared_team_ids||[],g.org_team_ids=i}g.scroll_mark=0,g.query_for_display=e,s.off("scroll.filter")}return TS.members.promiseToSearchMembers(g)},D=function(e,t,n){var i=_.map(n,"id"),a=t||TS.model.user.is_admin;return TS.model.user.is_ultra_restricted&&!a?Promise.resolve([]):TS.membership.ensureChannelMembershipIsKnownForUsers(e.id,i).then(function(){return _(n).map(function(t){if(!t.is_ultra_restricted&&!t.is_slackbot&&!t.is_self&&!t.deleted&&!t.is_app_user&&(a||!t.is_restricted||e.is_group)){return!TS.membership.getUserChannelMembershipStatus(t.id,e).is_member&&TS.permissions.channels.canMemberJoinChannel(e,t)?t:void 0}}).compact().uniq().value()})},F=function e(n){var i,a,s=[];return s.push(D(t,!0,n.items)),TS.model.user.is_admin||s.push(D(t,!1,n.items)),Promise.all(s).then(function(t){return t.length&&(i=t[0],a=2===t.length?t[1]:i),m=a.length!=i.length,O(),n.query||TS.lazyLoadMembersAndBots()||(c=!!n.num_found),a.length!=n.items.length&&(n.num_new-=n.items.length-a.length,n.items=a),!n.num_new&&n.num_found&&n.num_remaining?B(n.query).then(e):Promise.resolve(n)})},P=function e(t){var n=t.items.map(function(e){return{id:e.id,member:e}});if(s.longListView("setItems",n),t._is_new&&s.scrollTop(0),TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(s)}),t._is_new&&s.on("scroll.filter",function(){var n=s.scrollTop()+s.height()+f;if(!(n<=t.scroll_mark)){n>s.find(".list_items").height()&&g._searcher_p&&g._searcher_p.isResolved()&&(B(t.query).then(F).then(e),t.scroll_mark=n)}}),!n.length)return E().then(function(e){N(t.query_for_display,e),k()});G(),k(),t.query&&"@"!==t.query&&0!==n.length?t._is_new&&TS.kb_nav.highlightFirstItem():TS.kb_nav.clearHighlightedItem()},O=function(){if(m&&!e.find(".ra_not_appear_warning").length){var t=TS.i18n.t("Multi-channel guests may not appear below. Ask a Team Administrator to invite them.","channel_modal")(),n='<p class="mini subtle_silver no_bottom_margin ra_not_appear_warning">'+t+"</p>";e.find(".kb_nav_label").after(n)}},R=function(){var e=$("#channel_invite_filter"),t=e.val();$("#channel_invite_tokens").replaceWith(TS.templates.channel_invite_tokens({members:h,async_data:l})),e=$("#channel_invite_filter"),!t&&l?e.focus():e.val("").trigger("input").focus()},U=function(e){var t=e.data("member-id"),n=[],i=TS.members.getMemberById(t);i&&(p[t]||(h.push(i),p[t]=!0,n.push(i),H(n)))},L=function(e){var t=e.data("member-id"),n=_.remove(h,function(e){return e.id===t});delete p[t],H(n)},Q=function(){if(h.length){var e=h.pop();delete p[e.id],H([e])}},H=function(t){t&&t.forEach(function(e){s.longListView("itemUpdatedById",e.id)}),R(),W(),e.find(".invite_go").toggleClass("disabled",!h.length),s.longListView("resizeImmediately")},N=function(e,n){var i=$("#filter_invite_empty"),a=i.find(".filter_invite_empty_message");if(c)if(e){var s={query:e};if(t.is_shared&&n){var r;r=t.is_global_shared?_.map(TS.model.enterprise_teams,"name"):_.map(t.shared_team_ids,function(e){return TS.enterprise.getTeamById(e).name}),s.teams=r}a.html(TS.templates.channel_invite_no_results(s))}else a.empty();else a.html(TS.templates.channel_invite_no_results());i.removeClass("hidden"),$("#monkey_scroll_wrapper_for_channel_invite_container").addClass("hidden")},G=function(){$("#filter_invite_empty").addClass("hidden"),$("#monkey_scroll_wrapper_for_channel_invite_container").removeClass("hidden")},j=function(){var e,t,a,s=$("#channel_invite_container"),r={append:!0,data:d,approx_item_height:f,per_page:50,placeholder_text:TS.i18n.t("Search","channel_modal")(),always_visible:!0,tab_to_nav:!0,template:function(e){var t=TS.templates.channel_invite_member({member:e.member});return new Handlebars.SafeString(t)},tokenTemplate:function(e){var t=TS.templates.channel_invite_member_token({member:e.member});return new Handlebars.SafeString(t)},tokenClass:function(e){return TS.templates.builders.getMemberTypeClass(e.member)},filter:function(n,i){var s=n.member;e!==i&&(t=new RegExp("^"+TS.utility.regexpEscape(i),"i"),a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(i),"i"),e=i);return TS.utility.members.checkMemberMatch(s,t,!0)||TS.utility.members.checkMemberMatch(s,a,!0)},noResultsTemplate:function(e){return d.length?TS.i18n.t("No one found matching <strong>{query}</strong>","channel_modal")({query:_.escape(e)}):TS.i18n.t("Everyone is already in this channel, so there is no one to invite!","channel_modal")()},onItemAdded:function(){var e=s.lazyFilterSelect("value"),t=s.find(".lfs_input_container");e&&0!==e.length&&$(".invite_go").removeClass("disabled"),t.scrollTop(t.height()),W(),K()},onItemRemoved:function(){var e=s.lazyFilterSelect("value");e&&0===e.length&&$(".invite_go").addClass("disabled"),W(),K()},onKeyDown:function(e,t){if(e.which===TS.utility.keymap.enter&&!t){var n=s.lazyFilterSelect("value");if(n&&n.length>0){""===s.find(".lfs_input").val()&&v()}}}};n=s.lazyFilterSelect(r),i=n.find(".lfs_input"),s.find(".lfs_list_container").on("mouseleave",function(){$(this).find(".lfs_item.active").removeClass("active")}),s.find(".lfs_input_container").after(TS.templates.channel_kb_nav_label({multiple_select:!0})),O(),$(window).on("resize",K),setTimeout(K,10),i.on("keyup",function(){W()}).on("keydown",function(e){e.which===TS.utility.keymap.esc&&TS.ui.fs_modal.close()}).focus()},z=function(){var t=$("#channel_invite_container");if(n){var i=t.find(".lfs_input_container");i.wrap("<div></div>"),i.attr("style","max-width: 85%").addClass("inline_block").addClass("no_padding"),i.after(TS.templates.channel_modal_go_button({class_name:"invite_go",label:TS.i18n.t("Invite","channel_modal")()}))}W();var s=e.find(".invite_go");a=Ladda.create(s[0]),s.on("click",v)},K=function(){$("#channel_invite_container").lazyFilterSelect("recomputeHeight")},W=function(){var t=$("#channel_invite_container");if(n){var a=n.lazyFilterSelect("value"),s=t.find(".enter_to_go_label");i.val()?s.addClass("hidden"):a&&a.length>0?s.removeClass("hidden"):s.addClass("hidden")}else if(l){var r=e.find(".return_hint");$("#channel_invite_filter").val()?r.addClass("hidden"):h.length?r.removeClass("hidden"):r.addClass("hidden")}}}()},2546:function(e,t){!function(){"use strict";TS.registerModule("ui.channel_manage_teams_dialog",{div:null,c_id:null,ladda:null,start:function(t){TS.ui.channel_manage_teams_dialog.c_id=t,e()},addTempEphemeralFeedback:function(e){TS.client.ui.addOrFlashEphemeralBotMsg({text:e})}});var e=function(){var e=TS.shared.getModelObById(TS.ui.channel_manage_teams_dialog.c_id);if(!e||e.is_im){TS.log(1337,"No model_ob found for channel id :"+TS.ui.channel_manage_teams_dialog.c_id);var i=TS.i18n.t("Oops! No channel found???","channel_manage_teams")();return void TS.generic_dialog.alert('<p class="no_bottom_margin">'+i+"</p>")}var a=e.is_channel?"channel":"group",s={c_or_g:a,model_ob:e},r={body_template_html:TS.templates.channel_manage_teams_dialog(s),onShow:t,onCancel:n,modal_class:"channel_manage_teams_modal"};TS.ui.fs_modal.start(r)},t=function(){TS.ui.channel_manage_teams_dialog.div=$(".channel_manage_teams_modal");var e=TS.shared.getModelObById(TS.ui.channel_manage_teams_dialog.c_id);TS.ui.channel_manage_teams_dialog.div.find(".dialog_cancel").on("click",i),TS.ui.channel_manage_teams_dialog.div.find(".dialog_go").on("click",a),TS.ui.channel_manage_teams_dialog.div.on("change",'[type="radio"][name="share_with"]',function(){var e=$(this),t=e.val(),n="specific"===t;TS.ui.channel_manage_teams_dialog.div.find(".specific_team").toggleClass("hidden",!n);var i=!1;n&&(i=!(TS.ui.channel_manage_teams_dialog.div.find('[name="domains"]').val().trim().length>0)),s(i)}),TS.ui.channel_manage_teams_dialog.div.find('[name="domains"]').each(function(t,n){var i,a=$(n),s=_.filter(TS.model.enterprise_teams,function(e){return e.id!==TS.model.team.id});i=e.is_global_shared?_(TS.model.enterprise_teams).map("id").filter(function(e){return e!==TS.model.team.id}).value():e.shared_team_ids.filter(function(e){return e!==TS.model.team.id}),TS.ui.team_picker.make(a,{teams:s,preselected_ids:i,restrict_preselected_item_removal:!0}),a.on("change",function(){var e=TS.ui.team_picker.value(a).map(function(e){return e.team.domain}).join(",");a.val(e)})}),TS.ui.channel_manage_teams_dialog.div.on("change",'[name="domains"]',function(){var e=$(this),t=e.val().trim();s(!(t.length>0))})},n=function(){},i=function(){TS.ui.fs_modal.close()},a=function(){var e=TS.shared.getModelObById(TS.ui.channel_manage_teams_dialog.c_id),t=!0,n={channel_id:e.id};if("specific"===TS.ui.channel_manage_teams_dialog.div.find('[type="radio"][name="share_with"]:checked').val()){var i=TS.ui.team_picker.value(TS.ui.channel_manage_teams_dialog.div.find('[name="domains"]'));i=i.filter(function(e){return!1===e.preselected}).map(function(e){return e.team.id}),0===i.length&&(t=!1),n.team_ids=i.join(",")}else n.all_teams=!0;return t?TS.api.callImmediately("enterprise.channels.addToShared",n).then(function(){TS.ui.fs_modal.close()}):TS.ui.fs_modal.close(),!1},s=function(e){e||(e=!1),TS.ui.channel_manage_teams_dialog.div.find(".dialog_go").toggleClass("disabled",e)}}()},2547:function(e,t){!function(){"use strict";TS.registerModule("ui.channel_options_dialog",{div:null,showing:!1,c_id:null,ladda:null,preselected_section:null,params:null,onKeydown:function(e){TS.ui.channel_options_dialog.showing&&e.which===TS.utility.keymap.esc&&TS.ui.channel_options_dialog.cancel()},start:function(e,t,n){TS.ui.channel_options_dialog.ladda=null,TS.ui.channel_options_dialog.c_id=e,TS.ui.channel_options_dialog.preselected_section=t,TS.ui.channel_options_dialog.params=n,o()},go:function(){if(!TS.ui.channel_options_dialog.showing)return void TS.error("not showing?");TS.ui.channel_options_dialog.div.modal("hide")},cancel:function(){TS.ui.channel_options_dialog.div.modal("hide")},end:function(){TS.ui.channel_options_dialog.c_id=null,TS.model.dialog_is_showing=!1,TS.ui.channel_options_dialog.showing=!1,TS.ui.channel_options_dialog.params=null,$(window.document).unbind("keydown",TS.ui.channel_options_dialog.onKeydown)},build:function(){$("body").append('<div id="channel_options_dialog" class="modal hide fade"></div>'),TS.ui.channel_options_dialog.div=$("#channel_options_dialog");var e=TS.ui.channel_options_dialog.div;e.on("hide",function(e){e.target==this&&TS.ui.channel_options_dialog.end()}),e.on("show",function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.channel_options_dialog.showing=!0)}),e.on("shown",function(e){e.target==this&&setTimeout(function(){$(window.document).bind("keydown",TS.ui.channel_options_dialog.onKeydown)},100)})},addTempEphemeralFeedback:function(e){TS.client.ui.addOrFlashEphemeralBotMsg({text:e})},startWithChannelOption:function(e,t,n,i,a){v(e),T(t),b(n),m=i,TS.ui.fs_modal.showBackButton(),f(!0),a&&k()},showAllOptions:function(){S()}});var e,t,n,i,a,s,r,o=function(){var e=TS.shared.getModelObById(TS.ui.channel_options_dialog.c_id);if(!e||e.is_im&&!TS.boot_data.feature_dm_retention&&!TS.boot_data.feature_channel_exports){var t=TS.i18n.t("Oops! No channel found???","channel_options")();return void TS.generic_dialog.alert('<p class="no_bottom_margin">'+t+"</p>")}var n=e.is_private||e.is_group,i=!1;n||e.is_general||e.is_im||!TS.model.user.is_admin||e.is_org_default||(i=TS.permissions.members.canCreateGroups());var a=!1;if(!TS.channels.isChannelRequired(e)){var s=!0;TS.boot_data.page_needs_enterprise&&e.is_org_shared&&(!TS.permissions.members.canManageOrgSharedChannels()&&!TS.model.user.enterprise_user.is_owner||e.is_org_default)&&(s=!1),s&&(a=e.is_channel&&TS.permissions.members.canArchiveChannels()||e.is_group&&TS.permissions.members.canArchiveChannels()&&!TS.model.user.is_restricted)}var r=TS.boot_data.feature_archive_deeplink&&!TS.channels.isChannelRequired(e)&&e.is_channel&&TS.model.user.is_admin&&!e.is_org_default,o=!1;TS.boot_data.page_needs_enterprise&&e.is_org_shared&&!e.is_im&&TS.permissions.members.canManageOrgSharedChannels()?o=!0:e.is_im||!TS.model.user.is_admin&&e.creator!==TS.model.user.id||(o=!0);var c=!1;TS.model.user.is_ultra_restricted||e.is_general&&!TS.members.canUserPostInGeneral()||e.is_im||(c=!0);var _=!1;""!==TS.model.team.plan&&(TS.model.user.is_owner||1==n||e.is_im)&&TS.model.team.prefs.allow_retention_override&&(_=!0);var m=!1;TS.boot_data.page_needs_enterprise&&e.is_org_shared&&!e.is_im&&TS.permissions.members.canManageOrgSharedChannels()&&(m=!0);var h=!1;!TS.boot_data.page_needs_enterprise||e.is_shared||e.is_im||!TS.boot_data.feature_allow_shared_general&&e.is_general||TS.permissions.members.canCreateConvertOrgSharedChannels()&&(h=!0);var p={name:new Handlebars.SafeString(d(e)),model_ob:e,show_convert_btn:i,show_archive_btn:a,show_delete_btn:r,show_rename_btn:o,show_purpose_btn:c,show_data_retention_link:_,show_convert_to_shared_btn:h,show_manage_posting_privilege_btn:m,show_share_channel_btn:!e.is_shared&&TS.permissions.members.canRequestSharedChannel()&&!e.is_general,show_export_btn:TS.permissions.members.canExportMessageHistory(e)},g=TS.i18n.t("Additional Options for #{channel_name}","channel_options")({channel_name:e.name}),f={title:g,body_template_html:TS.templates.channel_options_dialog(p),onShow:l,onCancel:u,modal_class:"channel_options_modal"};TS.ui.fs_modal.start(f)},l=function(){var n=TS.shared.getModelObById(TS.ui.channel_options_dialog.c_id);if(TS.ui.channel_options_dialog.div=$(".channel_options_modal"),e=TS.ui.channel_options_dialog.div.find('.channel_options_section[data-section="options"]'),t=TS.ui.channel_options_dialog.div.find('.channel_options_section[data-section="option"]'),e.on("click",".channel_option_item",function(){var e=$(this).data("action");switch(TS.ui.channel_options_dialog.preselected_section||p(),e){case"channel_archive_btn":C(n);break;case"channel_delete_btn":x(n);break;case"group_archive_btn":M(n);break;case"channel_convert_btn":I(n);break;case"shared_channel_convert_btn":E(n);break;case"channel_rename_btn":R(n);break;case"channel_purpose_btn":U(n);break;case"data_retention_btn":ne(n);break;case"posting_privilege_btn":ee(n);break;case"export_history_btn":L(n);break;case"share_channel_btn":TS.ui.share_channel_dialog.start({model_ob:n})}}),TS.ui.channel_options_dialog.div.find(".option_cancel").on("click",function(){TS.ui.channel_options_dialog.preselected_section?TS.ui.fs_modal.close():S()}),TS.ui.channel_options_dialog.div.find(".option_go").on("click",h),TS.ui.channel_options_dialog.preselected_section)switch(TS.ui.channel_options_dialog.preselected_section){case"archive":n.is_group?e.find('[data-action="group_archive_btn"]').click():e.find('[data-action="channel_archive_btn"]').click();break;case"delete":e.find('[data-action="channel_delete_btn"]').click();break;case"export":e.find('[data-action="export_history_btn"]').click();break;case"convert_private":e.find('[data-action="channel_convert_btn"]').click();break;case"convert_shared":e.find('[data-action="shared_channel_convert_btn"]').click();break;case"rename":e.find('[data-action="channel_rename_btn"]').click();break;case"purpose":e.find('[data-action="channel_purpose_btn"]').click();break;case"retention":e.find('[data-action="data_retention_btn"]').click();break;case"posting_privilege":e.find('[data-action="posting_privilege_btn"]').click()}},d=function(e){return e.is_channel||e.is_group?"<strong>"+(TS.templates.builders.makeChannelPrefix(e)+_.escape(e.name))+(TS.shared.isModelObOrgShared(e)?TS.templates.shared_channel_icon({org:!0}):"")+(TS.shared.isModelObShared(e)?TS.templates.shared_channels_icon():"")+"</strong>":""},c=function(){TS.ui.channel_options_dialog.ladda||(TS.ui.channel_options_dialog.ladda=Ladda.create(TS.ui.channel_options_dialog.div.find(".option_go")[0]))},u=function(){p(!0)},m=_.noop,h=function(){m()},p=function(e){e?(TS.ui.fs_modal.unbindBackButton(),TS.ui.fs_modal.hideBackButton()):(TS.ui.fs_modal.bindBackButton(S),TS.ui.fs_modal.showBackButton())},g=function(){t.hide(),e.show()},f=function(n){e.hide(),t.show(),n&&c()},S=function(){p(!0),w(!1),y(!1),g()},T=function(e){t.find(".channel_options_header").html(e)},v=function(e){t.find(".channel_option_content").html(e)},b=function(e){t.find(".option_go .ladda-label").text(e)},w=function(e){void 0===e&&(e=!1),t.find(".option_go").toggleClass("btn_danger",e)},y=function(e){e||(e=!1),t.find(".option_go").toggleClass("disabled",e)},k=function(){t.find(".channel_option_buttons").hide()},A=function(){t.find(".channel_option_buttons").show()},C=function(e){var t;t=e.is_channel||e.is_group?TS.i18n.t("Archive {channel_name}","channel_options")({channel_name:d(e)}):TS.i18n.t("Archive <strong>this conversation</strong>","channel_options")(),T(t);var n={name:new Handlebars.SafeString(d(e))};v(TS.templates.channel_option_archive(n)),b(TS.i18n.t("Yes, archive the channel","channel_options")()),m=function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start(),TS.api.call("channels.archive",{channel:e.id},function(e,t){if(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),e)return TS.web&&($("p.alert").addClass("hidden"),$("#archive_success").removeClass("hidden"),$("#archive_btn").addClass("hidden"),$("#unarchive_btn").removeClass("hidden")),void TS.ui.fs_modal.close();var n=TS.i18n.t("For some weird reason, that didnt work. Please try again to continue.","channel_options")();"last_ra_channel"===t.error?n=TS.model.user.is_admin?TS.i18n.t("Sorry, you cant archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channel_options")():TS.i18n.t("Sorry, you cant archive this channel because it is the only channel one of the guest account members belongs to.","channel_options")():"restricted_action"===t.error?n=TS.i18n.t("<p>You dont have permission to archive channels.</p><p>Talk to your Team Owner.</p>","channel_options")():"already_archived"===t.error?n=TS.i18n.t("This channel was already archived.","channel_options")():"cant_archive_general"===t.error&&(n=TS.i18n.t("This channel cannot be archived.","channel_options")()),setTimeout(TS.generic_dialog.alert,500,n)})},f(!0)},M=function(e){var t;t=e.is_channel||e.is_group?TS.i18n.t("Archive {channel_name}","channel_options")({channel_name:d(e)}):TS.i18n.t("Archive <strong>this conversation</strong>","channel_options")(),T(t),v(TS.templates.channel_option_archive({name:new Handlebars.SafeString(d(e))})),b(TS.i18n.t("Yes, archive the channel","channel_options")()),m=function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start(),TS.api.call("groups.archive",{channel:e.id},function(e,t){if(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),e)return void TS.ui.fs_modal.close();var n;n="last_ra_channel"===t.error?TS.model.user.is_admin?TS.i18n.t("Sorry, you cant archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channel_options")():TS.i18n.t("Sorry, you cant archive this channel because it is the only channel one of the guest account members belongs to.","channel_options")():"already_archived"===t.error?TS.i18n.t("This channel was already archived.","channel_options")():"restricted_action"===t.error?TS.i18n.t("<p>You dont have permission to archive private channels.</p><p>Talk to your Team Owner.</p>","channel_options")():TS.i18n.t("For some weird reason, that didnt work. Please try again to continue.","channel_options")(),setTimeout(TS.generic_dialog.alert,500,n)})},f(!0)},x=function(e){var n=TS.i18n.t("Delete {channel_name}","channel_options")({channel_name:d(e)});T(n);var i={name:new Handlebars.SafeString(d(e))};v(TS.templates.channel_option_delete_channel(i)),b(TS.i18n.t("Delete Channel","channel_options")()),w(!0),y(!0),t.find("#delete_channel_cb").on("change",function(){y(!this.checked)}),t.find("#archive_channel_alt").on("click",function(t){t.preventDefault(),w(!1),y(!1),C(e)}),m=function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start(),TS.api.call("channels.delete",{channel:e.id},function(e,t){if(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),e)return TS.ui.fs_modal.close(),void TS.client.activeChannelDisplayGoneAway();var n=TS.i18n.t("For some weird reason, that didnt work. Please try again to continue.","channel_options")();"cant_delete_general"===t.error?n=TS.i18n.t("Sorry, you cant delete this channel","channel_options")():"compliance_exports_prevent_deletion"===t.error?n=TS.i18n.t("Sorry, you cant delete this channel because compliance exports are enabled","channel_options")():"not_supported"===t.error&&(n=TS.i18n.t("Sorry, you cant delete external shared channels just yet","channel_options")()),setTimeout(TS.generic_dialog.alert,500,n)})},f(!0)},I=function(e){var t;t=e.is_channel||e.is_group?TS.i18n.t("Convert {channel_name} to a private channel?","channel_options")({channel_name:d(e)}):TS.i18n.t("Convert <strong>this conversation</strong> to a private channel?","channel_options")(),T(t),v(TS.templates.channel_conversion_dialog({name:_.escape(e.name)})),b(TS.i18n.t("Yes, convert the channel","channel_options")()),m=function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start(),TS.api.call("channels.convertToGroup",{channel:e.id},function(e,t){if(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),e)return void TS.ui.fs_modal.close();var n;n="restricted_action"===t.error?TS.i18n.t("<p>You dont have permission to create private channels.</p><p>Talk to your Team Owner.</p>","channel_options")():"last_ra_channel"===t.error?TS.i18n.t("<p>Sorry, you cant convert this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to convert the channel.</p>","channel_options")():"name_taken"===t.error?TS.i18n.t('<p>Converting this channel failed because of a naming collision, which should never happen, but did. Please <a href="/help/requests/new">let us know</a> this happened.</p>',"channel_options")():TS.i18n.t("For some weird reason, that didnt work. Please try again to continue.","channel_options")(),setTimeout(TS.generic_dialog.alert,500,n)})},f(!0)},E=function(e){var n;n=e.is_channel||e.is_group?TS.i18n.t("Convert {channel_name} to a shared channel?","channel_options")({channel_name:d(e)}):TS.i18n.t("Convert <strong>this conversation</strong> to a shared channel?","channel_options")(),T(n);var i={name:_.escape(e.name),purpose:_.escape(e.purpose.value)};TS.boot_data.page_needs_enterprise&&(i.enterprise_info=TS.model.enterprise),v(TS.templates.shared_channel_conversion_dialog(i)),b(TS.i18n.t("Convert to shared channel","channel_options")()),m=function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start();var n,i=t.find(".convert_to_shared");if(!TS.ui.validation.validate(i.find('[name="channel_name"]')))return TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),void y(!0);i.find('[type="radio"][name="share_with"]').each(function(e,t){if(t.checked)return n=$(t),!1});var a={channel_id:e.id};if("all"===n.val())a.all_teams=!0;else{var s=$('[name="domains"]').data("TS-lazyFilterSelect").value();s=s.map(function(e){return e.team.domain}).join(","),a.target_domains=s}var r=i.find('[name="channel_name"]').val().trim();a.channel_name=r;var o=i.find('[name="purpose"]').val().trim();a.purpose=o;var l=TS.shared.getActiveModelOb(),d=l.is_group?"enterprise.groups.createShared":"enterprise.channels.createShared";TS.api.call(d,a,function(e,t){if(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),e)return void TS.ui.fs_modal.close();var n;n="restricted_action"===t.error?TS.i18n.t("<p>You dont have permission to create private channels.</p><p>Talk to your Team Owner.</p>","channel_options")():"last_ra_channel"===t.error?TS.i18n.t("<p>Sorry, you cant convert this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to convert the channel.</p>","channel_options")():"name_taken"===t.error?TS.i18n.t("<p>Sorry, it looks like this channel name is used elsewhere in {org_name}.</p><p>You can try changing the channel name and try again.</p>","channel_options")({org_name:TS.model.enterprise.name}):TS.i18n.t("For some weird reason, that didnt work. Please try again to continue.","channel_options")(),setTimeout(TS.generic_dialog.alert,500,n)})},f(!0),F()},B=!1,D=function(){var e=t.find(".convert_to_shared"),n=!1;"specific"===$('[type="radio"][name="share_with"]:checked').val()&&(0===e.find('[name="domains"]').val().trim().length&&(n=!0));return B&&(n=!0),n},F=function(){var e=t.find(".convert_to_shared");e.on("change",'[type="radio"][name="share_with"]',function(){var t=$(this),n=t.val(),i="specific"===n;e.find(".specific_team").toggleClass("hidden",!i),y(D())}),e.find('[name="domains"]').each(function(e,t){var n=$(t),i=TS.boot_data.page_needs_enterprise?_.filter(TS.model.enterprise_teams,function(e){return e.id!==TS.model.team.id}):[];TS.ui.team_picker.make(n,{teams:i}),n.on("change",function(){var e=TS.ui.team_picker.value(n).map(function(e){return e.team.domain}).join(",");n.val(e)})}),e.on("change",'[name="domains"]',function(){y(D())}),e.on("click",".current_channel_name a",function(t){t.preventDefault(),e.find(".current_channel_name").addClass("hidden"),e.find(".change_channel_name").removeClass("hidden")}),e.on("click",".current_channel_purpose a",function(t){t.preventDefault(),e.find(".current_channel_purpose").addClass("hidden"),e.find(".change_channel_purpose").removeClass("hidden")});var a=e.find('[name="channel_name"]');a.on("focus",function(){$(".validation_message").remove()}),a.on("input paste change blur",function(e){e.preventDefault(),e.stopPropagation(),$(".validation_message").remove(),$('label[for="channel_name"]').removeClass("validation_warning"),$(this).removeClass("validation_warning"),n&&(clearTimeout(n),n=null);var t=function e(){if(i&&i.isPending())return void(n=setTimeout(e.bind(this),325));if(P(),y(!0),TS.ui.validation.validate($(this))){var t=$(this),a=t.val().trim();i=TS.api.callImmediately("enterprise.nameTaken",{name:a,ignore_local_team:!0},function(e,n){if(e){if(n.name_taken){P(!0,!1),B=!0,y(!0);var i=TS.i18n.t('"{new_name}" is already taken by a channel, username, or user group.',"channel_options")({new_name:_.escape(a)});return void TS.ui.validation.showWarning(t,i,{})}P(!0,!0),B=!1,y(D())}else P(!0,!1),B=!0,TS.generic_dialog.alert(TS.i18n.t("For some weird reason, that didnt work. Please try again to continue.","channel_options")())}).catch(function(){i=null,P(!0,!1)})}else P(!0),B=!0};n=setTimeout(t.bind(this),325)})},P=function(e,n){e||(e=!1),n||(n=!1),t.find(".input_wrapper .spinner").toggleClass("hidden",e),n&&O(!e)},O=function(e){a&&(clearTimeout(a),a=null),e||(e=!1),t.find(".input_wrapper .available").toggleClass("hidden",e),e||(a=setTimeout(function(){t.find(".input_wrapper .available").addClass("hidden")},1e3))},R=function(e){if(!TS.model.user.is_restricted){T(TS.i18n.t("Rename this channel","channel_options")());var n;_.isObject(TS.ui.channel_options_dialog.params)&&(n=TS.ui.channel_options_dialog.params.name),n||(n=e.name||"");var i=TS.utility.cleanChannelName(n);v(TS.templates.channel_option_rename_channel({title:i}));var a=TS.i18n.t("Rename channel","channel_options")();e.is_group&&(a=TS.i18n.t("Rename private channel","channel_options")()),b(a);var s,r;m=function(){if(s=t.find(".title_input").val(),r=e.is_channel?"channels.rename":"groups.rename",TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start(),s===e.name)return TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),void TS.ui.fs_modal.close();TS.api.call(r,{name:s,channel:e.id,validate:!0}).then(function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),TS.ui.fs_modal.close()}).catch(function(e){var t=e.data.error,n=TS.ui.validation.getErrorMessage(t,{maxlength:22,name:s});return TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),TS.ui.validation.showWarning(TS.ui.channel_options_dialog.div.find(".title_input"),n,{custom_for:"channel_create_title"})})},f(!0)}},U=function(e){if(T(TS.i18n.t("Set channel purpose","channel_options")()),v(TS.templates.channel_option_purpose({model_ob:e,is_group:e.is_group})),TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()){var n=t.find("#purpose_input");TS.utility.contenteditable.create(n,{modules:{tabcomplete:{positionMenu:function(e){e.style.width=n.outerWidth()+"px",TS.tabcomplete.positionUIRelativeToInput(e,n)},searchOptions:{complete_member_specials:!1},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members]}},onEnter:function(e){return!!e.shiftKey||(h(),!1)},onEscape:function(){return!1},onTextChange:function(){TS.client.channel_page.updatePurposeTooLongWarning(n)}}),TS.utility.contenteditable.enable(n),TS.utility.contenteditable.value(n,TS.utility.unformatTopicOrPurpose(e.purpose.value))}b(TS.i18n.t("Update purpose","channel_options")()),m=function(){var n=t.find("#purpose_input"),i=_.trim(TS.utility.contenteditable.value(n));TS.client.channel_page.isPurposeTooLong(n)||(e.is_group?TS.groups.setPurpose(e.id,i):TS.channels.setPurpose(e.id,i),TS.ui.fs_modal.close())},f(!0)},L=function(e){if(TS.permissions.members.canExportMessageHistory(e)){var t;t=e.is_channel||e.is_group?TS.i18n.t("Export message history for {channel_name}","channel_options")({channel_name:d(e)}):TS.i18n.t("Export message history for <strong>this conversation</strong>","channel_options")(),T(t),v(TS.templates.channel_option_export_history()),b(TS.i18n.t("Export","channel_options")()),m=function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start();var t="channels.export";e.is_group?t="groups.export":e.is_im&&(t="im.export"),TS.api.call(t,{channel:e.id}).then(function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),TS.ui.fs_modal.close()})},f(!0)}},Q={},H={count:100,include_dangling:1,items:[]},N=!1,G={user:[],subteam:[]},j=function(e,n){var i,a=t.find(e+":checked").val(),s=[];return"multi"===a&&(s=t.find(n).lazyFilterSelect("value"),a=s.length?"owner":"admin"),i="type:"+a,s.length&&s.forEach(function(e){e.member?i+=",user:"+e.member.id:e.user_group&&(i+=",subteam:"+e.user_group.id)}),i},z=function(e){var n="";return t.find(e).is(":checked")&&(n="type:all"),n},K=function(e){var t=_.merge({},e);return t.type||(t.type=["ra"]),t.type&&"owner"===t.type[0]&&(t.user&&t.user.length||t.subteam&&t.subteam.length?t.type[0]="multi":t.type[0]="admin"),t},W=function(e){var t=_.merge({},e);return!_.isUndefined(t.type)&&"all"===t.type[0]},V=function(e,t){"@"===e.charAt(0)&&(e=e.substring(1));var n=[Y(Q,G,e,t),q(H,G,e,t)];return Promise.all(n).then(function(e){var t={_replace_all_items:!0,items:[]},n=e[0],i=e[1];return i._items.length&&t.items.push({label:TS.i18n.t("User Groups","channel_options")(),children:i._items}),n.items.length&&t.items.push({label:TS.i18n.t("Members","channel_options")(),children:n.items}),t})},Y=function(e,t,n){return e.query!==n&&(e=_.merge(e,{query:n,include_org:TS.boot_data.page_needs_enterprise,include_slackbot:!1,include_self:!0,full_profile_filter:!0,include_bots:!1,all_of_org:!0,org_team_ids:[]})),Promise.resolve(e).then(function(e){var n=t.user||[];return TS.members.ensureMembersArePresent(n).then(function(){return TS.members.promiseToSearchMembers(e).then(function(e){var t=[];return t=""===e.query?TS.members.getMembersForUser():e.items,e.items=t.map(function(e){return e.member&&void 0!==e.preselected?e:{member:e,lfs_id:"1."+e.id,preselected:n&&n.indexOf(e.id)>-1}}),e})})})},q=function(e,t,n){e._query!==n&&(e._query=n,e.include_enterprise=!0);var i=[{type:"is",value:"group"},{type:"is",value:"group_local"}];n.split(" ").forEach(function(e){""!==e&&i.push({type:"fuzzy",value:e})}),e.query=JSON.stringify({type:"and",clauses:i});var a=t.subteam||[];return TS.user_groups.ensureUserGroupsArePresent(a).then(function(){return TS.api.callImmediately("search.enterprise",e).then(function(t){if(e.num_new=t.data.items.length||0,!t.data.items.length)return Promise.resolve({_items:[]});var n=[];return""===e._query&&(n=TS.user_groups.getActiveUserGroups(!0)||[]),n=_(n).concat(t.data.items).uniqBy(function(e){return e.id}).map(function(e){return e.user_group&&void 0!==e.preselected?e:{user_group:e,lfs_id:"0."+e.id,preselected:a&&a.indexOf(e.id)>-1}}).value(),e._items=n,TS.user_groups.startBatchUpsert(),t.data.items.forEach(function(e){TS.user_groups.upsertUserGroup(e)}),TS.user_groups.finishBatchUpsert(),e})})},J={placeholder_text:TS.i18n.t("Search","channel_options")(),approx_item_height:38,template:function(e){var t="";return e.member?t=TS.templates.enterprise_member_profile_name({member:e.member}):e.user_group&&(t=TS.templates.enterprise_member_profile_name({user_group:e.user_group})),new Handlebars.SafeString(t)},tokenTemplate:function(e){var t="";return e.member?t=TS.templates.enterprise_member_token_sc({member:e.member}):e.user_group&&(t=TS.templates.enterprise_member_profile_name({user_group:e.user_group})),new Handlebars.SafeString(t)},tokenClass:function(e){return e.member?"lfs_token lfs_token_members":e.user_group?"lfs_token lfs_token_user_groups":"lfs_token"},noResultsTemplate:function(e){return e?TS.i18n.t("No match found for <strong>{query}</strong>","channel_options")({query:_.escape(e)}):TS.i18n.t("No match found","channel_options")()}},Z=_.assign({},J,{data_promise:V,onItemAdded:function(e){e.member?(G.user.push(e.member.id),G.user=_.uniq(G.user)):e.user_group&&(G.subteam.push(e.user_group.id),G.subteam=_.uniq(G.subteam)),y(!G.user.length&&!G.subteam.length)},onItemRemoved:function(e){e.member?G.user=G.user.filter(function(t){return t!==e.member.id}):e.user_group&&(G.subteam=G.subteam.filter(function(t){return t!==e.user_group.id})),y(!G.user.length&&!G.subteam.length)}}),X=function(){var e=t.find("[name=who_can_post]:checked").val();N||"multi"!==e||(t.find("#lfs_channel_posting").hide().lazyFilterSelect(Z),N=!0)},ee=function(e){s=null,G={subteam:[],user:[]},N=!1;var t;t=e.is_channel||e.is_group?TS.i18n.t("Manage posting privileges for {channel_name}","channel_options")({channel_name:d(e)}):TS.i18n.t("Manage posting privileges for <strong>this conversation</strong>","channel_options")(),T(t);var n=TS.i18n.t("Fetching channel settings","channel_options")();v(TS.templates.channel_options_posting_privileges({loading_text:n})),k(),b(TS.i18n.t("Save Changes","channel_options")()),m=function(){TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start();var t=j("[name=who_can_post]","#lfs_channel_posting"),n={who_can_post:t};if(TS.boot_data.feature_default_shared_channels){var i=z("[name=can_thread]");n.can_thread=i}var a={prefs:JSON.stringify(n),channel_id:e.id};TS.api.callImmediately("channels.prefs.set",a,function(e,t){if(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),!e){var n=TS.i18n.t("For some weird reason, that didnt work. Please try again to continue.","channel_options")();return TS.generic_dialog.alert(n),void TS.error("Failed with error: "+t.error)}TS.ui.fs_modal.close()})},f();var i=[TS.api.callImmediately("channels.prefs.get",{pref_name:"who_can_post",channel_id:e.id})];TS.boot_data.feature_default_shared_channels&&i.push(TS.api.callImmediately("channels.prefs.get",{pref_name:"can_thread",channel_id:e.id})),Promise.all(i).then(function(e){s=e[0].data.pref_value,s.user&&(G.user=s.user),s.subteam&&(G.subteam=s.subteam);var t={who_can_post:K(s),hide_loading_overlay:!0};TS.boot_data.feature_default_shared_channels&&(r=e[1].data.pref_value,t.can_thread=W(r)),v(TS.templates.channel_options_posting_privileges(t)),te(),X(),A(),c()})},te=function(){t.find("[name=who_can_post]").on("change",function(){var e=$(this).val();t.find(".lfs_channel_posting_selector").toggleClass("hidden","multi"!==e),"multi"===e?(y(!0),X()):y(!1)})},ne=function(e){var n;n=e.is_channel||e.is_group?TS.i18n.t("Edit retention policy for {channel_name}","channel_options")({channel_name:d(e)}):TS.i18n.t("Edit retention policy for <strong>this conversation</strong>","channel_options")(),T(n);var i=ie();v(i),b(TS.i18n.t("Save Settings","channel_options")()),k(),m=function(){function n(n,i){if(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.stop(),!n)return TS.error("failed onDataRetentionChanged"),void("invalid_duration"===i.error?t.find(".invalid_duration_error").removeClass("hidden"):TS.generic_dialog.alert(TS.i18n.t('<p class="no_bottom_margin">Oops! Something went wrong. Please try again.</p>',"channel_options")()));var a="";a=e.is_im?TS.i18n.t("Message retention settings updated for your direct messages with @{username}.","channel_options")({username:e.name}):e.is_mpim?TS.i18n.t("Message retention settings updated for your direct messages with {display_name}.","channel_options")({display_name:e._display_name}):TS.i18n.t("Message retention settings updated for #{channel_name}.","channel_options")({channel_name:e.name}),TS.ui.channel_options_dialog.addTempEphemeralFeedback(a),TS.ui.fs_modal.close()}var i=t.find('select[name="retention_type"]').val(),a=t.find("#retention_duration").val();null!==i&&null!==a&&(TS.ui.channel_options_dialog.ladda&&TS.ui.channel_options_dialog.ladda.start(),e.is_channel?TS.channels.setDataRetention(e.id,i,a,n):e.is_mpim?TS.mpims.setDataRetention(e.id,i,a,n):e.is_im?TS.ims.setDataRetention(e.id,i,a,n):TS.groups.setDataRetention(e.id,i,a,n))},f(),e.is_channel?TS.channels.getDataRetention(e.id,ae):e.is_im?TS.ims.getDataRetention(e.id,re):e.is_mpim?TS.mpims.getDataRetention(e.id,re):TS.groups.getDataRetention(e.id,se)},ie=function(){return'<div class="loading_hash_animation large_margin"><img src="'+cdn_url+'/9c217/img/loading_hash_animation_@2x.gif" alt="Loading" /><br />'+TS.i18n.t("loading...","channel_options")()+"</div>"},ae=function(e,t){e?oe("channel",t.retention.retention_type,t.retention.retention_duration):le("channel",t)},se=function(e,t){e?oe("group",t.retention.retention_type,t.retention.retention_duration):le("group",t)},re=function(e,t){e?oe("conversation",t.retention.retention_type,t.retention.retention_duration):le("conversation",t)},oe=function(e,n,i){var a=TS.model.team.prefs.retention_type,s=TS.model.team.prefs.retention_duration;"group"===e?(a=TS.model.team.prefs.group_retention_type,s=TS.model.team.prefs.group_retention_duration,e="channel"):"conversation"===e&&(a=TS.model.team.prefs.dm_retention_type,s=TS.model.team.prefs.dm_retention_duration);var r=TS.templates.channel_data_retention_dialog({model_type:e,retention_type:n,retention_duration:i,team_type:a,team_duration:s});v(r),t.find('select[name="retention_type"]').change(function(){if(t.find(".invalid_duration_error").addClass("hidden"),1!==parseInt(this.value,10))t.find("#team_retention_pref").removeClass("hidden"),t.find("#retention_duration_container, #retention_duration_warning").addClass("hidden");else{t.find("#team_retention_pref").addClass("hidden"),t.find("#retention_duration_container, #retention_duration_warning").removeClass("hidden");var e=t.find("#retention_duration");0===e.val()&&e.val(""),e.focus()}}).change(),t.find("#retention_duration").change(function(){t.find(".invalid_duration_error").addClass("hidden")}).change(),A(),c()},le=function(e,t){var n;"no_perms"===t.error||"is_archived"===t.error||"not_paid"===t.error?("group"===e&&(e="channel"),n='<p class="no_bottom_margin">'+TS.i18n.t("Sorry! You cant change the retention duration for this {type, select, channel {channel} group {private channel} other {conversation}}.","channel_options")({type:e}),n+="</p>"):n='<p class="no_bottom_margin">'+TS.i18n.t("Oops! Something went wrong. Please try again.","channel_options")()+"</p>",v(n)}}()},2548:function(e,t){!function(){"use strict";TS.registerModule("ui.channel_prefs_dialog",{showing:!1,onStart:function(){TS.prefs.push_changed_sig.add(l),TS.prefs.dtop_notif_changed_sig.add(s),TS.prefs.team_perms_pref_changed_sig.add(i),TS.prefs.muted_channels_changed_sig.add(o)},start:function(t){e||u(),TS.ui.channel_prefs_dialog.showing||(TS.ui.channel_prefs_dialog.renderOptions(e,t),e.modal("show"),e.find(".dialog_cancel").click(c),e.find(".dialog_go").click(d))},renderOptions:function(e,n,i){var r=TS.shared.getModelObById(n);if(!r||r.is_im)return void alert(n+" ???");var d="",c="",_=!1;r.is_channel?(d="channel",c="#"+r.name):r.is_mpim?(_=!0,d="group",c=TS.mpims.getDisplayName(r)):r.is_group&&(d="group",c=r.name),t=n;var u=TS.templates.channel_prefs_dialog({c_or_g:d,is_mpim:_,display_name:c,show_one_suppressed_cb:!0,show_two_suppressed_cbs:!1,is_muted:TS.notifs.isCorGMuted(n),model_ob:r,embedded:i});e.html(u),l(),s(),a(),o(),$("#notifications_not_working").addClass("hidden"),$("#notifications_impossible").addClass("hidden"),$("#notifications_not_yet_allowed").addClass("hidden"),$("#notifications_not_enabled").addClass("hidden"),$("#notifications_not_allowed").addClass("hidden"),$("#notifications_working").removeClass("hidden"),TS.ui.growls.shouldShowPermissionButton()?($("#notifications_working").addClass("hidden"),$("#notifications_not_working").removeClass("hidden"),$("#notifications_not_yet_allowed").removeClass("hidden")):TS.ui.growls.checkPermission()||($("#notifications_working").addClass("hidden"),$("#notifications_not_working").removeClass("hidden"),TS.ui.growls.no_notifications?$("#notifications_impossible").removeClass("hidden"):"denied"===TS.ui.growls.getPermissionLevel()&&$("#notifications_not_allowed").removeClass("hidden"))},showMainPrefs:function(e){c(),setTimeout(function(){TS.ui.prefs_dialog.start(e)},500)}});var e=null,t=null,n=function(e){TS.ui.channel_prefs_dialog.showing&&(e.which==TS.utility.keymap.enter?"BODY"===TS.utility.getActiveElementProp("NODENAME")&&(d(),e.preventDefault()):e.which==TS.utility.keymap.esc&&c())},i=function(e){"who_can_at_channel"!==e&&"who_can_at_everyone"!==e&&"who_can_post_general"!==e||(s(),l(),a())},a=function(){if(t){var e=$("#single_suppressed_cb"),n=$("#single_suppressed_label"),i=$("#single_suppressed_disabled_explain"),a=$("#single_suppressed_div"),s=$("#single_suppressed_disabled_explain_tip_link"),o=TS.notifs.hasUserSuppressedCorGChannelMentionsById(t)||TS.notifs.hasUserSuppressedCorGPushChannelMentions(t),l=TS.notifs.getCalculatedCorGPushNotifySetting(t),d=TS.notifs.getCalculatedCorGNotifySetting(t),c="mentions"===l||"mentions"===d;r(o,"both",c,e,n,i,a,s),c&&("mentions"===l&&"everything"===d?($("#single_suppressed_mobile_qualifier").removeClass("hidden"),$("#single_suppressed_desktop_qualifier").addClass("hidden")):"mentions"===d&&"everything"===l?($("#single_suppressed_desktop_qualifier").removeClass("hidden"),$("#single_suppressed_mobile_qualifier").addClass("hidden")):($("#single_suppressed_desktop_qualifier").addClass("hidden"),$("#single_suppressed_mobile_qualifier").addClass("hidden")),"mentions"===l?$("#single_suppressed_mobile_disclaimer").removeClass("hidden"):$("#single_suppressed_mobile_disclaimer").addClass("hidden"))}},s=function e(){if(t){var n=TS.notifs.getCalculatedCorGNotifySetting(t);$("#all_everything_default").addClass("hidden"),$("#all_mentions_default").addClass("hidden"),$("#all_nothing_default").addClass("hidden"),TS.model.prefs.growls_enabled&&TS.model.prefs.all_channels_loud?$("#all_everything_default").removeClass("hidden"):TS.model.prefs.growls_enabled?$("#all_mentions_default").removeClass("hidden"):$("#all_nothing_default").removeClass("hidden"),$('input:radio[name="channel_loud_rd"]').filter('[value="'+n+'"]').prop("checked",!0),$('input:radio[name="channel_loud_rd"]').unbind("change").bind("change",function(){var n=$(this).val();"everything"===n?TS.notifs.makeCorGDTopEverything(t):"mentions"===n?TS.notifs.makeCorGDTopMentions(t):TS.notifs.makeCorGDTopNothing(t),TS.boot_data.feature_channel_alert_words&&TS.ui.inline_saver.show({target:"[data-notification-table-header]"}),TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(",")}),e(),a()});var i=$("#suppressed_cb"),s=$("#suppressed_label"),o=$("#suppressed_disabled_explain"),l=$("#suppressed_span"),d=$("#suppressed_disabled_explain_tip_link"),c="mentions"===n;r(TS.notifs.hasUserSuppressedCorGChannelMentionsById(t),"at_channel_suppressed_channels",c,i,s,o,l,d),a()}},r=function(e,n,i,a,s,r,o,l){if(t){i?o.removeClass("hidden"):o.addClass("hidden");var d=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t),c=TS.model.team.prefs,_=!1;if("admin"===c.who_can_at_channel||"owner"===c.who_can_at_channel?_=!0:!d.is_general||"admin"!==c.who_can_at_everyone&&"owner"!==c.who_can_at_everyone&&"admin"!==c.who_can_post_general&&"owner"!==c.who_can_post_general||(_=!0),_){s.addClass("subtle_silver"),s.css("cursor","default"),r.removeClass("hidden"),$("#single_suppressed_mobile_disclaimer").addClass("hidden"),a.prop("disabled",!0),a.prop("checked",!1);var u,m="C"===t.charAt(0)?"channel":"group";u="group"===m?TS.i18n.t("A Team Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")}):d.is_general?TS.i18n.t("A Team Owner has restricted who can post to general and/or restricted the use of <b>{channel}</b> and/or <b>{everyone}</b> to admins and/or owners. These notifications can not be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel"),everyone:TS.templates.builders.atLabel("everyone")}):TS.i18n.t("A Team Owner has restricted the use of <b>{channel}</b> to admins and/or owners. These notifications cannot be ignored.","channel_prefs")({channel:TS.templates.builders.atLabel("channel")}),l.tooltip("destroy").attr("title",u).tooltip({html:!0,container:"#channel_prefs_dialog"})}else s.removeClass("subtle_silver"),s.css("cursor",""),r.addClass("hidden"),a.prop("disabled",!1),a.prop("checked",e),a.unbind("change").bind("change",function(){var e=!!$(this).prop("checked");"both"!==n&&"at_channel_suppressed_channels"!==n||(e?TS.notifs.makeCorGSuppressed(t):TS.notifs.makeCorGNOTSuppressed(t),TS.prefs.setPrefByAPI({name:"at_channel_suppressed_channels",value:TS.model.at_channel_suppressed_channels.join(",")})),"both"!==n&&"push_at_channel_suppressed_channels"!==n||(e?TS.notifs.makeCorGPushSuppressed(t):TS.notifs.makeCorGNOTPushSuppressed(t),TS.prefs.setPrefByAPI({name:"push_at_channel_suppressed_channels",value:TS.model.push_at_channel_suppressed_channels.join(",")})),TS.boot_data.feature_channel_alert_words&&TS.ui.inline_saver.show({target:"[data-muting-options-header]"})})}},o=function(){if(t){var e=TS.notifs.isCorGMuted(t),n=$("#muting_cb"),i=$("#non_muting_prefs"),a=$("#muting_info");n.prop("checked",e),n.unbind("change").bind("change",function(){TS.notifs.muteOrUnmuteCorG(t),TS.boot_data.feature_channel_alert_words&&TS.ui.inline_saver.show({target:"[data-muting-options-header]"})}),e?(i.slideUp(150),a.removeClass("hidden")):(i.slideDown(150),a.addClass("hidden"))}},l=function e(){if(t){var n=TS.notifs.getCalculatedCorGPushNotifySetting(t);$("#all_push_everything_default").addClass("hidden"),$("#all_push_mentions_default").addClass("hidden"),$("#all_push_nothing_default").addClass("hidden"),TS.model.prefs.push_everything?$("#all_push_everything_default").removeClass("hidden"):TS.model.prefs.push_mention_alert?$("#all_push_mentions_default").removeClass("hidden"):$("#all_push_nothing_default").removeClass("hidden"),$('input:radio[name="channel_push_loud_rd"]').filter('[value="'+n+'"]').prop("checked",!0),$('input:radio[name="channel_push_loud_rd"]').unbind("change").bind("change",function(){var n=$(this).val();"everything"===n?TS.notifs.makeCorGPushEverything(t):"mentions"===n?TS.notifs.makeCorGPushMentions(t):TS.notifs.makeCorGPushNothing(t),TS.boot_data.feature_channel_alert_words&&TS.ui.inline_saver.show({target:"[data-notification-table-header]"}),TS.prefs.setMultiPrefsByAPI({push_loud_channels:TS.model.push_loud_channels.join(","),push_mention_channels:TS.model.push_mention_channels.join(","),push_loud_channels_set:TS.model.push_loud_channels_set.join(",")}),e(),a()});var i=$("#push_suppressed_cb"),s=$("#push_suppressed_label"),o=$("#push_suppressed_disabled_explain"),l=$("#push_suppressed_span"),d=$("#push_suppressed_disabled_explain_tip_link"),c="mentions"===n;r(TS.notifs.hasUserSuppressedCorGPushChannelMentions(t),"push_at_channel_suppressed_channels",c,i,s,o,l,d),a()}},d=function(){if(!TS.ui.channel_prefs_dialog.showing)return void TS.error("not showing?");e.modal("hide")},c=function(){e.modal("hide")},_=function(){t=null,TS.model.dialog_is_showing=!1,TS.ui.channel_prefs_dialog.showing=!1,$(window.document).unbind("keydown",n)},u=function(){$("body").append('<div id="channel_prefs_dialog" class="modal hide fade"></div>'),e=$("#channel_prefs_dialog"),TS.boot_data.feature_notif_prefs_overhaul&&e.addClass("feature_notif_prefs_overhaul"),e.on("hide",function(e){e.target==this&&_()}),TS.boot_data.feature_notif_prefs_overhaul&&e.on("hidden",function(t){t.target==this&&(e.remove(),e=null)}),e.on("show",function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.channel_prefs_dialog.showing=!0)}),e.on("shown",function(e){e.target==this&&setTimeout(function(){$(window.document).bind("keydown",n)},100)})}}()},2614:function(e,t){!function(){"use strict";TS.registerModule("ui.fs_modal_file_viewer",{start:function(e){return(w=e)&&(w.current_file_id||w.current_external_link)?TS.ui.fs_modal_file_viewer.is_showing?void TS.error("Full screen file viewer modal is already showing."):(TS.files.team_file_comment_added_sig.add(pe),TS.files.team_file_comment_deleted_sig.add(pe),TS.files.team_file_deleted_sig.add(Ae),TS.files.team_file_changed_sig.add(Q),TS.channels.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.ims.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.groups.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.mpims.message_received_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.channels.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.ims.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.groups.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.mpims.message_removed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.channels.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.ims.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.groups.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.mpims.message_changed_sig.add(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.members.changed_current_status_sig.add(TS.ui.fs_modal_file_viewer.updateCurrentStatusForMember,TS.ui.fs_modal_file_viewer),TS.ui.fs_modal.start(se()),TS.ui.fs_modal_file_viewer.is_showing=!0,V(),me(),he(),ue(),ge(),Te(),_e("both"),void setTimeout(function(){re()},0)):void TS.error("Full screen file viewer modal requires something to show.")},getCurrentFileId:function(){return!!TS.ui.fs_modal_file_viewer.is_showing&&(w.current_file_id?w.current_file_id:!!w.current_external_link&&w.current_external_link.getAttribute("data-src"))},previous:function(){e.find(".previous_btn:not([disabled])").length&&de(-1)},next:function(){e.find(".next_btn:not([disabled])").length&&de(1)},updateGallery:function(){TS.client.activeChannelIsHidden()||setTimeout(function(){var e=$("#msgs_div").find(".file_viewer_link, .file_viewer_external_link, .thumbnail_link");e!==S&&(S=e,TS.model.pdf_viewer_enabled&&Y(),he(),ue())},500)},updateCurrentStatusForMember:function(e){if(TS.ui.fs_modal_file_viewer.is_showing){var t={member:e,for_message:!0};$(".aside_panel .message_current_status.color_"+e.id).replaceWith(TS.templates.current_status(t))}},storeLastCommentInput:function(){e&&b&&b.file&&b.file.id&&TS.storage.storeLastCommentInput(b.file.id,TS.utility.contenteditable.value(e.find("#file_comment")))},test:function(){return{_generateTemplateArguments:ee,_shouldDisplayLargestThumb:X}},canClose:function(){return F()}});var e,t,n,i,a,s,r,o,l,d,c,u,m,h,p,g,f,S,T,v=$("body"),b={index:0,aside_panel_showing:!1},w={},y=function(){e=$(".fs_modal_file_viewer"),t=e.find(".fs_modal_file_viewer_content"),n=e.find(".viewer"),k(),s=n.find(".images"),A(),C()},k=function(){i=e.find(".fs_modal_file_viewer_header"),a=i.find(".file_header_detailed")},A=function(){r=s.find(".scaled_image"),o=s.find(".actual_pixel_image")},C=function(){l=e.find(".comment_btn"),d=e.find(".aside_panel"),c=e.find(".details_container"),u=e.find(".comments_container"),m=e.find(".shared_to_conversations"),h=e.find(".file_comment_form_container")},M=function(){e=null,t=null,n=null,r=null,s=null,l=null,d=null,c=null,u=null,m=null,h=null,o=null,i=null,a=null,S=null,w.$el=null},x=function(){q(),we(),L(),TS.ui.inline_edit.end(),J(),ke(),M(),TS.ui.fs_modal_file_viewer.is_showing=!1},I=function(){y(),E(),ye(),b.is_pdf&&(T=new TS.ui.PdfViewer(s.find("#pdf_display"),b.file))},E=function(){e.on("click",".comment_btn, .aside_close_btn",H),e.on("click","#fs_modal_close_btn, .channel_link, .group_link, .file_preview_link",TS.ui.fs_modal.close),e.on("mousedown",".viewer",O),e.on("click",".viewer",R),e.on("click",".scaled_image",function(e){e.stopPropagation(),z(e)}),e.on("click",".actual_pixel_image",function(e){e.stopPropagation(),K()}),e.on("click",".previous_btn",function(e){e.stopPropagation(),TS.ui.fs_modal_file_viewer.previous()}),e.on("click",".next_btn",function(e){e.stopPropagation(),TS.ui.fs_modal_file_viewer.next()}),e.on("click",".file_comment_btn",function(e){var t=$(e.target),n=t.closest("[data-model-ob-id]").attr("data-model-ob-id");ge(n)}),e.on("click",".aside_back_btn",function(){ge(null)}),v.on("keydown",D),TS.view.resize_sig.add(re),t.on("click.view",TS.view.onFilePreviewClick),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||e.on("textchange","#file_comment",function(){TS.storage.storeLastCommentInput(b.file.id,$(this).val())}),B()},B=function(){e.find(".scaled_image").on("error",function(){s&&s.addClass("broken_image")})},D=function(e){switch(e.which){case TS.utility.keymap.up:if(TS.utility.isFocusOnInput())return;if(!b.is_actual_pixel_image_shown)return;e.preventDefault(),e.stopPropagation(),W("up");break;case TS.utility.keymap.down:if(TS.utility.isFocusOnInput())return;if(!b.is_actual_pixel_image_shown)return;e.preventDefault(),e.stopPropagation(),W("down");break;case TS.utility.keymap.left:if(TS.utility.isFocusOnInput())return;e.preventDefault(),e.stopPropagation(),b.is_actual_pixel_image_shown?W("left"):TS.ui.fs_modal_file_viewer.previous();break;case TS.utility.keymap.right:if(TS.utility.isFocusOnInput())return;e.preventDefault(),e.stopPropagation(),b.is_actual_pixel_image_shown?W("right"):TS.ui.fs_modal_file_viewer.next();break;case TS.utility.keymap.space:if(TS.utility.isFocusOnInput())return;e.preventDefault(),e.stopPropagation(),j(e);break;case TS.utility.keymap.esc:U(e)}},F=function(){return!TS.ui.react_emoji_menu.is_showing&&(!TS.model.menu_is_showing&&(!TS.model.dialog_is_showing&&(!TS.utility.isTabCompleteShowing()&&!TS.ui.inline_edit.containsActiveElement(e))))},P=!0,O=function(){P=F()},R=function(e){P&&($(e.target).closest(".control_btns").length||TS.ui.fs_modal.close())},U=function(e){TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()&&TS.utility.isFocusOnInput()||F()&&(e.stopPropagation(),e.preventDefault(),b.is_actual_pixel_image_shown?K():TS.ui.fs_modal.close())},L=function(){e.off("click"),v.off("keydown",D),TS.view.resize_sig.remove(re)},Q=function(t){if(e.length&&b.file.id===t.id){var n=ee(),i=!1;TS.ui.inline_edit.containsActiveElement(a)&&(i=!0),i||(a.replaceWith(TS.templates.file_header_detailed(n)),k())}},H=function(){b.aside_panel_showing?G():N()},N=function(){l.addClass("active"),t.addClass("aside_panel_active"),b.aside_panel_showing=!0,window.setTimeout(function(){g.focus()},250)},G=function(){l.removeClass("active"),t.removeClass("aside_panel_active"),b.aside_panel_showing=!1,window.setTimeout(function(){l.blur()},250)},j=function(e){b.is_actual_pixel_image_shown?K():z(e)},z=function(e){if(b.is_image_within_viewer)return!1;var t=oe(e);n.addClass("show_actual_pixel"),b.is_actual_pixel_image_shown=!0,le(t)},K=function(){n.removeClass("show_actual_pixel"),b.is_actual_pixel_image_shown=!1,n.scrollLeft(0),n.scrollTop(0)},W=function(e){var t=n[0];if(t){var i="up"===e||"down"===e,a=i?"scrollTop":"scrollLeft",s=25;"up"!==e&&"left"!==e||(s*=-1),t[a]+=s}},V=function(){if(TS.client.activeChannelIsHidden())return void(S=$());S=$("#msgs_div").find(".file_viewer_link, .file_viewer_external_link, .thumbnail_link"),TS.model.pdf_viewer_enabled&&Y()},Y=function(){S=S.filter(function(){var e=$(this),t=e.attr("data-file-id");return!TS.files.fileIsPDF(t)})},q=function(){TS.files.team_file_comment_added_sig.remove(pe),TS.files.team_file_comment_deleted_sig.remove(pe),TS.files.team_file_deleted_sig.remove(Ae),TS.files.team_file_changed_sig.remove(Q),TS.channels.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.ims.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.groups.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.mpims.message_received_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.channels.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.ims.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.groups.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.mpims.message_removed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.channels.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.ims.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.groups.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer),TS.mpims.message_changed_sig.remove(TS.ui.fs_modal_file_viewer.updateGallery,TS.ui.fs_modal_file_viewer)},J=function(){w.current_file_id=null,w.current_external_link=null,b.external_file_src=null,b.link_url=null,b.is_image_within_viewer=null,T&&(T.destroy(),T=null)},Z=function(){w.current_file_id?(b.file=TS.files.getFileById(w.current_file_id),b.member=TS.members.getMemberById(b.file.user),b.original_w=b.file.original_w,b.original_h=b.file.original_h,b.is_pdf=TS.model.pdf_viewer_enabled&&TS.files.fileIsPDF(b.file),TS.files.fetchFileInfo(b.file.id,function(){if(b.file&&b.file.comments&&b.file.comments.length&&!TS.boot_data.feature_share_mention_comment_cleanup){(d||$()).find(".comments").html(TS.templates.builders.buildComments(b.file))}})):w.current_external_link?(b.file={},b.model_ob=ne(),b.msg=ie(),b.member=ae(b.msg),b.link_url=w.current_external_link.getAttribute("data-link-url"),b.external_file_src=w.current_external_link.getAttribute("data-src"),b.original_w=w.current_external_link.getAttribute("data-width"),b.original_h=w.current_external_link.getAttribute("data-height"),b.rotation=w.current_external_link.getAttribute("data-rotation"),b.content_type=w.current_external_link.getAttribute("data-content-type"),b.is_pdf=!1):b.file={}},X=function(e){var t=!1===TS.model.prefs.a11y_animations&&"gif"===e.filetype&&!e.deanimate_gif,n="external"===e.mode,i=e.image_exif_rotation>4,a="tiff"===_.toLower(e.pretty_type);return t||n||i||a},ee=function(){var e,t=b.file.comments_count?b.file.comments_count:"",n=!b.external_file_src||w.current_file_id;e=n?TS.templates.builders.makeFileShareLabel(b.file):TS.templates.builders.makeMessageShareLabelSafe(b.model_ob);var i=n?b.file.timestamp:b.msg&&b.msg.ts,a=n?"file":"message",s="message"===a?b.msg:b.file,r="message"===a?b.model_ob:null,o=b.file.id?TS.files.getFileActions(b.file):{};o.more=n;var l;TS.boot_data.feature_name_tagging_client||(l=n?TS.templates.inline_edit_file_title({file:b.file,actions:o}):TS.templates.builders.makeMessageLinkLabelSafe(b.link_url)),TS.boot_data.feature_share_mention_comment_cleanup&&TS.files.createFileCommentsGroup(b.file);var d={file:b.file,member:b.member,title:l,share_label:e,timestamp:i,star_type:a,star_ob:s,star_parent_ob:r,msg:b.msg,model_ob:b.model_ob,comments_count:t,is_aside_panel_active:!!b.aside_panel_showing,show_open_public_link:n&&!TS.model.team.prefs.disallow_public_file_urls,show_revoke_public_link:n&&!TS.model.team.prefs.disallow_public_file_urls&&TS.files.getFileActions(b.file).revoke_public_link,control_btns:w.show_control_btns,actions:o,link_url:b.link_url};if(TS.model.pdf_viewer_enabled&&b.is_pdf)d.file_is_pdf=!0,d.control_btns=!1,d.pdf_viewer_url=TS.boot_data.abs_root_url+"pdf-viewer?feature_pdf_viewer=1";else{var c=te(b),_=c.scaled,u=c.actual_pixel;d.scaled_src=_,d.scaled_rotation=_===b.file.url_private&&b.file.image_exif_rotation,d.actual_pixel_src=u,d.actual_pixel_rotation=u===b.file.url_private&&b.file.image_exif_rotation}return d},te=function(e){var t=e.file.url_private;if(X(e.file)?t=TS.files.getThumbSrcForFile(e.file,{max_size:1024}):!1===TS.model.prefs.a11y_animations&&"gif"===e.file.filetype&&e.file.deanimate_gif&&(t=e.file.deanimate_gif),e.external_file_src){var n={};n.rotate=!!parseInt(e.rotation,10),"image/svg+xml"===e.content_type&&(n.render_svg=!0,n.width=e.original_w,n.height=e.original_h),t=TS.utility.getImgProxyURLWithOptions(e.external_file_src,n)}var i=t;if(e.file.thumb_1024&&!e.file.thumb_360_gif){($(window).width()<e.file.thumb_1024_w||$(window).height()<e.file.thumb_1024_h)&&(t=e.file.thumb_1024)}return{scaled:t,actual_pixel:i}},ne=function(){var e,t=$(w.current_external_link);if(t.closest(".search_message_result").length){var n=t.closest(".search_message_result").data("channel");e=TS.ims.getImById(n)||TS.channels.getChannelById(n)||TS.groups.getGroupById(n)||TS.mpims.getMpimById(n)}else t.closest("#messages_container").length&&(e=TS.shared.getActiveModelOb());return e||{}},ie=function(){var e=$(w.current_external_link).closest("ts-message").data("ts");return TS.utility.msgs.findMsg(e,b.model_ob.id)||{ts:e}},ae=function(e){return!!e&&TS.members.getMemberById(e.user)},se=function(){Z(),b.aside_panel_showing=!1;var e="fs_modal_file_viewer";return TS.boot_data.feature_share_mention_comment_cleanup&&(e+=" with_conversations"),$.extend({},{modal_class:e,modal_contents_container_class:"fs_modal_file_viewer_content",disable_default_controls:!0,body_template_html:TS.templates.fs_modal_file_viewer(ee()),onShow:I,onEnd:x})},re=function(){if(b.is_image_within_viewer=null,n&&!b.is_pdf){var e,t,i=n.width(),a=n.height();if(X(b.file)){var s=TS.files.getThumbSrcForFile(b.file,{max_size:1024}),l=_.invert(b.file)[s];l&&b.file&&(e=b.file[l+"_w"],t=b.file[l+"_h"])}else e=b.original_w,t=b.original_h;e||(e=o.width()),t||(t=o.height());var d=e-i,c=t-a;d<1&&c<1&&(b.is_image_within_viewer=!0),b.is_image_within_viewer?r.addClass("no_zoom"):r.removeClass("no_zoom")}},oe=function(e){if(e.pageX){var t={width:r.width(),height:r.height()},n={x:e.pageX-r.offset().left,y:e.pageY-r.offset().top};return{x:n.x/t.width,y:n.y/t.height}}return{x:.5,y:.5}},le=function(e){var t={x:(o.width()-n.width())*e.x,y:(o.height()-n.height())*e.y};n.scrollLeft(t.x),n.scrollTop(t.y)},de=function(e){if(TS.ui.inline_edit.end(),J(),b.index+=e,S){var t=S.eq(b.index);w.current_file_id=t.data("file-id"),t.hasClass("file_viewer_external_link")&&(w.current_external_link=t[0],b.aside_panel_showing&&!w.current_file_id&&H()),ce(),ye(),B(),_e(e)}},ce=function(){Z();var e=ee(),t=$(TS.templates.fs_modal_file_viewer_header(e));if(i.replaceWith(t),i=t,b.is_pdf){var n=$(TS.templates.fs_modal_file_viewer_content_pdf(e));s.replaceWith(n),s=n,T=new TS.ui.PdfViewer(s.find("#pdf_display"),b.file)}else{var a=$(TS.templates.fs_modal_file_viewer_content_image(e));s.replaceWith(a),s=a}if(A(),ve(),TS.boot_data.feature_share_mention_comment_cleanup)ge();else{var r=$(TS.templates.fs_modal_file_viewer_aside(e));d.replaceWith(r),d=r}C(),be(),ue(),re()},_e=function e(t){"both"===t&&(e(1),t=-1);var n=b.index+t;if(!(!S||n<0||S.length<=n)){var i=S.eq(n),a=i.hasClass("file_viewer_external_link"),s={file:TS.files.getFileById(i.data("file-id"))||{},external_file_src:a?i.data("src"):void 0};if(!TS.model.pdf_viewer_enabled||!TS.files.fileIsPDF(s.file)){var r=te(s);(new Image).src=r.scaled}}},ue=function(){if(e){var t=e.find(".control_btns"),n=e.find(".previous_btn"),i=e.find(".next_btn");1===S.length||0===S.length?t.addClass("hidden"):t.removeClass("hidden"),n.attr("disabled",b.index<=0),i.attr("disabled",b.index>=S.length-1)}},me=function(){var e={};S=S.filter(function(){var t=this.getAttribute("data-file-id")?this.getAttribute("data-file-id"):"";return t+=this.getAttribute("data-src")?this.getAttribute("data-src"):"",!e.hasOwnProperty(t)&&(e[t]=!0,!0)})},he=function(){for(var e=0;e<S.length;e+=1)if(S[e].getAttribute("data-file-id")){if(S[e].getAttribute("data-file-id")===w.current_file_id){b.index=e;break}}else if(S[e].getAttribute("data-src")===b.external_file_src){b.index=e;break}},pe=function(){if(e){var t=b.file.comments&&b.file.comments.length;e.find(".comment_count").text(t||"")}},ge=function(e){TS.boot_data.feature_share_mention_comment_cleanup&&(e=null!==e&&(e||w.$el.closest("[data-model-ob-id").attr("data-model-ob-id")),e?Se(e):fe())},fe=function(){TS.files.createFileCommentsGroup(b.file),m.replaceWith(TS.templates.shared_to_conversations(b.file)),d.attr("data-model-ob-id",""),h.addClass("hidden"),c.unhideWithRememberedScrollTop(),u.hideWithRememberedScrollTop()},Se=function(e){TS.files.createFileCommentsGroup(b.file);var t=jQuery.extend(!0,{},b.file),n=t._comments_grouped[e];t.comments=n.comments;var i=TS.shared.getModelObById(e),a=i&&TS.shared.getDisplayNameForModelOb(i),s=t.id?TS.files.getFileActions(t):{},r={file:t,name:a,actions:s};u.html(TS.templates.fs_modal_file_viewer_comments(r)),d.attr("data-model-ob-id",e),s.comment?h.removeClass("hidden"):h.addClass("hidden"),u.unhideWithRememberedScrollTop(),c.hideWithRememberedScrollTop()},Te=function(){ve(),be()},ve=function(){g=$("#file_comment"),p=$("#file_comment_form").detach(),f=$("#file_edit_comment_form").detach()},be=function(){h.append(p),h.append(f);var e=TS.storage.fetchLastCommentInput(b.file.id);e?TS.utility.contenteditable.value(g,e):TS.utility.contenteditable.clear(g),TS.utility.contenteditable.clearHistory(g)},we=function(){TS.ui.comments.onEndEdit();var e;e=TS.boot_data.feature_share_mention_comment_cleanup?$(".file_comments_scroller"):$("#file_preview_scroller");var t=$("#file_comment_form").detach(),n=$("#file_edit_comment_form").detach();if(e.append(t),e.append(n),b.file.id!==TS.model.last_previewed_file_id){var i=TS.storage.fetchLastCommentInput(TS.model.last_previewed_file_id);i?TS.utility.contenteditable.value($("#file_comment_form #file_comment"),i):TS.utility.contenteditable.clear($("#file_comment_form #file_comment")),TS.utility.contenteditable.clearHistory($("#file_comment_form #file_comment")),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||$("#file_comment_form #file_comment").trigger("keyup")}},ye=function(){TS.client.downloads.addIndividualDownload(e.find(".flex_menu_download_circle"),w.current_file_id)},ke=function(){TS.client.downloads.removeIndividualDownload()},Ae=function(){TS.ui.fs_modal.close(!0)}}()},2615:function(e,t){!function(){"use strict";TS.registerModule("ui.growls",{no_notifications:!1,permission_changed_sig:new signals.Signal,onStart:function(){if(TS.ui.growls.updateTotalUnreadDisplaysSSBThrottled=TS.utility.throttleFunc(TS.ui.growls.updateTotalUnreadDisplaysSSB,500,!0),TS.channels.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.channels.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.groups.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.groups.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.ims.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.ims.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.mpims.unread_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.mpims.unread_highlight_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls):TS.ms.connected_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.prefs.mac_ssb_bullet_changed_sig.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.client.threads.threads_unread_changed.add(TS.ui.growls.updateTotalUnreadDisplays,TS.ui.growls),TS.ui.window_focus_changed_sig.add(TS.ui.growls.windowFocusChanged,TS.ui.growls),window.macgap);else if(window.Notification||window.webkitNotifications);else if(!window.winssb)return void(TS.ui.growls.no_notifications=!0);TS.channels.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls),TS.groups.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls),TS.mpims.message_received_sig.add(TS.ui.growls.channelOrGroupMessageReceived,TS.ui.growls),TS.ims.message_received_sig.add(TS.ui.growls.imMessageReceived,TS.ui.growls)},shouldShowPermissionButton:function(){return!TS.ui.growls.no_notifications&&(!TS.ui.growls.checkPermission()&&"denied"!==TS.ui.growls.getPermissionLevel())},checkPermission:function(){return!TS.ui.growls.no_notifications&&(!!window.macgap||(!!window.winssb||"granted"===TS.ui.growls.getPermissionLevel()))},perm_map:{0:"granted",1:"default",2:"denied"},getPermissionLevel:function(){return TS.ui.growls.no_notifications?"na":window.macgap?"na":window.winssb?"na":window.webkitNotifications&&window.webkitNotifications.checkPermission?TS.ui.growls.perm_map[window.webkitNotifications.checkPermission()]:window.Notification?window.Notification.permission:void 0},promptForPermission:function(e){if(TS.ui.growls.no_notifications)return void(e&&e(!1,-9999999));var t=function(){e&&e(TS.ui.growls.checkPermission(),TS.ui.growls.getPermissionLevel()),TS.ui.growls.permission_changed_sig.dispatch(TS.ui.growls.checkPermission(),TS.ui.growls.getPermissionLevel())};window.webkitNotifications&&window.webkitNotifications.requestPermission&&window.webkitNotifications.checkPermission?window.webkitNotifications.requestPermission(t):window.Notification&&window.Notification.requestPermission(t)},show:function(e,t,n,a){a=a||{};var s=a.msg,r=a.channelId,o=a.subtitle,l=a.launchUri,d=a.soundUrl,c=TS.sounds.filenameForSoundName(a.sound_name||"new_message"),_=a.imageUri,u=a.avatarImage;if((!TS.utility.calls.isScreenSharing()||a.is_call_notification)&&TS.ui.growls.checkPermission()){var m;if(window.winssb)m={title:e,subtitle:o,content:t,launchUri:l,imageUri:_,channel:r||"",msg:s&&s.ts||"",avatarImage:u,ssbFilename:c},s&&s.thread_ts&&(m.thread_ts=s.thread_ts),TSSSB.call("notify",m),i(r,s);else if(window.macgap){var h=function(){window.focus(),TS.boot_data.feature_focus_mode&&TS.ui.focus_mode.is_in_focus_mode&&TS.ui.focus_mode.end(),n&&n()};window.macgap.growl?window.macgap.growl.notify({title:e,content:t,onclick:h,channel:r||""}):window.macgap.notice&&TSSSB.call("notify",{title:e,subtitle:o,content:t,soundUrl:d,ssbFilename:c,onclick:h,channel:r||"",msg:s&&s.ts||""})}else{var p;if(window.webkitNotifications?p=window.webkitNotifications.createNotification(TS.boot_data.img.app_icon,e,t):window.Notification&&(p=new Notification(e,{body:t,icon:TS.boot_data.img.app_icon,tag:"tag_"+(s?s.id||s.ts||Date.now():Date.now())})),!p)return;try{p.onclick=function(){window.focus(),TS.boot_data.feature_focus_mode&&TS.ui.focus_mode.is_in_focus_mode&&TS.ui.focus_mode.end(),n&&n(),this.cancel?this.cancel():this.close&&this.close()}}catch(e){}var g=function(){setTimeout(function(){p.cancel?p.cancel():p.close&&p.close()},t&&t.length>80?1e4:5e3)};if(p)try{p.onshow=g,setTimeout(g,1e3)}catch(e){g()}p.show&&p.show()}}},updateTotalUnreadDisplays:function(e,t){(window.macgap||window.winssb)&&(t&&!0===t?TS.ui.growls.updateTotalUnreadDisplaysSSBThrottled():TS.ui.growls.updateTotalUnreadDisplaysSSB()),TS.model.all_unread_highlights_cnt?TS.view.changeUnreadStatus("mentions"):TS.model.all_unread_cnt?TS.view.changeUnreadStatus("unreads"):TS.view.changeUnreadStatus("")},updateTotalUnreadDisplaysSSBThrottled:_.noop,updateTotalUnreadDisplaysSSB:function(){var e=TS.model.all_unread_highlights_cnt,t=TS.model.all_unread_cnt;TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts&&(TS.model.all_unread_highlights_cnt_to_exclude&&(TS.has_pri[a]&&TS.log(a,"updateTotalunreadDisplaysSSB: TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude),e=Math.max(0,e-TS.model.all_unread_highlights_cnt_to_exclude)),TS.model.all_unread_cnt_to_exclude&&(TS.has_pri[a]&&TS.log(a,"updateTotalunreadDisplaysSSB: TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude),t=Math.max(0,t-TS.model.all_unread_cnt_to_exclude))),TS.has_pri[a]&&TS.log(a,"TSSSB.call('setBadgeCount') - all_unread_highlights_cnt = "+e+", all_unread_cnt = "+t+", bullet = "+(!window.macgap&&!window.winssb||!TS.model.prefs.mac_ssb_bullet?"false":"true")),TSSSB.call("setBadgeCount",{all_unread_highlights_cnt:e,all_unread_cnt:t,bullet:!(!window.macgap&&!window.winssb)&&!!TS.model.prefs.mac_ssb_bullet})},getGrowlableTxtFromFile:function(e){if(e&&e.file){return TS.templates.builders.msgs.buildFileShareMetaText(e,!0)}},getGrowlableTxtFromAttachments:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(n.fallback)return n.fallback;if(n.text)return n.text;if(n.pretext)return n.pretext;if(n.footer)return n.footer}return null},no_growl_subtypes:["channel_leave","channel_join","group_leave","group_join"],channelOrGroupMessageReceived:function(t,n){if(!n)return void TS.error("no msg?");if(!n.no_display)return t?void e(t,n).then(function(){TS.ui.growls.growlChannelOrGroupMessage(t,n,!0)}):void TS.error("no channel/group?")},growlChannelOrGroupMessage:function(e,t,n,i){if(!t)return void TS.error("no msg?");if(!t.no_display){if(!e)return void TS.error("no channel/group?");var s,r,o=TS.notifs.canCorGHaveChannelMentions(e.id),l=!0,d=!1;if(TS.utility.msgs.isMsgReply(t)){var c=TS.replies.getSubscriptionState(e.id,t.thread_ts);l=c&&c.subscribed,d=!l}if(o){var _="away"===TS.model.user.presence;TS.utility.msgs.isMsgReply(t)&&(_=_||!l),s=TS.utility.msgs.msgContainsMention(t,_,d),s&&TS.mentions.maybeUpdateMentions()}else r=TS.utility.msgs.getMsgMentionData(t,d),s=r.non_channel_mentions,r.mentions&&TS.mentions.maybeUpdateMentions();if(i||!t.subtype||-1==TS.ui.growls.no_growl_subtypes.indexOf(t.subtype)){var u=TS.notifs.isCorGMuted(e.id),m=TS.utility.msgs.msgCanCountAsUnread(t),h=t._hidden_reply,p=(m||h)&&s,g=TS.ui.growls.containsCmd(t.text),f=TS.notifs.getCalculatedCorGNotifySetting(e.id);if((i||"bot_message"!==t.subtype||"everything"===f||s)&&(n&&m&&!TS.model.ui.is_window_focused&&(p&&-1==document.title.indexOf("!")?document.title="! "+document.title:u||-1!=document.title.indexOf("*")||(document.title="* "+document.title)),(i||"nothing"!==f)&&(!TS.utility.msgs.isMsgReply(t)||i||"everything"!==f||l||(f="mentions"),TS.ui.growls.checkPermission()))){var S=!(e.id!=TS.model.active_channel_id&&e.id!=TS.model.active_group_id&&e.id!=TS.model.active_mpim_id||h||TS.client.activeChannelIsHidden()),T=t.thread_ts&&e.id===TS.ui.replies.activeConvoModelId()&&t.thread_ts===TS.ui.replies.activeConvoThreadTs(),v=!1;if(p&&(v=!0),h&&l&&TS.model.prefs.threads_everything&&"nothing"!==f&&(v=!0),"everything"===f&&(v=!0),v&&(S||T)&&TS.model.ui.is_window_focused&&!g&&(v=!1),v&&!o&&r&&r.mentions&&!r.non_channel_mentions&&(v=!1),v&&(t.user==TS.model.user.id||t.comment&&t.comment.user==TS.model.user.id)&&(v=!1),v&&t.no_notifications&&(v=!1),v&&u&&(TS.utility.msgs.isMsgReply(t)?l||(v=!1):v=!1),v&&TS.dnd.isMemberInDnd(TS.model.user)&&!t._ignore_dnd&&(v=!1),TS.shared.isModelObOrgShared(e)){TS.shared.isRelevantTeamForSharedModelOb(e)?TS.pri&&TS.model.is_our_app&&TS.has_pri[a]&&TS.log(a,"Shared channel "+e.id+" is relevant; allowing notification."):(TS.has_pri[a]&&TS.model.is_our_app&&TS.log(a,"Shared channel "+e.id+" is not relevant; suppressing notification."),v=!1)}if(TS.boot_data.feature_stop_loud_channel_mentions&&(v||i)){if(!TS.permissions.members.canMsgMentionChannelIfMention(t.text,e.id,t.user))return void TS.log(67,"preventing over-size channel mention by "+t.user+" with ts = "+t.ts+" in "+e.id)}if(v||i){var b=TS.ui.growls.extractFromNameFromCorGMessage(t),w=function(){if(t.thread_ts&&t.ts!=t.thread_ts)return void TS.ui.replies.openConversation(e,t.thread_ts,t.ts);TS.boot_data.feature_focus_mode&&TS.ui.focus_mode.is_in_focus_mode&&TS.ui.focus_mode.end(),e.is_channel?TS.channels.displayChannel({id:e.id}):e.is_mpim?TS.mpims.displayMpim({id:e.id}):TS.groups.displayGroup({id:e.id})},y=TS.ui.growls.extractTxtFromMsg(t,!0);y=y.replace(":simple_smile:",":)");var k="";b&&(k=TS.model.prefs.no_text_in_notifications?TS.i18n.t("a message from {name}","growl")({name:b}):b+": "),k+=y,TS.ui.growls.maybeBounceDockIcon();var A,C,M="#"+e.name;e.is_mpim&&(M=TS.mpims.getDisplayName(e)),TS.getOtherAccountsCount()>0&&(TS.ui.growls.canSpeak()||window.winssb)?TS.model.supports_growl_subtitle?(A=TS.model.team.name,C=M):A=TS.i18n.t("[{team_domain}] in {channel}","growl")({team_domain:TS.model.team.domain,channel:M}):A=TS.i18n.t("New message in {channel}","growl")({channel:M});var x=TS.ui.growls.getProfileImageFromUserId(t.user);TS.utility.calls.getCallActive().then(function(n){var i="new_message";n?i="none":TSSSB.call("shouldAttachSoundToNotification")||(TS.sounds.play("new_message"),i="none"),TS.ui.growls.show(A,TS.format.formatNotification(k,t),w,{msg:t,channelId:e.id,subtitle:C,sound_name:i,launchUri:TS.ui.growls.getLaunchUriForChannel(e.id,t.ts),imageUri:TS.ui.growls.getAttachmentUri(t),avatarImage:x})})}}}}},getLaunchUriForChannel:function(e,t){return e?"slack://channel?id="+e+"&message="+t+"&team="+TS.model.team.id:null},getAttachmentUri:function(e){return e.attachments&&e.attachments.length>0&&e.attachments[0].image_url&&TS.model.prefs.expand_inline_imgs?e.attachments[0].image_url:null},canSpeak:function(){return!!(window.macgap&&macgap.app&&macgap.app.speakStringWithVoiceAndRateAndCallback)},imMessageReceived:function(t,n){if(!n)return void TS.error("no msg?");n.no_display||e(t,n).then(function(){TS.ui.growls.growlImMessage(t,n,!0)})},growlImMessage:function(e,t,n,i){if(!t)return void TS.error("no msg?");if(!t.no_display&&(n&&!TS.model.ui.is_window_focused&&-1==document.title.indexOf("!")&&(document.title="! "+document.title),(i||TS.model.prefs.growls_enabled)&&TS.ui.growls.checkPermission())){var s=!1,r=e.id===TS.model.active_im_id&&!TS.client.activeChannelIsHidden(),o=TS.utility.msgs.isMsgReply(t),l=o&&e.id===TS.ui.replies.activeConvoModelId()&&t.thread_ts===TS.ui.replies.activeConvoThreadTs(),d=!0;if(o){var c=TS.replies.getSubscriptionState(e.id,t.thread_ts);d=c&&c.subscribed}TS.model.ui.is_window_focused||(s=!0),s||r||l||(s=!0),!s&&r&&o&&!l&&(s=!0),s&&o&&!d&&(s=!1),(t.user==TS.model.user.id||t.comment&&t.comment.user==TS.model.user.id)&&(s=!1);var _=TS.templates.builders.getBotName(t);if(t.no_notifications&&(s=!1),s&&TS.dnd.isMemberInDnd(TS.model.user)&&!t._ignore_dnd&&(s=!1),TS.shared.isModelObOrgShared(e)){TS.shared.isRelevantTeamForSharedModelOb(e)?TS.pri&&TS.has_pri[a]&&TS.log(a,"Shared channel "+e.id+" is relevant; allowing notification."):(TS.has_pri[a]&&TS.log(a,"Shared channel "+e.id+" is not relevant; suppressing notification."),s=!1)}if(s||i){var u=function(){if(t.thread_ts&&t.ts!=t.thread_ts)return void TS.ui.replies.openConversation(e,t.thread_ts);TS.boot_data.feature_focus_mode&&TS.ui.focus_mode.is_in_focus_mode&&TS.ui.focus_mode.end(),TS.ims.startImByMemberId(e.user)},m=_||TS.ims.getDisplayNameOfUserForIm(e),h=TS.ui.growls.extractTxtFromMsg(t,!0);h=h.replace(":simple_smile:",":)");var p="";p+=h,TS.ui.growls.maybeBounceDockIcon();var g,f;TS.getOtherAccountsCount()>0&&(TS.ui.growls.canSpeak()||window.winssb)?TS.model.supports_growl_subtitle?(g=TS.model.team.name,f=m,t._ignore_dnd&&(f=TS.i18n.t("{name} is trying to reach you","growl")({name:m}))):g=t._ignore_dnd?TS.i18n.t("{name} is trying to reach you","growl")({name:m}):TS.i18n.t("[{team_domain}] from {name}","growl")({team_domain:TS.model.team.domain,name:m}):g=t._ignore_dnd?TS.i18n.t("{name} is trying to reach you","growl")({name:m}):TS.i18n.t("New message from {name}","growl")({name:m});var S=TS.ui.growls.getProfileImageFromUserId(e.user);TS.utility.calls.getCallActive().then(function(n){var i="new_message";n?i="none":TSSSB.call("shouldAttachSoundToNotification")||(TS.sounds.play("new_message"),i="none"),TS.ui.growls.show(g,TS.format.formatNotification(p,t),u,{msg:t,channelId:e.id,subtitle:f,sound_name:i,launchUri:TS.ui.growls.getLaunchUriForChannel(e.id,t.ts),imageUri:TS.ui.growls.getAttachmentUri(t),avatarImage:S})})}}},extractFromNameFromCorGMessage:function(e){var t=TS.members.getMemberById(e.user);return(t?TS.members.getPrefCompliantMemberName(t):e.user)||TS.templates.builders.getBotName(e)||""},getProfileImageFromUserId:function(e){if(!e)return null;var t=TS.members.getMemberById(e);if(!t||!t.profile)return null;var n=t.profile.image_512||t.profile.image_192;return n&&n.match(/^\//)&&(n="https://"+window.location.hostname+n),n},extractTxtFromMsg:function(e,t){if(t&&TS.model.prefs.no_text_in_notifications)return"";var n=e.type+" "+e.subtype+" "+TS.i18n.t("(message missing text)","growl")();return!e.file||"file_share"!==e.subtype&&"file_mention"!==e.subtype&&"file_reaction"!==e.subtype?e.text?n=e.text:e.attachments&&e.attachments.length&&(n=TS.ui.growls.getGrowlableTxtFromAttachments(e.attachments)||n):n=TS.ui.growls.getGrowlableTxtFromFile(e),n},containsCmd:function(e){var t=e&&TS.model.everyone_regex.test(e),n=e&&TS.model.channel_regex.test(e),i=e&&TS.model.group_regex.test(e);return t||n||i},windowFocusChanged:function(e){e&&("!"!==document.title.charAt(0)&&"*"!==document.title.charAt(0)||!TS.model.active_cid||(document.title=document.title.slice(2))),!e&&TS.model.all_unread_highlights_cnt&&TS.model.prefs&&"long"===TS.model.prefs.mac_ssb_bounce&&setTimeout(TS.ui.growls.maybeBounceDockIcon,100)},maybeBounceDockIcon:function(){var e;window.macgap?e=window.macgap:window.winssb&&TS.model.is_mac&&(e=window.winssb),e&&e.dock&&TS.model.prefs.mac_ssb_bounce&&("long"===TS.model.prefs.mac_ssb_bounce?e.dock.bounceIndefinitely&&e.dock.bounceIndefinitely():e.dock.bounceOnce&&e.dock.bounceOnce())},maybeGetThreadTsForLastNotification:function(e){return n()&&t&&t.c_id===e?t.thread_ts:null},showTestNotification:function(e,t,n,i){if(i=i||{},TSSSB.call("shouldAttachSoundToNotification")){var a=TS.sounds.soundForName("new_message");a&&(i.ssbFilename=a.ssbFilename,i.soundUrl=a.url)}else TS.sounds.play("new_message");TS.model.prefs.no_text_in_notifications&&(t=null),TS.ui.growls.show(e,t,n,i)}});var e=function(e,t){if(!TS.utility.msgs.isMsgReply(t))return Promise.resolve();var n=TS.replies.getSubscriptionState(e.id,t.thread_ts);return n?Promise.resolve():TS.replies.promiseToGetSubscriptionState(e.id,t.thread_ts).then(function(){if(!(n=TS.replies.getSubscriptionState(e.id,t.thread_ts)))throw new Error("promiseToGetSubscriptionState resolved but subscription is missing for "+t.thread_ts)})},t=null,n=function(){if(!TS.model.is_our_app||!TS.model.is_electron)return!1;var e=TS.model.mac_ssb_version||TS.model.win_ssb_version;return!(!e||e>=2.4)},i=function(e,i){if(n())return e&&i&&TS.utility.msgs.isMsgReply(i)?void(t={c_id:e,ts:i.ts,thread_ts:i.thread_ts}):void(t=null)},a=67}()},2617:function(e,t){!function(){"use strict";TS.registerModule("ui.im_browser",{onStart:function(){r=new TS.PresenceList},start:function(e){if(!TS.client.ui.checkForEditing()){if(TS.isPartiallyBooted())return void TS.incremental_boot.userDidInteractWithUI();s=[],d={},e&&e.forEach(function(e){var t=TS.members.getMemberById(e);t&&(t.is_self||t.deleted||t.is_slackbot||-1===s.indexOf(t)&&(s.push(t),d[t.id]=!0))});var t=TS.templates.im_browser({preselected:s,reached_maximum:s.length===h});TS.ui.fs_modal.start({body_template_html:t,onShow:p,onEnd:g,modal_class:"fs_modal_internal_scroll"})}},startWithMpim:function(e,t){if(e){var n=e.members.concat(t);TS.ui.im_browser.start(n)}},test:function(){return{onShow:p,onEnd:g,getLastMsg:v}},getRecentDMList:function(){return f()}});var e,t,n,i,a,s,r,o,l,d={},c=!1,u=null,m=null,h=8,p=function(){e=$("#im_browser"),t=$("#im_list_container"),s||(s=[]),z(),T();var n=e.find(".im_browser_go")[0];n&&(l=Ladda.create(n)),t.on("click",".im_browser_row",function(e){0===$(e.target).closest("a").length&&F($(this))}),e.on("input","#im_browser_filter",function(){w()}),e.on("keydown","#im_browser_filter",function(e){var t=$("#im_browser_filter").val();return e.which===TS.utility.keymap.del&&""===t?void O():e.which===TS.utility.keymap.enter&&""===t?(e.preventDefault(),void(TS.kb_nav.getHighlightedItem()||B())):e.which===TS.utility.keymap.esc?void TS.ui.fs_modal.close():void(s.length>=h&&e.preventDefault())}),e.on("focus","#im_browser_filter",function(){$("#im_browser_tokens").addClass("active")}).on("blur","#im_browser_filter",function(){$("#im_browser_tokens").removeClass("active")}),e.on("click","#im_browser_tokens",function(e){var t=$(e.target).closest(".member_token");if(t.length)P(t);else{if($(e.target).closest("#im_browser_filter").length)return;$("#im_browser_filter").focus()}}),e.on("click",".im_browser_go:not(.disabled)",function(){B()}),e.on("click",".create_private_channel",function(e){e.preventDefault(),K()}),setTimeout(function(){$("#im_browser_filter").focus()},0)},g=function(){e&&e.remove(),e=null,t=null,n=null,i=null,a=null,s=null,d={},l=null,c=!1,u&&u.cancel(),m=null,TS.kb_nav.end(),TS.ui.new_channel_modal.end(),r.clear()},f=function(){var e=TS.members.getActiveMembersWithSelfAndSlackbot(),t=TS.mpims.getVisibleMpims(),n=e.map(function(e){return{id:e.id,model_ob:TS.ims.getImByMemberId(e.id),member:e}}),i=n;if(t&&t.length>0){var s=t.map(function(e){return{id:e.id,model_ob:e,members:TS.mpims.getMembersInDisplayOrder(e)}});i=n.concat(s)}return i.sort(N),a=i},S=function(){return u=TS.searcher.search("",{members:{include_slackbot:!0,include_self:!0},mpims:!0}),u.then(function(n){var i=_.map(n.members,function(e){return{id:e.id,model_ob:TS.ims.getImByMemberId(e.id),member:e}}),s=_.map(n.mpims,function(e){return{id:e.id,model_ob:e,members:TS.mpims.getMembersInDisplayOrder(e)}}),r=_.concat(i,s);r.sort(N),a=r,t.longListView("setItems",a),e.addClass("showing_recent"),e.removeClass("filter_active no_filter_matches"),H()}),u},T=function(){var e;S(),e=[],t.longListView({items:e,approx_item_height:64,preserve_dom_order:!0,makeElement:function(){return $('<div class="im_browser_row"></div>')},renderItem:function(e,t){e.data("row_id",t.id);var n=t.model_ob;e.toggleClass("multiparty",!(!n||!n.is_mpim)),e.toggleClass("disabled",!!d[t.id]);var i={item:t,model_ob:n,slackbot_msg:o};t.members?(t.members.length>0&&(i.member_one=t.members[0]),t.members.length>1&&(i.member_two=t.members[1])):t.member&&t.member.is_self&&(i.is_self=!0),i.secondary_name=null,n&&n.is_mpim?i.display_name=TS.mpims.getDisplayName(n):TS.boot_data.feature_name_tagging_client?(i.display_name=TS.members.getMemberRealName(t.member),t.member.profile.title&&(i.title=t.member.profile.title),i.secondary_name=TS.members.getMemberProfileFieldDisplayName(t.member)):(i.display_name=TS.members.getPrefCompliantMemberName(t.member),t.member.profile.title&&(i.title=t.member.profile.title),t.member.profile.real_name&&t.member.name!==t.member.profile.real_name&&(i.display_name===t.member.profile.real_name?i.secondary_name=t.member.name:i.secondary_name=t.member.profile.real_name));var a,s="",r="",l=n&&v(n),c=!1;if(l){var u=l.comment?TS.members.getMemberById(l.comment.user):TS.members.getMemberById(l.user);u&&(u.id===TS.model.user.id?(s="You: ",c=!0):(s=_.escape(b(u)),s+=": "),!l.file||"file_share"!==l.subtype&&"file_mention"!==l.subtype&&"file_reaction"!==l.subtype?(a=TS.format.formatNoHighlightsNoSpecialsNoInlineImgs(l.text,l),a=a.replace(/<a .*?>(.*?)<\/a>/g,"$1")):a=J(l),s+=a,c&&!n.is_slackbot_im&&(r+='<i class="ts_icon ts_icon_angle_arrow_up_left ts_icon_inherit"></i>'),r+=TS.interop.datetime.toTimeAgo(l.ts))}else if(n){var m=TS.shared.getLatestMsgTs(n);m&&(r+=TS.interop.datetime.toTimeAgo(m))}if(s&&(i.last_msg=new Handlebars.SafeString(s)),r&&(i.last_msg_time=new Handlebars.SafeString(r)),n&&n.unread_cnt>0){var h=t.model_ob.unread_cnt;h>10&&(h="9+"),i.unread_cnt=h}e.html(TS.templates.im_browser_row(i))}}),t.longListView("getCurrentItemsInView")&&(TS.utility.rAF(function(){var e=t.longListView("getCurrentItemsInView");r.clear(),r.add(_.map(e,"id"))}),t.longListView("getCurrentItemsInViewSignal").add(function(e){r.clear(),r.add(_.map(e,"id"))})),TS.environment.supports_custom_scrollbar||t.monkeyScroll(),TS.kb_nav.start(t.find(".list_items"),".im_browser_row",t,{use_data_ordering:!0,no_blur:!0,scrollToStartImmediately:function(){t.longListView("scrollToTop",!0)},scrollToEndImmediately:function(){t.longListView("scrollToEnd",!0)}}),TS.kb_nav.setAllowHighlightWithoutBlurringInput(!0),TS.kb_nav.setSubmitItemHandler(function(e){F($(this)),e.preventDefault()}),s.length&&TS.boot_data.page_needs_enterprise?w():Q()},v=function(e){return TS.shared.getLastMsg(e)},b=function(e){return TS.members.shouldDisplayRealNames()&&e.profile&&e.profile.first_name?e.profile.first_name:e.name},w=function(){var e=$("#im_browser_filter").val();return I(e)},y=function(){A(),M()},k=function(){C(),x()},A=function(){var e=document.getElementById("im_browser_spinner");e&&e.classList&&e.classList.remove("hidden")},C=function(){var e=document.getElementById("im_browser_spinner");e&&e.classList&&e.classList.add("hidden")},M=function(){if(!i)return i=$("#monkey_scroll_wrapper_for_im_list_container"),n=$("<div>",{class:"monkey_scroll_mask"}),void i.append(n);n.removeClass("hidden")},x=function(){n&&n.addClass("hidden")},I=function(n){TS.metrics.mark("im_browser_search_start"),m=n,y(),u&&u.cancel();var i=!!s.length;if(n||TS.kb_nav.clearHighlightedItem(),!n&&!i){var r=a;return e.addClass("showing_recent"),e.removeClass("filter_active no_filter_matches"),t.longListView("setItems",r),t.scrollTop(0),0===r.length?Q(n):H(),void k()}u=TS.searcher.search(n,{members:{include_slackbot:!i,include_self:!i},mpims:!0,limit:24,filter:function(e){return e.mpims=_.filter(e.mpims,E),e},sort:{allow_empty_query:!0}}),u.then(function(i){i=i.map(function(e){var t=e.model_ob;return e.id=t.id,t.is_mpim?e.members=TS.mpims.getMembersInDisplayOrder(t):e.member=t,e}),e.toggleClass("filter_active",!!n).removeClass("showing_recent"),t.longListView("setItems",i),t.scrollTop(0),0===i.length?(Q(n),e.addClass("no_filter_matches"),TS.kb_nav.clearHighlightedItem()):(H(),e.removeClass("no_filter_matches"),n&&TS.kb_nav.highlightFirstItem()),k(),TS.metrics.measureAndClear("im_browser_search_searcher","im_browser_search_start")})},E=function(e){return!!s.every(function(t){return-1!==e.members.indexOf(t.id)})&&(s.length!==e.members.length-1&&!!TS.mpims.getMembersInDisplayOrder(e).some(function(e){return-1===s.indexOf(e)&&!e.deleted&&!e.is_self}))},B=function(){if(s.length)return 1===s.length?(l&&l.start(),void TS.ims.promiseToStartImByMemberId(s[0].id).then(function(){return TS.ui.fs_modal.close(),null}).finally(function(){return l&&l.stop(),null})):void(TS.permissions.members.canCreateMpims()&&(l.start(),TS.mpims.startMpimWithMembers(s,function(e,t){if(l&&l.stop(),!e)return void(t.error&&TS.error("Could not open MPIM: "+t.error));TS.ui.fs_modal.close()})))},D=function(e){var t=e.data("row_id");TS.interop.utility.looksLikeMemberId(t)?TS.ims.startImByMemberId(t):TS.mpims.displayMpim({id:t}),TS.ui.fs_modal.close()},F=function(e){if(s.length!==h){if(!TS.permissions.members.canCreateMpims())return D(e);var t=e.data("row_id");if(m&&TS.ui.frecency.record({id:t},m),t===TS.model.user.id||"USLACKBOT"===t)return D(e);var n=[];if(TS.interop.utility.looksLikeMemberId(t)){var i=TS.members.getMemberById(t);if(!i)return;if(-1!==s.indexOf(i))return;s.push(i),d[i.id]=!0,n.push(i)}else{var a=TS.mpims.getMpimById(t);if(!a)return;var r=TS.mpims.getMembersInDisplayOrder(a);if(_.some(r,"deleted"))return void D(e);r.forEach(function(e){-1===s.indexOf(e)&&(s.push(e),d[e.id]=!0,n.push(e))})}R(n)}},P=function(e){var t=e.data("member-id"),n=[];s=s.filter(function(e){return t===e.id&&n.push(e),e.id!==t}),delete d[t],R(n)},O=function(){if(s.length){var e=s.pop();delete d[e.id],R([e])}},R=function(n){U(),s.length?e.find(".im_browser_go").removeClass("disabled"):e.find(".im_browser_go").addClass("disabled"),s.length>=h?e.addClass("reached_maximum"):e.removeClass("reached_maximum"),n&&n.forEach(function(e){t.longListView("itemUpdatedById",e.id)}),L(),q(),TS.kb_nav.clearHighlightedItem(),t.longListView("resizeImmediately")},U=function(){var t=h,n=Math.max(0,t-s.length),i=e.find(".remaining_participant_hint");n?i.text(TS.i18n.t("You can add {num_remaining, plural, =1 {# more person} other {# more people}}","im_browser")({num_remaining:n})):i.text(TS.i18n.t("You have reached the maximum number of participants","im_browser")())},L=function(){var t=$("#im_browser_filter").val();$("#im_browser_tokens").replaceWith(TS.templates.im_browser_tokens({members:s}));var n=$("#im_browser_filter");!t&&TS.boot_data.page_needs_enterprise?n.focus():n.val("").trigger("input").focus(),e.removeClass("filter_active")},Q=function(e){var t=$("#im_browser_empty"),n=t.find(".im_browser_empty_message");e?n.html(TS.i18n.t("No one found matching <strong>{query}</strong>","im_browser")({query:TS.utility.truncateAndEscape(e,50)})):n.empty(),t.removeClass("hidden"),$("#monkey_scroll_wrapper_for_im_list_container").addClass("hidden")},H=function(){$("#im_browser_empty").addClass("hidden"),$("#monkey_scroll_wrapper_for_im_list_container").removeClass("hidden")},N=function(e,t){var n=TS.shared.sorterByLastMsg(e.model_ob,t.model_ob);return 0!==n?n:G(e,t)},G=function(e,t){var n,i;if(n=e.member?[e.member]:e.members||[],i=t.member?[t.member]:t.members||[],n.length!==i.length){if(1===n.length)return-1;if(1===i.length)return 1}return j(n,i,0)},j=function e(t,n,i){var a=t[i],s=n[i];if(a&&s){var r=TS.members.memberSorterByName(a,s);return 0!==r?r:e(t,n,i+1)}return s?-1:a?1:0},z=function(){var e=[TS.i18n.t("Yay! Youre here. What can I do for you?","im_browser")(),TS.i18n.t("Hello, Whats up?","im_browser")(),TS.i18n.t("How can I help today?","im_browser")(),TS.i18n.t("Hi hi! How can I help?","im_browser")(),TS.i18n.t("Youre here! What can I do to help?","im_browser")(),TS.i18n.t("You rang?","im_browser")()];o=e[Math.round(Math.random()*(e.length-1))]},K=function(){if(TS.permissions.members.canCreateGroups()){var t=$("#new_channel_container"),n=Object.keys(d);TS.ui.new_channel_modal.startInContainer(t,"",!1,n),e.addClass("hidden"),$("#fs_modal").removeClass("fs_modal_internal_scroll"),t.removeClass("hidden"),TS.ui.fs_modal.bindBackButton(W),TS.ui.fs_modal.showBackButton()}},W=function(){TS.ui.fs_modal.unbindBackButton(),TS.ui.fs_modal.hideBackButton(),$("#new_channel_container").addClass("hidden"),$("#fs_modal").addClass("fs_modal_internal_scroll"),e.removeClass("hidden"),TS.ui.new_channel_modal.end(),t.longListView("resizeImmediately"),TS.ui.utility.updateClosestMonkeyScroller(t)},V=function(t){Y(),e.prepend(t),e.addClass("showing_alert")},Y=function(){$("#im_browser_alert").remove(),e.removeClass("showing_alert")},q=function(){if(c&&(Y(),c=!1),!(TS.model.user.is_restricted||s.length<2)){var e=s.filter(function(e){return e.is_restricted});if(0!==e.length){var t=1===e.length&&e[0],n=t&&t.is_ultra_restricted,i=TS.templates.im_browser_ra_alert({members:e,member:t,is_ura:n});V(i),c=!0}}},J=function(e){if(!e||!e.file)return"";var t=TS.templates.builders.msgs.buildFileShareMetaText(e,!0),n=e.file;return t+": "+(n.title?n.title:n.name)}}()},2618:function(e,t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){"use strict";TS.registerModule("ui.inline_edit",{onStart:function(){var e="."+l+"_inner",t=".ui_"+l+"_start";$(e).attr("tabindex",0),$(document).on("keydown"+t,e,function(t){if(!m&&$(t.target).is(e)){if(13==t.keyCode||32==t.keyCode){t.preventDefault();var n=p(t);TS.ui.inline_edit.start(n),h=!0}}}),$(document).on("focus",".inline_edit_inner",function(e){$(e.target).closest(".inline_edit").addClass("has_focus")}),$(document).on("blur",".inline_edit_inner",function(e){$(e.target).closest(".inline_edit").removeClass("has_focus")}),$(document).on("click"+t,e,function(e){var t=p(e);e.stopPropagation(),TS.ui.inline_edit.start(t)})},start:function(o,d){if(o){if(TS.isPartiallyBooted())return void TS.incremental_boot.userDidInteractWithUI();var u=o.find("."+l+"_input");if(u){e&&!o.is(e)&&TS.ui.inline_edit.end();var m=d||_.find(c,function(e){var t=o.data(e.data_attribute)||u.data(e.data_attribute);return!!t&&(e.arguments={},e.arguments[e.argument_name_for_data_attribute]=t,!0)});if("object"===(void 0===m?"undefined":n(m))&&(i=m.method_name,a=m.value_name,s=m.arguments,i&&a&&"object"===(void 0===s?"undefined":n(s)))){var h="topic"===a?TS.utility.formatTopicOrPurpose:TS.format.formatNoSpecials;r=function(e){return h(TS.utility.removeLinksFromTabFlow(e))},e=o,t=u,g()}}}},end:function(){f(),v()},containsActiveElement:function(e){if(!TS.ui.inline_edit.is_showing||!t||!t.length)return!1;var n=document.activeElement;return!!$(n).is(t)&&(e instanceof jQuery&&e[0]&&(e=e[0]),e.nodeType===Node.ELEMENT_NODE&&$.contains(e,n))},focus:function(){e.find("."+l+"_inner").focus()}});var e,t,i,a,s,r,o,l="inline_edit",d=["animationend","webkitAnimationEnd","MSAnimationEnd","oAnimationEnd"].join(".ui_"+l+" ")+".ui_"+l,c=[{data_attribute:"file-id",method_name:"files.edit",value_name:"title",argument_name_for_data_attribute:"file"},{data_attribute:"group-id",method_name:"groups.setTopic",value_name:"topic",argument_name_for_data_attribute:"channel"},{data_attribute:"channel-id",method_name:"channels.setTopic",value_name:"topic",argument_name_for_data_attribute:"channel"}],u=!0,m=!1,h=!1,p=function(e){var t=$(e.target),n=t.closest("."+l);if(n&&n.length){var i=t.closest("a[href]");if(!i||!i.length)return n}},g=function(){m||($(document).off(".ui_"+l).on("keydown.ui_"+l,k).on("mousedown.ui_"+l,A),e.off(".ui_"+l).on("blur.ui_"+l,"."+l+"_input",C).on(d,y),t.off(".ui_"+l).on("paste.ui_"+l,M),o=t.data("inline-edit-unformatted")||t.text(),o=TS.format.unFormatMsg(o),t.text(o),e.addClass(l+"_editing"),t.attr("contenteditable",!0),t.focus(),TS.ui.inline_edit.is_showing=!0,m=!0,x(t))},f=function(){m&&(t&&t.removeAttr("contenteditable"),e&&e.removeClass(l+"_editing"),m=!1,h&&(TS.ui.inline_edit.focus(),h=!1))},S=function(){u=!1,f(),e.addClass(l+"_updating").removeClass(l+"_done");var n=function(){e.removeClass(l+"_updating")},r=_.clone(s),o=t[0].innerText;o||(o=$("<textarea/>").html(t.html().replace(/<br[^>]*>/,"\n")).text()),r[a]=o,TS.api.call(i,r).then(function(){n(),w.apply(null,arguments)}).catch(function(){n(),b.apply(null,arguments)})},T=function(){m&&(t&&t.html(r(o)),f(),TS.ui.inline_edit.is_showing=!1)},v=function(){$(document).off(".ui_"+l),e&&e.off(".ui_"+l),t&&t.off(".ui_"+l),TS.ui.inline_edit.is_showing=!1,m=!1,u=!0,o=null,s=null,a=null,i=null,t=null,e=null},b=function(){t.html(r(o)),e.addClass(l+"_done "+l+"_error")},w=function(n){var i=n.data||{};if(!i.ok)return void b(n);var a=t.text();i.topic&&(a=i.topic),i.file&&i.file.title&&(a=i.file.title),t.data("inline-edit-unformatted",a),t.html(r(a)),e.addClass(l+"_done "+l+"_success")},y=function(t){t.originalEvent.animationName===l+"_hide_done"&&(e.removeClass(l+"_done "+l+"_error "+l+"_success"),u=!0,m||(f(),TS.ui.inline_edit.is_showing=!1))},k=function(e){var t="."+l+"_inner";if(m&&!$(e.target).is(t))switch(e.which){case TS.utility.keymap.esc:T();break;case TS.utility.keymap.enter:if(e.shiftKey||e.altKey)return;e.preventDefault(),S()}},A=function(t){u=!e[0]||!$.contains(e[0],t.target)},C=function(e){m&&(u?T():(t.focus(),_.delay(x,0,t)))},M=function(e){if(m){e=e.originalEvent||e;var t=window.clipboardData||e.clipboardData,n=document.queryCommandSupported("insertText")||document.queryCommandSupported("insertHTML");if(document.queryCommandSupported("ms-pasteTextOnly"))e.preventDefault(),window.document.execCommand("ms-pasteTextOnly",!1);else if(t&&n){var i=t.getData("text");""==i&&(i=t.getData("text/plain")),""!==i&&(e.preventDefault(),document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,i):document.execCommand("insertHTML",!1,_.escape(i)))}}},x=function(e){e.length&&(e=e[0]);var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}}()},2621:function(e,t){!function(){"use strict";TS.registerModule("ui.invite",{showInviteMembersPreSelected:function(t,n,i){if(!n||!n.length)return void TS.warn("showInviteMembersPreSelected requires a non-empty array of preselected ids to invite to a group, ignoring...");e(t,n,i)},showInviteMemberToChannelDialog:function(e){var t=TS.members.getMemberById(e),n=TS.channels.getChannelsUserIsIn();if(TS.model.user.is_ultra_restricted)TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(t,!0)}),body:TS.i18n.t("You are not allowed to invite other members to channels.","channel_invite")(),show_cancel_button:!1});else if(t.is_ultra_restricted)TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(t,!0)}),body:TS.i18n.t("{name} cannot be invited to any new channels.","channel_invite")({name:TS.members.getPrefCompliantMemberName(t,!0)}),show_cancel_button:!1});else if(t.is_restricted&&!TS.model.user.is_admin)TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(t,!0)}),body:TS.i18n.t("Only a Team Admin can invite {name} into new channels.","channel_invite")({name:TS.members.getPrefCompliantMemberName(t,!0)}),show_cancel_button:!1});else{TS.generic_dialog.start({title:TS.i18n.t("Invite {name} to a channel","channel_invite")({name:TS.members.getPrefCompliantMemberName(t,!0)}),body:TS.templates.channel_invite_list({channels:n,name:TS.members.getPrefCompliantMemberName(t,!0,!0)}),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Invite","channel_invite")(),ladda:!0,onGo:function(){var e=$("#select_invite_channels").lazyFilterSelect("value");if(!e[0])return!1;var n=e[0].id;TS.api.call("channels.invite",{channel:n,users:t.id})}});var i={width:"230px",display:"inline-block"};$("#select_invite_channels").hide().lazyFilterSelect({filter:function(e,t){if(!e||!e.name)return!1;for(var n=e.name.toLowerCase(),i=t.toLowerCase();"#"===i[0];)i=i.slice(1,i.length);return n.indexOf(i)>-1},onItemAdded:function(t){TS.generic_dialog.div.find(".warning_already_member").addClass("hidden"),_.get(t,"id")&&(TS.generic_dialog.startLadda(),TS.membership.ensureChannelMembershipIsKnownForUsers(t.id,[e]).then(function(){TS.membership.getUserChannelMembershipStatus(e,t).is_member?(TS.generic_dialog.div.find(".warning_already_member").removeClass("hidden"),TS.generic_dialog.stopLadda(),TS.generic_dialog.div.find(".dialog_go").addClass("disabled")):TS.generic_dialog.stopLadda()}))},placeholder_text:TS.i18n.t("Select a channel","channel_invite")(),css:i,classes:"select_invite_channels",data:n,template:function(e){var t="#"+_.escape(e.name);return TS.shared.isModelObOrgShared(e)?t+=TS.templates.shared_channel_icon():TS.shared.isModelObShared(e)&&(t+=TS.templates.shared_channels_icon()),new Handlebars.SafeString(t)}}),$("#generic_dialog").find(".modal-body").css("overflow","visible")}}});var e=function(e,t,n){var i=TS.groups.getGroupById(e)||TS.channels.getChannelById(e);if(i){var a,s=TS.shared.getControllerForModelOb(i),r=i.is_group?"groups":"channels",o=function(e){if(n&&_.isFunction(s.removeMsg)&&s.removeMsg(i.id,TS.utility.msgs.getMsg(n,i.msgs)),e)return _.chunk(t,30).forEach(function(e){TS.api.call(r+".invite",{channel:i.id,force:!0,users:e.join(",")})}),!0;_.isFunction(s.createChild)&&s.createChild(i.id,t,function(e,t){if(!e){var n=TS.i18n.t("Sorry! Something went wrong. Please try again.","channel_invite")();t&&"restricted_action"===t.error?n=TS.i18n.t("<p>You dont have permission to create new private channels.</p><p>Talk to your Team Owner.</p>","channel_invite")():TS.error(t.error+" error occurred during TS."+r+".createChild"),setTimeout(function(){TS.generic_dialog.alert(n)},500)}})},l=_.map(t,function(e){return TS.members.getPrefCompliantMemberName(TS.members.getMemberById(e),!0)});a=TS.i18n.listify(l).join(""),TS.ui.fs_modal.start({title:TS.i18n.t("Invite {who} to {model_ob}","channel_invite")({who:a,model_ob:TS.model.group_prefix+i.name}),body:TS.templates.group_member_invite_list(),show_cancel_button:!1,show_go_button:!0,go_button_text:TS.i18n.t("Yes, show channel history","channel_invite")(),show_secondary_go_button:!0,secondary_go_button_text:TS.i18n.t("No, start a new channel","channel_invite")(),secondary_go_button_class:"btn_info",onGo:function(){return o(!0)},onSecondaryGo:function(){return o(!1)},onEnd:function(){$(".modal-body").css("overflow-y","auto")}}),$("#select_invite_group_members").hide().lazyFilterSelect(),$("#select_invite_group_members_holder").css("min-height",235),$(".modal-body").css("overflow-y","visible")}}}()},2622:function(e,t){!function(){"use strict";TS.registerModule("ui.jumper",{is_showing:!1,onStart:function(){TS.client.login_sig.add(TS.ui.jumper.onLogin)},onLogin:function(){l()},start:function(){TS.isPartiallyBooted()||TS.ui.jumper.is_showing||(TS.metrics.mark("start_jumper_open"),$(window.document).on("keydown.jumper",S),TS.tips.hideAll(),e[0].classList.add("active"),t.removeAttr("disabled"),t.focus(),TS.model.dialog_is_showing=!0,TS.ui.jumper.is_showing=!0,TS.metrics.measureAndClear("jumper_open","start_jumper_open"),TS.searcher.search("",{members:M(),channels:!0,groups:!0,mpims:!0}).then(function(e){if(TS.ui.jumper.is_showing)return r=x(e),u(r,""),null}))},end:function(){d(),e[0].classList.remove("active"),$(window.document).off("keydown.jumper",S),TS.kb_nav.end(),n.off("mousemove"),t.blur(),i&&i.cancel(),i=null,TS.model.dialog_is_showing=!1,TS.ui.jumper.is_showing=!1,TS.tips.unhideAll()},debugQuery:function(e){TS.sorter.printTest(e,{prefer_exact_match:!0,frecency:!0})}});var e,t,n,i,a,s,r=[],o=!1,l=function(){var i=TS.templates.jumper();$("body").append(i),e=$("ts-jumper"),t=e.find("input"),n=e.find("ts-jumper-results"),c(),TS.environment.supports_custom_scrollbar||n.monkeyScroll(),a=TS.utility.debounceWithPromise(function(e,t){o=!0,u(e,t)},200)},d=function(){t.val(""),_.each(r,function(e){e.model_ob._jumper_previous_name_match&&(e.model_ob._jumper_previous_name_match=void 0)}),u(r,""),n.scrollTop(0),setTimeout(function(){TS.ui.utility.updateClosestMonkeyScroller(n)},0)},c=function(){t.on("input.search",function(){var e=_.trim(t.val());i&&i.cancel(),e?(TS.metrics.mark("start_jumper_search"),TS.metrics.mark("start_jumper_remote_search"),A(e)):d()}),e.on("click","[data-item-id]",function(){T($(this))}),e.on("click",'[data-action="new_channel"]',k),e.on("click.end",function(e){$(e.target).is("ts-jumper")&&TS.ui.jumper.end()})},u=function(i,a){if(s&&s.cancel(),a||!(_.trim(t.val()).length>0)){var r=m(i,a),o="",l=!1;0==i.length?(o=TS.utility.channels.getPermissibleChannelName(a),r&&(o=null)):l=h(i);var d=_.remove(i,function(e){return e.model_ob.deleted}),c={matches:i,query:a,deleted:d,disambiguate_mpims:l,show_new_channel_link:!!o,clean_name:o,show_extended_search:r,threads_has_unreads:TS.model.threads_has_unreads,threads_mention_count:TS.model.threads_mention_count,show_scores:TS.boot_data.feature_show_jumper_scores&&TS.model.prefs.show_jumper_scores},u=TS.templates.jumper_results(c).trim();i.length||d.length||r?e.removeClass("empty_results"):e.addClass("empty_results"),n.html(u).removeClass("show_deleted"),1===d.length&&n.addClass("show_deleted"),f(i.concat(d)),g(),TS.ui.utility.updateClosestMonkeyScroller(n)}},m=function(e,t){return o?(o=!1,!0):(TS.boot_data.should_use_flannel&&t&&e.length<24&&i&&!i.isResolved()&&(s=a(e,t)),!1)},h=function(e){var t=!1;if(TS.members.shouldDisplayRealNames()){_.filter(e,"model_ob.is_mpim",!0).length>1&&(t=!0)}return t},p=function(){n.addClass("show_deleted");var t=e.find("li.deleted").eq(0);t.length&&TS.kb_nav.highlightItemWithKey(t,!0)},g=function(){n.one("mousemove",function(){n.one("mousemove",function(){var e=n.find("ol")[0];e&&e.classList.remove("no_pointer_events")})})},f=function(t){if(TS.kb_nav.end(),TS.kb_nav.start(e.find("ol"),"li",e.find("ol")),TS.kb_nav.setAllowHighlightWithoutBlurringInput(!0),TS.kb_nav.setSubmitItemHandler(function(e){T($(this)),e.preventDefault()}),t.length>0){var n=e.find("li:first");TS.kb_nav.highlightItemWithKey(n,!0)}},S=function(e){if(TS.ui.jumper.is_showing)if(e.which==TS.utility.keymap.esc)TS.ui.jumper.end(),e.preventDefault(),e.stopPropagation();else if(e.which==TS.utility.keymap.enter){var i=n.find('[data-action="new_channel"]');i.length&&k()}else!e.altKey&&TS.utility.cmdKey(e)&&(75==e.which||TS.model.is_our_app&&84==e.which)&&(_.trim(t.val())?d():(TS.ui.jumper.end(),e.preventDefault()))},T=function(e){e||TS.warn("No $el for Jumper selection");var n=e.data("item-id");n||TS.warn("No ID for Jumper selection");var i;e.data("item-team-id")&&(i=e.data("item-team-id"));var a,s=!1,r=_.trim(t.val());if("deleted_count"===n)return void p();"G"===n.charAt(0)?a=TS.shared.getModelObById(n):"C"===n.charAt(0)?a=TS.channels.getChannelById(n):"V"===n.charAt(0)?a=TS.model.getViewById(n):(TS.boot_data.page_needs_enterprise?i&&(s=_.find(TS.boot_data.other_accounts,["id",n])):s=_.find(TS.boot_data.other_accounts,["id",n]),a=s||TS.members.getMemberById(n)),TS.ui.frecency.record(a,r),s?b(s):a?v(a).then(function(){TS.ui.jumper.end()}):TS.error("Unknown jumper item "+n)},v=function(e){if(TS.boot_data.feature_tinyspeck&&TS.info("jumper: promising to switch to "+e.id),e.is_channel)return TS.channels.displayChannel({id:e.id}),Promise.resolve();if(e.is_mpim&&e.is_group)return TS.mpims.displayMpim({id:e.id}),Promise.resolve();if(e.is_group&&!e.is_mpim)return TS.groups.displayGroup({id:e.id}),Promise.resolve();if(e.is_view)return TS.client.ui.showView(e.id),Promise.resolve();if(e.presence){t.attr("disabled","disabled");var n=TS.ims.promiseToStartImByMemberId(e.id),i=setTimeout(function(){w(TS.members.getPrefCompliantMemberName(e))},500);return n.then(function(){clearTimeout(i)},function(e){throw y(),e})}return Promise.reject()},b=function(e){if(TSSSB.call("displayTeam",e.id))return void TS.ui.jumper.end();w(e.team_name),TS.prefs.setPrefByAPI({name:TS.ui.frecency.isEnterprise()?"frecency_ent_jumper":"frecency_jumper",value:JSON.stringify(TS.model.frecency_jumper)}).finally(function(){window.location.href=e.team_url})},w=function(e){t.attr("disabled","disabled"),n.html(TS.templates.jumper_switch_loading({name:e})),TS.ui.utility.updateClosestMonkeyScroller(n)},y=function(){t.removeAttr("disabled").trigger("input.search")},k=function(){var e=_.trim(t.val());TS.ui.jumper.end(),TS.ui.new_channel_modal.start(e)},A=function(e){i=TS.searcher.search(e,{members:M(),channels:{include_archived:!0},groups:{include_archived:!0},mpims:!0,teams:!0,views:!0,tiered:!0,sort:!0,limit:24}).then(function(t){return u(t,e),TS.metrics.measureAndClear("jumper_results","start_jumper_search"),t.promise}),i.then(function(t){var n=TS.kb_nav.getHighlightedItem();if(u(t,e),TS.metrics.measureAndClear("jumper_remote_results","start_jumper_remote_search"),n){var i=n.data("item-id"),a=TS.kb_nav.getItemByItemId(i);a&&TS.kb_nav.highlightItemWithKey(a,!0)}})},C=function(e){var t=TS.shared.getActiveModelOb().id;return t&&t==e.id},M=function(){var e=[];return TS.model.enterprise&&(e=_(TS.model.enterprise_teams).map("id").filter(function(e){return e!==TS.model.team.id}).value()),{include_org:!0,include_slackbot:!0,include_self:!0,include_deleted:TS.boot_data.feature_deleted_dm_archives,full_profile_filter:!1,org_team_ids:e}},x=function(e){var t=[],n=[],i=[],a=[];_.forEach(e.members,function(e){var n=TS.ims.getImByMemberId(e.id);n&&n.unread_cnt&&n.unread_cnt>0?t.push({model_ob:e,score:0}):n&&_.trim(n.last_msg_input)&&!C(n)&&!TS.ims.isImWithDeletedMember(n)&&i.push({model_ob:e,score:0})}),_.forEach(e.mpims,function(e){e.unread_cnt&&e.unread_cnt>0?t.push({model_ob:e,score:0}):_.trim(e.last_msg_input)&&!C(e)&&i.push({model_ob:e,score:0})}),_.forEach(e.groups,function(e){e.unread_highlight_cnt&&e.unread_highlight_cnt>0?t.push({model_ob:e,score:0}):e.unread_cnt&&e.unread_cnt>0&&!TS.notifs.isCorGMuted(e.id)?n.push({model_ob:e,score:0}):!_.trim(e.last_msg_input)||C(e)||e.is_archived||i.push({model_ob:e,score:0})}),_.forEach(e.channels,function(e){e.unread_highlight_cnt&&e.unread_highlight_cnt>0?t.push({model_ob:e,score:0}):e.unread_cnt&&e.unread_cnt>0&&!TS.notifs.isCorGMuted(e.id)?n.push({model_ob:e,score:0}):_.trim(e.last_msg_input)&&!C(e)&&!e.is_archived&&e.is_member&&i.push({model_ob:e,score:0})});var s=_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"});return TS.model.threads_mention_count&&s?t.push({model_ob:s,score:0}):TS.model.threads_has_unreads&&s&&n.push({model_ob:s,score:0}),a=t.concat(n,i),a.length||e.channels.length+e.groups.length<10&&(_.forEach(e.channels,function(e){a.push({model_ob:e,score:0})}),_.forEach(e.groups,function(e){a.push({model_ob:e,score:0})})),a.slice(0,24)}}()},2625:function(e,t){!function(){"use strict";TS.registerModule("ui.macro_keyboard_nav",{onStart:function(){TS.boot_data.feature_keyboard_navigation&&$(document).on("keydown",t).on("blur",".focusablesection",e).on("mousemove",".focusablesection",TS.ui.macro_keyboard_nav.blurSection)},blurSection:function(e){$(e.currentTarget).blur()},focusSection:function(e){$(e).append('<div class="sectionfocusindicator"></div>'),$(e).addClass("focusablesection").attr("tabindex",-1).focus(),document.body.scrollTop=0},moveNext:function(e){var t=$(e.target);if(!t.is(s.join(",")))return void TS.ui.macro_keyboard_nav.focusSection(s[0]);var i=s.reduce(function(e,n,i){return t.is(n)?i+1:e},0),a=n(i);TS.ui.macro_keyboard_nav.focusSection(a)},movePrev:function(e){var t=$(e.target);if(!t.is(s.join(",")))return void TS.ui.macro_keyboard_nav.focusSection(s[0]);var n=s.reduce(function(e,n,i){return t.is(n)?i-1:e},0),a=i(n);TS.ui.macro_keyboard_nav.focusSection(a)}});var e=function(e){$(e.currentTarget).removeClass("focusablesection").removeAttr("tabindex"),$(e.currentTarget).find(".sectionfocusindicator").remove()},t=function(e){192==e.keyCode&&e.ctrlKey&&TS.client.ui.isUserAttentionOnChat()&&(e.shiftKey?TS.ui.macro_keyboard_nav.movePrev(e):TS.ui.macro_keyboard_nav.moveNext(e))},n=function e(t){var n=s[t];if(!n)return e(0);var i=$(n);return a(i)?n:e(t+1)},i=function e(t){var n=s[t];if(!n)return e(s.length-1);var i=$(n);return a(i)?n:e(t-1)},a=function(e){return"none"!=e.css("display")&&e.width()&&e.height()},s=["#messages_container","#footer","#col_flex",".client_channels_list_container","#client_header"]}()},2626:function(e,t){!function(){"use strict";TS.registerModule("ui.message_container",{register:function(e){if(!e.container)return void TS.error("TS.ui.message_container.register requires a container!");e.updateCallback||(e.updateCallback=_.noop),e.msg_order||(e.msg_order="asc"),C(e);var t=M(e),n=$(e.container);n.data("message-container-config",e),n.addClass("message_container"),h(e,t),TS.attachment_actions.select.decorateNewElements(n),e._state=t,S(e),s(e),TS.client&&e.name&&TS.client.ui.checkInlineImgsAndIframes(e.name)},cleanup:function(e){var t=$(e.container),n=t;e.scroller&&(n=$(e.scroller)),n.off("scroll.message_container"),e._pending_op&&e._pending_op.cancel()},update:function(t,n){e={added:[],removed:[],replaced:[]};var i=$(t.container);t._known_edits=n,t._range?C(t,t._range.start):C(t);var a,s=M(t),r=t._state,o=T(r,s);w(o,function(e){var n=e.item;if("continue"===e.action)a=i.children('[data-section-id="'+n.id+'"]'),c(t,n);else if("delete"===e.action)i.children('[data-section-id="'+n.id+'"]').remove();else if("insert"===e.action){var s=p(t,n);a&&a.length?a.after(s):i.prepend(s),a=s}else if("append"===e.action){var r=p(t,n);i.append(r),a=r}}),t._state=s,S(t),TS.client&&t.name&&TS.client.ui.checkInlineImgsAndIframes(t.name),TS.attachment_actions.select.decorateNewElements(i);var l=i;if(t.scroller&&(l=$(t.scroller)),TS.ui.utility.updateClosestMonkeyScroller(l),t.updated_sig&&t.updated_sig.dispatch(e),t.page_size){var d=_.reduce(s,function(e,t){return e+(t.msgs.length||1)},0);if(!t._pending_op&&d<2*t.page_size){var u;t.has_more_end&&t.promiseToLoadMoreAtEnd?u=t.promiseToLoadMoreAtEnd:t.has_more_beginning&&t.promiseToLoadMoreAtBeginning&&(u=t.promiseToLoadMoreAtBeginning),u&&(t._pending_op=u().then(function(){return TS.ui.message_container.updateWithFocus(t,i.find(".message_container_item").first()),null}).finally(function(){t._pending_op=null}))}}var m=e;return t.updateCallback(m),e=null,t._known_edits=null,m},updateWithFocus:function(e,t){if(!t||!t.length)return TS.ui.message_container.update(e);var n,i=$(t);if(t.is("ts-message")){var a=t.find(".message_body");a.length&&(i=a)}if(t.is("ts-thread")){var s=t.find("ts-message:first");s.length&&(i=s)}return TS.ui.utility.preventElementFromScrolling(i,function(){return n=TS.ui.message_container.update(e),null},function(){var n=$(e.container);if($.contains(n[0],i[0]))return i;var r=t.attr("id");return t=n.find("#"+r),t.is("ts-message")&&(a=t.find(".message_body"),a.length)?a:t.is("ts-thread")&&(s=t.find("ts-message:first"),s.length)?s:t}),n},maybeUpdateMessages:function(e,t){var n=$(e.container),i=e._state;_.forEach(i,function(i){var a=n.children('[data-section-id="'+i.id+'"]'),s=F(e,i.msgs),r=a.find(".day_container");_.forEach(s,function(n){var a=n.length>0?n[0].ts:null;if(a){var s=r.filter(function(){var t=$(this).attr("data-ts"),n=TS.interop.datetime.toDateObject(a),i=TS.interop.datetime.toDateObject(t);return e.skip_day_groupings||TS.interop.datetime.isSameDay(n,i)});if(s.length){var o=b(n,n,e.msg_order,t);m(e,i,s,n,o)}}})})},jumpToTop:function(e){delete e._range;var t=$(e.container).find(".message_container_item").first(),n=TS.ui.message_container.updateWithFocus(e,t);return t=$(e.container).find(".message_container_item").first(),t.scrollintoview({offset:"top",px_offset:50}),n},jumpToEnd:function(e){var t=D(e);C(e,t);var n=TS.ui.message_container.update(e),i=$(e.container);return e.scroller&&(i=$(e.scroller)),i.scrollTop(i.prop("scrollHeight")),n},jumpToTS:function(e,t,n){var i=B(e),a=t;if(n){var s=_.findIndex(i,{msg_ts:a});s>0&&(s=Math.max(0,s-n),a=i[s].msg_ts)}var r=_.find(i,{msg_ts:a});return C(e,r),TS.ui.message_container.update(e)},scrollintoview:function(e,t,n){if(!e._scrolling_into_view){e._scrolling_into_view=!0,n=n||{};var i=n.complete,a=function(){e._scrolling_into_view=!1,i&&i.call(this)};n.complete=a,$("#"+t).scrollintoview(n)}},getRange:function(e){return e._range},pageUp:function(e,t){if(e._range&&e.page_size&&(x(e),TS.ui.message_container.updateWithFocus(e,t),e.afterPageUp)){var n=B(e),i=_.first(n),a=_.isEqual(i,e._range.start);_.invoke(e,"afterPageUp",a)}},pageDown:function(e,t){if(e._range&&e.page_size&&(I(e),TS.ui.message_container.updateWithFocus(e,t),e.afterPageDown)){var n=B(e),i=_.first(n),a=_.isEqual(i,e._range.start);_.invoke(e,"afterPageDown",a)}},test:function(){return{resolveOrderedLists:y}}});var e,t=!1,n=function(t){e&&e.removed.push(t)},i=function(t){e&&e.added.push(t)},a=function(t){e&&e.replaced.push(t)},s=function(e){if(e.page_size){var t=$(e.container),n=Q(e),i=n.parent(),a=_.debounce(function(n){if(!e._scrolling_into_view){var a=n.scrollTop,s=n.scrollHeight,d=i.height(),c=a+d,_=s>3*d?.9:1,u=c>.25*s,m=0===a,h=c>s*_;u&&o(e),h?l(e,t):m&&r(e,t),TS.client&&TS.client.ui.checkInlineImgsAndIframes(e.name)}},250);n.on("scroll.message_container",function(){a(this)})}},r=function(e,t){var n=B(e);if(n.length){var i=t.find(".message_container_item").first(),a=_.first(n);if(_.isEqual(a,e._range.start)){if(e.has_more_beginning&&e.promiseToLoadMoreAtBeginning)return e._pending_op=e.promiseToLoadMoreAtBeginning().then(function(){TS.ui.message_container.pageUp(e,i)}).finally(function(){e._pending_op=null}),e._pending_op}else TS.ui.message_container.pageUp(e,i)}},o=function(e){if(!e._pending_op&&!0!==t&&e.has_more_end&&e.promiseToLoadMoreAtEnd)return H("Start pre-emptive load of more messages",e),e._pending_op=e.promiseToLoadMoreAtEnd().then(function(){H("End pre-emptive load of more messages",e),e._pending_op=null,t=!0}),e._pending_op},l=function(e,n){var i=n.find(".message_container_item").last();if(t)H("Start appending loaded but not shown messages",e),t=!1,d(e,i),H("End appending loaded but not shown messages",e);else{if(!e._pending_op&&e.has_more_end&&e.promiseToLoadMoreAtEnd)return H("Start load of more messages at append point",e),e._pending_op=e.promiseToLoadMoreAtEnd().then(function(){H("End load of more messages at append point",e),H("Start appending loaded messages at append point",e),e._pending_op=null,t=!1,d(e,i),H("End appending loaded messages at append point",e)}),e._pending_op;if(e._pending_op)return e._pending_op.then(function(){t&&(H("Start appending loaded but not shown messages after pending",e),e._pending_op=null,t=!1,d(e,i),H("End appending loaded but not shown messages after pending",e))});H("Appending loaded and shown messages hidden by message_container at append point",e),d(e,i)}},d=function(e,t){TS.ui.message_container.pageDown(e,t);var n=Q(e);0===n.scrollTop()&&(n.scrollTop(80),e.page_size*=2)},c=function(e,t){var n=$(e.container),i=_.find(e._state,{id:t.id});if(!t)return void TS.error("TS.ui.message_container.update could not find section "+t.id+" to update.");if(!i)return void TS.error("TS.ui.message_container.update could not find section_state for "+t.id+" to update.");var a=n.children('[data-section-id="'+t.id+'"]');if(!a.length)return void TS.error("TS.ui.message_container.updateSection could not find section "+t.id);t.completeness&&(a.removeClass("complete partial_start partial_end"),t.completeness.start&&t.completeness.end?a.addClass("complete"):(t.completeness.start||a.addClass("partial_start"),t.completeness.end||a.addClass("partial_end")));var s=F(e,t.msgs),r=F(e,i.msgs),o=v(r,s,e.msg_order,e.skip_day_groupings);u(e,t,a,s,r,o)},u=function(e,t,n,i,a,s){var r,o=n.find(".msgs_holder");o.length||(o=n);var l=o.find(".day_container"),d=function(t){return l.filter(function(){var n=$(this).attr("data-ts"),i=TS.interop.datetime.toDateObject(t),a=TS.interop.datetime.toDateObject(n);return e.skip_day_groupings||TS.interop.datetime.isSameDay(i,a)})},c=function(t,n){return _.find(t,function(t){var i=t[0];return e.skip_day_groupings||TS.utility.msgs.areMsgsSameDay(i,n)})},u=function(t){if(e._known_edits&&_.includes(e._known_edits,t.ts))return!0};w(s,function(n){var s=n.item,_=c(i,s);if("continue"===n.action){r=d(s.ts);var h=b(c(a,s),_,e.msg_order,u);m(e,t,r,_,h)}else if("delete"===n.action)d(s.ts).remove();else if("insert"===n.action){var p=g(e,t,c(i,s));r&&r.length?r.after(p):l.length?l.first().before(p):o.append(p),r=p}else if("append"===n.action){var f=g(e,t,c(i,s));o.append(f),r=f}})},m=function(e,t,s,r,o){var l,d=s.find(".message_container_item"),c={};d.each(function(){var e=$(this).attr("data-ts");c[e]=this});var _,u={},m={};r.forEach(function(e){u[e.ts]=e,m[e.ts]=_,_=e});var h;w(o,function(r){var o=r.item,_=o.ts,p=r.action;if("edited"===p&&(p="replace"),"continue"!==p||"insert"!==h&&"delete"!==h||(p="replace"),"continue"===p)l=$(c[_]);else if("replace"===p){var g=$(c[_]),S=f(e,u[_],m[_],t);g.replaceWith(S),a(S),l=S}else if("delete"===p){var T=$(c[_]);n(T),T.remove()}else if("insert"===p){var v=f(e,u[_],m[_],t);l&&l.length?l.after(v):d.length?d.first().before(v):s.append(v),i(v),l=v}else if("append"===p){var b=f(e,u[_],m[_],t);s.append(b),i(b),l=b}h=r.action})},h=function(e,t){var n=$(e.container);_.forEach(t,function(t){var i=p(e,t);n.append(i)})},p=function(e,t){var n=e.buildSection(t),i=$(n);i.attr("data-section-id",t.id),t.completeness&&(t.completeness.start&&t.completeness.end?i.addClass("complete"):(t.completeness.start||i.addClass("partial_start"),t.completeness.end||i.addClass("partial_end")));var a=i.find(".msgs_holder");a.length||(a=i);var s=F(e,t.msgs);return _.forEach(s,function(n){var i=g(e,t,n);a.append(i)}),i},g=function(e,t,n){var a=n[0],s=$('<div class="day_container" data-ts="'+a.ts+'"></div>');if(!e.skip_day_groupings){var r=$(e.buildDayDivider(t,a));s.append(r),i(r)}var o;return _.map(n,function(n){var i=f(e,n,o,t);return o=n,i}).forEach(function(e){s.append(e),i(e)}),s},f=function(e,t,n,i){var a=e.buildMsgHTML(t,n,i),s=$(a);return s.addClass("message_container_item"),s},S=function(e){var t=$(e.container),n=B(e),i=_.first(n),a=_.last(n),s=e._range&&e._range.start,r=e._range&&e._range.end,o=e.has_more_beginning;o||i&&s&&!_.isEqual(i,s)&&(o=!0);var l=e.has_more_end;l||a&&r&&!_.isEqual(a,r)&&(l=!0);var d=TS.i18n.t("Loading more messages...","unread")();t.find(".and_more_beginning").remove(),o&&t.prepend('<div class="and_more_beginning italic align_center large_top_margin large_bottom_margin">'+d+"</div>"),t.find(".and_more_end").remove(),l?t.append('<div class="and_more_end italic align_center large_top_margin large_bottom_margin">'+d+"</div>"):t.find(".unread_group:last").addClass("at_bottom")},T=function(e,t){return y(e,t,function(e,t){return(e.order||0)-(t.order||0)})},v=function(e,t,n,i){var a=_.map(e,function(e){return e[0]}),s=_.map(t,function(e){return e[0]});return y(a,s,function(e,t){return i||TS.utility.msgs.areMsgsSameDay(e,t)?0:O(n,e.ts,t.ts)})},b=function(e,t,n,i){return y(e,t,function(e,t){return e.ts===t.ts?0:O(n,e.ts,t.ts)},function(e,t){if(i){var n=i(e,t);if(!_.isUndefined(n))return n}return L(e,t)})},w=function(e,t){for(;e;)t(e),e=e.next},y=function(e,t,n,i){var a=A(e,0),s=A(t,0);return k(a,s,n,i)},k=function e(t,n,i,a){if(!t&&!n)return null;if(!t)return{action:"append",item:n.item,next:e(t,n.next,i,a)};if(!n)return{action:"delete",item:t.item,next:e(t.next,n,i,a)};var s=i(t.item,n.item);return 0===s?a&&a(t.item,n.item)?{action:"edited",item:n.item,next:e(t.next,n.next,i,a)}:{action:"continue",item:n.item,next:e(t.next,n.next,i,a)}:s<0?{action:"delete",item:t.item,next:e(t.next,n,i,a)}:s>0?{action:"insert",item:n.item,next:e(t,n.next,i,a)}:void 0},A=function e(t,n,i){if(n>=t.length)return null;var a={item:t[n],prev:i};return a.next=e(t,n+1,a),a},C=function(e,t){if(e.page_size){var n=B(e);if(n.length){var i=2*e.page_size,a={},s=0,r=e.msg_order;if(t){var o=!1;s=_.findIndex(n,function(e){return e.section_id===t.section_id?-1==e.msg_ts||(o||(o=!0),R(r,e.msg_ts,t.msg_ts)):!(!o||e.section_id===t.section_id)}),s<0&&(s=0)}var l=Math.min(i+s,n.length);if(a.start=n[s],a.end=n[l-1],s>0&&l-s<i){var d=i-(l-s);s=Math.max(0,s-d),a.start=n[s]}e._range=a}}},M=function(e){if(!e._range)return _.map(e.sections,function(e){var t=_.create(e);return t.msgs=_.map(e.msgs,_.clone),t.completeness={start:!0,end:!0},t});var t=[],n=e._range.start,i=e._range.end;return _.forEach(e.sections,function(a){if(E(a,e)){var s=_.create(a),r=P(e,a.msgs);s.msgs=_.filter(r,function(t){var s=e.msg_order;return n.section_id===i.section_id?R(s,t.ts,n.msg_ts)&&U(s,t.ts,i.msg_ts):a.id===n.section_id?R(s,t.ts,n.msg_ts):a.id!==i.section_id||U(s,t.ts,i.msg_ts)}),"desc"===e.msg_order?s.completeness={start:_.first(s.msgs)===_.first(r),end:_.last(s.msgs)===_.last(r)}:s.completeness={start:_.last(s.msgs)===_.last(r),end:_.first(s.msgs)===_.first(r)},a===_.first(e.sections)&&e.has_more_beginning&&(s.completeness.start=!1),a===_.last(e.sections)&&e.has_more_end&&(s.completeness.end=!1),s.msgs=_.map(s.msgs,_.clone),t.push(s)}}),t},x=function(e){var t=B(e),n=e._range,i=e.msg_order,a=_.takeWhile(t,function(e){return!(e.section_id===n.start.section_id&&R(i,e.msg_ts,n.start.msg_ts))});if(a.length){var s=_.drop(t,a.length),r=!1;s=_.takeWhile(s,function(e){return!r&&(e.section_id===n.end.section_id&&R(i,e.msg_ts,n.end.msg_ts)&&(r=!0),!0)});var o=_.takeRight(a,e.page_size),l=_.take(s,s.length-o.length);n.start=_.first(o),n.end=_.last(l)}},I=function(e){var t=B(e),n=e._range,i=e.msg_order;t=_.dropWhile(t,function(e){return!(e.section_id===n.start.section_id&&R(i,e.msg_ts,n.start.msg_ts))});var a=!1,s=_.takeWhile(t,function(e){return!a&&(e.section_id===n.end.section_id&&R(i,e.msg_ts,n.end.msg_ts)&&(a=!0),!0)}),r=_.drop(t,s.length);if(r.length){var o=_.take(r,e.page_size),l=_.drop(s,o.length);n.start=_.first(l),n.end=_.last(o)}},E=function(e,t){if(!t._range)return!0;for(var n,i=!1,a=0;a<t.sections.length;a+=1){if(n=t.sections[a],i||n.id!==t._range.start.section_id||(i=!0),i&&n.id===e.id)return!0;if(n.id===t._range.end.section_id)break}return!1},B=function(e){var t=[],n=e.msg_order,i="asc"===n?_.forEachRight:_.forEach;return _.forEach(e.sections,function(n){if(n.msgs.length){var a=P(e,n.msgs);i(a,function(e){t.push({section_id:n.id,msg_ts:e.ts})})}else t.push({section_id:n.id,msg_ts:"-1"})}),t},D=function(e){var t;return _.findLast(e.sections,function(n){if(!n.msgs||!n.msgs.length)return!1;var i,a;return"asc"===e.msg_order?(i=_.first(n.msgs),a=i?i.ts:null,t={section_id:n.id,msg_ts:a}):(i=_.last(n.msgs),a=i?i.ts:null,t={section_id:n.id,msg_ts:a}),!0}),t},F=function(e,t){if(!t)return[];var n,i=e.msg_order,a="asc"===i?_.forEachRight:_.forEach,s=[],r=[];return a(t,function(t){e.skip_day_groupings||n&&TS.utility.msgs.areMsgsSameDay(t,n)?r.push(t):(r.length&&s.push(r),r=[t]),n=t}),r.length&&s.push(r),s},P=function(e,t){if("desc"===e.msg_order)return t;var n,i,a,s=[],r=[];for(n=t.length-1;n>-1;n-=1)a=t[n],a.no_display||a._hidden_reply&&!e.show_hidden_replies||"continue"!==(i=TS.utility.msgs.msgRollUpWorker(n,a,t,r))&&("swap"===i&&(a=r[0],r.length=0),s.unshift(a));return s},O=function(e,t,n){if("asc"===e){if(t<n)return-1;if(t>n)return 1}else{if(t>n)return-1;if(t<n)return 1}return 0},R=function(e,t,n){return"asc"===e?t>=n:t<=n},U=function(e,t,n){return"asc"===e?t<=n:t>=n},L=function(e,t){if(t.ts in TS.model.display_unsent_msgs)return!0;var n=e.edited,i=t.edited;return!(!e.is_ephemeral||e.text===t.text)||(!_.isEqual(n,i)||!_.isEqual(e.reply_count,t.reply_count))},Q=function(e){var t=$(e.container),n=t;return e.scroller&&(n=$(e.scroller)),n},H=function(e,t){if(TS.shouldLog(102)){var n=B(t),i=n.length,a=t.sections.length,s=t._range?_.findIndex(n,{msg_ts:t._range.start.msg_ts}):null,r=t._range?_.findIndex(n,{msg_ts:t._range.end.msg_ts}):null,o=t.has_more_end;TS.log(102,"[msg_container] "+e,{sections:a,messages:i,range_start:s,range_end:r,has_more_end:o})}}}()},2628:function(e,t){!function(){"use strict";TS.registerModule("ui.messages_utils",{onStart:function(){if(TS.boot_data.feature_keyboard_navigation){$("#messages_container").prepend('<div class="first_hidden_tab_stop" tabindex="0"></div>').append('<div class="last_hidden_tab_stop" tabindex="0"></div>').on("keydown",h).on("focus",".message",A).on("mousedown",".message",k).on("mousemove",".message--focus",I),$(document).on("keyup",C).on("keydown",M);var e=_.debounce(TS.ui.messages_utils.identifyFirstAndLastTabStopInView,50);$(".message_pane_scroller").on("scroll",e),TS.view.resize_sig.add(e),TS.channels.history_being_fetched_sig.add(x),TS.groups.history_being_fetched_sig.add(x),TS.ims.history_being_fetched_sig.add(x),TS.mpims.history_being_fetched_sig.add(x)}},getLastTabStopInView:function(e){var t=i("reduceRight");return e.reduce(t,null)||$()},getFirstTabStopInView:function(e){if(B())return $(TS.ui.utility.firstFocusableChild($("#end_div")));var t=i("reduce");return e.reduceRight(t,null)||$()},identifyFirstAndLastTabStopInView:function(){c();var e=TS.ui.messages_utils.scrollerForCurrentView();if(e.outerHeight()==e[0].scrollHeight)return $(TS.ui.utility.firstFocusableChild(e)).addClass("first_tab_stop_in_view"),void $(TS.ui.utility.lastFocusableChild(e)).addClass("last_tab_stop_in_view");var t=TS.ui.messages_utils.getMessagesInView();if(t&&(!t||t.length)){if(1===t.length)return void t[0].addClass("first_tab_stop_in_view").addClass("last_tab_stop_in_view");var n=TS.ui.messages_utils.getFirstTabStopInView(t),i=TS.ui.messages_utils.getLastTabStopInView(t);n.addClass("first_tab_stop_in_view"),i.addClass("last_tab_stop_in_view")}},nextChannelViewMessage:function(e){var t=TS.ui.utility.nextWithClass(e,"message");return t.length?t:o(e,".day_container")},prevChannelViewMessage:function(e){var t=TS.ui.utility.prevWithClass(e,"message");return t.length?t:r(e,".day_container")},nextUnreadViewMessage:function(e){var t=TS.ui.messages_utils.nextChannelViewMessage(e);return t.length?t:e.closest(".unread_group").next(".unread_group").find(".day_container").first().find("ts-message:first-of-type")},prevUnreadViewMessage:function(e){var t=TS.ui.messages_utils.prevChannelViewMessage(e);return t.length?t:e.closest(".unread_group").prev(".unread_group").find(".day_container").last().find("ts-message:last-of-type")},nextThreadsViewMessage:function(e){var t=TS.ui.utility.nextWithClass(e,"message");if(t.length)return t;var n=TS.ui.utility.nextWithClass(e,"thread_replies_container").find("ts-message:first-of-type");if(n.length)return n;var i=o(e,"ts-thread",".thread_messages > ts-message:first-of-type");if(i.length)return i;return o(e,".threads_section","ts-thread:first-of-type .thread_messages > ts-message:first-of-type")},prevThreadsViewMessage:function(e){var t=TS.ui.utility.prevWithClass(e,"message");if(t.length)return t;var n=TS.ui.utility.prevWithClass(e.closest(".thread_replies_container"),"message");if(n.length)return n;var i=r(e,"ts-thread",".thread_replies_container > ts-message:last-of-type");if(i.length)return i;return r(e,".threads_section","ts-thread:last-of-type .thread_replies_container > ts-message:last-of-type")},getMessagesInView:function(){var e=TS.ui.messages_utils.scrollerForCurrentView();if(e.outerHeight()==e[0].scrollHeight)return e.find(".message").toArray().reverse().map(function(e){return $(e)});var n=TS.ui.messages_utils.visibleMsgsScrollAreaRect(),i=n.left+n.width/2,a=n.bottom-10,s=n.left,r=n.bottom/2,o=t(),l=TS.ui.utility.findNodeInRegion(".message",i,a,s,r);return l?function e(t){var n=t[t.length-1],i=n[0].getBoundingClientRect().top;if(i>=0&&i<=10)return t;if(i<0)return t;var a=o(n);return a.length?e(t.concat(a)):t}([l]):void 0},scrollerForCurrentView:function(){var e={unread_view_is_showing:"#unread_msgs_scroller_div",threads_view_is_showing:"#threads_msgs_scroller_div",archive_view_is_showing:"#archive_msgs_scroller_div",app_space_view_is_showing:"#app_space_scroller_div"},t=Object.keys(e).reduce(function(t,n){return TS.model[n]?e[n]:t},"#msgs_scroller_div");return $(t)},establishInitialFocus:function(e,t){var n={unread_view_is_showing:".first_tab_stop_in_view",threads_view_is_showing:".first_tab_stop_in_view"},i=Object.keys(n).reduce(function(e,t){return TS.model[t]?n[t]:e},".last_tab_stop_in_view");E(t.find(".message--focus")),TS.ui.messages_utils.identifyFirstAndLastTabStopInView();var a=t.find(i).closest(".message");l(a);var s=38==e.keyCode;d(s,a,t)},visibleMsgsScrollAreaRect:function(){var e=document.getElementById("messages_container").getBoundingClientRect(),t=TS.model.unread_view_is_showing?$(".unread_group_header").first().outerHeight():0,n=e.top+8+t;return{top:n,left:e.left,bottom:e.bottom,right:e.right,width:e.width,height:e.bottom-n}}});var e=function(e){var t="prev"==e?"prev":"next",n={unread_view_is_showing:"UnreadViewMessage",threads_view_is_showing:"ThreadsViewMessage"};return function(){var e=Object.keys(n).reduce(function(e,t){return TS.model[t]?n[t]:e},"ChannelViewMessage");return TS.ui.messages_utils[t+e]}},t=e("prev"),n=e("next"),i=function(e){return function(t,n){if(t)return t;var i=n.hasClass("message--focus");i||n.addClass("message--focus");var a=s(n,e);return i||n.removeClass("message--focus"),a?$(a):void 0}},a=function(){var e=TS.ui.messages_utils.visibleMsgsScrollAreaRect(),t=e.top,n=e.bottom;return function(e){var i=e.getBoundingClientRect().top;return i>=t&&i<=n}},s=function(e,t){var n=a(),i="reduceRight"==t?"lastFocusableChild":"firstFocusableChild";return TS.ui.utility[i](e[0],n)},r=function(e,t,n){var i=n||"ts-message:last-of-type";return e.closest(t).prev(t).find(i)},o=function(e,t,n){var i=n||"ts-message:first-of-type";return e.closest(t).next(t).find(i)},l=function(e){e.length&&(TS.ui.messages.updateMessageHoverContainer(e),e.attr("tabindex",-1).focus())},d=function(e,t,n){if(t.length){var i=TS.ui.messages_utils.visibleMsgsScrollAreaRect(),a=t[0].getBoundingClientRect(),s=a.top,r=a.height,o=t.find(".action_hover_container"),l=function(){return o.length?o[0].getBoundingClientRect().top-parseInt(o.css("right"),10):0}(),d=i.top+(s-l),c=n.scrollTop();e&&s>=d||(e||r>=i.height)&&n.scrollTop(c-(d-s))}},c=function(){var e=TS.ui.messages_utils.scrollerForCurrentView();e.find(".first_tab_stop_in_view").removeClass("first_tab_stop_in_view"),e.find(".last_tab_stop_in_view").removeClass("last_tab_stop_in_view")},u=function(){var e=TS.ui.messages_utils.scrollerForCurrentView();E(e.find(".message--focus")),TS.ui.messages_utils.identifyFirstAndLastTabStopInView(),e.find(".first_tab_stop_in_view").focus().addClass("focus-ring")},m=function(){var e=TS.ui.messages_utils.scrollerForCurrentView();E(e.find(".message--focus")),TS.ui.messages_utils.identifyFirstAndLastTabStopInView();var t=e.find(".last_tab_stop_in_view");t.closest(".message").addClass("message--focus"),t.focus().addClass("focus-ring")},h=function(e){if(e.keyCode==TS.utility.keymap.tab&&TS.client.ui.isUserAttentionOnChat())return void b(e);!$(e.target).is("#messages_container")&&p(e)&&v(e)},p=function(e){var t=e.keyCode,n=TS.utility.keymap,i=t==n.up||t==n.down,a=e.metaKey||e.ctrlKey||e.altKey||e.shiftKey;return i&&!TS.utility.isFocusOnInput()&&!a&&TS.client.ui.isUserAttentionOnChat()},g=0,f=0,S=function(e){if(!e)return!1;var t=a(),n=TS.ui.messages_utils.visibleMsgsScrollAreaRect(),i=e.getBoundingClientRect(),s=i.bottom;return t(e)||s>n.top&&s<=n.bottom||i.height>=n.height},T=function(e,i,a){var s=e.keyCode,r={38:t,40:n}[s](),o=r(i);if(o.length){e.preventDefault(),l(o);d(38==s,o,a),g=Date.now()}},v=function(e,t){var n=TS.ui.messages_utils.scrollerForCurrentView(),i=n.find(".message--focus");if(t||!t&&!S(i[0]))return void TS.ui.messages_utils.establishInitialFocus(e,n);T(e,i,n)},b=function(e){f=Date.now();var t=e.target,n=$(t),i=n.closest(".message");i.hasClass("dirty_hover_container")&&TS.ui.messages.updateMessageHoverContainer(i);var s=e.shiftKey,r=a(),o=TS.ui.messages_utils.scrollerForCurrentView();return s||!n.is("#messages_container")&&!n.is(o)?!s&&n.is(".last_tab_stop_in_view")?(e.preventDefault(),$("#client-ui").hasClass("flex_pane_showing")?void w():window.winssb?void TS.utility.contenteditable.focus(TS.client.msg_input.$input):void $("#messages_container .last_hidden_tab_stop").focus()):s&&n.is(".first_tab_stop_in_view")?(e.preventDefault(),void TS.ui.utility.lastFocusableChild($("#client_header .flex_header")).focus()):void(function(e){var t=TS.ui.messages_utils.visibleMsgsScrollAreaRect(),n=e.getBoundingClientRect(),i=n.bottom;return r(e)||i>t.top&&i<=t.bottom}(t)||(e.preventDefault(),u())):(e.preventDefault(),void u())},w=function(){var e=TS.ui.utility.firstFocusableChild($("#col_flex .panel.active"));e&&e.focus()},y=!1,k=function(){y=!0},A=function(e){if(y)return void(y=!1);var t=e.target,n=$(t),i=$(".message--focus"),a=i.get(0);a&&a.contains(t)||n.is(".message--focus")||(E(i),n.closest(".message").addClass("message--focus").append('<div class="messagefocusindicator"></div>'))},C=function(e){var t=e.target,n=$(t);if(9==e.keyCode){if(!e.shiftKey&&n.is("#messages_container .first_hidden_tab_stop"))return void u();if(e.shiftKey&&n.is("#messages_container .last_hidden_tab_stop"))return void m();var i=TS.ui.messages_utils.scrollerForCurrentView(),a=i.find(".message--focus"),s=a.get(0);s&&!s.contains(t)&&E(a)}},M=function(e){var t=e.keyCode,n=e.target,i=$(n),a=$("#messages_container"),s=i.is(a),r=t==TS.utility.keymap.tab;if(r&&!e.shiftKey&&i.is("#col_flex"))return w(),void e.preventDefault();if(s&&r)return void a.blur();if(p(e)){var o=!s&&a[0].contains(n),l=$("#col_flex")[0].contains(n),d=$(".client_channels_list_container")[0].contains(n);o||l||d||(e.preventDefault(),s&&a.blur(),v(e,!0))}},x=function(){if(!(Date.now()-g>1e3)){var e=TS.ui.messages_utils.scrollerForCurrentView(),t=e.find(".message--focus");if(t.length){(TS.model.archive_view_is_showing?TS.client.archives.msgs_scrolled_sig:TS.client.ui.msgs_scrolled_sig).addOnce(function(){var e=$("#"+t.attr("id"));l(e)})}}},I=function(e){var t=Date.now();if(!(t-g<=1e3||t-f<=1e3)){var n=$(e.currentTarget);n.blur().removeAttr("tabindex"),E(n)}},E=function(e){e.removeClass("message--focus"),e.find(".messagefocusindicator").remove()},B=function(){var e=document.getElementById("end_div");if(!e)return!1;var t=TS.ui.messages_utils.visibleMsgsScrollAreaRect(),n=e.getBoundingClientRect(),i=n.bottom;return i>t.top&&i<=t.bottom}}()},2629:function(e,t){!function(){"use strict";TS.registerModule("ui.mpim_conversion_modal",{onStart:function(){},startMpimConversionModal:function(e){n=e;var t=TS.mpims.getMembersInDisplayOrder(n),r=_.filter(t,{is_ultra_restricted:!0}),o=TS.templates.mpim_conversion_modal({members:t,uras:r});TS.ui.fs_modal.start({body_template_html:o,onShow:i,onEnd:s,modal_class:"mpim_conversion_modal",onGo:a})},go:function(){var i=e.find(".title_input").val();t&&t.start(),TS.mpims.convertToGroup(n,i,{validate_name:!0}).then(function(){t&&t.stop(),TS.ui.fs_modal.close()}).catch(function(n){t&&t.stop();var a=n.data.error,s=TS.ui.validation.getErrorMessage(a,{maxlength:22,name:i});return TS.ui.validation.showWarning(e.find(".title_input"),s,{custom_for:"channel_create_title"})})}});var e,t,n,i=function(){e=$(".mpim_conversion_modal"),e.on("click",".continue",function(){a()}),e.find(".convert_mpim_go").click(TS.ui.mpim_conversion_modal.go),e.find(".title_input").keydown(function(e){e.which===TS.utility.keymap.enter?TS.ui.mpim_conversion_modal.go():e.which===TS.utility.keymap.esc&&TS.ui.fs_modal.close()})},a=function(){return!$("#conversion_step").hasClass("hidden")&&e.find(".title_input").val().length>1?TS.ui.mpim_conversion_modal.go():($("#confirmation_step").addClass("hidden"),$("#conversion_step").removeClass("hidden"),t=Ladda.create(e.find(".convert_mpim_go")[0]),e.find(".title_input").focus(),!1)},s=function(){r()},r=function(){e=null,t=null,n=null}}()},2630:function(e,t){!function(){"use strict";TS.registerModule("ui.msg_tab_complete",{$input:null,onStart:function(){},start:function(t){e||(e=!0,TS.ui.msg_tab_complete.$input=t,t.tab_complete_ui({id:"chat_input_tab_ui"}))},positionUI:function(){e&&TS.ui.msg_tab_complete.$input.tab_complete_ui("positionUI")},isShowing:function(){return e&&TS.ui.msg_tab_complete.$input.tab_complete_ui("isShowing")}});var e=!1}()},2632:function(e,t){!function(){"use strict";TS.registerModule("ui.paste",{catcher_div:null,onStart:function(){window.Clipboard||(TS.ui.paste.catcher_div=document.createElement("div"),TS.ui.paste.catcher_div.setAttribute("tabindex","-1"),TS.ui.paste.catcher_div.setAttribute("contenteditable",""),TS.ui.paste.catcher_div.setAttribute("class","offscreen"),document.body.appendChild(TS.ui.paste.catcher_div));$(window.document).keydown(function(e){if(TS.ui.paste.okToGo()&&TS.utility.cmdKey(e)&&86==e.which){if(!TS.ui.paste.catcher_div)return;if(e.altKey)return;TS.utility.isFocusOnInput()||TS.ui.paste.catcher_div.focus()}}),$(window).bind("paste",TS.ui.paste.handler)},okToGo:function(){if(TS.web)return!0;if(TS.client&&!TS.client.ui.$msg_input)return!1;if(TS.utility.contenteditable.supportsTexty()){if(!TS.utility.isFocusOnInput()||TS.utility.contenteditable.isActiveElement(TS.client.ui.$msg_input))return!0}else if(!TS.utility.isFocusOnInput()||document.activeElement==TS.client.ui.$msg_input[0])return!0;return!1},handler:function(e){if(TS.ui.paste.okToGo()){TS.info("TS.ui.paste.handler"),e=e.originalEvent||e;var t=TS.model.shift_key_pressed;if(window.desktop&&window.desktop.app.getModifierKeys){var n=window.desktop.app.getModifierKeys();t=t||n&&n.shift}if(TS.model.is_FF&&bowser.version<50||!e.clipboardData){var i,a=e.clipboardData&&e.clipboardData.types;a&&_.includes(a,"text/plain")&&(i=e.clipboardData.getData("text")),setTimeout(TS.ui.paste.checkCatcher,0,t,i)}else{var s=TS.ui.paste.detectImageFromEvent(e);s?(e.preventDefault(),e.clipboardData.items?TS.client.ui.file_pasted_sig.dispatch(s,t):TS.ui.paste.startUploadFromMacSSBReadImage(s,t)):!TS.model.is_FF&&e.clipboardData.items&&TS.client&&!TS.utility.isFocusOnInput()&&(TS.boot_data.feature_texty_mentions?TS.utility.contenteditable.paste(TS.client.msg_input.$input,e):TS.view.focusMessageInput())}}},supportsUploadOnPaste:function(){return!TS.model.is_IE},detectImageFromEvent:function(e){TS.info("clipboardData!"),TS.info(e.clipboardData.types);var t,n,i=e.clipboardData.items,a={};if(i){for(t=0;t<i.length;t+=1)i[t]&&(a[i[t].type]=!0);for(t=0;t<i.length;t+=1)if(-1!==i[t].type.indexOf("image"))if(TS.model.is_mac&&a["text/plain"]&&a["text/html"]&&a["text/rtf"])TS.info("Ignoring pasted image data, likely from Office/Word for Mac.");else if(TS.model.is_win&&a["text/plain"]&&a["text/html"]&&a["image/png"])TS.info("Ignoring pasted image data from Windows, which should render as text");else if(null!==(n=i[t].getAsFile()))return n}else{TS.warn("no clipboardData.items");var s=e.clipboardData.types||[];for(t=0;t<s.length;t+=1)s[t]&&(a[s[t]]=!0);var r=window.macgap||window.winssb;if(r&&r.clipboard&&r.clipboard.readImage&&!a["text/rtf"]&&r.clipboard.readImage())return r.clipboard.readImage()}return!1},startUploadFromMacSSBReadImage:function(e,t){var n=document.getElementById("converter_canvas");n||($("body").append('<canvas id="converter_canvas" class="offscreen"></canvas>'),n=document.getElementById("converter_canvas"));var i=n.getContext("2d"),a=new Image;a.src="data:image/tiff;base64,"+e,a.onload=function(){n.width=a.width,n.height=a.height,i.clearRect(0,0,n.width,n.height),i.drawImage(a,0,0);var e=TS.utility.base64StrFromDataURI(n.toDataURL("image/png"));TS.client.ui.file_pasted_sig.dispatch(e,t)}},checkCatcher:function(e,t){var n=TS.ui.paste.catcher_div;if(n){var i=n.childNodes[0],a=TS.utility.contenteditable.value(TS.client.ui.$msg_input),s=t;s||(s="textContent"in n?n.textContent:n.innerText,s=$.trim(s));var r,o;if(i)if("IMG"===i.tagName)TS.client.ui.file_pasted_sig.dispatch(TS.utility.base64StrFromDataURI(i.src),e);else{if(a){o=TS.client.ui.$msg_input.getCursorRange();var l=o.l,d=o.s,c=a.substr(0,d),_=a.substr(d+l);r=c+s+_}else r=s;TS.client.msg_input.populate(r)}n.innerHTML="",o&&TS.client.ui.$msg_input.setCursorPosition(o.s+o.l+s.length)}},getPlainTextFromClipboard:function(e){return e&&e.clipboardData?e.clipboardData.getData("text/plain"):window.clipboardData?window.clipboardData.getData("Text"):null}})}()},2635:function(e,t){!function(){"use strict";TS.registerModule("ui.prefs_dialog",{onStart:function(){Q(),TS.client.login_sig.add(T),TS.prefs.sidebar_theme_changed_sig.add(ce),TS.prefs.dtop_notif_changed_sig.add(J),TS.prefs.read_changed_sig.add(oe),TS.prefs.display_real_names_override_changed_sig.add(ie),TS.prefs.team_display_real_names_changed_sig.add(ie),TS.prefs.tz_changed_sig.add(he),TS.boot_data.feature_localization&&TS.prefs.locale_changed_sig.add(pe),TS.members.changed_tz_sig.add(me),d=TS.qs_args.prefs_last_section||d,TS.boot_data.feature_notif_prefs_overhaul&&(TS.prefs.email_alerts_changed_sig.add(J),TS.prefs.push_changed_sig.add(J),J=_.throttle(J,1e3))},start:function(e,t,n){v(e,t,n)}});var e,t,n,i,a,s=!1,r=null,o=null,l=null,d="notifications",c=null,u=0,m=!1,h=!1,p=!1,g=!1,f=!1,S=[],T=function(){h=TS.model.mac_ssb_version&&TS.model.mac_ssb_version>=.32||TS.model.win_ssb_version&&TS.model.is_mac,p=TS.model.win_ssb_version&&TS.model.is_win,g=TS.model.lin_ssb_version&&TS.model.is_lin,m=TS.model.prefs.sidebar_theme&&("custom_theme"===TS.model.prefs.sidebar_theme||"cotton_theme"===TS.model.prefs.sidebar_theme||"eco_theme"===TS.model.prefs.sidebar_theme)},v=function(t,i,a){if(t=t||d,TS.model.ms_logged_in_once&&TS.model.prefs&&!$("body").hasClass("loading")&&!TS.ui.fs_modal.is_showing){c||(c=TS.templates.prefs_sidebar({show_mac_ssb_prefs:h,show_win_ssb_prefs:p,show_lin_ssb_prefs:g,show_labs_prefs:TS.boot_data.feature_tinyspeck})),s=!0;var _={title:b(),body_template_html:"",sidebar_html:c,onShow:w,onCancel:y,modal_class:"fs_modal_header fs_modal_sidebar prefs_modal"};TS.boot_data.feature_notif_prefs_overhaul&&(_.onGo=$e),TS.ui.fs_modal.start(_),r=$("#fs_modal"),o=r.find(".contents"),l=$("#fs_modal_sidebar"),l.find("a").on("click",function(){k($(this).data("section"))}),TS.environment.supports_custom_scrollbar||r.find(".contents_container").monkeyScroll(),TS.boot_data.feature_notif_prefs_overhaul&&(e=Se(),n={}),k(t),i&&setTimeout(function(){TS.boot_data.feature_notif_prefs_overhaul?r.find(i).scrollintoview({offset:"bottom",px_offset:-100}).highlight():r.find(i).highlight()},1e3),TS.boot_data.feature_notif_prefs_overhaul||"notifications"!==t||a&&q(a),M(),$("#col_channels").addClass("prefs_open")}},b=function(){return TS.i18n.t("Your preferences for {team_name}","prefs")({team_name:TS.model.team.name})},w=function(){},y=function(){$("#col_channels").removeClass("prefs_open"),S=[],s=!1,r=null,o=null,l.find("a").off("click"),l=null},k=function(e){f&&de();var t=A(e);d=e,l.find("a").removeClass("is_active").end().find('a[data-section="'+e+'"]').addClass("is_active"),o.html(t),C(e),setTimeout(function(){TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller(o),r.find(".contents_container").scrollTop(0)},0),f="themes"===e,"notifications"===e&&_.each(S,function(e){q(e)})},A=function(e){var t,n={};switch(e){case"notifications":var i=TS.model.prefs.highlight_words||"";i=i.replace(/,/g,", ").replace(/ {2}/g," "),n={notification_sounds:TS.boot_data.notification_sounds,member:TS.model.user,highlight_words:i,team_prefs:TS.model.team.prefs,time24:TS.model.prefs.time24,show_mac_ssb_prefs:h,show_win_ssb_prefs:p,has_tz:!!TS.model.prefs.tz,tz_guess:!TS.model.prefs.tz&&B()},TS.boot_data.feature_notif_prefs_overhaul?(n.new_msg_snd_label=ge(TS.model.prefs.new_msg_snd),t=TS.templates.prefs_notifications_new(n)):t=TS.templates.prefs_notifications(n);break;case"win_ssb":case"lin_ssb":t=TS.templates.prefs_win_lin_ssb({show_lin_ssb_prefs:g,is_app_store_build:TSSSB.call("isAppStoreBuild")});break;case"language_region":n={user_locale:TS.i18n.locale(),languages:TS.model.prefs.locales_enabled,timezones:window.timezones_list(),user_tz:TS.model.user.tz},t=TS.templates.prefs_language_region(n);break;case"messages_media":var a="";TS.model.prefs.preferred_skin_tone&&"1"!==TS.model.prefs.preferred_skin_tone&&(a=":skin-tone-"+TS.model.prefs.preferred_skin_tone+":"),n={inline_img_byte_limit:TS.model.inline_img_byte_limit,clean_theme:"light_with_avatars"===TS.model.prefs.messages_theme,compact_theme:"dense"===TS.model.prefs.messages_theme,thumbs_up_name_with_skin_tone_modifier:":thumbsup:"+a,should_use_local_lato_2:TS.boot_data.should_use_local_lato_2,messages_theme:TS.model.prefs.messages_theme,show_time24_pref:!TS.boot_data.feature_localization||"en-US"===TS.i18n.locale()},t=TS.templates.prefs_messages_media(n);break;case"themes":TS.model.prefs.sidebar_theme_custom_values&&"undefined"!==TS.model.prefs.sidebar_theme_custom_values&&(n.theme=JSON.parse(TS.model.prefs.sidebar_theme_custom_values),n.show_customization_ui=m,n.show_customization_ui=m),t=TS.templates.prefs_themes(n);break;case"search":t=TS.templates.prefs_search(re());break;case"read_state_tracking":t=TS.templates.prefs_read_state_tracking({short_key_name:TS.model.is_mac?"Option":"Alt"});break;case"a11y":t=function(){var e=TS.model.is_electron&&(TSSSB.env.mac_ssb_version>2.5||2.5===TSSSB.env.mac_ssb_version&&2===TSSSB.env.mac_ssb_version_minor||TSSSB.env.lin_ssb_version>2.5||2.5===TSSSB.env.lin_ssb_version&&2===TSSSB.env.lin_ssb_version_minor||TSSSB.env.win_ssb_version>2.5||2.5===TSSSB.env.win_ssb_version&&2===TSSSB.env.win_ssb_version_minor);return n={zoom_pref_enabled:TSSSB.supports_zoom_api,zoom_pref_70_supported:e},TS.templates.prefs_a11y(n)}();break;case"advanced":var s=!1,r="";TS.model.is_our_app&&(s=window.TSSSB&&TSSSB.call("hasPreference","PrefSSBFileDownloadPath"),TSSSB.env.mac_ssb_version&&TSSSB.env.mac_ssb_version<2&&(s=!1),s&&(r=TSSSB.call("getPreference","PrefSSBFileDownloadPath"))),n.show_app_download_path=s,n.app_download_path=r,n.show_console_whitelist=!0;var o=_.get(TS.model.prefs,"client_logs_pri","");n.user_facing_pris=_(Object.keys(TS.boot_data.client_logs)).filter(function(e){var t=TS.boot_data.client_logs[e],n=!0;if(!_.isUndefined(t.features)){var i=t.features;_.isArray(t.features)||(i=i.split(","));var a=0;i.forEach(function(e){0!==e.indexOf("feature_")&&(e="feature_"+e),TS.boot_data[e]&&(a+=1)}),n=a===i.length}return!_.isUndefined(t.user_facing)&&t.user_facing&&n}).map(function(e){var t=_.merge({},TS.boot_data.client_logs[e]);return t.selected=o.indexOf(e)>-1,t.name&&(t.name=t.name.replace(/[_-]/g," ")),t}).value(),n.client_logs_pri_all_selected=o.indexOf("all")>-1,n.show_separate_shared_channels_pref=TS.boot_data.feature_shared_channels_client&&TS.environment.is_dev,t=TS.templates.prefs_advanced(n);break;case"labs":n={show_electron_prefs:TS.model.is_electron},t=TS.templates.prefs_labs(n);break;default:return void TS.error("This isn't the Prefs HTML builder you're looking for: "+e)}return t},C=function(e){switch(e){case"notifications":x(),J(),h&&(j(),ue()),p&&z(),Y(),X(),ee();break;case"win_ssb":case"lin_ssb":W(),V();break;case"language_region":F();break;case"messages_media":P(),ie(),$("#dont_obey_inline_img_limit_cb").prop("disabled",!TS.model.prefs.expand_inline_imgs);break;case"themes":N(),ce(),le();break;case"search":O();break;case"read_state_tracking":R(),oe();break;case"a11y":U();break;case"advanced":H();break;case"labs":G();break;default:TS.error("This isn't the Prefs UI binding you're looking for: "+e)}},M=function(){o.on("change",'input[type="checkbox"][data-inline-saver], input[type="radio"][data-inline-saver], input[type="file"], select[data-inline-saver]',function(){TS.ui.inline_saver.show({target:$(this).data("inline-saver")})});var e=TS.boot_data.feature_notif_prefs_overhaul?1e3:250;o.on("input",'input[type="text"][data-inline-saver], textarea[data-inline-saver]',TS.utility.debounce(function(){var e=$(this);e.hasClass("validation_error")||TS.ui.inline_saver.show({target:e.data("inline-saver")})},e))},x=function(){$(".growls_stuff").addClass("hidden"),$("#growls_permission_link").on("click",ne),$("#growls_test").on("click",function(){TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("What do you know? It works.","prefs")())}).addClass("hidden"),TS.ui.growls.shouldShowPermissionButton()?$("#growls_permission_div").removeClass("hidden"):TS.ui.growls.checkPermission()?($("#growls_allowed_div").removeClass("hidden"),$("#growls_test").removeClass("hidden")):TS.ui.growls.no_notifications?$("#growls_impossible_div").removeClass("hidden"):"denied"===TS.ui.growls.getPermissionLevel()&&$("#growls_disallowed_div").removeClass("hidden"),$('input:radio[name="notifications_rd"]').on("change",function(){var t=$(this).val();if(TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{desktop_notifications:t.toString()}}),TS.boot_data.feature_notif_prefs_overhaul){var n={};"all"===t?(n.all_channels_loud=!0,n.growls_enabled=!0):"mentions"===t?(n.all_channels_loud=!1,n.growls_enabled=!0):(n.all_channels_loud=!1,n.growls_enabled=!1),e||("all"===t?t="everything":"mentions"===t?t="mentions":"never"===t&&(t="nothing"),_.assign(n,ve(t))),_.assign(TS.model.prefs,n),TS.prefs.setMultiPrefsByAPI(n)}else"all"===t||"mentions"===t?("all"===t?(TS.prefs.setPrefByAPI({name:"all_channels_loud",value:!0}),TS.model.prefs.all_channels_loud=!0):(TS.prefs.setPrefByAPI({name:"all_channels_loud",value:!1}),TS.model.prefs.all_channels_loud=!1),TS.model.prefs.growls_enabled||(TS.prefs.setPrefByAPI({name:"growls_enabled",value:!0}),TS.model.prefs.growls_enabled=!0)):(TS.prefs.setPrefByAPI({name:"growls_enabled",value:!1}),TS.model.prefs.growls_enabled=!1);TS.prefs.dtop_notif_changed_sig.dispatch()}),$("#no_text_in_notifications_cb").on("change",function(){var e=!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"no_text_in_notifications",value:e}),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{no_text_in_notifications:e.toString()}})});var t;$('input:radio[name="sound_option_rd"]').on("change",function(){t=$(this).val(),TS.sounds.play(t,{ignore_mute:!0}),TS.prefs.setPrefByAPI({name:"new_msg_snd",value:t})}),$(".sound_option").find("ts-icon").on("click",function(e){t=$(this).siblings("input").val(),TS.sounds.play(t,{ignore_mute:!0}),e.preventDefault(),e.stopPropagation()}),$("#mute_sounds_cb").prop("checked",!0===TS.model.prefs.mute_sounds),$("#mute_sounds_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.mute_sounds=e,TS.prefs.setPrefByAPI({name:"mute_sounds",value:e}),J(),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{mute_sounds:e.toString()}})}),$("#threads_everything_cb").prop("checked",!0===TS.model.prefs.threads_everything),$("#threads_everything_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.threads_everything=e,TS.prefs.setPrefByAPI({name:"threads_everything",value:e}),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{threads_everything:e.toString()}})});var i=TS.boot_data.feature_notif_prefs_overhaul?1e3:250;if(r.find("#highlight_words_input").on("input",TS.utility.debounce(se,i)),TS.model.win_ssb_version||TS.model.lin_ssb_version){var a=$("#highlight_words_input").attr("placeholder"),s=!0;$("#highlight_words_input").on("textchange",function(){$(this).val()&&s?($(this).attr("placeholder",""),s=!1):$(this).val()||s||($(this).attr("placeholder",a),s=!0)})}$("#dnd_enabled").prop("checked",!!TS.model.prefs.dnd_enabled),$("#dnd_start_hour, #dnd_end_hour").prop("disabled",!TS.model.prefs.dnd_enabled).closest("label").toggleClass("disabled",!TS.model.prefs.dnd_enabled);var o=I();$("#dnd_enabled").on("change",function(){var e=$(this).is(":checked");e?$("#dnd_start_hour, #dnd_end_hour").prop("disabled",!1).closest("label").removeClass("disabled"):$("#dnd_start_hour, #dnd_end_hour").prop("disabled",!0).closest("label").addClass("disabled"),o.dnd_enabled=e,TS.prefs.setMultiPrefsByAPI(o),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{dnd_enabled:e.toString()}})});var l=E($("#dnd_start_hour"),o.dnd_start_hour);l.prop("selected",!0);var d=E($("#dnd_end_hour"),o.dnd_end_hour);d.prop("selected",!0),$("#dnd_start_hour").on("change",function(){o.dnd_start_hour=$(this).val(),TS.prefs.setMultiPrefsByAPI(o),$("#dnd_end_hour option").each(function(){return $(this).prop("disabled",!1)}),E($("#dnd_end_hour"),o.dnd_start_hour).prop("disabled",!0)}),$("#dnd_end_hour").on("change",function(){o.dnd_end_hour=$(this).val(),TS.prefs.setMultiPrefsByAPI(o),$("#dnd_start_hour option").each(function(){return $(this).prop("disabled",!1)}),E($("#dnd_start_hour"),o.dnd_end_hour).prop("disabled",!0)}),l=E($("#dnd_start_hour"),o.dnd_end_hour),l.prop("disabled",!0),d=E($("#dnd_end_hour"),o.dnd_start_hour),d.prop("disabled",!0),$("#confirm_dnd_tz_guess").click(function(){if(!$(this).hasClass("disabled")&&window.timezones_guess){var e=window.timezones_guess();TS.prefs.setPrefByAPI({name:"tz",value:e}),$(this).addClass("disabled")}}),TS.boot_data.feature_notif_prefs_overhaul&&($('#global_prefs_container [data-action="your_keywords_jump"]').click(function(e){e.preventDefault(),$("#prefs_highlight_words").scrollintoview({offset:"bottom",px_offset:-100}).highlight()}),$("#change_notification_sound").click(function(e){TS.menu.startWithSoundsMenu(e,function(e){TS.sounds.play(e,{ignore_mute:!0});var t=TS.prefs.setPrefByAPI({name:"new_msg_snd",value:e});TS.ui.inline_saver.show({target:"#prefs_sounds_and_appearance",promise:t});var n=ge(e);$("#selected_new_msg_snd").text(n),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{new_msg_snd:e}})})}),$("#new_msg_snd_none_cb").on("change",function(){var e,t=$(this).is(":checked");t?(e=n.new_msg_snd||"knock_brush.mp3",$("#selected_new_msg_snd").text(ge(e)),$("#select_new_msg_snd").removeClass("hidden")):(n.new_msg_snd=TS.model.prefs.new_msg_snd,e="none",$("#select_new_msg_snd").addClass("hidden")),TS.prefs.setPrefByAPI({name:"new_msg_snd",value:e}),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{new_msg_snd:e}})}),$("#email_alerts_cb").on("change",function(){$(this).is(":checked")?TS.model.prefs.email_alerts=n.email_alerts||"instant":(n.email_alerts=TS.model.prefs.email_alerts,TS.model.prefs.email_alerts="none"),TS.prefs.setPrefByAPI({name:"email_alerts",value:TS.model.prefs.email_alerts}),J(),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{email_alerts:TS.model.prefs.email_alerts}})}),$("#change_email_alerts").on("click",function(e){TS.menu.startWithGeneric(e,[{value:"instant",label:TS.i18n.t("Once every 15 minutes","prefs")()},{value:"hourly",label:TS.i18n.t("Once an hour","prefs")()}],function(e){var t=TS.prefs.setPrefByAPI({name:"email_alerts",value:e});TS.ui.inline_saver.show({target:"#prefs_notifs_delay",promise:t}),TS.model.prefs.email_alerts=e,J(),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{email_alerts:TS.model.prefs.email_alerts}})})}),$("#mobile_specific_settings select").on("change",function(){var e=$(this).val();Te(e),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{mobile_notifications:e}})}),$("#mobile_different_settings_cb").on("change",function(){if(e=$(this).is(":checked"),$("#mobile_specific_settings").toggleClass("hidden",!e),!e&&Se()){var t=TS.notifs.getGlobalNotificationSetting();Te(t)}TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{use_different_mobile_settings:e.toString()}})}),$("#push_idle_wait_select").on("change",function(){var e=$(this).val(),t=TS.prefs.setPrefByAPI({name:"push_idle_wait",value:e});TS.ui.inline_saver.show({target:"#prefs_notifs_delay",promise:t}),TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{push_idle_wait:e.toString()}})}),$(".global_notification_block").on("click",function(e){e.isDefaultPrevented()||$(e.target).closest("label, input").length||$(this).find("input").prop("checked",!0).trigger("change")}),$("#channel_specific_overrides").on("click",'[data-action="reset_channel_to_defaults"]',function(e){var t=$(this).closest(".channel_overrides_row"),n=t.attr("data-cid");n&&(e.preventDefault(),Ae(n),we())}),$("#channel_specific_overrides").on("click",'[data-action="open_channel_overrides"]',function(e){if(!e.isDefaultPrevented()){var t=$(this).attr("data-cid");t&&(Ce(),xe(t))}}),$('#global_prefs_container [data-action="add_channel_override"]').on("click",function(){Ce(),Me()}),$("#channel_prefs_container").on("click",'[data-action="proceed_to_channel_options"]',function(){var e=$("#channel_override_picker").lazyFilterSelect("value")[0],t=_.get(e,"model_ob.id");t&&xe(t)}),$("#global_prefs_container").on("click",'[data-action="highlight_channel_overrides"]',function(e){e.preventDefault(),$("#prefs_channel_overrides").scrollintoview({offset:"top",px_offset:50}).highlight()}),TS.boot_data.feature_localization&&$('#global_prefs_container [data-action="show_time_zone"]').on("click",function(e){e.preventDefault();var t=$(this).closest(".contents_container"),n=function(){k("language_region"),setTimeout(function(){$(".prefs_tz").highlight()},500)};0===t.scrollTop()?n():$(this).closest(".contents_container").animate({scrollTop:0}).queue(function(e){setTimeout(n,250),e()})}))},I=function(){return{dnd_enabled:TS.model.prefs.dnd_enabled,dnd_start_hour:TS.model.prefs.dnd_start_hour||TS.model.team.prefs.dnd_start_hour||"22:00",dnd_end_hour:TS.model.prefs.dnd_end_hour||TS.model.team.prefs.dnd_end_hour||"08:00"}},E=function(e,t){var n=e.find("option").filter(function(){var e=$(this).attr("value"),n=e===t;return n||(n=e==="0"+t),n});if(!n.length){if(n=$('<option data-custom-time="true">'),n.val(t),TS.utility.date.do24hrTime())n.text(t);else{var i=te(t);n.text(i)}var a=e.find("option").filter(function(){return $(this).attr("value")>t});a.length?a.filter(":first").before(n):e.append(n)}return n},B=function(){if(!window.timezones_guess||!window.timezones_list)return null;var e=window.timezones_guess(),t=window.timezones_list(),n=_.find(t,function(t){return 2===t.length&&t[1]===e});return n?n[0]:null},D=function(e){TS.utility.disableElement($("#jumbomoji_cb"),e),$("#jumbomoji_pref").toggleClass("jumbomoji_pref_disabled",e)},F=function(){o.find('[name="lang"]').on("change",function(){var e=$(this).val(),t=TS.i18n.locale(),n=TS.i18n.localesEnabled()[e];e!==t&&TS.generic_dialog.start({title:TS.i18n.t("Change language to {lang}?","prefs")({lang:n}),body:"<p>"+TS.i18n.t("Are you sure you want to change the language you use with Slack?","prefs")()+"</p>",show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Change to {lang}","prefs")({lang:n}),onGo:function(){e!==t&&(window.createCookie("i18n_locale",e,365,"slack.com"),i=!0,TS.prefs.setPrefByAPI({name:"locale",value:e},function(){TS.reload(null,"prefs dialog change: locale -> "+e)}))}})}),o.find('[name="tz"]').on("change",function(){var e=$(this).val();e!==TS.model.user.tz&&TS.prefs.setPrefByAPI({name:"tz",value:e})})},P=function(){$('input:radio[name="messages_theme_select"]').filter('[value="'+TS.model.prefs.messages_theme+'"]').prop("checked",!0),$('input:radio[name="messages_theme_select"]').on("change",function(){$(".prefs_messages_theme_preview").toggleClass("hidden");var e=$(this).val();D("dense"===e),TS.prefs.setPrefByAPI({name:"messages_theme",value:e})}),$("#show_typing_cb").prop("checked",!0===TS.model.prefs.show_typing).removeClass("hidden"),$("#show_typing_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"show_typing",value:!!$(this).prop("checked")})}),$("#display_real_names_override_cb").on("change",function(){var e,t=!!$(this).prop("checked");e=TS.model.team.prefs.display_real_names?t?0:-1:t?1:0,TS.prefs.setPrefByAPI({name:"display_real_names_override",value:e})}),$("#time24_cb").prop("checked",!0===TS.model.prefs.time24),$("#time24_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"time24",value:!!$(this).prop("checked")})}),$("#hide_hex_swatch_cb").prop("checked",!1===TS.model.prefs.hide_hex_swatch),$("#hide_hex_swatch_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"hide_hex_swatch",value:!e})}),$("#load_lato_2_cb").prop("checked",!0===TS.model.prefs.load_lato_2),$("#load_lato_2_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.load_lato_2=e,TS.prefs.setPrefByAPI({name:"load_lato_2",value:e},function(){TS.reload(null,"prefs dialog change: load_lato_2 -> "+e)})}),$('input:radio[name="emoji_mode_select"]').filter('[value="'+TS.model.prefs.emoji_mode+'"]').prop("checked",!0),$('input:radio[name="emoji_mode_select"]').on("change",function(){TS.prefs.setPrefByAPI({name:"emoji_mode",value:$(this).val()})}),$("#jumbomoji_cb").prop("checked",!0===TS.model.prefs.jumbomoji),$("#jumbomoji_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"jumbomoji",value:e}),TS.prefs.onPrefChanged({name:"jumbomoji",value:e})}),$("#convert_emoticons_cb").prop("checked",!0===TS.model.prefs.convert_emoticons),$("#convert_emoticons_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"convert_emoticons",value:e})}),$("#expand_internal_inline_imgs_cb").prop("checked",!0===TS.model.prefs.expand_internal_inline_imgs),$("#expand_internal_inline_imgs_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"expand_internal_inline_imgs",value:!!$(this).prop("checked")})}),$("#expand_inline_imgs_cb").prop("checked",!0===TS.model.prefs.expand_inline_imgs),$("#expand_inline_imgs_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"expand_inline_imgs",value:e}),TS.model.prefs.expand_inline_imgs=e,$("#dont_obey_inline_img_limit_cb").prop("disabled",!TS.model.prefs.expand_inline_imgs)}),$("#dont_obey_inline_img_limit_cb").prop("checked",!1===TS.model.prefs.obey_inline_img_limit),$("#dont_obey_inline_img_limit_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.obey_inline_img_limit=!e,TS.prefs.setPrefByAPI({name:"obey_inline_img_limit",value:!e})}),$("#expand_non_media_attachments_cb").prop("checked",!0===TS.model.prefs.expand_non_media_attachments),$("#expand_non_media_attachments_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"expand_non_media_attachments",value:!!$(this).prop("checked")})})},O=function(){$("#search_channel_exclusion").lazyFilterSelect({placeholder_text:TS.i18n.t("Pick channels to exclude...","prefs")()}).on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"search_exclude_channels",value:e?e.join(","):""})}).hide()},R=function(){$('input:radio[name="read_rd"]').on("change",function(){var e=$(this).val();TS.prefs.setReadStateTrackingPref(e),oe()})},U=function(){var e=$("#a11y_animations");e.prop("checked",!0===TS.model.prefs.a11y_animations),e.on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"a11y_animations",value:e})}),a=TSSSB.call("getZoom");var t=TS.ui.a11y.zoomLevelToPercent(a);L(t),$('input:radio[name="a11y_font_size_select"]').on("change",function(){var e=$(this).val();a=TS.ui.a11y.zoomPercentToLevel(e),TSSSB.call("setZoom",a)})},L=function(e){$('input:radio[name="a11y_font_size_select"]').filter('[value="'+e+'"]').prop("checked",!0)},Q=function(){TS.client&&TSSSB.supports_zoom_api&&TS.ui.a11y.zoom_level_changed_sig.add(function(e){var t=e.zoom_level,n=a==t;n||(a=t,L(TS.ui.a11y.zoomLevelToPercent(a)));var i=TS.ui.a11y.zoomLevelToPercent(t),s="normal"===i?"100":i,r=n?"PREF":"OTHER",o={a11y_zoom_level:s,a11y_zoom_set_origin:r};TS.clog.track("PREF_USER_CLIENT_UPDATE",o)})},H=function(){$("#webapp_spellcheck_cb").prop("checked",!0===TS.model.prefs.webapp_spellcheck).removeClass("hidden"),$("#webapp_spellcheck_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"webapp_spellcheck",value:!!$(this).prop("checked")})}),TS.boot_data.feature_name_tagging_client||($("#require_at_cb").prop("checked",!0===TS.model.prefs.require_at).removeClass("hidden"),$("#require_at_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"require_at",value:!!$(this).prop("checked")})})),$("#enter_is_special_in_tbt_cb").prop("checked",!0===TS.model.prefs.enter_is_special_in_tbt),$("#enter_is_special_in_tbt_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"enter_is_special_in_tbt",value:!!$(this).prop("checked")})}),$("#arrow_history_cb").prop("checked",!0===TS.model.prefs.arrow_history),$("#arrow_history_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"arrow_history",value:e})}),$('input:radio[name="pr_sidebar"]').filter('[value="'+TS.model.prefs.sidebar_behavior+'"]').prop("checked",!0),$('input:radio[name="pr_sidebar"]').on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"sidebar_behavior",value:e}),TS.prefs.onPrefChanged({name:"sidebar_behavior",value:e})}),$("#separate_private_channels_cb").prop("checked",!0===TS.model.prefs.separate_private_channels),$("#separate_private_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"separate_private_channels",value:e})}),$("#separate_shared_channels_cb").prop("checked",!0===TS.model.prefs.separate_shared_channels),$("#separate_shared_channels_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"separate_shared_channels",value:e})}),r.find('[data-action="select_ssb_download_path"]').on("click",function(){var e=TSSSB.call("getPreference","PrefSSBFileDownloadPath")||"",t={type:"openDirectory",title:TS.i18n.t("Select a download location","prefs")(),defaultPath:e};TSSSB.call("showOpenDialog",{options:t,callback:function(e){if(e){var t=e[0];TSSSB.call("setPreference",{name:"PrefSSBFileDownloadPath",value:t}),r.find("#app_download_path_input").val(t),TS.ui.inline_saver.show({target:r.find("#prefs_download_location")})}}})}),$("#pagekeys_handled_cb").prop("checked",!0===TS.model.prefs.pagekeys_handled).removeClass("hidden"),$("#pagekeys_handled_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"pagekeys_handled",value:!!$(this).prop("checked")})}),$("#f_key_search_cb").prop("checked",!0===TS.model.prefs.f_key_search).removeClass("hidden"),$("#f_key_search_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"f_key_search",value:!!$(this).prop("checked")})}),$("#k_key_omnibox_cb").prop("checked",!0===TS.model.prefs.k_key_omnibox).removeClass("hidden"),$("#k_key_omnibox_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"k_key_omnibox",value:!!$(this).prop("checked")})}),$("#no_omnibox_in_channels_cb").prop("checked",!0===TS.model.prefs.no_omnibox_in_channels).removeClass("hidden"),$("#no_omnibox_in_channels_cb").on("change",function(){TS.prefs.setPrefByAPI({name:"no_omnibox_in_channels",value:!!$(this).prop("checked")})}),TS.boot_data.feature_prev_next_button&&($("#prev_next_btn").prop("checked",!0===TS.model.prefs.prev_next_btn).removeClass("hidden"),$("#prev_next_btn").on("change",function(){TS.prefs.setPrefByAPI({name:"prev_next_btn",value:!!$(this).prop("checked")})})),$("#ask_after_away_cb").prop("checked",!0===TS.model.prefs.confirm_user_marked_away),$("#ask_after_away_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.confirm_user_marked_away=e,TS.prefs.setPrefByAPI({name:"confirm_user_marked_away",value:e})}),$("#enable_chan_suggestions").prop("checked",!0===TS.model.prefs.overloaded_message_enabled),$("#enable_chan_suggestions").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"overloaded_message_enabled",value:e})}),$("#allow_calls_to_set_current_status").prop("checked",!0===TS.model.prefs.allow_calls_to_set_current_status),$("#allow_calls_to_set_current_status").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"allow_calls_to_set_current_status",value:e})}),$("#ls_disabled_cb").prop("checked",!0===TS.model.prefs.ls_disabled),$("#ls_disabled_cb").bind("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.ls_disabled=e,TS.storage.setDisabled(TS.model.prefs.ls_disabled),TS.prefs.setPrefByAPI({name:"ls_disabled",value:e},function(){TS.reload(null,"prefs dialog change: ls_disabled -> "+e)})}),$("#ss_emojis_cb").prop("checked",!0!==TS.model.prefs.ss_emojis),$("#ss_emojis_cb").bind("change",function(){var e=!$(this).prop("checked");TS.model.prefs.ss_emojis=e,TS.prefs.setPrefByAPI({name:"ss_emojis",value:e},function(){TS.reload(null,"prefs dialog change: ss_emojis -> "+e)})}),$("#enhanced_debugging_cb").prop("checked",!0===TS.model.prefs.enhanced_debugging),$("#enhanced_debugging_cb").bind("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.enhanced_debugging=e,TS.prefs.setPrefByAPI({name:"enhanced_debugging",value:e},function(){TS.reload(null,"prefs dialog change: enhanced_debugging -> "+e)})}),$("#flannel_server_pool").val(TS.model.prefs.flannel_server_pool),$("#flannel_server_pool").on("change",function(){var e=$(this).val(),t=TS.model.prefs.flannel_server_pool;if(!_.includes(["production","canary","random"],e))return void TS.error("Tried to set an invalid value ('"+e+"') for `flannel_server_pool` pref");TS.prefs.setPrefByAPI({name:"flannel_server_pool",value:e},function(){TS.log(1989,"Flannel: canary pref changed from "+t+" to "+e),TS.isSocketManagerEnabled()?TS.interop.SocketManager.disconnect():TS.ms.disconnect()})}),$("#enable_unread_view").prop("checked",!0===TS.model.prefs.enable_unread_view),$("#enable_unread_view").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.seen_unread_view_coachmark=!0,TS.prefs.setMultiPrefsByAPI({enable_unread_view:e,seen_unread_view_coachmark:!0}),TS.prefs.onPrefChanged({name:"enable_unread_view",value:e})}),$("#client_logs_pri").hide().lazyFilterSelect({placeholder_text:TS.i18n.t("Select logs to enable...","prefs")(),tokenClass:function(){return"capitalize"},listItemClass:function(){return"capitalize"}}).on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"client_logs_pri",value:e?e.join(","):""})});var e=Math.random();"U024BE7LV"===TS.model.user.id?$("#emo_bear").attr("src","/img/emo_bear2.gif?"+e):$("#emo_bear").attr("src","/img/emo_bear.gif?"+e),$("#surprise_me").on("change",function(){$("#surprise").fadeIn(150,function(){setTimeout(function(){$("#surprise").fadeOut(500,function(){e=Math.random(),"U024BE7LV"===TS.model.user.id?$("#emo_bear").attr("src","/img/emo_bear2.gif?"+e):$("#emo_bear").attr("src","/img/emo_bear.gif?"+e),$("#surprise_me").prop("checked",!1)})},2400)})}),TS.boot_data.feature_show_jumper_scores&&($("#show_jumper_scores").prop("checked",!0===TS.model.prefs.show_jumper_scores),$("#show_jumper_scores").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"show_jumper_scores",value:e})}))},N=function(){r.find('input:radio[name="sidebar_theme_rd"]').on("change",function(){var e=$(this).val(),t=TS.sidebar_themes.default_themes[e];_e(e,t)}),r.find("input.color_hex").on("textchange",function(){var e=$.trim($(this).val());if(!e.match(TS.prefs.hex_regex))return void clearTimeout(u);0!==e.indexOf("#")&&(e="#"+e),$(this).prev(".color_swatch").css("background-color",e).data("hex",e),clearTimeout(u),u=setTimeout(function(){var e={column_bg:r.find('input[name="color_column_bg_hex"]').val(),menu_bg:r.find('input[name="color_menu_bg_hex"]').val(),active_item:r.find('input[name="color_active_item_hex"]').val(),active_item_text:r.find('input[name="color_active_item_text_hex"]').val(),hover_item:r.find('input[name="color_hover_item_hex"]').val(),text_color:r.find('input[name="color_text_color_hex"]').val(),active_presence:r.find('input[name="color_active_presence_hex"]').val(),badge:r.find('input[name="color_badge_hex"]').val()};$.each(e,function(t,n){"#"!==n[0]&&(e[t]="#"+n)}),_e("custom_theme",e)},250)}),r.find("#sidebar_theme_custom").on("textchange",function(){var e=$(this);setTimeout(function(){var t=$.trim(e.val()),n=t.replace(/ /g,"").split(","),i=!0;if($.each(n,function(e,t){t.match(TS.prefs.hex_regex)||(i=!1)}),!i)return void clearTimeout(u);var a={column_bg:n[0],menu_bg:n[1],active_item:n[2],active_item_text:n[3],hover_item:n[4],text_color:n[5],active_presence:n[6],badge:n[7]};$.each(a,function(e,t){"#"!==t[0]&&(a[e]="#"+t)}),clearTimeout(u),u=setTimeout(function(){_e("custom_theme",a)},250)},0)}),r.find(".color_swatch").on("click.show_picker",function(e){e.stopPropagation();var t=$(this),n=t.next("input");r.find(".color_swatch.selected").removeClass("selected").find(".colpick").addClass("hidden");var i=t.data("hex").replace("#","");t.colpick({flat:!0,layout:"hex",color:i,submit:0,onChange:function(e,i){t.css("background-color","#"+i).data("hex","#"+i),n.val("#"+i),clearTimeout(u),u=setTimeout(function(){var e={column_bg:r.find('input[name="color_column_bg_hex"]').val(),menu_bg:r.find('input[name="color_menu_bg_hex"]').val(),active_item:r.find('input[name="color_active_item_hex"]').val(),active_item_text:r.find('input[name="color_active_item_text_hex"]').val(),hover_item:r.find('input[name="color_hover_item_hex"]').val(),text_color:r.find('input[name="color_text_color_hex"]').val(),active_presence:r.find('input[name="color_active_presence_hex"]').val(),badge:r.find('input[name="color_badge_hex"]').val()};_e("custom_theme",e)},500)}}).colpickSetColor(i),r.on("click.hide_colpick",function(){r.find(".color_swatch.selected").removeClass("selected").find(".colpick").addClass("hidden")}),t.addClass("selected").find(".colpick").removeClass("hidden")}),$("#customize_theme_toggle").on("click",function(){$("#customize_theme_info").addClass("hidden"),$("#prefs_themes_customize").removeClass("hidden"),m=!0})},G=function(){if($("#full_text_extracts_cb").prop("checked",!0===TS.model.prefs.full_text_extracts),$("#full_text_extracts_cb").on("change",function(){var e=!!$(this).prop("checked");TS.model.prefs.full_text_extracts=e,TS.prefs.setPrefByAPI({name:"full_text_extracts",value:e})}),$("#msg_preview_cb").prop("checked",!0===TS.model.prefs.msg_preview),$("#msg_preview_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"msg_preview",value:e}),$("#msg_preview_persistent_cb").prop("disabled",!e),TS.prefs.onPrefChanged({name:"msg_preview",value:e})}),$("#msg_preview_persistent_cb").prop("checked",!0===TS.model.prefs.msg_preview_persistent),$("#msg_preview_persistent_cb").prop("disabled",!TS.model.prefs.msg_preview),$("#msg_preview_persistent_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"msg_preview_persistent",value:e}),TS.prefs.onPrefChanged({name:"msg_preview_persistent",value:e})}),$("#measure_css_usage_cb").prop("checked",!0===TS.model.prefs.measure_css_usage),$("#measure_css_usage_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"measure_css_usage",value:e}),TS.prefs.onPrefChanged({name:"measure_css_usage",value:e})}),TS.model.is_electron&&($("#show_memory_instrument_cb").prop("checked",!0===TS.model.prefs.show_memory_instrument),$("#show_memory_instrument_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"show_memory_instrument",value:e}),TS.prefs.onPrefChanged({name:"show_memory_instrument",value:e})})),TS.boot_data.feature_react_sidebar){var e=!0===TS.model.prefs.use_react_sidebar,t=$("#use_react_sidebar_cb");t.prop("checked",e),t.on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"use_react_sidebar",value:e},function(){TS.reload("Switching this sidebar pref requires a reload","Switched use_react_sidebar pref")})});var n=!TS.boot_data.feature_sli_channel_priority||!e;$("[data-js-show-when-use-react-sidebar]").toggleClass("hidden",n);var i=$("#channel_sort_select"),a={default:"Alphabetical (default)",priority:"Scientifically (priority sort)"};_.each(a,function(e,t){i.append('<option value="'+t+'">'+e+"</option>")});var s=_.get(a,TS.model.prefs.channel_sort)?TS.model.prefs.channel_sort:"default";i.val(s),i.on("change",function(){var e=$(this).val();TS.prefs.setPrefByAPI({name:"channel_sort",value:e}),TS.prefs.onPrefChanged({name:"channel_sort",value:e})})}},j=function(){$("#mac_ssb_bounce_cb").prop("checked",!!TS.model.prefs.mac_ssb_bounce),$("#mac_ssb_bounce_short_cb").prop("checked","long"!==TS.model.prefs.mac_ssb_bounce),$("#mac_ssb_bounce_cb").on("change",function(){var e=!!$(this).prop("checked"),t=!!$("#mac_ssb_bounce_short_cb").prop("checked");TS.model.prefs.mac_ssb_bounce="",e&&(TS.model.prefs.mac_ssb_bounce=t?"short":"long"),TS.prefs.setPrefByAPI({name:"mac_ssb_bounce",value:TS.model.prefs.mac_ssb_bounce}),ue()}),$("#mac_ssb_bounce_short_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"mac_ssb_bounce",value:e?"short":"long"})}),$("#mac_ssb_bullet_cb").prop("checked",!0===TS.model.prefs.mac_ssb_bullet),$("#mac_ssb_bullet_cb").on("change",function(){var e=!!$(this).prop("checked");TS.prefs.setPrefByAPI({name:"mac_ssb_bullet",value:e})})},z=function(){if(window.TSSSB&&TSSSB.call("hasPreference","windowFlashBehavior")?TS.boot_data.feature_notif_prefs_overhaul?(K(),$("#winssb_flash_window_cb").on("change",function(){var e=$(this).is(":checked"),t=e?"always":"never";TSSSB.call("setPreference",{name:"windowFlashBehavior",value:t}),K()}),$("#winssb_flash_window_only_inactive_cb").on("change",function(){var e=$(this).is(":checked"),t=e?"idle":"always";TSSSB.call("setPreference",{name:"windowFlashBehavior",value:t}),K()})):($('input:radio[name="winssb_flash_window_rd"]').filter('[value="'+TSSSB.call("getPreference","windowFlashBehavior")+'"]').prop("checked",!0),$('input:radio[name="winssb_flash_window_rd"]').on("change",function(){var e=$(this).val();TSSSB.call("setPreference",{name:"windowFlashBehavior",value:e}),$('input:radio[name="winssb_flash_window_rd"]').filter('[value="'+e+'"]').prop("checked",!0)})):($("#winssb_flash_window_heading").addClass("hidden"),$("#winssb_flash_window_choices").addClass("hidden")),window.TSSSB&&!TS.environment.isSSBAndAtLeastVersion("2.7.0")&&TSSSB.call("hasPreference","notifyPosition")){var e=TSSSB.call("getPreference","notifyPosition");$("#winssb_notify_corner").val(e.corner),$("#winssb_notify_corner").on("change",function(){var e=$(this).val(),t=$("#winssb_notify_display").val();TSSSB.call("setPreference",{name:"notifyPosition",value:{corner:e,display:t}})}),$("#winssb_notify_display").val(e.display),$("#winssb_notify_display").on("change",function(){var e=$("#winssb_notify_corner").val(),t=$(this).val();TSSSB.call("setPreference",{name:"notifyPosition",value:{corner:e,display:t}})})}else $("#winssb_notify_prefs_heading").addClass("hidden"),$("#winssb_notify_position").addClass("hidden")},K=function(){var e=TSSSB.call("getPreference","windowFlashBehavior");"never"===e?($("#winssb_flash_window_cb").prop("checked",!1),$("#winssb_flash_window_only_inactive_cb").prop("checked",!1).prop("disabled",!0)):"idle"===e?($("#winssb_flash_window_cb").prop("checked",!0),$("#winssb_flash_window_only_inactive_cb").prop("checked",!0).prop("disabled",!1)):($("#winssb_flash_window_cb").prop("checked",!0),$("#winssb_flash_window_only_inactive_cb").prop("checked",!1).prop("disabled",!1))},W=function(){$("#winssb_launch_on_start_cb").prop("checked",TSSSB.call("getPreference","launchOnStartup")),$("#winssb_launch_on_start_cb").on("change",function(){var e=!!$(this).prop("checked");TSSSB.call("setPreference",{name:"launchOnStartup",value:e})}),$("#winssb_run_from_tray_cb").prop("checked",TSSSB.call("getPreference","runFromTray")),$("#winssb_run_from_tray_cb").on("change",function(){var e=!!$(this).prop("checked");TSSSB.call("setPreference",{name:"runFromTray",value:e}),V()}),window.TSSSB&&TSSSB.call("hasPreference","useHwAcceleration")?($("#winssb_disable_hw_acceleration_cb").prop("checked",!TSSSB.call("getPreference","useHwAcceleration")),$("#winssb_disable_hw_acceleration_cb").on("change",function(){var e=!$(this).prop("checked");TSSSB.call("setPreference",{name:"useHwAcceleration",value:e})})):($("#winssb_disable_hw_acceleration_pref").addClass("hidden"),$("#winssb_disable_hw_acceleration_note").addClass("hidden"))},V=function(){var e=!0;if(window.TSSSB&&TSSSB.call("hasPreference","windowFlashBehavior")){var t=TSSSB.call("getPreference","windowFlashBehavior");"never"!==t&&"idle"!==t&&TSSSB.call("getPreference","runFromTray")&&(e=!1)}$("#winssb_flash_warning").toggleClass("hidden",e)},Y=function(){r.find(".section_rollup").on("click",function(e){var t=$(e.target),n=$(this),i=n.attr("id"),a=n.hasClass("is_active");t.closest(".section_rollup_header").length?(n.toggleClass("is_active"),a&&(X(),ee()),TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller(o)):n.hasClass("is_active")||(n.toggleClass("is_active"),TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller(o)),n.hasClass("is_active")?(S.push(i),S=_.uniq(S)):_.remove(S,function(e){return e===i})})},q=function(e){var t=$("#"+e);t.length&&t.addClass("is_active")},J=function(){if(s){var t=Z();TS.boot_data.feature_notif_prefs_overhaul&&"never"!==t&&(TS.ui.growls.checkPermission()||(t="never")),$("#growls_test").css("visibility","");var n=$('input:radio[name="notifications_rd"]').filter('[value="'+t+'"]').prop("checked",!0);TS.boot_data.feature_notif_prefs_overhaul&&($(".global_notification_block.selected").removeClass("selected"),n.closest(".global_notification_block").addClass("selected"));var i=TS.templates.builders.buildNonDefaultNotificationBlock("margin-left");if(i?($(".non_default").removeClass("hidden"),$("#non_default_html").html(i),$("#no_non_default").addClass("hidden")):($(".non_default").addClass("hidden"),$("#no_non_default").removeClass("hidden")),$("#non_default_tip_link").tooltip("destroy").attr("title",TS.templates.builders.buildNonDefaultNotificationBlock("align_left")).tooltip({html:!0}),TS.boot_data.feature_notif_prefs_overhaul||("never"===t?($("#no_text_in_notifications_cb").prop("disabled",!0).prop("checked",!1).closest("label").addClass("disabled"),$("#threads_everything_cb").prop("disabled",!0).prop("checked",!1).closest("label").addClass("disabled")):($("#no_text_in_notifications_cb").prop("disabled",!1).prop("checked",!0!==TS.model.prefs.no_text_in_notifications).closest("label").removeClass("disabled"),$("#threads_everything_cb").prop("disabled",!1).prop("checked",!!TS.model.prefs.threads_everything).closest("label").removeClass("disabled"))),$('input:radio[name="sound_option_rd"]').each(function(){$(this).val()==TS.model.prefs.new_msg_snd&&$(this).attr("checked",!0)}),TS.model.prefs.mute_sounds?(r.find('input:radio[name="sound_option_rd"]').attr("disabled","disabled"),r.find("label.sound_option").addClass("disabled")):(r.find('input:radio[name="sound_option_rd"]').removeAttr("disabled"),r.find("label.sound_option").removeClass("disabled")),TS.boot_data.feature_notif_prefs_overhaul){var a="never"===t,o="nothing"===fe(),l=a&&o;$("#new_msg_snd_settings").toggleClass("disabled",!!TS.model.prefs.mute_sounds),$("#new_msg_snd_none_cb").prop("checked","none"!==TS.model.prefs.new_msg_snd),$("#select_new_msg_snd").toggleClass("hidden","none"===TS.model.prefs.new_msg_snd||a),$("#email_alerts_cb").prop("checked","none"!==TS.model.prefs.email_alerts),$("#select_email_alerts, #email_alerts_info").toggleClass("hidden","none"===TS.model.prefs.email_alerts),"instant"===TS.model.prefs.email_alerts?$("#email_alerts_current").html(TS.i18n.t("once every 15 minutes","prefs")()):"hourly"===TS.model.prefs.email_alerts&&$("#email_alerts_current").html(TS.i18n.t("once an hour","prefs")()),$("#mobile_different_settings_cb").prop("checked",e),$("#mobile_specific_settings").toggleClass("hidden",!e),$("#mobile_specific_settings").find('option[value="'+fe()+'"]').prop("selected",!0),$("#push_idle_wait_select").find('option[value="'+TS.model.prefs.push_idle_wait+'"]').prop("selected",!0),$("#no_text_in_notifications_cb").prop("checked",!0!==TS.model.prefs.no_text_in_notifications),$("#threads_everything_cb").prop("checked",!!TS.model.prefs.threads_everything&&!l),$("#no_notifications_warning").toggleClass("hidden","never"!==t);var d=["#threads_everything_cb","#no_text_in_notifications_cb","#dnd_enabled","#dnd_start_hour","#dnd_end_hour","#push_idle_wait_select"].join(", ");$(d).prop("disabled",l).closest("label").toggleClass("disabled",l);var c=["#new_msg_snd_none_cb","#mac_ssb_bounce_cb","#mac_ssb_bounce_short_cb","#winssb_flash_window_cb","#winssb_flash_window_only_inactive_cb","#winssb_notify_corner","#winssb_notify_display"].join(", ");$(c).prop("disabled",a).closest("label").toggleClass("disabled",a);var u=ye();_.size(u)>0?$("#channel_overrides_callout").removeClass("hidden").html(TS.templates.prefs_channel_overrides_callout({count:_.size(u)})):$("#channel_overrides_callout").addClass("hidden"),be()}X(),ee()}},Z=function(){var e="all";return TS.model.prefs.growls_enabled?TS.model.prefs.all_channels_loud||(e="mentions"):e="never",e},X=function(){if(!TS.boot_data.feature_notif_prefs_overhaul){var e={send_notifications_for:Z(),mute_sounds:TS.model.prefs.mute_sounds,new_msg_snd:TS.sounds.getNotificationSoundNameFromFilename(TS.model.prefs.new_msg_snd)||"none",no_text_in_notifications:TS.model.prefs.no_text_in_notifications,show_mac_ssb_prefs:h,show_win_ssb_prefs:p};h&&(e.show_mac_ssb_bullet=TS.model.prefs.mac_ssb_bullet,e.mac_ssb_bounce=!!TS.model.prefs.mac_ssb_bounce,e.mac_ssb_bounce_short=!!TS.model.prefs.mac_ssb_bounce&&"long"!==TS.model.prefs.mac_ssb_bounce),p&&(e.window_flash_behavior=TSSSB.call("getPreference","windowFlashBehavior"),window.TSSSB&&!TS.environment.isSSBAndAtLeastVersion("2.7.0")&&TSSSB.call("hasPreference","notifyPosition")&&(e.show_notify_position=!0,e.winssb_notify_corner=TSSSB.call("getPreference","notifyPosition").corner,e.winssb_notify_display=TSSSB.call("getPreference","notifyPosition").display));var t=TS.templates.prefs_notifications_summary(e);r.find("#prefs_notifications").find(".section_rollup_summary").html(t)}},ee=function(){if(!TS.boot_data.feature_notif_prefs_overhaul){var e=I(),t=e.dnd_start_hour,n=e.dnd_end_hour;TS.model.prefs.time24||(t=te(t),n=te(n));var i=TS.templates.prefs_dnd_summary({dnd_enabled:e.dnd_enabled,dnd_start_hour:t,dnd_end_hour:n,timezone:TS.model.user.tz_label});r.find("#prefs_dnd").find(".section_rollup_summary").html(i)}},te=function(e){var t=/(\d?\d):(\d\d)/.exec(e);if(!t)return e;var n=parseInt(t[1],10),i=t[2],a="AM";return n>12?(a="PM",n-=12):0==n?n=12:12==n&&(a="PM"),n+":"+i+" "+a},ne=function(){$("#growls_permission_div").addClass("hidden"),$("#growls_instructions_div").removeClass("hidden"),TS.ui.growls.promptForPermission(function(e,t){TS.info("callback called allowed:"+e+" permission_level:"+t),$("#growls_instructions_div").addClass("hidden"),"granted"===t&&e?($("#growls_allowed_div").removeClass("hidden").find(".desktop_notifications_title").addClass("kelly_green").text(TS.i18n.t("Desktop Notifications enabled!","prefs")()),$("#growls_test").removeClass("hidden"),TS.model.prefs.growls_enabled||(TS.prefs.setPrefByAPI({name:"growls_enabled",value:!0}),TS.model.prefs.growls_enabled=!0),J()):"default"===t?$("#growls_permission_div").removeClass("hidden"):"denied"===t?$("#growls_disallowed_div").removeClass("hidden"):alert("huh allowed:"+e+" permission_level:"+t)})},ie=function(){if(s){$("#display_real_names_override_cb").prop("checked",TS.members.shouldDisplayRealNames()),TS.model.team.prefs.display_real_names?($("#display_real_names_default").removeClass("hidden"),$("#display_usernames_default").addClass("hidden")):($("#display_real_names_default").addClass("hidden"),$("#display_usernames_default").removeClass("hidden"))}},ae=null,se=function(){ae&&ae.cancel();var e=$("#highlight_words_input"),t=e.parents("label"),n=TS.ui.validation.validate(e);if(t.toggleClass("validation_error",!n),e.toggleClass("validation_error",!n),n){var i=$("#highlight_words_input").val();ae=TS.prefs.saveHighlightWords(i),ae.finally(function(){ae=null})}},re=function(){var e,t=[],n=[],i=TS.channels.getChannelsForUser();return i.sort(function(e,t){var n=e._name_lc,i=t._name_lc;return n<i?-1:n>i?1:0}),_.forOwn(i,function(i){e=!1,-1!=$.inArray(i.id,TS.model.search_exclude_channels)&&(e=!0),i.is_archived?n.push({search_channel_exclusion:e,channel:i}):t.push({search_channel_exclusion:e,channel:i})}),{active_channels:t,archived_channels:n}},oe=function(){if(s){var e=TS.prefs.getReadStateTrackingPref();$('input:radio[name="read_rd"]').filter('[value="'+e+'"]').prop("checked",!0)}},le=function(){$("#fs_modal, #fs_modal_bg").addClass("show_sidebar"),$("#fs_modal_bg").append('<div id="sidebar_overlay"></div>')},de=function(){$("#fs_modal, #fs_modal_bg").removeClass("show_sidebar"),$("#sidebar_overlay").remove(),setTimeout(function(){TS.view.resizeManually()},TS.ui.fs_modal.transition_duration)},ce=function(e){if(s&&(e=!1!==e,!TS.prefs.last_theme_selected_in_UI||TS.model.prefs.sidebar_theme===TS.prefs.last_theme_selected_in_UI)){TS.prefs.last_theme_selected_in_UI&&e&&(TS.prefs.last_theme_selected_in_UI=null),"default"===TS.model.prefs.sidebar_theme&&(TS.model.prefs.sidebar_theme="default_theme");var t=TS.model.prefs.sidebar_theme;if($('input:radio[name="sidebar_theme_rd"]').filter('[value="'+t+'"]').prop("checked",!0),TS.model.prefs.sidebar_theme_custom_values&&"undefined"!==TS.model.prefs.sidebar_theme_custom_values){var n=JSON.parse(TS.model.prefs.sidebar_theme_custom_values),i=$.map(n,function(e){return e});r&&(r.find('input[name="color_column_bg_hex"]').val(n.column_bg),r.find('input[name="color_menu_bg_hex"]').val(n.menu_bg),r.find('input[name="color_active_item_hex"]').val(n.active_item),r.find('input[name="color_active_item_text_hex"]').val(n.active_item_text),r.find('input[name="color_hover_item_hex"]').val(n.hover_item),r.find('input[name="color_text_color_hex"]').val(n.text_color),r.find('input[name="color_active_presence_hex"]').val(n.active_presence),r.find('input[name="color_badge_hex"]').val(n.badge),r.find('.color_swatch[data-theme-element="column_bg"]').css("background-color",n.column_bg).data("hex",n.column_bg),r.find('.color_swatch[data-theme-element="menu_bg"]').css("background-color",n.menu_bg).data("hex",n.menu_bg),r.find('.color_swatch[data-theme-element="active_item"]').css("background-color",n.active_item).data("hex",n.active_item),r.find('.color_swatch[data-theme-element="active_item_text"]').css("background-color",n.active_item_text).data("hex",n.active_item_text),r.find('.color_swatch[data-theme-element="hover_item"]').css("background-color",n.hover_item).data("hex",n.hover_item),r.find('.color_swatch[data-theme-element="text_color"]').css("background-color",n.text_color).data("hex",n.text_color),r.find('.color_swatch[data-theme-element="active_presence"]').css("background-color",n.active_presence).data("hex",n.active_presence),r.find('.color_swatch[data-theme-element="badge"]').css("background-color",n.badge).data("hex",n.badge),$("#sidebar_theme_custom").val(i.join(",")))}}},_e=function(e,t){TS.prefs.last_theme_selected_in_UI=e,TS.prefs.setMultiPrefsByAPI({sidebar_theme:e,sidebar_theme_custom_values:JSON.stringify(t)}),TS.model.prefs.sidebar_theme=e,TS.prefs.setSidebarThemeCustomValues(t),ce(!1),TS.view.prefs.sidebarThemePrefChanged(!1),TS.prefs.messages_theme_changed_sig.dispatch()},ue=function(){TS.model.prefs.mac_ssb_bounce?$("#mac_ssb_bounce_short_cb").prop("disabled",!1):$("#mac_ssb_bounce_short_cb").prop("disabled",!0)},me=function(e){e.is_self&&s&&$(".dnd_tz_label").text(TS.model.user.tz_label)},he=function(){s&&TS.model.prefs.tz&&$("#prefs_dnd").removeClass("tz_not_set")},pe=function(e){if(i)return void(i=!1);if(e!==TS.model.prefs.locale){var t=TS.i18n.localesEnabled()[e];window.desktop&&desktop.teams&&desktop.teams.setTeamLocale&&desktop.teams.setTeamLocale(e),TS.generic_dialog.start({title:TS.i18n.t("Change language to {lang}?","prefs")({lang:t}),body:"<p>"+TS.i18n.t("Changing your language will take just a moment. Would you like to do that now? Otherwise, the change will happen next time you reload.","prefs")()+"</p>",show_cancel_button:!0,show_go_button:!0,cancel_button_text:TS.i18n.t("Not now","prefs")(),go_button_text:TS.i18n.t("Change to {lang}","prefs")({lang:t}),onGo:function(){window.createCookie("i18n_locale",t,365,"slack.com"),TS.reload(null,"prefs dialog change: locale -> "+t)}})}},ge=function(e){var t=TS.boot_data.notification_sounds,n=_.find(t,{value:e});return n?n.label:""},fe=function(){var e=TS.notifs.getGlobalPushNotificationSetting();return"mentions"!==e&&"dm_and_mentions"!==e&&"dms"!==e||(e="mentions"),e},Se=function(){return TS.notifs.getGlobalNotificationSetting()!==fe()},Te=function(e){var t=ve(e);if(t){var n=TS.prefs.setMultiPrefsByAPI(t);TS.ui.inline_saver.show({target:"#prefs_send_notifications_for",promise:n})}},ve=function(e){var t={};switch(e){case"nothing":t.push_dm_alert=0,t.push_mention_alert=0,t.push_everything=0;break;case"mentions":t.push_dm_alert=1,t.push_mention_alert=1,t.push_everything=0;break;case"everything":t.push_dm_alert=1,t.push_mention_alert=1,t.push_everything=1;break;default:t=null}return t},be=function(){var e=$("#channel_specific_overrides");e.longListView({items:[],approx_item_height:61,makeElement:function(){return $('<div class="channel_overrides_row" data-action="open_channel_overrides"></div>')},renderItem:function(e,t){e.attr("data-cid",t.id),e.html(TS.templates.prefs_channel_overrides({override:t}))},calcItemHeight:function(e){return e.outerHeight()},preserve_dom_order:!0,scrollable:e.closest(".contents_container")}),we()},we=function(){var e=ye();e=_.values(e);var t=_.reject(e,"channel.is_mpim"),n=_.filter(e,"channel.is_mpim");t=_.sortBy(t,"channel.name"),n=_.sortBy(n,"channel.name");var i=t.concat(n);$("#channel_specific_overrides").longListView("setItems",i,!0)},ye=function(){var e=TS.notifs.getCorGsNotUsingGlobalNotificationSetting(),t=TS.notifs.getCorGsNotUsingGlobalPushNotificationSetting(),n={},i=function(e,t,i){e.forEach(function(e){var a=n[e.id];a||(a=ke(e),n[e.id]=a),a[t]=i})};return i(e.everything,"desktop","everything"),i(e.mentions,"desktop","mentions"),i(e.nothing,"desktop","nothing"),i(e.muted,"is_muted",!0),i(e.suppressed,"is_suppressed",!0),i(t.everything,"mobile","everything"),i(t.mentions,"mobile","mentions"),i(t.nothing,"mobile","nothing"),n},ke=function(e){return{channel:e,id:e.id}},Ae=function(e){var t=TS.notifs.getGlobalNotificationSetting();"everything"===t?TS.notifs.makeCorGDTopEverything(e):"mentions"===t?TS.notifs.makeCorGDTopMentions(e):TS.notifs.makeCorGDTopNothing(e);var n=fe();"everything"===n?TS.notifs.makeCorGPushEverything(e):"mentions"===n?TS.notifs.makeCorGPushMentions(e):TS.notifs.makeCorGPushNothing(e),TS.notifs.makeCorGNOTPushSuppressed(e),TS.notifs.makeCorGNOTSuppressed(e),TS.notifs.makeCorGNOTMuted(e),TS.prefs.setMultiPrefsByAPI({loud_channels:TS.model.loud_channels.join(","),never_channels:TS.model.never_channels.join(","),loud_channels_set:TS.model.loud_channels_set.join(","),push_loud_channels:TS.model.push_loud_channels.join(","),push_mention_channels:TS.model.push_mention_channels.join(","),push_loud_channels_set:TS.model.push_loud_channels_set.join(","),at_channel_suppressed_channels:TS.model.at_channel_suppressed_channels.join(","),push_at_channel_suppressed_channels:TS.model.push_at_channel_suppressed_channels.join(","),muted_channels:TS.model.muted_channels.join(",")}).catch(function(){TS.error("Failed to reset to channel defaults: "+e)})},Ce=function(){var e=$("#global_prefs_container"),n=$("#channel_prefs_container");t||(t=e.closest(".contents_container").scrollTop()),l.addClass("hidden"),e.addClass("hidden"),n.removeClass("hidden"),$("#channel_specific_overrides").longListView("setHidden",!0),TS.ui.fs_modal.bindBackButton(Ie),TS.ui.fs_modal.showBackButton()},Me=function(){var e=$("#channel_prefs_container");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Add a Channel-Specific Notification Setting","prefs")()),e.html(TS.templates.prefs_channel_picker());var t=function(e){return TS.searcher.search(e,{channels:{include_archived:!1,only_if_member:!0},groups:{include_archived:!1},mpims:!0,sort:{allow_empty_query:!0}}).then(function(e){return e.all_items_fetched=!0,_.forEach(e,function(e){e.lfs_id=e.model_ob.id}),e})};$("#channel_override_picker").lazyFilterSelect({single:!0,placeholder_text:TS.i18n.t("Select or search","prefs")(),approx_item_height:30,tab_to_nav:!0,no_default_selection:!0,template:function(e){return new Handlebars.SafeString(TS.templates.file_sharing_channel_row({item:e.model_ob}))},data_promise:t}).one("remove",function(){$(this).lazyFilterSelect("destroy")})},xe=function(e){var t=$("#channel_prefs_container"),n=TS.shared.getModelObById(e);if(n){var i=TS.shared.getDisplayNameForModelOb(n);i.length>30&&(i=i.substring(0,30)+"..."),TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Notification Preferences: {channel_name}","prefs")({channel_name:i}));TS.ui.channel_prefs_dialog.renderOptions(t,e,!0),t.find('[data-action="done"]').on("click",Ie),t.find('[data-action="reset_channel_to_defaults"]').on("click",function(){Ae(e)})}},Ie=function(){var e=$("#global_prefs_container"),n=$("#channel_prefs_container");TS.ui.fs_modal.unbindBackButton(),TS.ui.fs_modal.hideBackButton(),TS.ui.fs_modal.setHeaderTitle(b()),l.removeClass("hidden"),e.removeClass("hidden"),n.addClass("hidden").empty(),$("#channel_specific_overrides").longListView("setHidden",!1),e.closest(".contents_container").scrollTop(t),t=0},$e=function(){var e=$("#channel_prefs_container");if(!e.length||e.hasClass("hidden"))return!0;var t=$("#channel_override_picker");if(t.length){var n=t.lazyFilterSelect("value")[0],i=_.get(n,"model_ob.id");return!!i&&(xe(i),!1)}return Ie(),!1}}()},2636:function(e,t){!function(){"use strict";TS.registerModule("ui.purpose_dialog",{div:null,showing:!1,model_ob:null,onStart:function(){},onKeydown:function(e){if(e.which==TS.utility.keymap.enter){if(e.shiftKey)return;TS.ui.purpose_dialog.go(),e.preventDefault()}else e.which==TS.utility.keymap.esc&&TS.ui.purpose_dialog.cancel()},start:function(e,t){if(!TS.client.ui.checkForEditing()){TS.ui.purpose_dialog.model_ob=t,TS.ui.purpose_dialog.is_group=TS.ui.purpose_dialog.model_ob.is_group,TS.ui.purpose_dialog.div||TS.ui.purpose_dialog.build();var n=TS.ui.purpose_dialog.div,i=TS.templates.purpose_dialog({model_ob:TS.ui.purpose_dialog.model_ob,is_group:TS.ui.purpose_dialog.is_group});if(n.empty(),n.html(i),TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()){var a=n.find("#purpose_input");TS.utility.contenteditable.create(a,{modules:{tabcomplete:{positionMenu:function(e){e.style.width=a.outerWidth()+"px",TS.tabcomplete.positionUIRelativeToInput(e,a)},searchOptions:{complete_member_specials:!1},completers:[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members]}},onEnter:function(e){return!!e.shiftKey||(TS.ui.purpose_dialog.go(),!1)},onEscape:function(){TS.ui.purpose_dialog.cancel()},onTextChange:function(){TS.client.channel_page.updatePurposeTooLongWarning(a)}}),TS.utility.contenteditable.enable(a),TS.utility.contenteditable.value(a,TS.utility.unformatTopicOrPurpose(TS.ui.purpose_dialog.model_ob.purpose.value))}n.find(".dialog_cancel").click(TS.ui.purpose_dialog.cancel),n.find(".dialog_go").click(TS.ui.purpose_dialog.go),n.modal("show")}},go:function(){if(!TS.ui.purpose_dialog.showing)return void TS.error("not showing?");var e=TS.ui.purpose_dialog.div,t=e.find("#purpose_input");if(!TS.client.channel_page.isPurposeTooLong(t)){var n=_.trim(TS.utility.contenteditable.value(t));TS.ui.purpose_dialog.is_group?TS.groups.setPurpose(TS.ui.purpose_dialog.model_ob.id,n):TS.channels.setPurpose(TS.ui.purpose_dialog.model_ob.id,n),e.modal("hide")}},cancel:function(){TS.ui.purpose_dialog.div.modal("hide")},end:function(){TS.model.dialog_is_showing=!1,TS.ui.purpose_dialog.showing=!1,TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()||$(window.document).unbind("keydown",TS.ui.purpose_dialog.onKeydown)},build:function(){$("body").append('<div id="purpose_dialog" class="modal hide fade"></div>'),TS.ui.purpose_dialog.div=$("#purpose_dialog");var e=TS.ui.purpose_dialog.div;e.on("hide",function(t){t.target==this&&(TS.ui.purpose_dialog.end(),e.removeAttr("data-qa"))}),e.on("show",function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.purpose_dialog.showing=!0)}),e.on("shown",function(t){t.target==this&&setTimeout(function(){TS.utility.contenteditable.focus(e.find("#purpose_input")),TS.boot_data.feature_texty_mentions&&TS.utility.contenteditable.supportsTexty()||$(window.document).bind("keydown",TS.ui.purpose_dialog.onKeydown),e.attr("data-qa","purpose_dialog_ready")},100)})}})}()},2638:function(e,t){!function(){"use strict";TS.registerModule("ui.replies",{$scroller:$("#convo_scroller"),onStart:function(){if(!TS.client)return void TS.warn("TS.ui.replies only works in the client");TS.prefs.team_perms_pref_changed_sig.add(D),TS.client.flexpane_display_switched_sig.add(A),TS.ui.window_focus_changed_sig.add(V),TS.replies.sanity_check_failed_sig.add(Q),TS.replies.reply_changed_sig.add(K),TS.replies.reply_deleted_sig.add(W),TS.channels.joined_sig.add(H),TS.channels.left_sig.add(N),TS.groups.left_sig.add(G),TS.channels.archived_sig.add(j),TS.groups.archived_sig.add(j),TS.channels.unarchived_sig.add(j),TS.groups.unarchived_sig.add(j),TS.channels.history_fetched_sig.add(z),TS.groups.history_fetched_sig.add(z),TS.ims.history_fetched_sig.add(z),TS.mpims.history_fetched_sig.add(z),TS.view.members.unknown_resolution_rebuild_sig.add(Y),TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.add(h):TS.ms.connected_sig.add(h),TS.channels.read_only.list_updated_sig.add(TS.ui.replies.refreshConversation),U=TS.utility.throttleFunc(U,250,!0),p()},refreshConversation:function(){var e=TS.ui.replies.activeConvoModelId(),t=TS.ui.replies.activeConvoThreadTs();if(e&&t){var n=TS.shared.getModelObById(e),i=TS.replies.getMessage(n,t);i&&(s=TS.permissions.members.canPostInModelOb(TS.model.user,n)&&!n.is_archived,TS.boot_data.feature_default_shared_channels&&!s&&(s=TS.channels.read_only.threads.canThread(n.id)),x(n,i))}},openConversationFromMessagePane:function(e,t,n,i,a){TS.client.ui.areMsgsScrolledToBottom()?(TS.ui.replies.openConversation(t,n,i,a),TS.client.ui.instaScrollMsgsToBottom()):TS.ui.utility.preventElementFromScrolling(e,function(){TS.ui.replies.openConversation(t,n)})},openConversation:function(e,t,n,i){try{if(!t)return TS.error("openConversation called with bogus data; this is a programming error."),void C();if(!TS.client){var s=TS.utility.msgs.constructConversationPermalink(e,t);return void(window.location=s)}_.isNumber(t)&&(TS.warn("Thread flexpane opened with non-string thread_ts"),t+=""),TS.info("Opening conversation "+t+" in "+e.id);var r=!!a;y(),k=!0,TS.client.ui.flex.openConversationFlex(e,t),TS.ui.replies.maybeRenderReplies(e,t,n,i),TS.utility.msgs.startUpdatingRelativeTimestamps("#convo_container"),r?(F(),l=!0):($("#reply_container .message_input").addClass("hidden"),l=!1,TS.view.resize_sig.addOnce(function(){$("#reply_container .message_input").removeClass("hidden"),F(),l=!0,c.dispatch()}))}catch(n){TS.error("Something went wrong when trying to open conversation "+t+" in "+_.get(e,"id")+": "+n),C()}finally{k=!1}},maybeRenderReplies:function(t,n,l,c){var u=TS.replies.getMessage(t,n),m=$("ts-conversation");if(m.length)return m.find("ts-message.selected").attr("data-ts")!=n?(TS.warn("maybeRenderReplies called when same convo is already open"),Promise.resolve()):Promise.reject(new Error("There is already a conversation open; only one can be open at a time"));m=$(TS.templates.message_conversation({model_ob_id:t.id,thread_ts:n})),i=t.id,a=n,s=TS.permissions.members.canPostInModelOb(TS.model.user,t)&&!t.is_archived,TS.boot_data.feature_default_shared_channels&&!s&&(s=TS.channels.read_only.threads.canThread(t.id)),r=[],o=c&&_.includes(d,c)?c:null,w(t,n,m),R(!0),Z(u,t,n,m),TS.ui.message_container.register(e),M(m),u&&x(t,u);var h=!!o;TS.ui.replies.toggleBackButton(h);var p;if(l)p=TS.replies.getThreadAround(t.id,n,l);else{p=TS.replies.getThreadLazy(t.id,n,!1)}return p.then(function(e){return TS.ui.replies.finishRenderingReplies(t,n,u,e,l),!TS.client||TS.newxp.inOnboarding()||TS.model.prefs.seen_replies_coachmark&&!TS.qs_args.show_replies_coachmark||setTimeout(function(){a&&(TS.coachmark.start(TS.coachmarks.coachmarks.replies),TS.model.prefs.seen_replies_coachmark=!0,TS.prefs.setPrefByAPI({name:"seen_replies_coachmark",value:!0}))},500),null}).catch(function(e){TS.error("Unable to get conversation around message thread_ts="+n+" with error: "+e),i===t.id&&a===n&&C()}).finally(function(){i===t.id&&a===n&&(0===m.closest(".monkey_scroller").width()&&TS.ui.utility.updateClosestMonkeyScroller(TS.ui.replies.$scroller,!0),R(!1))})},finishRenderingReplies:function(t,n,s,o,l){var d=o.messages,c=!!o.has_more_beginning||!!o.has_more_end;if(i==t.id&&a==n){if(TS.info("Rendering thread "+n+", "+d.length+" messages (has_more: "+c+")"),r=d,S())return void TS.client.ui.flex.hideFlex();if(s||(s=TS.utility.msgs.getMsg(n,d),s=o.root_msg,x(t,s)),q(d,o.has_more_beginning,o.has_more_end),l?TS.ui.message_container.jumpToTS(e,l,m):o.has_more_beginning&&TS.ui.message_container.jumpToEnd(e),s=b(s,d),E(s),TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",t.id,n),l){var _=TS.templates.makeMsgDomIdInConversation(l);TS.ui.message_container.scrollintoview(e,_,{offset:"bottom",px_offset:-50,complete:function(){P()}}),$("#"+_).highlight(2500,"msg_highlighter")}else P();return TS.replies.promiseToGetSubscriptionState(t.id,n).then(function(e){if(i==t.id&&a==n&&e)return TS.ui.replies.checkUnreads(),null}),null}},maybeRemoveMessageFromConversation:function(e,t){if(e.id===i&&(t.thread_ts==a||t.ts==a)){var s=r&&_.find(r,{ts:t.ts});if(s&&(s.subtype="tombstone"),S())return void TS.client.ui.flex.hideFlex();if(g().length&&t.ts==a)return void TS.ui.replies.maybeUpdateConversationWithMessage(e,t);var o=$('ts-conversation[data-thread-ts="'+t.thread_ts+'"]');if(o.length){var l=o.find('ts-relatives ts-message[data-ts="'+t.ts+'"]');_.remove(r,{ts:t.ts}),TS.utility.msgs.isMsgReply(t)&&_.remove(n.msgs,{ts:t.ts}),t.is_pending?J():l.length?l.addClass("delete_mode").slideUp(200,function(){J()}):J(),E(_.find(r,{ts:t.thread_ts||t.ts}))}}},maybeUpdateConversationWithMessage:function(s,o){if(s.id===i&&(o.thread_ts==a||o.ts==a)){var l=r&&_.findIndex(r,{ts:o.ts});-1!==l?r[l]=o:r.push(o);var d=!1;if(TS.utility.msgs.isMsgReply(o)){var c=_.findIndex(n.msgs,{ts:o.ts});if(-1!==c)n.msgs[c]=o;else{d=!0;var u=_.findIndex(n.msgs,function(e){return e.ts<o.ts});-1===u?n.msgs.push(o):n.msgs.splice(u,0,o)}}else t.msgs.length?t.msgs[0]=o:t.msgs.push(o);if(S())return void TS.client.ui.flex.hideFlex();var m=TS.ui.replies.$scroller[0],h=Math.abs(m.scrollHeight-m.offsetHeight-m.scrollTop),p=50,g=TS.ui.replies.$scroller.find("#reply_container");g.length&&(p=g.outerHeight(!0));var f=h<p,T=$('ts-conversation[data-thread-ts="'+(o.thread_ts||o.ts)+'"]');if(T.length){var v,b=T.find('ts-message[data-ts="'+o.ts+'"]');J([o.ts]),d&&f&&TS.ui.message_container.jumpToEnd(e),v=T.find('ts-message[data-ts="'+o.ts+'"]'),b.length&&b.hasClass("hidden")&&v.addClass("hidden"),E(_.find(r,{ts:o.thread_ts||o.ts})),b.length||TS.ui.replies.checkUnreads(),f&&(m.scrollTop=m.scrollHeight-m.offsetHeight)}}},updateMessageActions:function(e,t){if(!TS.replies.canReplyToMsg(e,t))return void(e.is_channel&&!e.is_member&&L(e,t));var n=t.thread_ts||t.ts,i=$("#reply_container");i.empty(),i.append(TS.ui.replies.getReplyInputAvatarHTML()),TS.ui.inline_msg_input.make(i,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:!!TS.boot_data.feature_name_tagging_client&&["BKhere"],complete_cmds:!0,in_thread:!0,model_ob:e,onSubmit:function(i,a){if(TS.model.ms_connected){if(e.is_archived)return void TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","threads")());var s=_.reject(r,f);if(s.length){var o=_.maxBy(s,"ts");if(!TS.client.ui.maybeHandleReactionCmd(o,a,function(){TS.ui.replies.clearReplyInput(e,n)}))if("/"===a.substr(0,1)&&"//"!==a.substr(0,2))TS.ui.replies.clearReplyInput(e,n),TS.client.ui.sendSlashCommand(e,a,t);else{TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",e.id,n);var l=$("#reply_container .reply_broadcast_toggle").prop("checked");TS.ui.replies.clearReplyInput(e,n);var d=l?"THREADS_REPLY_BROADCAST_CLICKED":"THREADS_REPLY",c=_.get(t,".reply_count",0)+1;TS.ui.thread.trackEvent(e.id,t.ts,"convo",d,{num_msg_in_thread:c}),l&&TS.log(2004,"Submitting broadcast from flexpane for "+e.id+"-"+t.ts),TS.client.ui.sendMessage(e,a,t,l)}}}},getMsgDivForEditing:function(){if(!r)return null;var e=_.reject(r,f);_.reverse(e);var t=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,e);return t?$('#convo_container ts-message[data-ts="'+t.ts+'"]'):null},onTextChange:function(t){var i=TS.ui.replies.getReplyInputValueForStorage(t);TS.storage.storeReplyInput(e.id,n,i);var a=TS.ui.replies.$scroller[0];TS.ui.replies.maybeScrollReplyInputToBottomOfScroller(a)}}),TS.ui.replies.bindReplyInputFocusEvents(i),I(e,n,i);var a=TS.storage.fetchReplyInput(e.id,n);if(a)TS.ui.replies.populateReplyInput(a);else if(!TS.boot_data.feature_tinyspeck&&!t.reply_count){var s=t.user&&TS.members.getMemberById(t.user);if(s&&!s.is_self&&!s.is_bot&&!s.is_slackbot)if(TS.model.team.prefs.require_at_for_mention){var o="@"+s.name+" ";TS.boot_data.feature_name_tagging_client&&(o=TS.format.texty.getMemberAsContentsString(s)+" "),TS.ui.replies.populateReplyInput(o)}else TS.ui.replies.populateReplyInput(s.name+": ")}},getReplyInputAvatarHTML:function(){return TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,36,!1,!0)},bindReplyInputFocusEvents:function(e){var t=e.find(".message_input");t.on("focusin",function(){e.addClass("has_focus")}).on("focusout",function(){var n=TS.utility.contenteditable.isEmpty(t,!0),i=document.activeElement===this||TS.utility.contenteditable.isActiveElement(this);n&&!i&&e.removeClass("has_focus")})},maybeScrollReplyInputToBottomOfScroller:function(e){Math.abs(e.scrollHeight-e.offsetHeight-e.scrollTop)<50&&(e.scrollTop=e.scrollHeight-e.offsetHeight)},getReplyInputValueForStorage:function(e){var t=TS.utility.contenteditable.value(e);return t.trim()?t:""},checkReplyInputLengthAndUpdate:function(e){var t=e.find(".message_input"),n=TS.msg_edit.isMessageTooLong(t);TS.features.isEnabled("message_input_byte_limit")?e.find(".reply_container_info").toggleClass("no_opacity",n>0):e.find(".reply_container_info").toggleClass("no_opacity",n)},submitReply:function(e,t){if(t&&0!==t.length){var n=t.closest("#reply_container, #file_reply_container").find("form");0!==n.length&&n.submit()}},updateFlexpaneThreadDivider:function(e,t){if(e&&e.length)if(t){e.removeClass("hidden");var n=e.find(".reply_count");n.text(TS.i18n.t("{count, plural, =1 {# reply} other {# replies}}","threads")({count:t}))}else e.addClass("hidden")},activeConvoModelId:function(){return i},activeConvoThreadTs:function(){return a},activeConvoOrigin:function(){return o},populateReplyInput:function(e){var t=$("#reply_container .message_input");TS.utility.populateInput(t,e,e.length)},clearReplyInput:function(e,t){TS.ui.replies.populateReplyInput(""),TS.utility.contenteditable.clearHistory($("#reply_container .message_input")),TS.storage.storeReplyInput(e.id,t,""),$("#reply_container .reply_broadcast_toggle").attr("checked",!1)},focusReplyInput:function(e){e&&!O()||TS.utility.contenteditable.focus($("#reply_container .message_input"))},getActiveMessage:function(e,t){return e.id!=i?null:TS.utility.msgs.getMsg(t,r)},getActiveMessages:function(){return r},toggleBackButton:function(e){$("#convo_tab_back_container").toggleClass("hidden",!e)},joinChannelFromThread:function(){if(i&&a){var e=TS.shared.getModelObById(i);if(e){var t=_.find(r,function(e){return e.ts===a});t&&(TS.channels.joinById(e.id,function(){x(e,t)},{in_background:!0}),$("#reply_container .join_channel_from_thread").addClass("disabled"))}}},checkUnreads:function(){if(TS.client.ui.isUserAttentionOnChat()&&i&&a&&r&&!(r.length<2)){var e=TS.replies.getSubscriptionState(i,a);if(e&&e.subscribed){var t=_.chain(r).filter(function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)&&!f(e)}).map("ts").max().value();if(t)return(!e.last_read||t>e.last_read)&&TS.replies.markThread(i,a,t),null}}},rebuildMsgsIncludingMember:function(t){if(i&&a&&e){TS.shared.getModelObById(i)&&TS.ui.message_container.maybeUpdateMessages(e,function(e){return TS.utility.msgs.messageIncludesMember(t,e)})}},maybeOpenConversationLink:function(e,t){if(!e||!e.length)return!1;var n=e.prop("hostname"),i=e.prop("pathname");if(!n||!i)return!1;if(0!==i.indexOf("/conversation/"))return!1;if(TS.utility.normalizeDevHost(n)!==TS.utility.normalizeDevHost(document.location.hostname))return!1;var a=i.split("/");if(a=_.drop(a,1),3!==a.length)return!1;var s=a[1];if(!s)return!1;var r=TS.shared.getModelObById(s)||TS.channels.getChannelByName(s)||TS.groups.getGroupByName(s)||TS.mpims.getMpimByName(s);if(!r)return!1;if(!(r.is_channel||r.is_group||r.is_im))return!1;if(r.is_im&&TS.ims.isImWithDeletedMember(r))return!1;var o=a[2];if(!o)return!1;if(0!==o.indexOf("p"))return!1;if(17!==o.length)return!1;if(o=o.replace("p",""),isNaN(o))return!1;var l=o.substr(0,10)+"."+o.substr(10);return TS.ui.replies.openConversation(r,l,null,t),!0},rebuildMsgCurrentStatusIncludingMember:function(t){if(i&&a){if(TS.shared.getModelObById(i)){var n={member:t,for_message:!0},s=e._state;_.each(s,function(e){_.each(e.msgs,function(e){if(TS.utility.msgs.memberSentMessage(t,e)){var i=$('ts-conversation[data-thread-ts="'+(e.thread_ts||e.ts)+'"]');if(!i.length)return;i.find('ts-message[data-ts="'+e.ts+'"] .message_current_status').replaceWith(TS.templates.current_status(n))}})})}}}});var e,t,n,i,a,s,r,o,l,d=["mentions","search_results","starred_items","channel_page","group_page","im_page"],c=new signals.Signal,u=!1,m=50,h=function(s){if(!u)return void(u=!0);if(!s&&i&&a){var o=TS.shared.getModelObById(i);if(o){var l=a,d=_.maxBy(r,"ts"),c=_.get(d,"ts");c&&TS.replies.getThreadAfter(o.id,l,c).then(function(s){i===o.id&&a===l&&s.messages.length&&t&&n&&(s.has_more&&(e.has_more_end=!0),ee(n.msgs,s.messages,l),X(),J())})}}},p=function(){TS.ui.replies.$scroller.scroll(function(){U()}),TS.ui.replies.$scroller.click(function(){TS.ui.replies.checkUnreads()}),$("#convo_tab").on("click","#convo_tab_back",function(){"mentions"===o?TS.client.ui.flex.openFlexTab("mentions"):"search_results"===o?(TS.search.view.showResults(),TS.search.view.maybeRebuildResults()):"starred_items"===o?TS.client.ui.flex.openFlexTab("stars"):"channel_page"!==o&&"group_page"!==o&&"im_page"!==o||TS.client.ui.flex.openFlexTab("details")})},g=function(){return $("ts-conversation ts-message.selected")},f=function(e){return"tombstone"===e.subtype},S=function(){return 0===_.reject(r,f).length},T=function(e,t,n,i){if(!f(t))return TS.templates.builders.msgs.buildHTML({msg:t,prev_msg:n,model_ob:e,is_in_conversation:!0,highlight_as_new:i,relative_ts:!0,enable_slack_action_links:!0})},v=function(e,t){return TS.templates.builders.msgs.buildHTML({model_ob:e,msg:t,is_root_msg:!0,is_in_conversation:!0,full_date:!0,enable_slack_action_links:!0})},b=function(e,t){if(!e.replies)return e;for(var n=0;n<e.replies.length;n+=1){var i=e.replies[n];if(i&&"U00"===i.user){var a=_.find(t,{ts:i.ts});a&&a.bot_id&&(i.bot_id=a.bot_id),e.replies[n]=i}}return e},w=function(e,t,n){var i=$("#convo_tab");y(),i.find("#convo_container").append(n)},y=function(){e&&(TS.ui.message_container.cleanup(e),e=null,t=null,n=null),$("#convo_tab #convo_container, #convo_tab #reply_container").empty(),$("#thread_load_error_wrapper").remove(),$("#convo_tab .thread_participants").empty()},k=!1,A=function(e,t){if(!k){if(!TS.model.ui_state)return void TS.warn("TS.model.ui_state not available; ignoring this flexpane switch");var n=TS.model.ui_state.flex_name,l=TS.model.ui_state.flex_extra;if("convo"===n&&"convo"===e&&l==t){if(!$("#flex_contents #convo_container").is(":empty"))return}if("convo"===e&&(y(),i=void 0,a=void 0,s=void 0,r=void 0,o=void 0,TS.utility.msgs.stopUpdatingRelativeTimestamps("#convo_container")),"convo"===n){var d,c,_=(l||"").split("-");if(1==_.length?(d=TS.shared.getActiveModelOb().id,c=_[0]):(d=_[0],c=_[1]),d&&c){var u=TS.shared.getModelObById(d);if(!u&&TS._incremental_boot){var m=function(){u=TS.shared.getModelObById(d),TS.ui.replies.openConversation(u,c)};return void(TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.addOnce(m):TS.ms.connected_sig.addOnce(m))}return TS.ui.replies.openConversation(u,c)}TS.error("convo flex pane opened without thread_ts; ignoring");try{k=!0,TS.client.ui.flex.hideFlex()}catch(e){}finally{k=!1}}}},C=function(){if("convo"===TS.model.ui_state.flex_name){y(),B(),$("#reply_container").addClass("hidden");var e={default:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f50d.png",as_text:cdn_url+"/f5d6f/img/emoji_2016_06_08/apple/1f50d.png",google:cdn_url+"/b7f24/img/emoji_2016_06_08/google/1f50d.png",twitter:cdn_url+"/6c9e5/img/emoji_2016_06_08/twitter/1f50d.png",emojione:cdn_url+"/5499/img/emoji_2016_06_08/emojione/1f50d.png"};TS.ui.replies.$scroller.prepend(TS.templates.thread_flexpane_error({emoji:e[TS.model.prefs.emoji_mode]}))}},M=function(t){var i=_.find(r,{ts:a});if(i){var s=_.get(n,"msgs.length",0);s=Math.max(i.reply_count||0,s);var o=s>0;t.find("ts-relatives.descendants").toggleClass("empty",!o),t.toggleClass("has_replies",o);var l=t.find(".convo_flexpane_divider");TS.ui.replies.updateFlexpaneThreadDivider(l,s);var d=!0;if(e.has_more_end)d=!1;else{var c=_(n.msgs).map("ts").max();if(c){var u=TS.ui.message_container.getRange(e);c>_.get(u,"end.msg_ts")&&(d=!1)}}$("#reply_container").toggleClass("hidden",!d)}},x=function(e,t){TS.replies.canReplyToMsg(e,t,!0)&&(s?TS.ui.replies.updateMessageActions(e,t):$("#reply_container").html(TS.templates.reply_limited({channel_name:TS.shared.getDisplayNameForModelOb(e),is_archived:e.is_archived})),$("#reply_container").removeClass("hidden"))},I=function(e,t,n){if(e&&n&&0!==n.length&&TS.permissions.members.canPostInChannel(e)){n.append(TS.templates.reply_broadcast_buttons({model_ob:e,label_id:t,view:"convo"}));if(n.find(".reply_broadcast_label_container, .reply_send").mousedown(function(e){e.preventDefault(),TS.ui.replies.focusReplyInput()}).click(TS.ui.replies.focusReplyInput),TS.console.shouldLog(2004)){var i=n.find(".reply_broadcast_toggle");i.change(function(){$(this).prop("checked")?TS.log(2004,"Broadcast toggle checked"):TS.log(2004,"Broadcast toggle un-checked")}),i.closest("label").mousedown(function(){TS.log(2004,"mousedown on broadcast toggle")}).keydown(function(){TS.log(2004,"keydown on broadcast toggle")})}}},E=function(e){e&&$("#convo_tab .thread_participants").html(TS.templates.builders.buildThreadParticipantListHTML(e))},B=function(){$("#convo_tab .thread_participants").text("")},D=function(){if(i){var e=TS.shared.getModelObById(i);if(e){var t=TS.permissions.members.canPostInModelOb(TS.model.user,e)&&!e.is_archived;if(TS.boot_data.feature_default_shared_channels&&!t&&(t=TS.channels.read_only.threads.canThread(e.id)),t!==s){var n=TS.replies.getMessage(e,a);s=t,$("#reply_container").empty(),x(e,n)}}}},F=function(){$("#reply_container .message_input").trigger("autosize-resize")},P=function(){var e=$("#reply_container .message_input");if(!TS.utility.isFocusOnInput()||TS.utility.contenteditable.isActiveElement(e[0])){l?TS.ui.replies.focusReplyInput(!0):c.addOnce(function(){TS.ui.replies.focusReplyInput(!0)})}},O=function(){var e=$("#reply_container .message_input");return TS.client.ui.isElInView(e,0,TS.ui.replies.$scroller.dimensions_rect())},R=function(e){$("#convo_loading_indicator").toggleClass("hidden",!e)},U=function(){TS.ui.replies.checkUnreads()},L=function(e,t){$("#reply_container").html(TS.templates.join_channel_from_thread({model_ob_name:e.name,is_convo:!0,has_replies:!!t.reply_count}))},Q=function(e,t,n,s,r){i==e.id&&a==t.ts&&q(n,s,r)},H=function(e){i===e.id&&TS.ui.replies.openConversation(e,a)},N=function(e){i===e.id&&TS.ui.replies.openConversation(e,a)},G=function(e){i===e.id&&TS.client.ui.flex.hideFlex()},j=function(e){i===e.id&&TS.ui.replies.openConversation(e,a)},z=function(e){if(e.id===i&&r&&r.length){var n={};_.forEach(r,function(e,t){n[e.ts]=t}),_.forEach(e.msgs,function(e){if(n.hasOwnProperty(e.ts)){var i=n[e.ts];r[i]=e}_.get(t,"msgs.length")&&t.msgs[0].ts===e.ts&&(t.msgs[0]=e)})}},K=function(e,t){TS.ui.replies.maybeUpdateConversationWithMessage(e,t)},W=function(e,t){TS.ui.replies.maybeRemoveMessageFromConversation(e,t)},V=function(){TS.ui.replies.checkUnreads()},Y=function(e){TS.ui.replies.rebuildMsgsIncludingMember(e)},q=function(i,s,r){var o=_.find(i,{ts:a}),l=_.without(i,o);t.msgs.length=0,n.msgs.length=0,o&&t.msgs.push(o),_.forEach(l,function(e){n.msgs.unshift(e)}),e.sections.length=0,t.msgs.length&&e.sections.push(t),e.sections.push(n),e.has_more_beginning=!!s,e.has_more_end=!!r,TS.utility.msgs.sortMsgs(n.msgs),X(),J()},J=function(t){TS.ui.message_container.update(e,t)},Z=function(i,a,s,r){t={id:"root",order:0,msgs:[]},i&&t.msgs.push(i),n={id:"replies",order:1,msgs:[]},e={name:"replies",container:r,scroller:TS.ui.replies.$scroller,page_size:m,sections:[t,n],has_more_beginning:!1,has_more_end:!1,skip_day_groupings:!0,show_hidden_replies:!0,buildSection:function(e){return"root"===e.id?TS.templates.message_conversation_root():TS.templates.message_conversation_descendants()},buildMsgHTML:function(e,t,n){return"root"===n.id?v(a,e):T(a,e)},updateCallback:function(){M(r)},promiseToLoadMoreAtBeginning:function(){var i=n.msgs,r=_.minBy(i,"ts"),o=_.get(r,"ts");return o?TS.replies.getThreadBefore(a.id,s,o).then(function(i){var a=i.root_msg;ee(n.msgs,i.messages,s),i.has_more||(e.has_more_beginning=!1,t.msgs[0]=a,e.sections[0]!==t&&e.sections.unshift(t)),X()}):Promise.reject()},promiseToLoadMoreAtEnd:function(){var t=n.msgs,i=_.maxBy(t,"ts"),r=_.get(i,"ts");return r?TS.replies.getThreadAfter(a.id,s,r).then(function(t){ee(n.msgs,t.messages,s),t.has_more||(e.has_more_end=!1),X()}):Promise.reject()}}},X=function(){r=_.flatten([t.msgs,n.msgs]),r=_.sortBy(r,"ts")},ee=function(e,t,n){var i=_.groupBy(e,"ts");_.forEach(t,function(t){t.ts!==n&&(i[t.ts]||e.push(t))}),TS.utility.msgs.sortMsgs(e)}}()},2639:function(e,t){!function(){"use strict";TS.registerModule("ui.share_channel_dialog",{start:function(e){if(r=e&&void 0===e.model_ob,void 0===e.skip_interstitial)return void d(e);var t=w(e),n=TS.templates.channel_share_dialog(t),c=TS.templates.channel_share_dialog_go_label(t),u=TS.templates.channel_share_dialog_heading(t);s=_.throttle(p,1e3),r?TS.ui.fs_modal.start({body_template_html:n,onShow:function(){i=$(".share_channel_modal_contents"),o.channel_name=i.find("#channel_create_title"),o.email_address=i.find("#email_address"),o.team_url=i.find("#team_url"),l.cancel=i.find(".cancel_share"),l.submit=i.find(".submit"),a=Ladda.create(l.submit[0]),T()},onShowComplete:function(){o.channel_name.focus().val(o.channel_name.val())}}):(TS.ui.channel_options_dialog.startWithChannelOption(n,u,c,_.noop,!0),i=TS.ui.channel_options_dialog.div,l.cancel=i.find(".cancel_share"),l.submit=i.find(".submit"),a=Ladda.create(l.submit[0]),TS.permissions.members.canCreateSharedChannel()?f():S())},test:function(){var e={_generateTemplateArgs:w,_handleSubmitCreate:c,_handleSuccess:m,_handleError:h,_validateShare:g,_promiseAdmins:v,_initAdminRequestUI:S,_generateAttachment:b,_handleSubmitRequest:u,_startInterstitial:d,$_admin_select:n,$_modal_content:i,_ladda:a,_is_new_channel:r,$_buttons:l};return Object.defineProperty(e,"_generateTemplateArgs",{get:function(){return w},set:function(e){w=e}}),Object.defineProperty(e,"_handleSubmitCreate",{get:function(){return c},set:function(e){c=e}}),Object.defineProperty(e,"_handleSuccess",{get:function(){return m},set:function(e){m=e}}),Object.defineProperty(e,"_handleError",{get:function(){return h},set:function(e){h=e}}),Object.defineProperty(e,"_validateShare",{get:function(){return g},set:function(e){g=e}}),Object.defineProperty(e,"_promiseAdmins",{get:function(){return v},set:function(e){v=e}}),Object.defineProperty(e,"_initAdminRequestUI",{get:function(){return S},set:function(e){S=e}}),Object.defineProperty(e,"_generateAttachment",{get:function(){return b},set:function(e){b=e}}),Object.defineProperty(e,"_handleSubmitRequest",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(e,"_startInterstitial",{get:function(){return d},set:function(e){d=e}}),Object.defineProperty(e,"$_admin_select",{get:function(){return n},set:function(e){n=e}}),Object.defineProperty(e,"_ladda",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(e,"$_modal_content",{get:function(){return i},set:function(e){i=e}}),Object.defineProperty(e,"_is_new_channel",{get:function(){return r},set:function(e){r=e}}),Object.defineProperty(e,"$_buttons",{get:function(){return l},set:function(e){l=e}}),e}});var e,t,n,i,a,s,r,o={},l={},d=function(e){var t=w(e),n=function(){TS.ui.share_channel_dialog.start(_.set(e,"skip_interstitial",!0))};if(r)TS.ui.fs_modal.start({body_template_html:TS.templates.channel_share_dialog_interstitial(t),onShowComplete:function(){i=$(".share_channel_modal_interstitial"),i.find(".submit").on("click",n),i.find(".cancel_share").on("click",function(){TS.ui.new_channel_modal.startInContainer(i)})}});else{var a=TS.templates.channel_share_dialog_interstitial(t),s=TS.templates.channel_share_dialog_heading(t),o=TS.templates.channel_share_dialog_go_label(t);TS.ui.channel_options_dialog.startWithChannelOption(a,s,o,_.noop,!0),TS.ui.channel_options_dialog.div.find(".submit").click(n),TS.ui.channel_options_dialog.div.find(".cancel_share").click(function(){TS.ui.channel_options_dialog.showAllOptions()})}},c=function(e){return a.start(),i.find(".error").remove(),g(e).then(function(){return TS.api.call("channels.inviteShared",{channel:e.model_ob?e.model_ob.id:e.channel_name,target_domain:e.target_domain,email:e.email})}).then(m,h)},u=function(){a.start(),i.find(".error").remove();var t=n.lazyFilterSelect("value"),s=TS.utility.contenteditable.value(e);return TS.api.call("im.open",{user:t[0].id}).then(function(){return TS.api.call("chat.postMessage",{channel:t[0].id,text:s,link_names:!0}).then(function(e){TS.ui.fs_modal.close(),TS.ims.startImById(e.data.channel)})}).then(null,h)},m=function(e){if(r);else{var t=TS.templates.channel_share_dialog_content(),n=TS.templates.channel_share_dialog_heading({email:"fake@acme-corp.com"}),s=TS.templates.channel_share_dialog_go_label({email:!0});TS.ui.channel_options_dialog.startWithChannelOption(t,n,s,TS.ui.fs_modal.close),i.find(".option_cancel").addClass("hidden"),a.stop(),TS.ui.fs_modal.hideBackButton(),TS.log("shared_channels_connection",e)}},h=function(e){e.ok||(a.stop(),i.find(".information").after(TS.templates.channel_share_dialog_error({is_generic_error:!0,response:e.data}))),TS.log("shared_channels_connection",e.data)},p=function(){if(r)_.isEmpty(o.channel_name.val())||_.isEmpty(o.email_address.val())||_.isEmpty(o.team_url.val())?l.submit.attr("disabled","disabled"):l.submit.removeAttr("disabled");else{if(n.lazyFilterSelect("value").length>0&&!TS.utility.contenteditable.isEmpty(e))return t.html(b(TS.utility.contenteditable.value(e))),void a.enable();t.children().length>0&&t.empty(),a.disable()}},g=function(e){return TS.api.call("api.test",{channel:e.model_ob?e.model_ob.id:e.channel_name,target_domain:e.target_domain,email:e.email})},f=function(){l.cancel.click(TS.ui.channel_options_dialog.showAllOptions),l.submit.click(function(){c({model_ob:TS.shared.getActiveModelOb(),target_domain:i.find("#team_url").val(),email:i.find("#email").val()})})},S=function(){e=i.find("#message"),n=i.find(".lfs_container"),l.submit.attr("disabled","disabled"),TS.utility.contenteditable.create(e,{modules:{tabcomplete:{positionMenu:function(t){var n=e.offset(),i=$(window).width()-n.left-2;t.style.width=Math.min(e.outerWidth(),i)+"px",t.style.minWidth=0,TS.tabcomplete.positionUIRelativeToInput(t,e)}}},onTextChange:s}),TS.utility.contenteditable.setCursorAtEnd(e),TS.utility.contenteditable.blur(e),i.find(".emo_menu").bind("click.open_emo_menu",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:i.find("#message")})}),n.lazyFilterSelect({data_promise:v,single:!0,template:function(e){return new Handlebars.SafeString(TS.templates.file_sharing_channel_row({item:e,show_share_prefix:!1}))},onItemAdded:s,onItemRemoved:s}),l.cancel.click(TS.ui.channel_options_dialog.showAllOptions),l.submit.click(u),t=i.find(".message_attachment")},T=function(){o.privacy=$(".share_channel_modal_contents #channel_public_private_toggle"),o.privacy.togglify(),o.privacy.bind("change",function(){o.privacy.is(":checked")?(i.find(".private_channel_item").addClass("hidden"),i.find(".public_channel_item").removeClass("hidden")):(i.find(".public_channel_item").addClass("hidden"),i.find(".private_channel_item").removeClass("hidden"))}).trigger("change"),i.find("input").on("keyup",s),l.cancel.click(function(){TS.ui.new_channel_modal.startInContainer(i)}),l.submit.click(function(){c({channel_name:o.channel_name,target_domain:o.team_url,email:o.email_address})})},v=function(e){return TS.flannel.fetchAndUpsertObjectsWithQuery({query:e,count:10,index:TS.members.shouldDisplayRealNames()?"users_by_realname":"users_by_name",filter:"admins"}).then(function(e){var t=e.objects;return t.forEach(function(e,n){t[n].lfs_id=e.id}),t})},b=function(e){var t={type:"message",ts:TS.interop.datetime.makeTsStamp(),user:TS.model.user.id,text:TS.format.cleanMsg(e)};return TS.templates.builders.formatMessageAsAttachment(t)},w=function(e){return{model_ob:e?e.model_ob:null,can_create_shared_channel:TS.permissions.members.canCreateSharedChannel(),show_heading:r,title:e?e.title:null,is_new_channel:r,is_private:e?e.is_private:null,channel_name:e&&e.model_ob?TS.templates.builders.makeChannelPrefix(e.model_ob)+_.escape(e.model_ob.name):null,is_interstitial:e&&(void 0===e.skip_interstitial||!e.skip_interstitial)}}}()},2643:function(e,t){!function(){"use strict";TS.registerModule("ui.shared_invites_modal",{onStart:function(){if($("body").on("click",'[data-action="admin_shared_invites_modal"]',function(e){if(!TS.isPartiallyBooted()){if(!s())return TS.ui.admin_invites.start();"channel_list_invites_link"===e.target.id&&(TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"invite_people",action:"click",ui_element:"invite_people_button"}}}),TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"impression",ui_element:"share_invite_link_modal"},referring_ui_context:{step:"invite_people",ui_element:"invite_people_button"}},referring_event_id:"INAPP_INVITES"})),d(e)}}),TS.boot_data.show_shared_invites_modal)return r()},start:function(e){return u(e)},updateCode:function(){return r()},userCanViewSharedInvitesModal:function(){return s()}});var e,t,n,i,a=function(){return!TS.model.team.plan&&TS.model.user.is_admin},s=function(){return!!TS.boot_data.show_shared_invites_modal&&(!TS.model.team.plan&&(a()||TS.ui.admin_invites.canInvite()&&n))},r=function(){return TS.api.call("users.listSharedInvites",{mode:"last_active"}).then(function(e){o(e.data.invites&&e.data.invites.length?e.data.invites[0]:null)},function(e){TS.error("could not create shared invite link: "+e)})},o=function(e){if(n=e,clearTimeout(i),n){var t=1e3*n.date_expire,a=t-new Date;if(a<0)return void(n=null);a>2147483647&&(a=2147483647),i=setTimeout(r,a)}},l=function(){return r().then(function(){if(n)return TS.api.call("users.admin.revokeSharedInvite",{code:n.code}).then(function(){return o(null),Promise.resolve()})})},d=function(e){TS.menu.isRedundantClick(e)||TS.menu.menu_is_showing||(TS.menu.buildIfNeeded(),TS.menu.clean(),TS.menu.$menu_items.html(TS.templates.shared_invites_modal()),TS.menu.start(e),TS.menu.menu_closed_sig.addOnce(function(){$("#shared_invite_link_modal_warning").remove()}),u(e))},c=function(t,n){n=n||{};var i=A[t];if(!i)return TS.error("no shared invite modal view"),Promise.reject();if(n.warning){e.closest(".menu").prepend(TS.templates.shared_invites_modal_warning({warning:n.warning}))}else $("#shared_invite_link_modal_warning").remove();return i(n)},u=function(){e=$("#shared_invite_link_modal"),t=$("#shared_invite_link_modal_body");var i;return i=n?a()?"admin_share_link":"nonadmin_share_link":"admin_create_link",m(),c(i)},m=function(){p(),f(),v(),b(),h(),S()},h=function(){e.find("#shared_invite_link_url").on("click",function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"invite_link"}}})})},p=function(){e.on("click",'[data-action="shared_invite_open_email_invites"]',function(){TS.ui.admin_invites.start(),TS.menu&&TS.menu.end(),TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"email_invite_link"}}})})},g=function(){return t.html(TS.templates.shared_invites_modal_admin_create_link_body()),Promise.resolve()},f=function(){var t;e.on("click",'[data-action="shared_invite_create_link"]',function(){t=$(this);var n=e.find("#select_shared_invite_expiration");TS.ui.startButtonSpinner(t.get(0)),n.attr("disabled","disabled");var i=_.toInteger(n.val());return TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"create_invite_link_button"}}}),TS.api.call("users.admin.createSharedInvite",{expiration:i,max_signups:500,disable_email:!0},function(e,i){return e?(o(i),c("admin_share_link")):(n.removeAttr("disabled"),TS.ui.stopButtonSpinner(t.get(0),!1),c("admin_create_link",{warning:"ratelimited"}))})})},S=function(){e.on("click","#select_shared_invite_expiration",function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"expiration_period_menu"}}})})},T=function(){var e=n.date_expire,i=y(e),a={shared_invite_url:n.url,is_admin:!0};return i&&(a.time_until_expiration_string=new Handlebars.SafeString(i),a.expiration_date=TS.interop.datetime.toCalendarDate(e),a.expiration_time=TS.interop.datetime.toTime(e,{do24hrTime:TS.utility.date.do24hrTime()})),t.html(TS.templates.shared_invites_modal_share_link_body(a)),Promise.resolve()},v=function(){e.on("click",'[data-action="disable_shared_link"]',function(){var e=$(".menu");return e.addClass("hide_behind_dialog"),TS.menu.needs_to_remain_open=function(){return!0},TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"disable_link"}}}),new Promise(function(t){TS.generic_dialog.start({title:TS.i18n.t("Deactivate your invite link?","pages_admin")(),body:TS.i18n.t("<p>The invite link for <b>{team_name}</b> will stop working. Please note that if you sent the link to anyone, they may not be able to join your team.</p>","pages_admin")({team_name:_.escape(TS.model.team.name)}),go_button_class:"btn_danger ladda-button",go_button_text:TS.i18n.t("Deactivate Link","pages_admin")(),onGo:function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"deactivate_link",action:"click",ui_element:"deactivate_link_button"}}}),t()},onCancel:function(){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"deactivate_link",action:"click",ui_element:"cancel_button"}}})},onEnd:function(){TS.menu.needs_to_remain_open=void 0,e.removeClass("hide_behind_dialog")}})}).then(function(){return l().then(function(){return c("admin_create_link",{warning:"link_disabled"})},function(){TS.error("disable share invites link failed")})})})},b=function(){e.on("click",'[data-action="copy_shared_link"]',function(){var e=$(this);w(e),TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"click",ui_element:"copy_button"}}})})},w=function(e){var t=e.parent().find("input"),n=t.attr("data-invite-url");TS.clipboard.writeText(n),t.select(),e.removeClass("hide_copy_btn_ts_tip"),window.setTimeout(function(){e.addClass("hide_copy_btn_ts_tip")},2e3)},y=function(e){var t,n=TS.interop.datetime.toDateObject(Date.now()/1e3),i=TS.interop.datetime.distanceInDays(TS.interop.datetime.toDateObject(e),n),a=i/7;return i>30?"":(t=_.isInteger(a)?TS.i18n.t("in {num_weeks, plural, =1{one week}other{{num_weeks} weeks}}","shared_invites_modal")({num_weeks:a}):TS.i18n.t("in {num_days, plural, =1{one day}other{{num_days} days}}","shared_invites_modal")({num_days:i}),TS.interop.datetime.prettifyDateString(e,{fallbackString:t,uncapitalized:!0}))},k=function(){var e=n.date_expire,i=y(e),a={shared_invite_url:n.url,is_admin:!1};return i&&(a.time_until_expiration_string=new Handlebars.SafeString(i),a.expiration_date=TS.interop.datetime.toCalendarDate(e),a.expiration_time=TS.interop.datetime.toTime(e,{do24hrTime:TS.utility.date.do24hrTime()})),t.html(TS.templates.shared_invites_modal_share_link_body(a)),Promise.resolve()},A={admin_create_link:g,admin_share_link:T,nonadmin_share_link:k}}()},2644:function(e,t){!function(){"use strict";TS.registerModule("ui.snippet_dialog",{editor:null,text_from_input:null,edit_file_id:null,div:null,showing:!1,onStart:function(){},startCreate:function(e){TS.ui.snippet_dialog.showing||(TS.ui.snippet_dialog.showing=!0,TS.ui.snippet_dialog.text_from_input=e||null,TS.ui.snippet_dialog.edit_file_id=null,TS.ui.snippet_dialog.start(e,null,TS.model.prefs.last_snippet_type||"text"))},startEdit:function(e){if(!TS.ui.snippet_dialog.showing){TS.files.getFileById(e)&&TS.files.fetchFileInfo(e,function(t,n){TS.ui.snippet_dialog.edit_file_id=e,TS.ui.snippet_dialog.text_from_input=null,TS.ui.snippet_dialog.start(n.content,n.title,n.filetype)})}},start:function(s,r,o){if(n=s||"",t=r||"",i=o||"",!window.CodeMirror)return void(e||(e=!0,TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror","/js/libs/codemirror.js")).done(function(){TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror_addon_simple","/js/libs/codemirror/addon/simple.js")).done(function(){TS.utility.getCachedScript(_.get(TS,"boot_data.vvv_paths.codemirror_load","/js/codemirror_load.js")).done(function(){TS.ui.snippet_dialog.start(s,r,o)})})})));TS.ui.snippet_dialog.div||TS.ui.snippet_dialog.build();var l={codemirror_types:TS.boot_data.codemirror_types,wrap_lines:TS.model.prefs.snippet_editor_wrap_long_lines};TS.ui.snippet_dialog.edit_file_id?l.is_edit=!0:(l.is_edit=!1,l.sharing_html=TS.templates.builders.buildFileSharingControls());var d=TS.templates.snippet_dialog(l),c=TS.ui.snippet_dialog.div;c.html(d),c.modal("show"),c.find(".modal-footer-action > .cancel, .modal-header > .close").click(TS.ui.snippet_dialog.cancelPrompt),c.find(".dialog_cancel").click(TS.ui.snippet_dialog.cancel),c.find(".dialog_cancel_decline").click(TS.ui.snippet_dialog.cancelDecline),c.find(".dialog_go").click(TS.ui.snippet_dialog.go),TS.ui.snippet_dialog.editor=CodeMirror.fromTextArea(document.getElementById("client_file_snippet_textarea"),{lineNumbers:!0,matchBrackets:!0,indentUnit:4,indentWithTabs:!0,enterMode:"keep",tabMode:"shift",viewportMargin:10,autofocus:!1,lineWrapping:TS.model.prefs.snippet_editor_wrap_long_lines}),$("#client_file_snippet_select").change(function(){CodeMirror.switchSlackMode(TS.ui.snippet_dialog.editor,$(this).val()),TS.prefs.setPrefByAPI({name:"last_snippet_type",value:$(this).val()})}).change(),$("#client_file_wrap_cb").bind("change",function(){var e=$(this).is(":checked");TS.ui.snippet_dialog.editor.setOption("lineWrapping",e),TS.prefs.setPrefByAPI({name:"snippet_editor_wrap_long_lines",value:e})});var u=!1;TS.ui.snippet_dialog.edit_file_id?(TS.ui.snippet_dialog.editor.setValue(s),r&&(r=TS.format.unFormatMsg(r)),$("#client_file_snippet_title_input").val(r||"")):(TS.ui.snippet_dialog.editor.setValue(s||""),$("#client_file_snippet_title_input").val(""),TS.ui.file_share.bindFileShareDropdowns(),TS.ui.file_share.bindFileShareShareToggle(),TS.ui.file_share.bindFileShareCommentField(),u=!!s);var m=$("#file_comment_textarea");TS.ui.comments.bindInput(m,TS.ui.snippet_dialog.go),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||m.autogrow(),$("#client_file_snippet_select").val(o).trigger("change"),setTimeout(function(){u?$("#client_file_snippet_title_input").focus():TS.ui.snippet_dialog.editor.focus(),TS.ui.snippet_dialog.editor.refresh()},350),$(window.document).on("keydown",TS.ui.snippet_dialog.onKeyDown),$(window.document).on("keyup",a),TS.ui.snippet_dialog.editor.on("change",a)},go:function(){if(!TS.ui.snippet_dialog.showing)return void TS.error("not showing?");var e=TS.ui.snippet_dialog.editor.getValue();if($.trim(e)&&!TS.ui.file_share.shouldBlockUploadDialogSubmission()){var t=TS.emoji.maybeGetCanonicalEmojiString($("#client_file_snippet_title_input").val());if(TS.ui.snippet_dialog.edit_file_id)TS.api.call("files.edit",{file:TS.ui.snippet_dialog.edit_file_id,title:t,content:e,filetype:$("#client_file_snippet_select").val()});else{var n=!!$("#share_cb").prop("checked"),i=n?$("#share_model_ob_id").val():null,a=TS.format.cleanMsg(TS.utility.contenteditable.value($("#file_comment_textarea"))),s=$("#client_file_snippet_select").val();""===$.trim(a)&&(a=""),TS.shared.getShareModelObId(i,function(n){if(TS.files.upload({text:e,title:t,filetype:s,channels:n,initial_comment:a}),TS.client){var i=TS.shared.getModelObById(n);if(!i)return;TS.client.displayModelOb(i)}})}TS.ui.snippet_dialog.div.modal("hide"),TS.ui.snippet_dialog.end()}},cancelPrompt:function(e){e&&(e.preventDefault(),e.stopPropagation());var a=TS.ui.snippet_dialog,s=TS.emoji.maybeGetCanonicalEmojiString($("#client_file_snippet_title_input").val()),r=TS.ui.snippet_dialog.editor.getValue(),o=$("#client_file_snippet_select").val();if(TS.ui.snippet_dialog.edit_file_id){if(TS.emoji.maybeGetCanonicalEmojiString(t)===s&&n===r&&i===o)return a.cancel()}else if(!r&&!s)return a.cancel();var l=TS.ui.snippet_dialog.div;l.find(".modal-footer-confirm").removeClass("hidden"),l.find(".modal-footer-action").addClass("hidden")},cancelDecline:function(){var e=TS.ui.snippet_dialog.div;e.find(".modal-footer-confirm").addClass("hidden"),e.find(".modal-footer-action").removeClass("hidden")},cancel:function(e){e&&e.preventDefault(),TS.ui.snippet_dialog.text_from_input&&(TS.client.msg_input.populate(TS.ui.snippet_dialog.editor.getValue()),TS.ui.snippet_dialog.text_from_input=""),setTimeout(TS.view.focusMessageInput,10),TS.ui.snippet_dialog.end(),TS.ui.snippet_dialog.div.modal("hide")},end:function(){$(window.document).off("keydown",TS.ui.snippet_dialog.onKeyDown),$(window.document).off("keyup",a),TS.model.dialog_is_showing=!1,TS.ui.snippet_dialog.showing=!1,TS.ui.comments.unbindInput($("#file_comment_textarea")),TS.ui.snippet_dialog.editor&&TS.ui.snippet_dialog.editor.cleanup&&TS.ui.snippet_dialog.editor.cleanup(),TS.ui.snippet_dialog.editor=null,TS.ui.snippet_dialog.div.empty()},onKeyDown:function(e){var t=TS.ui.snippet_dialog;e.which==TS.utility.keymap.esc?(t.div.find(".modal-footer-confirm").is(":visible")?t.cancelDecline():t.cancelPrompt(),e.preventDefault()):e.which==TS.utility.keymap.enter&&(TS.utility.isFocusOnInput()&&document.activeElement&&"client_file_snippet_title_input"!==TS.utility.getActiveElementProp("id")||(t.div.find(".modal-footer-confirm").is(":visible")?t.cancel():t.go(),e.preventDefault()))},build:function(){$("body").append('<div id="snippet_dialog" class="modal hide fade" data-backdrop="static" data-keyboard="false"></div>'),TS.ui.snippet_dialog.div=$("#snippet_dialog");var e=TS.ui.snippet_dialog.div;e.on("hidden",function(e){e.target==this&&TS.ui.snippet_dialog.end()}),e.on("show",function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.snippet_dialog.showing=!0)})}});var e=!1,t="",n="",i="",a=function(){var e=TS.ui.snippet_dialog,t=e.editor.getValue();$.trim(t)?e.div.find(".ts_tip").addClass("ts_tip_hide"):e.div.find(".ts_tip").removeClass("ts_tip_hide")}}()},2653:function(e,t){!function(){"use strict";TS.registerModule("ui.upload_dialog",{div:null,filesQ:[],file:null,showing:!1,last_share_cb_checked:null,selection:null,onStart:function(){},onKeydown:function(e){TS.ui.upload_dialog.showing&&(e.which==TS.utility.keymap.enter?"TEXTAREA"!==TS.utility.getActiveElementProp("NODENAME")&&(n?TS.ui.upload_dialog.cancel():TS.ui.upload_dialog.go(),e.preventDefault()):e.which==TS.utility.keymap.esc?TS.ui.upload_dialog.cancel():e.which==TS.utility.keymap.tab&&$(document.activeElement).hasClass("dialog_go")&&(e.preventDefault(),TS.ui.upload_dialog.div.find(".title_input").focus()))},shouldShowConfirmation:function(){return!n&&TS.utility.contenteditable.getLength(TS.ui.upload_dialog.div.find("#file_comment_textarea"))>400},showConfirmation:function(){var e=TS.ui.upload_dialog.div,t=e.find(".modal-footer-confirm");e.find(".upload_actions").addClass("hidden"),t.removeClass("hidden"),t.find(".dialog_cancel").focus(),n=!0},start:function(e){if(!e||!e.length)return void TS.info("no files");for(var t,n=0,i=0;i<e.length;i+=1)t=e[i],t.size>TS.model.upload_file_size_limit_bytes||(n+=1,TS.ui.upload_dialog.filesQ.push(t));if(n<e.length){var a="";a=1==e.length?TS.i18n.t("That file is too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)}):n?TS.i18n.t("Well upload what we can, but one or more of those files is too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)}):TS.i18n.t("All of those file are too large and cannot be uploaded. The limit is {limit_size}.","upload_dialog")({limit_size:TS.utility.convertFilesize(TS.model.upload_file_size_limit_bytes)}),alert(a)}n&&(TS.ui.upload_dialog.div||TS.ui.upload_dialog.build(),TS.ui.upload_dialog.showing||TS.ui.upload_dialog.pullFromQ(!0))},startWithCommentFromChatInput:function(t){e=TS.utility.contenteditable.value(TS.client.ui.$msg_input),TS.ui.upload_dialog.start(t),TS.view.clearMessageInput()},pullFromQ:function(e){return TS.ui.upload_dialog.filesQ.length?(TS.ui.upload_dialog._startWithFile(TS.ui.upload_dialog.filesQ.shift(),e),!0):(TS.client.ui.resetFiles?TS.client.ui.resetFiles():TS.console&&TS.console.warn&&TS.console.warn(8675309,"TS.client.ui.resetFiles undefined"),!1)},_startWithFile:function(e,n){t=!1,TS.ui.upload_dialog.file=e;var o=TS.templates.file_upload_dialog({filename:TS.files.makeFileNameFromFile(e),title:a(e),has_name:!!e.name,sharing_html:TS.templates.builders.buildFileSharingControls(e,null,s(),null,TS.ui.upload_dialog.selection),over_storage_limit:TS.model.team.over_storage_limit,more_in_queue:TS.ui.upload_dialog.filesQ.length>0,file_retention_type:parseInt(TS.model.team.prefs.file_retention_type,10),file_retention_duration:TS.interop.datetime.daysToYearsPretty(TS.model.team.prefs.file_retention_duration)}),l=TS.ui.upload_dialog.div;l.html(o);var d=function(e){$("#upload_image_preview").removeClass("hidden").find("img").attr("src",e)};if("string"==typeof e)d("data:image/png;base64,"+e);else if(window.FileReader)try{if(EXIF){var c=new FileReader;c.onload=function(e){var t=EXIF.readFromBinaryFile(e.target.result);t.Orientation&&"number"==typeof t.Orientation&&1!==t.Orientation&&$("#upload_image_preview").find("img").addClass("orientation_"+t.Orientation)},c.readAsArrayBuffer(e)}var _=new FileReader;_.onload=function(e){var t=e.target.result;0===t.indexOf("data:image/")&&d(t)},_.onloadstart=function(e){e.total>33554432&&(TS.info("skipping image preview for large file: "+e.total),_.abort())},_.readAsDataURL(e)}catch(e){TS.info(e)}var u=$("#file_comment_textarea");TS.ui.comments.bindInput(u,TS.ui.upload_dialog.go),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()?TS.utility.contenteditable.value(u,s()):u.autogrow(),u=null;var m=TS.ui.upload_dialog.showing;if(l.modal("show"),TS.ui.upload_dialog.filesQ.length&&l.find(".file_count").text(TS.i18n.t(" (and {num_files_remaining, number} more)","upload_dialog")({num_files_remaining:TS.ui.upload_dialog.filesQ.length})),n){var h=!TS.client.activeChannelIsHidden();l.find("#share_cb").prop("checked",h)}else l.find("#share_cb").prop("checked",!0===TS.ui.upload_dialog.last_share_cb_checked);l.find(".modal-header > .close").click(r),l.find(".dialog_cancel_all").click(TS.ui.upload_dialog.cancelAll),l.find(".dialog_cancel").click(TS.ui.upload_dialog.cancel),l.find(".dialog_go").click(TS.ui.upload_dialog.go);var p=!n&&TS.ui.upload_dialog.selection?TS.ui.upload_dialog.selection:null;TS.ui.file_share.bindFileShareDropdowns(void 0,void 0,p),TS.ui.file_share.bindFileShareShareToggle(),TS.ui.file_share.bindFileShareCommentField();l.find(".lfs_input_container").attr("tabindex","0"),TS.boot_data.feature_texty_takes_over&&TS.utility.contenteditable.supportsTexty()||l.find("#file_comment_textarea").attr("tabindex","0"),l.find("#select_share_channels").data("TS-lazyFilterSelect").instance.onKeyDown=function(e){e.which==TS.utility.keymap.tab&&(e.preventDefault(),e.shiftKey?l.find("#share_cb").focus():TS.utility.contenteditable.focus(l.find("#file_comment_textarea")))},m&&i(l)},go:function(){if(t)return TS.info("TS.ui.upload_dialog.go stopped because already uploading"),!1;if(!TS.ui.upload_dialog.showing)return void TS.error("not showing?");if(!TS.ui.upload_dialog.file)return void TS.error("no file?");if(!TS.ui.file_share.shouldBlockUploadDialogSubmission()){var e=TS.ui.upload_dialog.div,n=!!e.find("#share_cb").prop("checked");TS.ui.upload_dialog.last_share_cb_checked=!!n,TS.ui.upload_dialog.selection=$("#share_model_ob_id").val();var i=n?TS.ui.upload_dialog.selection:null,a=TS.format.cleanMsg(TS.utility.contenteditable.value($("#file_comment_textarea")));""===$.trim(a)&&(a="");var s=e.find(".filename_input").val(),r=e.find(".title_input").val();if(TS.ui.upload_dialog.file.is_dropbox||TS.ui.upload_dialog.file.is_box){var l=TS.ui.upload_dialog.file.link;TS.shared.getShareModelObId(i,function(e){TS.files.upload({link:l,filename:s,title:r,channels:e,initial_comment:a,is_dropbox:TS.ui.upload_dialog.file.is_dropbox,is_box:TS.ui.upload_dialog.file.is_box}),i&&o(i)})}else{var d=TS.ui.upload_dialog.file;TS.shared.getShareModelObId(i,function(e){TS.files.upload({file:d,filename:s,title:r,channels:e,initial_comment:a}),i&&o(i)})}t=!0,TS.ui.upload_dialog.maybeGoAway()}},maybeGoAway:function(){return e="",!TS.ui.upload_dialog.pullFromQ()&&(TS.ui.upload_dialog.div.modal("hide"),TS.ui.upload_dialog.selection=null,!0)},cancel:function(){if(TS.ui.upload_dialog.shouldShowConfirmation())return void TS.ui.upload_dialog.showConfirmation();TS.ui.upload_dialog.selection=$("#share_model_ob_id").val();var t=e,i=TS.ui.upload_dialog.maybeGoAway();t&&TS.client.msg_input.populate(t),i&&t&&setTimeout(TS.view.focusMessageInput,10),n=!1},cancelAll:function(){TS.ui.upload_dialog.filesQ=[],TS.ui.upload_dialog.cancel()},end:function(){TS.model.dialog_is_showing=!1,TS.ui.upload_dialog.showing=!1,TS.ui.upload_dialog.file=null,e="",n=!1,TS.ui.comments.unbindInput($("#file_comment_textarea")),TS.ui.upload_dialog.div.empty(),$(window.document).unbind("keydown",TS.ui.upload_dialog.onKeydown)},build:function(){$("body").append('<div id="upload_dialog" class="modal hide fade" data-keyboard="false" data-backdrop="static"></div>'),TS.ui.upload_dialog.div=$("#upload_dialog");var e=TS.ui.upload_dialog.div;e.on("hidden",function(e){e.target==this&&TS.ui.upload_dialog.end()}),e.on("show",function(e){e.target==this&&(TS.model.dialog_is_showing=!0,TS.ui.upload_dialog.showing=!0)}),e.on("shown",function(t){t.target==this&&setTimeout(function(){i(e),$(window.document).bind("keydown",TS.ui.upload_dialog.onKeydown)},100)})}});var e="",t=!1,n=!1,i=function(t){e&&e.length>50?(TS.utility.contenteditable.focus(t.find("#file_comment_textarea")),TS.utility.contenteditable.cursorPosition(t.find("#file_comment_textarea"),0,1e5)):t.find("#upload_file_title").focus().select()},a=function(t){return e&&e.length<=50?e:TS.files.makeFileTitleFromFile(t)},s=function(){return e&&e.length>50?e:""},r=function(e){e.preventDefault(),TS.ui.upload_dialog.cancelAll()},o=function(e){TS.channels.getChannelById(e)?TS.channels.displayChannel({id:e}):TS.ims.getImByMemberId(e)?TS.ims.startImByMemberId(e):TS.mpims.getMpimById(e)?TS.mpims.displayMpim({id:e}):TS.groups.getGroupById(e)?TS.groups.displayGroup({id:e}):TS.error("no valid shared channel/im/mpim/group to display")}}()},2659:function(e,t){!function(){"use strict";TS.registerModule("utility.box",{onStart:function(){},launchPopup:function(){if(window.BoxSelect){var e;try{e=window.open,window.open=function(n,i,a){var s,r,o,l;return s=String(a).match(/width\D+(\d+)/),s=parseInt(s&&s[1]||590,10),r=String(a).match(/height\D+(\d+)/),r=parseInt(r&&r[1]||520,10),o=(window.screenX||window.screenLeft)+((window.outerWidth||document.documentElement.offsetWidth)-s)/2,l=(window.screenY||window.screenTop)+((window.outerHeight||document.documentElement.offsetHeight)-r)/2,t=e(n,i,[a,"left="+o,"top="+l].join(","))},n().launchPopup(),window.focus&&t&&t.focus()}finally{window.open=e}}},closePopup:function(){window.BoxSelect&&n().closePopup()},success:function(e){window.BoxSelect&&n().success(e)},cancel:function(e){window.BoxSelect&&n().cancel(e)},unregister:function(){window.BoxSelect&&n().unregister.apply(n(),arguments)},isBrowserSupported:function(){if(window.BoxSelect)return n().isBrowserSupported()},test:function(){return{getBoxSelect:n,setBoxSelect:i}}});var e,t,n=function(){return e||(e=new window.BoxSelect({clientId:TS.boot_data.box_app_key,linkType:"shared",multiselect:"true"}),TS.utility.box.SUCCESS_EVENT_TYPE=e.SUCCESS_EVENT_TYPE,TS.utility.box.CANCEL_EVENT_TYPE=e.CANCEL_EVENT_TYPE,e)},i=function(t){e=t}}()},2678:function(e,t){!function(){"use strict";TS.registerModule("view.channel",{channel_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function(){TS.channels.renamed_sig.add(TS.view.channel.channelRenamed,TS.view.channel),TS.channels.switched_sig.add(TS.view.channel.channelSwitched,TS.view.channel),TS.channels.created_sig.add(TS.view.channel.channelCreated,TS.view.channel),TS.channels.deleted_sig.add(TS.view.channel.channelDeleted,TS.view.channel),TS.channels.joined_sig.add(TS.view.channel.channelJoined,TS.view.channel),TS.channels.member_joined_sig.add(TS.view.channel.channelMemberJoined,TS.view.channel),TS.channels.left_sig.add(TS.view.channel.channelLeft,TS.view.channel),TS.channels.member_left_sig.add(TS.view.channel.channelMemberLeft,TS.view.channel),TS.channels.history_fetched_sig.add(TS.view.channel.channelHistoryFetched,TS.view.channel),TS.channels.history_being_fetched_sig.add(TS.view.channel.channelHistoryBeingFetched,TS.view.channel),TS.channels.message_received_sig.add(TS.view.channel.channelMessageReceived,TS.view.channel),TS.channels.message_removed_sig.add(TS.view.channel.channelMessageRemoved,TS.view.channel),TS.channels.message_changed_sig.add(TS.view.channel.channelMessageChanged,TS.view.channel),TS.channels.marked_sig.add(TS.view.channel.channelMarked,TS.view.channel),TS.channels.unread_changed_sig.add(TS.view.channel.channelUnreadCountChanged,TS.view.channel),TS.channels.unread_highlight_changed_sig.add(TS.view.channel.channelUnreadHighlightCountChanged,TS.view.channel),TS.channels.topic_changed_sig.add(TS.view.channel.channelTopicChanged,TS.view.channel),TS.channels.purpose_changed_sig.add(TS.view.channel.channelPurposeChanged,TS.view.channel),TS.channels.archived_sig.add(TS.view.channel.channelArchived,TS.view.channel),TS.channels.unarchived_sig.add(TS.view.channel.channelUnArchived,TS.view.channel),TS.channels.msg_not_sent_sig.add(TS.view.channel.channelMsgNotsent,TS.view.channel)},channelRenamed:function(){TS.client.ui.rebuildAll(!1),TS.view.updateTitleWithContext()},channelSwitched:function(){TS.view._maybeUpdateOnboarding(),TS.view.switchedHelper(),TS.view.updateTitleWithContext(),TS.view.updateTypingText()},channelCreated:function(){TS.client.channel_pane.rebuild("channels","starred")},channelDeleted:function(){TS.client.channel_pane.rebuild("channels","starred")},channelJoined:function(){TS.client.channel_pane.rebuild("channels","starred")},channelMemberJoined:function(e){e.id==TS.model.active_channel_id&&(TS.client.msg_pane.rebuildChannelMembersList(),e.needs_created_message&&TS.view.overlay.startWithCreatedChannel(e))},channelLeft:function(){TS.client.channel_pane.rebuild("channels","starred")},channelMemberLeft:function(e){e.id==TS.model.active_channel_id&&TS.client.msg_pane.rebuildChannelMembersList()},channelHistoryFetched:function(e){e.id==TS.model.active_channel_id&&TS.client.ui.afterHistoryFetch(e)},channelHistoryBeingFetched:function(e){if(e.id==TS.model.active_channel_id&&(TS.client.msg_pane.updateEndMarker(),(e=TS.channels.getChannelById(TS.model.active_channel_id))&&e.msgs.length)){if(TS.model.ms_connected)if(e.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(e.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")}},channelMessageReceived:function(e,t){if(e.id==TS.model.active_channel_id){if(!t)return void TS.error("no msg?");if(TS.boot_data.feature_message_replies_inline&&TS.utility.msgs.isMsgReply(t))return void TS.view.addReplyMsg(e,t);if(!TS.utility.msgs.isMsgHidden(t)){var n=_.reject(e.msgs,TS.utility.msgs.isMsgHidden),i=n;if(i.length>1&&TS.utility.msgs.msgMightBeRolledUp(t)&&TS.utility.msgs.msgMightBeRolledUp(i[1])||1==i.length||i[0]!=t){TS.client.msg_pane.rebuildMsgsWithReason("channelMessageReceived",!0)}else TS.view.addMsg(t,e.unread_cnt),TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeClearUnreadDivider(e,t);TS.view.channel.channel_ui_updated_with_new_msg_sig.dispatch(t)}}},channelMessageRemoved:function(e,t){if(e.id==TS.model.active_channel_id)return t?void TS.view.removeMsg(e,t):void TS.error("no msg?")},channelMessageChanged:function(e,t,n){e.id==TS.model.active_channel_id&&setTimeout(function(){TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")?t._hidden_reply&&_.includes(n,"subtype")?TS.view.channel.channelMessageRemoved(e,t):t._hidden_reply||"thread_broadcast"!==t.subtype||TS.view.channel.channelMessageReceived(e,t):TS.view.rebuildMsg(t,n)},0)},channelMarked:function(e){e.id==TS.model.active_channel_id&&(TS.client.msg_pane.assignLastReadMsgDiv(e),TS.view.reClassUnreads(e.last_read))},channelUnreadCountChanged:function(e){if(e){var t="."+TS.templates.makeChannelDomId(e),n=$(t);0===e.unread_cnt?n.removeClass("unread mention"):(TS.notifs.isCorGMuted(e.id)||n.addClass("unread"),e.unread_highlight_cnt>0&&n.addClass("mention")),e._show_in_list_even_though_no_unreads?n.addClass("show_in_list_even_though_no_unreads"):n.removeClass("show_in_list_even_though_no_unreads");var i=n.find(".channel_name");i.length&&i.attr("aria-label",TS.templates.builders.makeChannelLinkAriaLabelSafe(e)),t="."+TS.templates.makeUnreadMsgsDomId(e);var a=$(t);0===e.unread_cnt?a.html(e.unread_cnt).addClass("hidden"):e.unread_cnt<10?a.html(e.unread_cnt).removeClass("hidden"):a.html("9+").removeClass("hidden"),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads(),TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(e),TS.client.msg_pane.maybeResetAndAutoScroll(e)}},channelUnreadHighlightCountChanged:function(e){if(e){var t="."+TS.templates.makeUnreadHighlightDomId(e);0===e.unread_highlight_cnt?$(t).html(e.unread_highlight_cnt).addClass("hidden"):e.unread_highlight_cnt<10?$(t).html(e.unread_highlight_cnt).removeClass("hidden"):$(t).html("9+").removeClass("hidden")}},channelTopicChanged:function(e){e&&e.id==TS.model.active_channel_id&&TS.client.msg_pane.updateEndMarker()},channelPurposeChanged:function(e){e&&e.id==TS.model.active_channel_id&&TS.client.msg_pane.updateEndMarker()},channelArchived:function(e){TS.client.channel_pane.rebuild("channels","starred"),TS.client.msg_pane.rebuildChannelMembersList(),e.id==TS.model.active_channel_id&&TS.client.archives.start()},channelUnArchived:function(e){TS.client.channel_pane.rebuild("channels","starred"),e.id==TS.model.active_channel_id&&(TS.client.msg_pane.rebuildChannelMembersList(),TS.client.msg_pane.rebuildMsgsWithReason("channelUnArchived"))},channelMsgNotsent:function(e,t,n){e.id==TS.model.active_channel_id&&TS.view.showUnSentControlsForMsg(t,e,n)}})}()},2679:function(e,t){!function(){"use strict";TS.registerModule("view.dnd",{onStart:function(){TS.dnd.dnd_statuses_changed_sig.add(TS.view.dnd.dndStatusesChanged,TS.view.dnd),TS.dnd.current_user_dnd_status_changed_sig.add(TS.view.dnd.currentUserDndStatusChanged,TS.view.dnd)},dndStatusesChanged:function(e){if(e&&e.length){var t=$(".presence[data-member-presence]"),n={};t.each(function(){var e=$(this),t=e.attr("data-member-presence");n[t]||(n[t]=[]),n[t].push(e)});var i=0;e.forEach(function(e){var t=n[e.id];t&&t.forEach(function(t){i+=1;var n=TS.templates.makeMemberPresenceStateClass(e);t.removeClass("away active dnd").addClass(n);var a=TS.ims.getImByMemberId(e.id);a&&t.closest(".im_name").attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:e,im:a}))})}),TS.has_pri[2002]&&TS.log(2002,"dndStatusesChanged updated "+i+" out of "+t.length+" presence icons")}},currentUserDndStatusChanged:function(){TS.model.ms_connected&&TS.view.ms.maybeChangeConnectionDisplay();var e=$("#team_menu").find(".notifications_menu_btn");TS.dnd.isMemberInDnd(TS.model.user)?e.removeClass("ts_icon_bell_o").addClass("ts_icon_snooze_outline"):e.removeClass("ts_icon_snooze_outline").addClass("ts_icon_bell_o")}})}()},2680:function(e,t){!function(){"use strict";TS.registerModule("view.files",{onStart:function(){TS.files.team_file_added_sig.add(TS.view.files.teamAdded,TS.view.files),TS.files.team_file_deleted_sig.add(TS.view.files.teamDeleted,TS.view.files),TS.files.team_file_changed_sig.add(TS.view.files.teamChanged,TS.view.files),TS.files.file_uploaded_sig.add(TS.view.files.uploaded,TS.view.files),TS.files.file_uploading_sig.add(TS.view.files.uploading,TS.view.files),TS.files.file_progress_sig.add(TS.view.files.progress,TS.view.files),TS.files.file_canceled_sig.add(TS.view.files.canceled,TS.view.files),TS.files.file_queue_emptied_sig.add(TS.view.files.queueEmptied,TS.view.files)},teamAdded:function(e){!e.is_deleted&&TS.view.files.shouldAppearInlist(e)&&TS.view.files.throttledRebuildList()},teamDeleted:function(e){TS.view.files.shouldAppearInlist(e)&&TS.view.files.throttledRebuildList()},teamChanged:function(e){!e.is_deleted&&TS.view.files.shouldAppearInlist(e)&&TS.view.files.singleListItemChanged(e);var t=TS.shared.getActiveModelOb();t&&TS.utility.msgs.updateFileMsgs(t,e)},uploaded:function(e,t){$("#file_progress").queue(function(n){if(e&&($(this).removeClass("loaded").find(".progress_bar").addClass("seafoam_green_bg no_transition").end().find(".progress_bar_progress_animated_thin").addClass("no_transition progress_bar_progress_thin progress_bar_progress_striped").removeClass("progress_bar_progress_animated_thin").attr("data-label-left",TS.i18n.t("Processing uploaded file complete!","files")()).css({width:"0%"}).end(),TS.model.ui_state.flex_visible)){var i=TS.files.getFileById(t);!i||"snippet"!==i.mode&&"post"!==i.mode||TS.client.ui.files.previewFile(i.id,"file_list")}n()}).delay(1e3)},uploading:function(e,t,n){var i="";n&&(i+='<a id="cancel_upload_in_progress" class="float_right very_small_right_margin">'+TS.i18n.t("cancel","files")()+"</a>");var a="";a=t?TS.i18n.t("Re-uploading {filename}","files")({filename:e}):TS.i18n.t("Uploading {filename}","files")({filename:e}),$("#file_progress").queue(function(e){$(this).toggleClass("is_cancelable",!!n).removeClass("hidden loaded").find(".progress_bar").removeClass("candy_red_bg seafoam_green_bg").end().find(".progress_bar_progress_thin").removeClass("no_transition").data("label-left-original",a).attr("data-label-left",a).end().find("#progress_text").html(i).find("#cancel_upload_in_progress").click(TS.files.cancelCurrentUpload),e(),TS.client.msg_pane.topMessagesBannerShown()}).fadeIn(200)},progress:function(e){$("#file_progress").queue(function(t){$(this).find(".progress_bar.no_transition").removeClass("no_transition");var n=$(".progress_bar_progress_thin"),i="";if(TS.files.uploadQ.length&&(i=TS.i18n.t("(1 of {total})","files")({total:TS.files.uploadQ.length+1})),e<99){var a=n.data("label-left-original")+""+e+"% "+i;n.css({width:e+"%"}).attr("data-label-left",a)}else $("#file_progress").addClass("loaded").find(".progress_bar_progress_thin").removeClass("progress_bar_progress_thin progress_bar_progress_striped").addClass("progress_bar_progress_animated_thin").css({width:"100%"}).attr("data-label-left",TS.i18n.t("Processing uploaded file","files")()+" "+i).end().find("#cancel_upload_in_progress").remove().end();t()})},canceled:function(e){$("#file_progress").queue(function(t){$(this).removeClass("loaded").find(".progress_bar").addClass("candy_red_bg").end().find(".progress_bar_progress_thin").addClass("no_transition progress_bar_progress_striped").css({width:"0%"}).attr("data-label-left","").end().find("#progress_text").html(TS.i18n.t('Canceling <strong class="filename">{filename}</strong>',"files")({filename:_.escape(e)})).end().find("#cancel_upload_in_progress").remove().end(),t()}).delay(1e3)},queueEmptied:function(){$("#file_progress").fadeOut(200,function(){TS.client.msg_pane.topMessagesBannerHidden()})},throttledRebuildList:function(){TS.utility.throttle.method(TS.view.files.maybeRebuildList,"file_list_rebuild",1e3)},maybeRebuildList:function(){!TS.model.ui_state.flex_visible||TS.model.ui_state.flex_name&&"files"!==TS.model.ui_state.flex_name||!TS.model.ui_state.flex_name&&"files"!==TS.model.default_flex_name||TS.view.files.rebuildList()},last_files_html:"",rebuildList:function(){TS.metrics.mark("start_file_flexpane_rebuild");var t,n=$("#file_list"),i=$("#file_list_block"),a=n.data("list"),s=TS.model.files,r="/files";"user"===a?(s=TS.model.user.files,r+="/"+TS.model.user.name):TS.interop.utility.looksLikeMemberId(a)&&(t=TS.members.getMemberById(a),t?(s=t.files,r+="/"+t.name):TS.error(a+" is not valid?"));var o=s.filter(function(e){return!e.is_deleted&&TS.view.files.shouldAppearInlist(e)});$("#file_list_heading").find(".heading_label").text(TS.view.file_list_heading),$("#file_list_toggle").removeClass("hidden"),$("#file_search_cancel").addClass("hidden");var l=TS.model.file_list_types,d=!l||!l.length||-1!=l.indexOf("all");if(i.find(".subsection").addClass("hidden"),d?i.find('.subsection[data-filter="all"]').removeClass("hidden"):("all"===TS.model.active_file_list_member_filter&&(r+="/all"),r+="/"+TS.model.active_file_list_filter,i.find('.subsection[data-filter="'+l[0]+'"]').removeClass("hidden")),!o.length){var c=TS.i18n.t("No files.","files")();d?"user"===a?c=TS.i18n.t("No files from you.","files")():t&&(c=TS.i18n.t("No files from {user}.","files")({user:"<strong>"+TS.members.getPrefCompliantMemberName(t,!0)+"</strong>"})):"user"===a?c=TS.i18n.t("No {files_type} from you.","files")({files_type:TS.model.file_list_type_map[l[0]]}):t&&(c=TS.i18n.t("No {files_type} from {user}.","files")({files_type:TS.model.file_list_type_map[l[0]],user:"<strong>"+TS.members.getPrefCompliantMemberName(t,!0)+"</strong>"})),e&&(n.longListView("destroy"),e=!1),n.empty().html('<p class="no_results">'+c+"</p>")}if(o.length)if(e)n.longListView("setItems",o,!1,!0);else{n.empty();n.longListView({items:o,approx_item_height:80,preserve_dom_order:!0,scrollable:$("#file_list_scroller"),makeElement:function(){return $("<div>")},renderItem:function(e,t){var n=TS.templates.builders.fileHTML(t);n=TS.format.replaceHighlightMarkers(n);var i=$(n);i.find("i.lazy").each(function(){var e=$(this);e.removeClass("lazy"),e.css("background-image","url("+e.attr("data-original")+")")}),e.attr("id",i.attr("id")),e.attr("class",i.attr("class")),e.attr("data-file-id",t.id),e.data("file-id",t.id),TS.boot_data.feature_arugula&&(e.attr("draggable","true"),e.attr("data-drag-meta",TS.templates.makeFileDragData(t))),e.empty(),i.children().each(function(){e.append(this)}),TS.utility.makeSureAllLinksHaveTargets(e)},calcItemHeight:function(e){var t=e.outerHeight();return t?t+12:80}}),e=!0}0===TS.model.files.length?$("#file_listing_bottom_button").addClass("hidden"):$("#file_listing_bottom_button").removeClass("hidden").attr("href",r),TS.ui.utility.updateClosestMonkeyScroller(n),TS.metrics.measureAndClear("file_flexpane_rebuild","start_file_flexpane_rebuild")},filterSet:function(){"files"===TS.model.ui.active_tab_id&&TS.model.ui_state.flex_visible&&!TS.model.previewed_file_id||TS.client.ui.files.showFileList(),TS.view.files.maybeRebuildList(),$("#file_list_scroller").scrollTop(0),TS.client.flex_pane.maybeFetchFileList()},clearFilter:function(){TS.model.active_file_list_filter="all",TS.view.file_list_heading=TS.i18n.t("All File Types","files")(),TS.model.file_list_types=["all"],TS.view.files.filterSet(),TS.view.files.setButtonState("all"),$("#file_list_clear_filter").addClass("hidden")},setButtonState:function(e){$(".secondary_file_button").addClass("hidden"),"snippets"===e?$("#secondary_snippet_button").removeClass("hidden"):"posts"===e?$("#secondary_post_button").removeClass("hidden"):$("#file_list_button").removeClass("hidden")},shouldAppearInlist:function(e){var t=TS.model.file_list_types;return!t||(!t.length||(t.indexOf("all")>-1||(t.indexOf("snippets")>-1&&"snippet"===e.mode||(t.indexOf("posts")>-1&&"post"===e.mode||(t.indexOf("spaces")>-1&&"space"===e.mode||(!!(TS.boot_data.feature_arugula&&t.indexOf("arugula")>-1&&"arugula"===e.mode)||(t.indexOf("emails")>-1&&"email"===e.mode||(t.indexOf("zips")>-1&&"zip"===e.filetype||(t.indexOf("pdfs")>-1&&"pdf"===e.filetype||(!!(t.indexOf("images")>-1&&e.mimetype&&0===e.mimetype.indexOf("image/"))||(!!(t.indexOf("videos")>-1&&e.mimetype&&0===e.mimetype.indexOf("video/"))||!!(t.indexOf("gdocs")>-1&&e.mimetype&&0===e.mimetype.indexOf("application/vnd.google-apps")))))))))))))},singleListItemChanged:function(t){e&&"files"===TS.model.ui_state.flex_name&&$("#file_list").longListView("itemUpdated",t)},cleanList:function(){e&&($("#file_list").longListView("destroy"),e=!1)},hideList:function(){e&&($("#file_list_scroller").data("disable-scroll",!0),$("#file_list").longListView("setHidden",!0))},unHideList:function(){$("#file_list_scroller").data("disable-scroll",!1),e?$("#file_list").longListView("setHidden",!1):TS.view.files.rebuildList()},shareInCurrentChannelOrIM:function(e,t){TS.files.shareOrReshareFile(e,void 0,void 0,t,!0)},delete:function(e){var t,n,i,a=TS.files&&TS.files.getFileById?TS.files.getFileById(e):null;a&&a.filetype&&"space"===a.filetype?(t=TS.i18n.t("Delete post","files")(),n=TS.i18n.t("Are you sure you want to delete this post permanently?","files")(),i=TS.i18n.t("Yes, delete this post","files")()):(t=TS.i18n.t("Delete file","files")(),n=a.is_external?TS.i18n.t("Are you sure you want to permanently delete this file from Slack?","files")():TS.i18n.t("Are you sure you want to delete this file permanently?","files")(),i=TS.i18n.t("Yes, delete this file","files")()),TS.generic_dialog.start({title:t,body:n,show_cancel_button:!0,show_go_button:!0,go_button_class:"btn_danger",go_button_text:i,cancel_button_text:TS.i18n.t("Cancel","files")(),onGo:function(){TS.files.deleteFile(e)}})},saveToDropbox:function(e){TS.generic_dialog.start({title:TS.i18n.t("Save to Dropbox","files")(),body:TS.i18n.t("Do you want to save this file to your Dropbox Slack folder?","files")(),show_cancel_button:!0,show_go_button:!0,go_button_text:TS.i18n.t("Yes","files")(),cancel_button_text:TS.i18n.t("No","files")(),onGo:function(){TS.files.saveFileToDropbox(e)}})}});var e=!1}()},2681:function(e,t){!function(){"use strict";TS.registerModule("view.group",{group_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function(){TS.groups.renamed_sig.add(TS.view.group.groupRenamed,TS.view.group),TS.groups.switched_sig.add(TS.view.group.groupSwitched,TS.view.group),TS.groups.deleted_sig.add(TS.view.group.groupDeleted,TS.view.group),TS.groups.joined_sig.add(TS.view.group.groupJoined,TS.view.group),TS.groups.member_joined_sig.add(TS.view.group.groupMemberJoined,TS.view.group),TS.groups.left_sig.add(TS.view.group.groupLeft,TS.view.group),TS.groups.member_left_sig.add(TS.view.group.groupMemberLeft,TS.view.group),TS.groups.history_fetched_sig.add(TS.view.group.groupHistoryFetched,TS.view.group),TS.groups.history_being_fetched_sig.add(TS.view.group.groupHistoryBeingFetched,TS.view.group),TS.groups.message_received_sig.add(TS.view.group.groupMessageReceived,TS.view.group),TS.groups.message_removed_sig.add(TS.view.group.groupMessageRemoved,TS.view.group),TS.groups.message_changed_sig.add(TS.view.group.groupMessageChanged,TS.view.group),TS.groups.marked_sig.add(TS.view.group.groupMarked,TS.view.group),TS.groups.unread_changed_sig.add(TS.view.group.groupUnreadCountChanged,TS.view.group),TS.groups.unread_highlight_changed_sig.add(TS.view.group.groupUnreadHighlightCountChanged,TS.view.group),TS.groups.topic_changed_sig.add(TS.view.group.groupTopicChanged,TS.view.group),TS.groups.purpose_changed_sig.add(TS.view.group.groupPurposeChanged,TS.view.group),TS.groups.opened_sig.add(TS.view.group.groupOpened,TS.view.group),TS.groups.closed_sig.add(TS.view.group.groupClosed,TS.view.group),TS.groups.archived_sig.add(TS.view.group.groupArchived,TS.view.group),TS.groups.unarchived_sig.add(TS.view.group.groupUnArchived,TS.view.group),TS.groups.msg_not_sent_sig.add(TS.view.group.groupMsgNotSent,TS.view.group)},groupRenamed:function(){TS.view.updateTitleWithContext();TS.client.ui.rebuildAll(!1)},groupSwitched:function(){TS.view._maybeUpdateOnboarding(),TS.view.switchedHelper(),TS.view.unAdjustForWelcomeSlideShow(),TS.view.updateTitleWithContext(),TS.view.updateTypingText()},groupDeleted:function(){TS.client.channel_pane.rebuild("channels","starred")},groupJoined:function(){TS.client.channel_pane.rebuild("channels","starred")},created_group_overlay_tim:0,groupMemberJoined:function(e){e.id==TS.model.active_group_id&&(TS.client.msg_pane.rebuildChannelMembersList(),e.needs_created_message&&(clearTimeout(TS.view.group.created_group_overlay_tim),TS.view.group.created_group_overlay_tim=setTimeout(function(){e.id==TS.model.active_group_id&&TS.view.overlay.startWithCreatedGroup(e)},1e3)))},groupLeft:function(){TS.client.channel_pane.rebuild("channels","starred")},groupMemberLeft:function(e){e.id==TS.model.active_group_id&&TS.client.msg_pane.rebuildChannelMembersList()},groupHistoryFetched:function(e){e.id==TS.model.active_group_id&&TS.client.ui.afterHistoryFetch(e)},groupHistoryBeingFetched:function(e){if(e.id==TS.model.active_group_id&&(TS.client.msg_pane.updateEndMarker(),(e=TS.groups.getGroupById(TS.model.active_group_id))&&e.msgs.length)){if(TS.model.ms_connected)if(e.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(e.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")}},groupMessageReceived:function(e,t){if(e.id==TS.model.active_group_id){if(!t)return void TS.error("no msg?");if(TS.boot_data.feature_message_replies_inline&&TS.utility.msgs.isMsgReply(t))return void TS.view.addReplyMsg(e,t);if(!TS.utility.msgs.isMsgHidden(t)){var n=_.reject(e.msgs,TS.utility.msgs.isMsgHidden),i=n;if(i.length>1&&TS.utility.msgs.msgMightBeRolledUp(t)&&TS.utility.msgs.msgMightBeRolledUp(i[1])||1==i.length||i[0]!=t){TS.client.msg_pane.rebuildMsgsWithReason("groupMessageReceived",!0)}else TS.view.addMsg(t,e.unread_cnt),TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeClearUnreadDivider(e,t);TS.view.group.group_ui_updated_with_new_msg_sig.dispatch(t)}}},groupMessageRemoved:function(e,t){if(e.id==TS.model.active_group_id)return t?void TS.view.removeMsg(e,t):void TS.error("no msg?")},groupMessageChanged:function(e,t,n){e.id==TS.model.active_group_id&&setTimeout(function(){TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")?t._hidden_reply&&_.includes(n,"subtype")?TS.view.group.groupMessageRemoved(e,t):t._hidden_reply||"thread_broadcast"!==t.subtype||TS.view.group.groupMessageReceived(e,t):TS.view.rebuildMsg(t,n)},0)},groupMarked:function(e){e.id==TS.model.active_group_id&&(TS.client.msg_pane.assignLastReadMsgDiv(e),TS.view.reClassUnreads(e.last_read))},groupUnreadCountChanged:function(e){if(e){var t="."+TS.templates.makeGroupDomId(e),n=$(t);0===e.unread_cnt?n.removeClass("unread mention"):(n.addClass("unread"),e.unread_highlight_cnt>0&&n.addClass("mention")),e._show_in_list_even_though_no_unreads?n.addClass("show_in_list_even_though_no_unreads"):n.removeClass("show_in_list_even_though_no_unreads");var i=n.find(".group_name");i.length&&i.attr("aria-label",TS.templates.builders.makeChannelLinkAriaLabelSafe(e)),t="."+TS.templates.makeUnreadMsgsDomId(e);var a=$(t);0===e.unread_cnt?a.html(e.unread_cnt).addClass("hidden"):e.unread_cnt<10?a.html(e.unread_cnt).removeClass("hidden"):a.html("9+").removeClass("hidden"),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads(),TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(e),TS.client.msg_pane.maybeResetAndAutoScroll(e)}},groupUnreadHighlightCountChanged:function(e){if(e){var t="."+TS.templates.makeUnreadHighlightDomId(e);0===e.unread_highlight_cnt?$(t).html(e.unread_highlight_cnt).addClass("hidden"):e.unread_highlight_cnt<10?$(t).html(e.unread_highlight_cnt).removeClass("hidden"):$(t).html("9+").removeClass("hidden")}},groupTopicChanged:function(e){e&&e.id==TS.model.active_group_id&&TS.client.msg_pane.updateEndMarker()},groupPurposeChanged:function(e){e&&e.id==TS.model.active_group_id&&TS.client.msg_pane.updateEndMarker()},groupOpened:function(){TS.client.msg_pane.rebuildChannelMembersList(),TS.client.channel_pane.rebuild("channels","starred")},groupClosed:function(){TS.client.msg_pane.rebuildChannelMembersList(),TS.client.channel_pane.rebuild("channels","starred")},groupArchived:function(e){TS.client.channel_pane.rebuild("channels","starred"),e.id==TS.model.active_group_id&&TS.client.archives.start()},groupUnArchived:function(e){TS.client.channel_pane.rebuild("channels","starred"),e.id==TS.model.active_group_id&&TS.client.msg_pane.rebuildMsgsWithReason("groupUnArchived")},groupMsgNotSent:function(e,t,n){e.id==TS.model.active_group_id&&TS.view.showUnSentControlsForMsg(t,e,n)}})}()},2682:function(e,t){!function(){"use strict";TS.registerModule("view.im",{im_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function(){TS.ims.opened_sig.add(TS.view.im.imOpened,TS.view.im),TS.ims.closed_sig.add(TS.view.im.imClosed,TS.view.im),TS.ims.switched_sig.add(TS.view.im.imSwitched,TS.view.im),TS.ims.history_fetched_sig.add(TS.view.im.imHistoryFetched,TS.view.im),TS.ims.history_being_fetched_sig.add(TS.view.im.imHistoryBeingFetched,TS.view.im),TS.ims.message_received_sig.add(TS.view.im.imMessageReceived,TS.view.im),TS.ims.message_removed_sig.add(TS.view.im.imMessageRemoved,TS.view.im),TS.ims.message_changed_sig.add(TS.view.im.imMessageChanged,TS.view.im),TS.ims.marked_sig.add(TS.view.im.imMarked,TS.view.im),TS.ims.unread_changed_sig.add(TS.view.im.imUnreadCountChanged,TS.view.im),TS.ims.unread_highlight_changed_sig.add(TS.view.im.imUnreadHighlightCountChanged,TS.view.im),TS.ims.msg_not_sent_sig.add(TS.view.im.imMsgNotsent,TS.view.im)},imOpened:function(){TS.client.msg_pane.rebuildChannelMembersList(),TS.apps.isAppSpaceEnabled()?TS.client.channel_pane.rebuild("ims","starred","apps"):TS.client.channel_pane.rebuild("ims","starred")},imClosed:function(){TS.client.msg_pane.rebuildChannelMembersList(),TS.apps.isAppSpaceEnabled()?TS.client.channel_pane.rebuild("ims","starred","apps"):TS.client.channel_pane.rebuild("ims","starred")},imSwitched:function(){TS.view._maybeUpdateOnboarding(),TS.view.switchedHelper(),TS.newxp.inOnboarding()||TS.view.unAdjustForWelcomeSlideShow(),TS.view.updateTitleWithContext(),TS.view.updateTypingText()},imHistoryFetched:function(e){e.id===TS.model.active_im_id&&TS.client.ui.afterHistoryFetch(e)},imHistoryBeingFetched:function(e){if(e.id===TS.model.active_im_id&&(TS.client.msg_pane.updateEndMarker(),(e=TS.ims.getImById(TS.model.active_im_id))&&e.msgs.length)){if(TS.model.ms_connected)if(e.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(e.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;TS.client.msg_pane.updateEndMarker(),$("html").unbind("mousemove.monkeyScroll")}},imMessageReceived:function(e,t,n){return!n&&TS.model.user&&TS.model.user.is_restricted&&-1===(TS.model.guest_accessible_user_ids||[]).indexOf(e.user)?void TS.members.maybeUpdateMembersUserCanSee().then(function(){TS.view.im.imMessageReceived(e,t,!0)}):(e.is_open||TS.client.channel_pane.rebuild("ims","starred"),e.id===TS.model.active_im_id?t?TS.boot_data.feature_message_replies_inline&&TS.utility.msgs.isMsgReply(t)?void TS.view.addReplyMsg(e,t):void(TS.utility.msgs.isMsgHidden(t)||(1===e.msgs.length||e.msgs[0]!==t?TS.client.msg_pane.rebuildMsgsWithReason("imMessageReceived"):(TS.view.addMsg(t,e.unread_cnt),TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeClearUnreadDivider(e,t)),TS.view.im.im_ui_updated_with_new_msg_sig.dispatch(t))):void TS.error("no msg?"):void 0)},imMessageRemoved:function(e,t){if(e.id===TS.model.active_im_id)return t?void TS.view.removeMsg(e,t):void TS.error("no msg?")},imMessageChanged:function(e,t,n){e.id===TS.model.active_im_id&&setTimeout(function(){TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")?t._hidden_reply&&_.includes(n,"subtype")?TS.view.im.imMessageRemoved(e,t):t._hidden_reply||"thread_broadcast"!==t.subtype||TS.view.im.imMessageReceived(e,t):TS.view.rebuildMsg(t,n)},0)},imMarked:function(e){TS.client.channel_pane.rebuild("ims","starred"),e.id===TS.model.active_im_id&&(TS.client.msg_pane.assignLastReadMsgDiv(e),TS.view.reClassUnreads(e.last_read))},imUnreadCountChanged:function(e){if(e){var t=TS.members.getMemberById(e.user),n="."+TS.templates.makeMemberDomId(t),i=$(n),a="."+TS.templates.makeUnreadHighlightDomId(t);0===e.unread_cnt?(i.removeClass("unread mention"),$(a).html(e.unread_cnt).addClass("hidden")):e.unread_cnt<10?(i.addClass("unread mention"),$(a).html(e.unread_cnt).removeClass("hidden")):(i.addClass("unread mention"),$(a).html("9+").removeClass("hidden"));var s=i.find(".im_name");s.length&&s.attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:t,im:e})),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads(),TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(e),TS.client.msg_pane.maybeResetAndAutoScroll(e)}},imUnreadHighlightCountChanged:function(e){if(e){var t="."+TS.templates.makeUnreadHighlightDomId(e);$(t).html(e.unread_highlight_cnt),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()}},imMsgNotsent:function(e,t,n){e.id===TS.model.active_im_id&&TS.view.showUnSentControlsForMsg(t,e,n)}})}()},2683:function(e,t){!function(){"use strict";TS.registerModule("view.members",{unknown_resolution_rebuild_sig:new signals.Signal,onStart:function(){TS.members.presence_changed_sig.add(TS.view.members.memberPresenceChanged,TS.view.members),TS.members.status_changed_sig.add(TS.view.members.memberStatusChanged,TS.view.members),TS.members.joined_team_sig.add(TS.view.members.memberJoinedTeam,TS.view.members),TS.members.members_for_user_changed_sig.add(TS.view.members.memberChangeVisibilityToUser,TS.view.members),TS.members.changed_name_sig.add(TS.view.members.memberChangedName,TS.view.members),TS.members.changed_real_name_sig.add(TS.view.members.memberChangedRealName,TS.view.members),TS.members.changed_self_sig.add(TS.view.members.somethingChangedOnUser,TS.view.members),TS.members.changed_deleted_sig.add(t,TS.view.members),TS.members.non_loaded_changed_deleted_sig.add(t,TS.view.members),TS.members.changed_profile_sig.add(TS.view.members.memberChangedProfile,TS.view.members),TS.members.changed_current_status_sig.add(TS.view.members.memberChangedCurrentStatus,TS.view.members),TS.members.changed_tz_sig.add(TS.view.members.memberChangedTZ,TS.view.members),TS.members.changed_account_type_sig.add(TS.view.members.memberAccountTypeChanged,TS.view.members),TS.members.changed_admin_perms_sig.add(TS.view.members.memberAdminPermsChanged,TS.view.members),TS.members.changed_owner_perms_sig.add(TS.view.members.memberAdminPermsChanged,TS.view.members),TS.members.changed_is_unknown_sig.add(n),TS.typing.started_sig.add(TS.view.members.memberTypingStarted,TS.view.members),TS.typing.ended_sig.add(TS.view.members.memberTypingEnded,TS.view.members),TS.stars.member_stars_fetched_sig.add(TS.view.members.memberStarsFetched,TS.view.members),TS.view.members.unknown_resolution_rebuild_sig.add(TS.view.members.memberChangedName)},memberPresenceChanged:function(e){if(e){var t,n,i;if(e.is_self){TS.model.ms_connected&&TS.view.ms.maybeChangeConnectionDisplay();var a=$("#menu").find("#member_presence").find(".menu_item_label");"away"===e.presence?a.text(TS.i18n.t("[Away] Set yourself to active","view_members")()):a.text(TS.i18n.t("Set yourself away","view_members")())}else t="."+TS.templates.makeMemberDomId(e),n=$(t).not(".call_icon"),"away"===e.presence?n.addClass("away"):n.removeClass("away");t="."+TS.templates.makeMemberPresenceDomClass(e.id),i=TS.templates.makeMemberPresenceStateClass(e);var s="active"===e.presence?TS.i18n.t("active","view_members")():TS.i18n.t("away","view_members")();$(t).removeClass("away active dnd").addClass(i).attr("title",s);var r=TS.ims.getImByMemberId(e.id);r&&$(t).closest(".im_name").attr("aria-label",TS.templates.builders.makeMemberLinkAriaLabelSafe({member:e,im:r})),TS.view.last_team_list_html=null}},memberStatusChanged:function(e){if(e){e.is_self&&$(".user_status_label").text(e.status||"");var t="."+TS.templates.makeMemberStatusDomClass(e.id);$(t).html(e.status?e.status:"-"),TS.view.updateTeamListCache()}},memberJoinedTeam:function(){TS.view.rebuildTeamList(!0)},member_changed_visibility_to_user_tim:0,memberChangeVisibilityToUser:function(){clearTimeout(TS.view.members.member_changed_visibility_to_user_tim),TS.view.members.member_changed_visibility_to_user_tim=setTimeout(function(){TS.client.channel_pane.rebuild("ims","starred","apps"),TS.view.rebuildTeamList(!0)},1e3)},memberChangedName:function(e){e.id==TS.model.user.id&&(TS.view.members.updateUserDisplayName(),TS.prefs.setHighlightWords(TS.model.prefs.highlight_words)),TS.view.updateTitleWithContext();TS.client.ui.rebuildAll(!1,!0),TS.view.rebuildTeamMember(e),e.id==TS.model.previewed_member_id&&TS.client.ui.previewMember(e.id)},memberChangedRealName:function(){TS.view.rebuildTeamList(!0)},somethingChangedOnUser:function(){TS.view.showProperTeamPaneFiller()},memberChangedProfile:function(e){var t=[];if(!TS.members.is_in_bulk_upsert_mode){var n=TS.shared.getActiveModelOb(),i=n.is_im&&n.user===e.id||n.is_mpim&&n.members.indexOf(e.id)>-1,a=_.map(TS.model.ims,"user").indexOf(e.id)>-1,s=e.id===TS.model.user.id,r={channel_header:!i,user_current_status:!s,channel_pane_channels:!0,channel_pane_apps:!0,channel_pane_ims:!a,channel_pane_starred:!a};TS.client.ui.rebuildAllButMsgs(!1,r,!0),TS.view.rebuildMsgsIncludingMember(e),TS.client.ui.threads.rebuildMsgsIncludingMember(e),TS.ui.replies.rebuildMsgsIncludingMember(e),TS.client.unread.isEnabled()&&TS.client.ui.unread.rebuildMsgsIncludingMember(e)}e.id==_.get(TS.model.user,"id")&&(TS.view.members.updateUserDisplayName(),t.push("url("+e.profile.image_72+")"),$('a[data-member-id="'+TS.model.user.id+'"] .member_image, a[data-member-id="'+TS.model.user.id+'"].member_image').attr("style","background-image: "+t.join(",")),$('#menu a[data-member-id="'+TS.model.user.id+'"].member_image').attr("style","background-image: "+TS.templates.builders.makeMemberPreviewCardLinkImageBackground(TS.model.user.id))),TS.view.rebuildTeamMember(e),e.id==TS.model.previewed_member_id&&TS.client.ui.previewMember(e.id)},memberChangedCurrentStatus:function(e){if(!TS.members.is_in_bulk_upsert_mode){var t=TS.shared.getActiveModelOb(),n=t.is_im&&t.user===e.id||t.is_mpim&&t.members.indexOf(e.id)>-1,i=_.map(TS.model.ims,"user").indexOf(e.id)>-1,a=e.id===TS.model.user.id,s={channel_header:!n,user_current_status:!a,channel_pane_channels:!0,channel_pane_apps:!0,channel_pane_ims:!i,channel_pane_starred:!i};TS.client.ui.rebuildAllButMsgs(!1,s,!0),TS.view.rebuildMsgCurrentStatusIncludingMember(e),TS.client.ui.threads.rebuildMsgCurrentStatusIncludingMember(e),TS.ui.replies.rebuildMsgCurrentStatusIncludingMember(e),TS.client.ui.flex.rebuildMsgCurrentStatusIncludingMember(e),TS.client.ui.unread.rebuildMsgCurrentStatusIncludingMember(e),$(".team_list_item.member_item .current_status.color_"+e.id).replaceWith(TS.templates.current_status({member:e}));var r=TS.templates.current_status({member:e,classes:"ts_tip_float"});$(".member_info .current_status.color_"+e.id).replaceWith(r),$("#channel_page_member_"+e.id+" .current_status").replaceWith(r)}e.id==TS.model.user.id&&TS.view.members.updateUserCurrentStatus(),TS.view.rebuildTeamMember(e),e.id==TS.model.previewed_member_id&&TS.client.ui.previewMember(e.id)},memberChangedTZ:function(e){TS.client.ui.rebuildAll(!1,!0),TS.view.rebuildTeamMember(e),e.id==TS.model.previewed_member_id&&TS.client.ui.previewMember(e.id)},member_account_changed_tim:0,memberAccountTypeChanged:function(e){e&&e.id==TS.model.user.id||(clearTimeout(TS.view.members.member_account_changed_tim),TS.view.members.member_account_changed_tim=setTimeout(function(){TS.view.rebuildTeamList(!0),e.id==TS.model.previewed_member_id&&TS.client.ui.previewMember(e.id)},1e3))},memberAdminPermsChanged:function(e){e&&e.id==TS.model.user.id&&TS.ui.admin_invites.maybeShowInviteLink(),$("#team_list_admin_link").toggleClass("hidden",!e.is_admin),TS.model.previewed_member_id===e.id&&TS.client.ui.previewMember(e.id)},updateUserDisplayName:function(){$(".current_user_name").html(TS.members.getPrefCompliantMemberName(TS.model.user,!0))},updateUserCurrentStatus:function(){$(".current_user_current_status").replaceWith(TS.templates.current_status({member:TS.model.user,tip_direction:"bottom",classes:"current_user_current_status ts_tip_float"}))},getUserPresenceStr:function(){var e=TS.model.user;return"away"===e.manual_presence?e.presence+" "+TS.i18n.t("(manual)","view_members")():e.presence},memberTypingStarted:function(e,t){if(TS.model.prefs.show_typing){var n=TS.shared.getActiveModelOb();if(n&&e.id==n.id&&TS.view.updateTypingText(),!t.is_self){var i=TS.view.members.getSelectorForTypingIndicator(e,t);i&&$(i).addClass("typing")}}},memberTypingEnded:function(e,t){var n=TS.shared.getActiveModelOb();n&&e.id==n.id&&TS.view.updateTypingText();var i=TS.view.members.getSelectorForTypingIndicator(e,t);i&&$(i).removeClass("typing")},getSelectorForTypingIndicator:function(e,t){var n,i=TS.shared.getActiveModelOb();return e.is_im?n=".channels_list_holder ul li."+TS.templates.makeMemberDomId(t):i&&e.id===i.id&&(n="#"+TS.templates.makeChannelListDomId(e)+" ."+TS.templates.makeMemberDomId(t)),n},memberStarsFetched:function(e,t){TS.view.toggleStarsError(!!e),e||t&&t.is_self&&TS.view.rebuildStars()}});var e=!1,t=function(t){if(!e){var n=TS.shared.getActiveModelOb();if(n){if(!TS.membership.lazyLoadChannelMembership()){var i=t.id||t;if(!TS.membership.getUserChannelMembershipStatus(i,n).is_member)return}e=!0,TS.utility.rAF(function(){e=!1,TS.client.channel_pane.rebuild("ims","starred","apps"),TS.client.msg_pane.rebuildChannelMembersList(),TS.view.rebuildTeamList(!0)})}}},n=function(e){$(".unknown_member").length>0&&TS.view.members.unknown_resolution_rebuild_sig.dispatch(e)}}()},2684:function(e,t){!function(){"use strict";TS.registerModule("view.mpim",{mpim_ui_updated_with_new_msg_sig:new signals.Signal,onStart:function(){TS.mpims.switched_sig.add(TS.view.mpim.mpimSwitched,TS.view.mpim),TS.mpims.history_fetched_sig.add(TS.view.mpim.mpimHistoryFetched,TS.view.mpim),TS.mpims.history_being_fetched_sig.add(TS.view.mpim.mpimHistoryBeingFetched,TS.view.mpim),TS.mpims.message_received_sig.add(TS.view.mpim.mpimMessageReceived,TS.view.mpim),TS.mpims.message_removed_sig.add(TS.view.mpim.mpimMessageRemoved,TS.view.mpim),TS.mpims.message_changed_sig.add(TS.view.mpim.mpimMessageChanged,TS.view.mpim),TS.mpims.joined_sig.add(TS.view.mpim.mpimJoined,TS.view.mpim),TS.mpims.opened_sig.add(TS.view.mpim.mpimOpened,TS.view.mpim),TS.mpims.closed_sig.add(TS.view.mpim.mpimClosed,TS.view.mpim),TS.mpims.marked_sig.add(TS.view.mpim.mpimMarked,TS.view.mpim),TS.mpims.unread_changed_sig.add(TS.view.mpim.mpimUnreadCountChanged,TS.view.mpim),TS.mpims.unread_highlight_changed_sig.add(TS.view.mpim.mpimUnreadHighlightCountChanged,TS.view.mpim),TS.mpims.msg_not_sent_sig.add(TS.view.mpim.mpimMsgNotsent,TS.view.mpim)},mpimSwitched:function(){TS.view._maybeUpdateOnboarding();var e=!TS.model.ms_logged_in_once;TS.view.switchedHelper(e),TS.newxp.inOnboarding()||TS.view.unAdjustForWelcomeSlideShow(),TS.view.updateTitleWithContext(),TS.view.updateTypingText()},mpimHistoryFetched:function(e){e.id===TS.model.active_mpim_id&&TS.client.ui.afterHistoryFetch(e)},mpimHistoryBeingFetched:function(e){if(e.id===TS.model.active_mpim_id&&(TS.client.msg_pane.updateEndMarker(),(e=TS.mpims.getMpimById(TS.model.active_mpim_id))&&e.msgs.length)){if(TS.model.ms_connected)if(e.history_changed)TS.model.ui.last_top_msg=null;else{var t=TS.utility.msgs.getDisplayedMsgs(e.msgs);TS.model.ui.last_top_msg=t[t.length-1]}else TS.model.ui.last_top_msg=null;$("html").unbind("mousemove.monkeyScroll")}},mpimMessageReceived:function(e,t){if(e.is_open||TS.client.channel_pane.rebuild("ims","starred"),e.id===TS.model.active_mpim_id)return t?TS.boot_data.feature_message_replies_inline&&TS.utility.msgs.isMsgReply(t)?void TS.view.addReplyMsg(e,t):void(TS.utility.msgs.isMsgHidden(t)||(1===e.msgs.length||e.msgs[0]!==t?TS.client.msg_pane.rebuildMsgsWithReason("mpimMessageReceived"):(TS.view.addMsg(t,e.unread_cnt),TS.client&&TS.client.msg_pane&&TS.client.msg_pane.maybeClearUnreadDivider(e,t)),TS.view.mpim.mpim_ui_updated_with_new_msg_sig.dispatch(t))):void TS.error("no msg?")},mpimMessageRemoved:function(e,t){if(e.id===TS.model.active_mpim_id)return t?void TS.view.removeMsg(e,t):void TS.error("no msg?")},mpimMessageChanged:function(e,t,n){e.id===TS.model.active_mpim_id&&setTimeout(function(){TS.boot_data.feature_new_broadcast&&_.includes(n,"_hidden_reply")?t._hidden_reply&&_.includes(n,"subtype")?TS.view.mpim.mpimMessageRemoved(e,t):t._hidden_reply||"thread_broadcast"!==t.subtype||TS.view.mpim.mpimMessageReceived(e,t):TS.view.rebuildMsg(t,n)},0)},mpimJoined:function(){TS.client.channel_pane.rebuild("ims","starred")},mpimOpened:function(){TS.client.channel_pane.rebuild("ims","starred")},mpimClosed:function(){TS.client.channel_pane.rebuild("ims","starred")},mpimMarked:function(e){TS.client.channel_pane.rebuild("ims","starred"),e.id===TS.model.active_mpim_id&&(TS.client.msg_pane.assignLastReadMsgDiv(e),TS.view.reClassUnreads(e.last_read))},mpimUnreadCountChanged:function(e){if(e){$("#im-list, #starred-list").find("."+TS.templates.makeMpimDomId(e)).replaceWith(TS.templates.mpim({model_ob:e})),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads(),TS.client.msg_pane.maybeInsertUnreadDividerAndNewMsgsBar(e),TS.client.msg_pane.maybeResetAndAutoScroll(e)}},mpimUnreadHighlightCountChanged:function(){},mpimMsgNotsent:function(e,t,n){e.id===TS.model.active_mpim_id&&TS.view.showUnSentControlsForMsg(t,e,n)}})}()},2685:function(e,t){!function(){"use strict";TS.registerModule("view.ms",{onStart:function(){TS.isSocketManagerEnabled()?(TS.interop.SocketManager.troubleConnectingSig.add(TS.view.ms.socketTroubled,TS.view.ms),TS.interop.SocketManager.waitingForRateLimitSig.add(TS.view.ms.socketReconnecting,TS.view.ms),TS.interop.SocketManager.connectedSig.add(TS.view.ms.socketConnected,TS.view.ms),TS.interop.SocketManager.disconnectedSig.add(TS.view.ms.socketDisconnected,TS.view.ms)):(TS.ms.connected_sig.add(TS.view.ms.socketConnected,TS.view.ms),TS.ms.trouble_sig.add(TS.view.ms.socketTroubled,TS.view.ms),TS.ms.disconnected_sig.add(TS.view.ms.socketDisconnected,TS.view.ms),TS.ms.reconnecting_sig.add(TS.view.ms.socketReconnecting,TS.view.ms))},ever_connected:!1,socketConnected:function(e){var t=!!TS.view.ms.ever_connected;if(TS.view.ms.ever_connected){TS.utility.msgs.removeAllEphemeralMsgsByType("disconnected_feedback");if(TS.client.ui.rebuildAllButMsgs(!0),TS.client.ui.rebuildMemberListToggle(),TS.mentions.maybeUpdateMentions(),e){var i=TS.shared.getActiveModelOb();i&&TS.shared.maybeDealWithAllSentTempMsgs(i,TS.shared.getControllerForModelOb(i))}}else TS.metrics.getLatestMark("start_load")&&TS.metrics.measure("client_load","start_load"),"chunked"===TS.boot_data.http_chunk_head_bucket?TS.metrics.measure("client_load_with_chunking_v2","start_nav"):"control"===TS.boot_data.http_chunk_head_bucket&&TS.metrics.measure("client_load_without_chunking_v2","start_nav"),TS.metrics.measure("client_total_load","start_nav"),TS.metrics.logPerfTimingSections(),n();TS.view.ms.ever_connected=!0,TS.client.msg_input.setOnline(),TS.info("Hiding the reconnection banner because we are connected"),s(),$("#connection_div").html("").addClass("hidden"),TS.client.msg_pane.topMessagesBannerHidden(),TS.view.ms.changeConnectionStatus("online"),TS.view.prefs.toggleSpellcheck(),TS.view.checkIfInputShouldBeDisabledAndPopulate(t),TS.ui.a11y.annouceCurrentChannelOrImOrGroup()},socketTroubled:function(){TS.view.ms.changeConnectionStatus("trouble"),TS.client.msg_input.setOffline(),TS.info("Hiding the reconnection banner because we are troubled"),s()},socketDisconnected:function(){TS.view.ms.changeConnectionStatus("offline"),TS.client.msg_input.setOffline(),TS.info("Hiding the reconnection banner because we are disconnected"),s()},socketReconnecting:function(e){TS.model.window_unloading?(TS.info("Hiding the reconnection banner because we are unloading"),s(),$("#connection_div").html("").addClass("hidden"),TS.client.msg_pane.topMessagesBannerHidden()):$("#connection_div").hasClass("hidden")?i(e):a(e)},current_connection_status:null,changeConnectionStatus:function(e){TS.view.ms.current_connection_status=e,TS.view.maybeChangeFavIco(),TS.view.ms.maybeChangeConnectionDisplay()},maybeChangeConnectionDisplay:function(){var e,t=$("#presence"),n="";switch(TS.view.ms.current_connection_status){case"online":TSSSB.call("setConnectionStatus","online"),"away"===TS.model.user.presence?(e=TS.dnd.isMemberInDnd(TS.model.user)?TS.i18n.t('Away<br><span class="greigh">Notifications snoozed</span>',"ms")():TS.i18n.t("Away","ms")(),n="away"):(e=TS.dnd.isMemberInDnd(TS.model.user)?TS.i18n.t('Active<br><span class="greigh">Notifications snoozed</span>',"ms")():TS.i18n.t("Active","ms")(),n="active"),TS.dnd.isMemberInDnd(TS.model.user)&&(n+=" dnd");break;case"trouble":TSSSB.call("setConnectionStatus","connecting"),e=TS.i18n.t("Connecting...","ms")(),n="connecting";break;default:TSSSB.call("setConnectionStatus","offline"),e=TS.i18n.t("away","ms")(),n="Away"}TS.tips.updateTipTitle($("#presence_container"),e),t.removeClass("active away connecting dnd"),t.addClass(n)}});var e,t,n=function(){var e=Array.prototype.slice.call(document.getElementsByTagName("style")),t=Array.prototype.slice.call(document.getElementsByTagName("link")),n=Array.prototype.slice.call(document.getElementsByTagName("script")),i=n.filter(function(e){return!e.src&&"text/x-handlebars-template"!==e.type}),a=n.filter(function(e){return!!e.src}),s=n.filter(function(e){return!e.src&&"text/x-handlebars-template"===e.type});t=t.filter(function(e){return"stylesheet"===e.rel}),TS.metrics.store("inline_script_nodes",i.length,{is_count:!0}),TS.metrics.store("inline_template_nodes",s.length,{is_count:!0}),TS.metrics.store("inline_style_nodes",e.length,{is_count:!0}),TS.metrics.store("external_script_nodes",a.length,{is_count:!0}),TS.metrics.store("external_link_nodes",t.length,{is_count:!0})},i=function(n){if(t=n,!e)return 1e3*n>1e4?void a(n):void(e=setTimeout(function(){e=void 0,TS.model.ms_connected||a(t)},1e4))},a=function(e){if(s(),TS.api.isPaused()&&!$("#connection_div").hasClass("hidden"))return void TS.info("Not showing reconnecting banner because API is paused and showing its own banner");var t=TS.i18n.t("Reconnecting...","ms")();e&&(t=TS.i18n.t("Reconnecting in {num_secs, plural, =1 {# second} other {# seconds...}}","ms")({num_secs:e}),e>2&&(t+=' <a onclick="TS.client.manualReconnectNow()">'+TS.i18n.t("Retry now?","ms")()+"</a>")),$("#connection_div").html(t).removeClass("hidden"),TS.client.msg_pane.topMessagesBannerShown()},s=function(){e&&(clearTimeout(e),e=void 0)}}()},2686:function(e,t){!function(){"use strict";TS.registerModule("view.overlay",{onStart:function(){e=$("#msgs_overlay_div"),$(window.document).keydown(function(e){TS.model.overlay_is_showing&&(e.which!=TS.utility.keymap.enter&&e.which!=TS.utility.keymap.esc||(n?n():r(!0)))})},startWithJoinedSharedChannel:function(e){$("#col_messages").append("<div class='shared_channels_join_modal_overlay transparent'></div>");var t=$(".shared_channels_join_modal_overlay");t.html(TS.templates.channel_shared_join_overlay({channel:e,source_team:TS.model.team,inviter:TS.members.getMemberById(e.inviter),shared_team:TS.teams.getTeamById(e.shared_team_ids[0])})),TS.utility.rAF(function(){t.removeClass("transparent"),TS.client.ui.$msgs_div.addClass("hide_day_divider_labels")});var n=function(){t.addClass("transparent"),TS.client.ui.$msgs_div.removeClass("hide_day_divider_labels"),t.on("transitionend",function(){t.remove()})};t.find("button").on("click",function(){e.needs_invited_message=!1,n()}),TS.channels.switched_sig.add(n)},startWithJoinedChannel:function(a){s(),t=!0,e.html(TS.templates.channel_join_overlay({invited:!1,channel:a})),n=function(){a.needs_joined_message=!1,r(!0),n=null},i($("#channel_joined"))},startWithInvitedChannel:function(a){s(),t=!0;var o={invited:!0,channel:a};TS.boot_data.page_needs_enterprise&&a.is_shared&&(a.is_global_shared?o.teams_shared_with=TS.model.enterprise_teams:o.teams_shared_with=_.map(a.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)})),e.html(TS.templates.channel_join_overlay(o)),n=function(){a.needs_invited_message=!1,r(!0),n=null},i($("#channel_joined"))},startWithCreatedChannel:function(a){s(),t=!0;var o={channel:a,name_for_url:a.id};TS.boot_data.page_needs_enterprise&&a.is_shared&&(a.is_global_shared?o.teams_shared_with=TS.model.enterprise_teams:o.teams_shared_with=_.map(a.shared_team_ids,function(e){return TS.enterprise.getTeamById(e)})),e.html(TS.templates.channel_create_overlay(o)),n=function(){a.needs_created_message=!1,r(!0),n=null},e.find("a.invite_link").bind("click.invite_and_clear_overlay",function(e){TS.ui.channel_invite_modal.startInviteToChannelModal(a.id),n(e)}),i($("#channel_created"))},startWithInvitedGroup:function(a){s(),t=!0,e.html(TS.templates.group_join_overlay({invited:!0,group:a})),n=function(){a.needs_invited_message=!1,r(!0),n=null},i($("#group_joined"))},startWithCreatedGroup:function(a){s(),t=!0,e.html(TS.templates.group_create_overlay({group:a,name_for_url:a.id})),$(window).trigger("resize"),n=function(){a.needs_created_message=!1,r(!0),n=null},i($("#group_created"))},startWithGrowlPromptDisplay:function(){s(),t=!0;var n=e;n.html(TS.templates.growl_prompt_overlay({})),n.find(".prompt_allow").bind("click",a),n.find(".prompt_cancel_forever").bind("click",function(){window.createCookie("no_growl_prompt","1",3650),$("#growl_prompt_div").addClass("hidden"),r()}),n.find(".see-apps").bind("click",function(){window.createCookie("no_growl_prompt","1",.5),$("#growl_prompt_div").addClass("hidden"),r()}),n.find(".prompt_cancel").bind("click",function(){$("#growl_prompt_div").addClass("hidden"),r()}),n.find(".prompt_test").bind("click",function(){$("#growl_prompt_div").addClass("hidden"),TS.sounds.play("new_message"),TS.ui.growls.showTestNotification(TS.i18n.t("A Notification from Slack","prefs")(),TS.i18n.t("What do you know? It works.","prefs")())}),TS.ui.growls.no_notifications?$("#growl_prompt_overlay_impossible").removeClass("hidden"):$("#growl_prompt_overlay_start").removeClass("hidden")},fadeInAndOut:function(){s(),r()},cancelFromSendingMessage:function(){TS.model.overlay_is_showing&&(n?n():r(!0))}});var e=null,t=!1,n=null,i=function(t){e.find("a.btn").bind("click.clear_overlay",n),t.wrap('<div id="overlay_wrapper">'),$("#overlay_wrapper").monkeyScroll()},a=function(){$("#growl_prompt_overlay_start").addClass("hidden"),$("#growl_prompt_overlay_tell_to_allow").removeClass("hidden"),TS.ui.growls.promptForPermission(function(e,t){$("#growl_prompt_overlay_tell_to_allow").addClass("hidden"),"granted"===t&&e?($("#growl_prompt_overlay_success").removeClass("hidden"),TS.prefs.setPrefByAPI({name:"growls_enabled",value:!0})):"default"===t?$("#growl_prompt_overlay_start").removeClass("hidden"):"denied"===t?$("#growl_prompt_overlay_disallowed").removeClass("hidden"):alert("huh allowed:"+e+" permission_level:"+t)})},s=function(t){TS.model.overlay_is_showing||(e.stop(),e.empty(),e.removeClass("hidden"),TS.client.ui.$msgs_div.addClass("hide_day_divider_labels"),t?(e.css("opacity",0),e.transition({opacity:1},250)):e.css("opacity",1),TS.model.overlay_is_showing=!0)},r=function(n){var i=TS.model.overlay_is_showing;TS.model.overlay_is_showing=!1;var a=e.find("#no_joined_overlays_cb");a.length&&a.prop("checked")&&TS.prefs.setPrefByAPI({name:"no_joined_overlays",value:!0});var s=e.find("#no_created_overlays_cb");s.length&&s.prop("checked")&&TS.prefs.setPrefByAPI({name:"no_created_overlays",value:!0}),TS.client.ui.$msgs_div.removeClass("hide_day_divider_labels"),e.transition({opacity:0},250,function(){o()}),t&&(t=!1,TS.view.showInterstitialAfterChannelOrImShown()),i&&n&&TS.client.msg_pane.checkUnreads()},o=function(){e.addClass("hidden"),TS.model.overlay_is_showing=!1}}()},2687:function(e,t){!function(){"use strict";TS.registerModule("view.prefs",{onStart:function(){TS.prefs.webapp_spellcheck_changed_sig.add(TS.view.prefs.toggleSpellcheck,TS.view.prefs),TS.prefs.highlight_words_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.highlight_words_changed_sig"),TS.view.prefs),TS.prefs.emoji_mode_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs),TS.boot_data.feature_name_tagging_client||TS.prefs.team_require_at_for_mention_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs),TS.prefs.expand_inline_imgs_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_inline_imgs_changed_sig"),TS.view.prefs),TS.prefs.expand_internal_inline_imgs_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_internal_inline_imgs_changed_sig"),TS.view.prefs),TS.prefs.expand_non_media_attachments_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.expand_non_media_attachments_changed_sig"),TS.view.prefs),TS.prefs.obey_inline_img_limit_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.obey_inline_img_limit_changed_sig"),TS.view.prefs),TS.prefs.messages_theme_changed_sig.add(TS.ui.setThemeClasses,TS),TS.prefs.dtop_notif_changed_sig.add(TS.view.prefs.dTopNotificationChanged,TS.view.prefs),TS.prefs.muted_channels_changed_sig.add(TS.view.prefs.mutedChannelsChanged,TS.view.prefs),TS.prefs.sidebar_behavior_changed_sig.add(TS.view.prefs.sidebarBehaviorPrefChanged,TS.view.prefs),TS.prefs.team_hide_referers_changed_sig.add(TS.client.msg_pane.rebuildMsgsWithReason.bind(null,"TS.prefs.team_hide_referers_changed_sig"),TS.view.prefs),TS.prefs.team_perms_pref_changed_sig.add(TS.view.prefs.teamPermsPrefChanged,TS.view.prefs),TS.prefs.display_real_names_override_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs),TS.prefs.team_display_real_names_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs),TS.prefs.time24_changed_sig.add(TS.view.prefs.time24PrefChanged,TS.view.prefs),TS.prefs.sidebar_theme_changed_sig.add(TS.view.prefs.sidebarThemePrefChanged,TS.view.prefs),TS.prefs.mentions_exclude_at_channels_changed_sig.add(TS.view.prefs.rebuildMentionOptions,TS.view.prefs),TS.prefs.mentions_exclude_at_user_groups_changed_sig.add(TS.view.prefs.rebuildMentionOptions,TS.view.prefs),TS.boot_data.feature_prev_next_button?(TS.prefs.prev_next_btn_changed_sig.add(TS.client.channel_pane.rebuildFooter,TS.view.prefs),TS.prefs.no_omnibox_in_channels_changed_sig.add(TS.client.channel_pane.rebuildFooter,TS.view.prefs)):(TS.prefs.no_omnibox_in_channels_changed_sig.add(TS.client.channel_pane.updateQuickSwitcherBtnVisibility,TS.view.prefs),TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.add(e,TS.view.prefs)),TS.prefs.separate_private_channels_changed_sig.add(t),TS.prefs.team_display_email_addresses_changed_sig.add(TS.view.prefs.farReachingDisplayPrefChanged,TS.view.prefs),TS.prefs.hide_hex_swatch_changed_sig.add(TS.view.prefs.hideHexSwatchPrefChanged,TS.view.prefs)},toggleSpellcheck:function(){var e="textarea";TS.utility.contenteditable.supportsTexty()&&(e+=', [contenteditable="true"]'),$(e).attr("autocorrect","off"),$(e).attr("autocomplete","off"),TS.model.prefs.webapp_spellcheck?$(e).attr("spellcheck",!0):$(e).attr("spellcheck",!1)},farReachingDisplayPrefChanged:function(){TS.client.msg_pane.rebuildMsgsWithReason("farReachingDisplayPrefChanged",!0),TS.search.view.renderResults(),TS.view.rebuildMentions(),TS.view.rebuildStars(),TS.view.files.throttledRebuildList(),TS.view.members.updateUserDisplayName(),TS.view.members.updateUserCurrentStatus(),TS.client.channel_pane.rebuild("ims","starred"),TS.client.msg_pane.displayTitle(),TS.client.msg_pane.rebuildChannelMembersList(),TS.view.rebuildPreviewedMember(),TS.members.shouldDisplayRealNames()?$("#col_channels").addClass("real_names"):$("#col_channels").removeClass("real_names"),TS.model.previewed_file_id&&TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},dTopNotificationChanged:function(){TS.utility.msgs.reCalcAndCountAllUnreads(),TS.client.channel_pane.rebuild("starred","channels")},mutedChannelsChanged:function(){TS.model.newly_unmuted_channels&&TS.model.newly_unmuted_channels.length?(TS.log(389,"mutedChannelsChanged: recalculating unreads for newly-unmuted channel(s): "+TS.model.newly_unmuted_channels.join(", ")),TS.utility.msgs.reCalcAndCountSomeUnreads(TS.model.newly_unmuted_channels)):TS.log(389,"mutedChannelsChanged: No newly-unmuted channels, no need to recalculate unreads."),TS.model.newly_muted_channels=[],TS.model.newly_unmuted_channels=[],TS.client.channel_pane.rebuild("starred","channels","ims"),TS.client.msg_pane.displayTitle()},sidebarBehaviorPrefChanged:function(){TS.utility.msgs.reCalcAndCountAllUnreads()},teamPermsPrefChanged:function(e){"who_can_at_channel"!==e&&"who_can_at_everyone"!==e&&"who_can_post_general"!==e||TS.utility.msgs.reCalcAndCountAllUnreads(),"who_can_edit_user_groups"!==e&&"who_can_create_delete_user_groups"!==e||TS.view.userGroupPrefUpdated(),TS.client.channel_pane.rebuild("channels","starred"),TS.view.checkIfInputShouldBeDisabledAndPopulate()},time24PrefChanged:function(){TS.client.msg_pane.rebuildMsgsWithReason("time24PrefChanged"),TS.search.view.renderResults(),TS.view.rebuildMentions(),TS.view.rebuildStars(),TS.view.files.throttledRebuildList(),TS.client.channel_pane.rebuild("ims","starred"),TS.model.previewed_file_id&&TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},hideHexSwatchPrefChanged:function(){TS.client.msg_pane.rebuildMsgsWithReason("hideHexSwatchPrefChanged"),TS.search.view.renderResults(),TS.view.rebuildMentions(),TS.view.rebuildStars(),TS.model.previewed_file_id&&TS.client.ui.files.rebuildFilePreview(TS.files.getFileById(TS.model.previewed_file_id))},sidebarThemePrefChanged:function(e){if(e=!1!==e,TS.model.prefs.sidebar_theme){if(TS.prefs.last_theme_selected_in_UI&&TS.model.prefs.sidebar_theme!==TS.prefs.last_theme_selected_in_UI)return;TS.prefs.last_theme_selected_in_UI&&e&&(TS.prefs.last_theme_selected_in_UI=null,TS.model.prefs.sidebar_theme_custom_values=TS.sidebar_themes.default_themes[TS.model.prefs.sidebar_theme]),"arctic_theme"===TS.model.prefs.sidebar_theme&&(TS.model.prefs.sidebar_theme="hoth_theme");var t=$("#client-ui"),n=t[0],i=n.className.split(" ").filter(function(e){return 0!==e.lastIndexOf("sidebar_theme_",0)});n.className=i.join(" "),t.addClass("sidebar_theme_"+TS.model.prefs.sidebar_theme)}if("default"===TS.model.prefs.sidebar_theme||"default_theme"===TS.model.prefs.sidebar_theme||"basic_theme"===TS.model.prefs.sidebar_theme)$("#sidebar_theme_css").remove();else if(TS.model.prefs.sidebar_theme_custom_values){var a=JSON.parse(TS.model.prefs.sidebar_theme_custom_values);TS.environment.supports_custom_scrollbar&&_.forEach(a,function(e,t){a[t+"_rgb"]=TS.utility.hex2rgb(e)});var s=TS.templates.sidebar_theme_css({theme:a});$("#sidebar_theme_css").length?$("#sidebar_theme_css").replaceWith(s):$("head").append(s)}TS.view.updateTitleBarColor(),TSSSB.call("refreshTileColors")},rebuildMentionOptions:function(){var e,t=TS.model.prefs.mentions_exclude_at_channels,n=TS.model.prefs.mentions_exclude_at_user_groups;e=t&&n?TS.i18n.t("mentions and reactions, no {at_label} or User Groups","prefs")({at_label:TS.templates.builders.atLabel("channel")}):!t&&n?TS.i18n.t("mentions, reactions, and {at_label} mentions","prefs")({at_label:TS.templates.builders.atLabel("channel")}):t&&!n?TS.i18n.t("mentions, reactions, and User Group mentions","prefs")():TS.i18n.t("everything","prefs")();var i=TS.templates.mentions_options({include_text:e});$("#mentions_options").html(i),$(".mentions_filter_menu_target").click(TS.menu.startWithMentionsFilter)},userGroupPrefUpdated:function(){var e=$("#user_group_edit.tab_action"),t=TS.permissions.members.canEditUserGroups(),n=TS.permissions.members.canCreateAndDeleteUserGroups();$('[data-action="admin_user_groups_modal"]').toggleClass("hidden",t),$('[data-action="admin_user_groups_modal_new"]').toggleClass("hidden",n),e.toggleClass("hidden",!(t||n))}});var e=function(){5!==TS.model.prefs.k_key_omnibox_auto_hide_count||TS.model.prefs.no_omnibox_in_channels||(TS.prefs.setPrefByAPI({name:"no_omnibox_in_channels",value:!0}),TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"keyboard_shortcut",action:"button_hidden"}))},t=function(){TS.client.channel_pane.rebuild("starred","channels")}}()},2688:function(e,t){!function(){"use strict";TS.registerModule("view",{file_list_heading:TS.i18n.t("All File Types","view")(),file_list_lazyload:null,members_list_lazyload:null,user_groups_members_list_lazyload:null,member_stars_list_lazyload:null,last_attachment_max_width:null,resize_sig:new signals.Signal,onStart:function(){if(TS.view.rebuildMentionsImmediately=TS.view.rebuildMentions,TS.view.rebuildMentions=TS.utility.throttleFunc(TS.view.rebuildMentions,1e3,!0),TS.view.rebuildTeamList=TS.utility.throttleFunc(TS.view.rebuildTeamListThrottled,1e3,!0),TS.view.maybeRebuildUserGroupList=TS.utility.throttleFunc(TS.view.rebuildUserGroupList,1e3),TS.client.login_sig.add(TS.view.loggedIn,TS.view),TS.channels.read_only.list_updated_sig.add(TS.view.checkIfInputShouldBeDisabledAndPopulate),TS.user_groups.updated_sig.add(TS.view.userGroupUpdated,TS.view),TS.members.view.team_filter_changed_sig.add(function(){TS.view.maybeRebuildUserGroupList()},TS.view),TS.bots.added_sig.add(TS.view.botChanged,TS.view),TS.bots.changed_name_sig.add(TS.view.botChanged,TS.view),TS.bots.changed_icons_sig.add(TS.view.botChanged,TS.view),TS.ui.window_unloaded_sig.add(TS.view.windowUnloaded,TS.view),TS.client.flexpane_display_switched_sig.add(TS.view.flexpaneDisplaySwitched,TS.view),TS.client.ui.file_dropped_sig.add(TS.view.filesDropped),TS.client.ui.file_pasted_sig.add(TS.view.filePasted),TS.team.team_plan_changed_sig.add(TS.view.teamPlanChanged,TS.view),TS.team.team_profile_changed_sig.add(TS.view.teamProfileChanged,TS.view),TS.mentions.mentions_fetched_sig.add(TS.view.mentionsFetched,TS.view),TS.mentions.mention_changed_sig.add(TS.view.mentionChanged,TS.view),TS.mentions.mention_removed_sig.add(TS.view.mentionRemoved,TS.view),TS.mentions.mentions_being_fetched_sig.add(TS.view.mentionsBeingFetched,TS.view),TS.prefs.enable_unread_view_changed_sig.add(TS.view.resize),TS.prefs.team_disable_file_editing_changed_sig.add(TS.view.rebuildMsgFile),TS.view.resizeManually("TS.view.onStart"),$(window).resize(TS.view.onResize),"0"!=TS.qs_args.new_scroll){var e="1"==TS.qs_args.debug_scroll;TS.environment.supports_custom_scrollbar||TS.client.ui.$msgs_scroller_div.monkeyScroll({debug:e,always_show:!0,no_gutter:!0}),TS.environment.supports_custom_scrollbar||($(".flex_content_scroller").monkeyScroll({debug:e}),TS.client.channel_pane.$scroller.monkeyScroll({debug:e}))}TS.view.ms.changeConnectionStatus("trouble"),$("a.clear_unread_messages").tooltip({placement:"bottom",delay:{show:500,hide:150}}),$(".channels_list_new_btn").tooltip({container:"body",delay:{show:400,hide:150}}),$(".channel_list_header_label, #direct_messages_header").tooltip({placement:"top-left",container:"body",delay:{show:400,hide:150}}),TS.view.cached_wh=0,TS.view.resizeManually("TS.view.onStart 2");var t=!1;$(window).bind("scroll",function(){t||(t=!0,$(window).unbind("mouseup.scroll").bind("mouseup.scroll",function(){t=!1,$(window).unbind("mouseup.scroll"),$("body").scrollTop(0)}))}),TS.model.is_mac&&$("#drag_drop_mac_key").text(TS.i18n.t("Command","view")());r=TS.utility.enableFeatureForUser(10),$("#stars_scroller").on("click.fetchUserStarredItems",".flexpane_load_more_btn",function(){var e=$(this);e.data("ladda")||e.data("ladda",Ladda.create(this)),e.data("ladda").start(),TS.stars.fetchUserStarredItems().finally(function(){e.data("ladda").stop()})}),o=!TS.boot_data.feature_initial_scroll_position||!TS.environment.supports_custom_scrollbar},was_at_bottom_at_first_resize_event:!1,resize_tim:0,onResize:function(){TS.view.triggering_resize||(TS.view.cached_wh=0),TS.model.ui.cached_file_preview_scroller_rect=null,TS.model.ui.cached_msgs_scroller_rect=null,TS.model.ui.cached_msgs_scroll_result=null,TS.model.ui.cached_search_scroller_rect=null,TS.model.ui.cached_channels_scroller_rect=null,TS.model.ui.cached_archives_scroller_rect=null,TS.model.ui.cached_archive_scroll_result=null,TS.model.ui.cached_convo_scroller_rect=null,TS.model.ui.cached_unread_scroller_rect=null,TS.model.ui.cached_threads_scroller_rect=null,TS.view.resize_tim?(clearTimeout(TS.view.resize_tim),TS.view.resize_tim=0):o&&(TS.view.was_at_bottom_at_first_resize_event=TS.client.ui.areMsgsScrolledToBottom(50)),TS.view.resize_tim=setTimeout(function(){clearTimeout(TS.view.resize_tim),TS.view.resize_tim=0,TS.view.should_reset_input&&TS.view.resetForInput(),TS.view.resize(!0),TS.view.should_reset_input=!1},250),TS.view.triggering_resize||TS.view.resize(!1,!0)},team_menu_h:$("#team_menu").outerHeight(),cached_wh:0,last_msgs_div_width:0,last_input_height:0,last_preview_height:0,last_preview_height_changed:0,last_input_container_height:0,msgs_scroller_y:-1,footer_outer_h:-1,triggering_resize:!1,resizeManually:function(e,t){if(TS.model.ms_logged_in_once){e=e||"unspecified",TS.has_pri[c]&&TS.log(c,"======================================resizeManually ("+e+") starting");var n=Date.now();TS.view.resize(!1,!1,!!t),TS.has_pri[c]&&TS.log(c,"======================================resizeManually ("+e+") took "+(Date.now()-n)+"ms")}},resetUI:function(){TS.view.should_reset_input=!0},resetForInput:function(){TS.view.cached_wh=0,TS.view.last_input_height=0,TS.view.last_preview_height=0,TS.view.last_preview_height_changed=0,TS.view.last_input_container_height=0,TS.view.msgs_scroller_y=-1,TS.view.footer_outer_h=-1},resizeForBanner:function(e){TS.view.msgs_scroller_y=-1,TS.view.resizeManually(e);var t=$("html");t.height(t.height()),TS.utility.rAF(function(){t.height("")})},resize:function(e,t,n){if(r){var i="start_resize";TS.metrics.mark(i)}var a=Date.now();TS.has_pri[c]&&TS.log(c,a+" #1 cached_wh:"+TS.view.cached_wh+" TS.view.resize from_timer:"+e+" no_trigger:"+t+" "+(Date.now()-a)+"ms"),a=Date.now();var s=o&&TS.client.ui.areMsgsScrolledToBottom(50);if(o&&!n&&(s||TS.view.was_at_bottom_at_first_resize_event)){var l=TS.shared.getActiveModelOb();l&&(TS.model.prefs&&TS.model.prefs.start_scroll_at_oldest?!l.unread_cnt||-1!=l.scroll_top&&void 0!==l.scroll_top||!TS.client.ui.$msgs_unread_divider||TS.client.ui.$msgs_unread_divider.hasClass("no_unreads")?s&&(TS.has_pri[u]&&TS.log(u,"view resize: insta-scrolling to bottom because was_at_bottom, AND, !unread_cnt ("+l.unread_cnt+") OR scroll_top ("+l.scroll_top+") OR !TS.client.ui.$msgs_unread_divider ("+TS.client.ui.$msgs_unread_divider+") OR $msg_unread_divider has .no_unreads ("+(TS.client.ui.$msgs_unread_divider?TS.client.ui.$msgs_unread_divider.hasClass("no_unreads"):"undefined")+")"),TS.client.ui.instaScrollMsgsToBottom()):TS.client.msg_pane.dont_check_unreads_til_switch?(TS.has_pri[u]&&TS.log(u,"view resize: NOT scrolling despite unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+l.scroll_top+"), because _has_auto_scrolled is true."),s?(TS.has_pri[u]&&TS.log(u,"view resize: was at bottom, so insta-scrolling to bottom."),TS.client.ui.instaScrollMsgsToBottom()):TS.has_pri[u]&&TS.log(u,"view resize: was NOT scrolled to bottom before resize, so not doing anything.")):l._has_auto_scrolled?TS.has_pri[u]&&TS.log(u,"view resize: NOT scrolling first unread into view despite unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+l.scroll_top+"), because _has_auto_scrolled is true."):(TS.has_pri[u]&&TS.log(u,"view resize: scrolling first unread into view because unread AND start_scroll_at_oldest AND scroll_top == -1 or undefined (actual value: "+l.scroll_top+")"),TS.client.ui.scrollMsgsSoFirstUnreadMsgIsInView()):TS.client.ui.instaScrollMsgsToBottom())}e?TS.view.was_at_bottom_at_first_resize_event=!1:t||(TS.view.triggering_resize=!0,$(window).trigger("resize"),TS.view.triggering_resize=!1),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads(),TS.view.msgs_unscrollable&&TS.view.makeMsgsDivUnscrollable(),TS.ui.msg_tab_complete.positionUI(),TS.view.resize_sig.dispatch(),TS.has_pri[c]&&TS.log(c,a+" #15 "+(Date.now()-a)+"ms"),r&&(TS.metrics.measure("resize",i),TS.metrics.clearMarks(i))},never_set:!0,measureMsgPreview:function(){TS.view.footer_outer_h=$("#footer").outerHeight(),TS.view.last_preview_height_changed=TS.view.last_preview_height!==TS.view.footer_outer_h,TS.view.last_preview_height=TS.view.footer_outer_h},makeAttachmentWidthRule:function(e){var t,n,i,a,s;a=-96,TS.model.prefs&&"dense"===TS.model.prefs.theme&&(a=-144),t=e+a,s="\t\t\t#msgs_div div.dynamic_content_max_width {\t\t\t\tmax-width:"+t+"px;\t\t\t}\t\t",TS.view.last_attachment_max_width!==t&&(TS.view.last_attachment_max_width=t,n="dynamic_content_max_width_rule",i=$("#"+n),i.length?i.html(s):$('<style type="text/css" id="'+n+'">'+s+"</style>").appendTo("head"))},filesSelected:function(e){TS.client.ui.files.validateFiles(e,!1,function(e){TS.ui.upload_dialog.startWithCommentFromChatInput(e)})},filePasted:function(e,t){if("disable_all"===TS.model.team.prefs.disable_file_uploads)return void TS.generic_dialog.start({title:TS.i18n.t("Upload failed","view")(),body:TS.i18n.t("At the request of your administrator, file uploads have been disabled on this team.","view")(),show_cancel_button:!1,onGo:function(){TS.files.uploadOver(!1)}});t?TS.files.justUploadTheseFileNow([e]):TS.ui.upload_dialog.startWithCommentFromChatInput([e])},filesDropped:function(e,t){TS.ui.fs_modal.is_showing&&TS.ui.fs_modal.close(),t?TS.files.justUploadTheseFileNow(e):TS.ui.upload_dialog.startWithCommentFromChatInput(e)},updateTypingText:function(){var e=TS.typing.getTypersInChannel(TS.shared.getActiveModelOb().id);if(!e||!e.length||TS.model.archive_view_is_showing)return $("#typing_text").empty(),void $("#notification_bar").removeClass("showing_typing");if(TS.model.prefs.show_typing){$("#notification_bar").addClass("showing_typing");var t,n,i;t=TS.members.getPrefCompliantMemberName(e[0],!0),2==e.length&&(n=TS.members.getPrefCompliantMemberName(e[1],!0)),i=1==e.length?TS.i18n.t("{user_name} is typing","view")({user_name:'<span class="typing_name">'+t+"</span>"}):2==e.length?TS.i18n.t("{user_name} and {another_user_name} are typing","view")({user_name:'<span class="typing_name">'+t+"</span>",another_user_name:'<span class="typing_name">'+n+"</span>"}):TS.model.typing_msg,$("#typing_text").html(i)}},botChanged:function(){if(!TS.bots.is_in_bulk_upsert_mode&&!TS.isPartiallyBooted()){TS.client.msg_pane.rebuildMsgsWithReason("botChanged",!0)}},switchedHelper:function(e){var t=TS.shared.getActiveModelOb(),n=TS.shared.getModelObById(TS.model.last_active_cid);n&&(TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",n.id),n._show_in_list_even_though_no_unreads=!1,d(TS.model.last_active_cid)),TS.client.unread.isEnabled()&&TS.client.unread.destroyUnreadView(),TS.client.threads.destroyThreadsView(),TS.client.app_space.destroyAppSpaceView(),TS.apps.isAppSpaceEnabled()&&TS.client.ui.app_space.resetUI(),!TS.model.ui_state.flex_name&&TS.model.ui_state.details_tab_active&&TS.client.ui.flex.openFlexTab("details",!0);var i={};if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.features.messagePane.switchToChannel(t.id)),TS.client.ui.rebuildAllButMsgs(!0,i,!1);else if(!t.is_channel||t.is_member&&!t.is_archived?t.is_group&&t.is_archived?TS.client.archives.start():TS.ims.isImWithDeletedMember(t)?TS.client.archives.start():TS.client.archives.cancel(!0):TS.client.archives.start(),t._show_in_list_even_though_no_unreads=!1,TS.client.msg_pane.clearBlueBarTimer(),e)TS.client.ui.rebuildAllButMsgs(!0,i,!1);else{var a=t.scroll_top;TS.client.ui.rebuildAll(!0,!1),TS.boot_data.feature_initial_scroll_position&&TS.client.msg_pane.setInitialScrollPosition(a)}if(window.setTimeout(TS.view.focusMessageInput,0),TS.view.checkIfInputShouldBeDisabledAndPopulate(),TS.utility.contenteditable.clearHistory(TS.client.ui.$msg_input),TS.view.showInterstitialAfterChannelOrImShown(),TS.client.activeChannelIsHidden()||TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div),TS.utility.enableFeatureForUser(1)){var s="start_channel_change_"+TS.model.active_cid,r="channel_change";t.is_shared&&(r+="_shared"),t.is_im?r+="_im":t.is_mpim?r+="_mpim":t.is_group?r+="_group":t.is_private&&(r+="_private"),TS.metrics.measureAndClear(r,s)}},removeMsg:function(e,t){TS.view.removeMessageDiv(t)},removeMsgsAfterTruncation:function(e){for(var t,n,i=0;i<e.length;i+=1){t=e[i],n=TS.client.msg_pane.getDivsForMsg(t.ts);var a=n.parent(".day_msgs");TS.client.msg_pane.cleanMsgDiv(n),n.remove(),a.children().length||a.parent(".day_container").remove()}var s=TS.utility.msgs.getDisplayedMsgs(TS.shared.getActiveModelOb().msgs);s&&TS.view.rebuildMsg(s[s.length-1]),TS.client.msg_pane.updateEndMarker(),TS.view.resizeManually("TS.view.removeMsgsAfterTruncation")},removeMessageDiv:function(e,t){var n=TS.client.msg_pane.getDivsForMsg(e.ts);if(n.length){TS.client.msg_pane.cleanMsgDiv(n);var i,a=TS.client.msg_pane.last_rendered_msg&&TS.client.msg_pane.last_rendered_msg.ts==n.data("ts"),s=n.nextAll(".message:not(.hidden)").first();a&&(i=n.prevAll(".message:not(.hidden)").first());var r=function(){n=TS.client.msg_pane.getDivsForMsg(e.ts);var t=n.parent(".day_msgs");if(n.remove(),t.children().length||t.parent(".day_container").remove(),TS.client.ui.$msgs_unread_divider){TS.client.ui.$msgs_unread_divider.nextAll(".message:not(.hidden)").length||(TS.info("calling TS.client.ui.markMostRecentReadMsgInActive(true) after message removal because there are no displayed messages after the red line now"),TS.client.ui.markMostRecentReadMsgInActive(TS.model.marked_reasons.deleted,!0))}if(a&&i&&i.length){var r=TS.utility.msgs.getMsg(i.data("ts"),TS.shared.getActiveModelOb().msgs);r&&(TS.client.msg_pane.last_rendered_msg=r,TS.client.msg_pane.last_in_stream_msg=TS.client.msg_pane.last_rendered_msg,TS.info("set a new TS.client.msg_pane.last_rendered_msg && TS.client.msg_pane.last_in_stream_msg because the deleted msg was the last one"))}if(s&&s.length){var o=TS.utility.msgs.getMsg(s.data("ts"),TS.shared.getActiveModelOb().msgs);o&&TS.view.rebuildMsg(o)}TS.view.resizeManually("TS.view.removeMessageDiv")};t||TS.utility.msgs.isTempMsg(e)?r():n.addClass("delete_mode").slideUp(200,r)}},updateTitleWithContext:function(){var e,t,n,i,s;t=TS.shared.getActiveModelOb(),TS.model.unread_view_is_showing?n=TS.i18n.t("Unread Messages","view")():TS.model.threads_view_is_showing?n=TS.i18n.t("Threads","view")():TS.model.app_space_view_is_showing?n=TS.i18n.t("Apps","view")():t&&(n=t.name||""),n&&(e=" | ",s=document.title,i=s.indexOf(e),s=-1!==i?n+e+s.substr(i+e.length):n+e+s,a!==s&&(a=s,document.title=s))},start_time:new Date,checkIfInputShouldBeDisabledAndPopulate:function(e){TS.view.actuallyCheckIfInputShouldBeDisabledAndPopulate(e)},actuallyCheckIfInputShouldBeDisabledAndPopulate:function(e){var t,n=TS.shared.getActiveModelOb();n&&n.is_general&&!TS.members.canUserPostInGeneral()?(TS.utility.contenteditable.clear(TS.client.ui.$msg_input,!0),TS.utility.contenteditable.supportsTexty()||TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize"),TS.utility.contenteditable.disable(TS.client.ui.$msg_input),t=$("#msg_input_message span"),t.html(TS.i18n.t("Your Team Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+n.name+"</strong>"})),TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")):n&&(n.is_channel||n.is_group)&&TS.shared.isModelObOrgShared(n)&&!TS.permissions.members.canPostInChannel(n)?(TS.utility.contenteditable.clear(TS.client.ui.$msg_input,!0),TS.utility.contenteditable.supportsTexty()||TS.client.ui.$msg_input.trigger("autosize").trigger("autosize-resize"),TS.utility.contenteditable.disable(TS.client.ui.$msg_input),t=$("#msg_input_message span"),n.is_group?t.html(TS.i18n.t("Your Team Owners have limited who can post to {channel_or_group}","view")({channel_or_group:'<ts-icon class="ts_icon_lock prefix"></ts-icon>'+n.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon>'})):t.html(TS.i18n.t("Your Team Owners have limited who can post to {channel_or_group}","view")({channel_or_group:"#<strong>"+n.name+'<ts-icon class="ts_icon_shared_channel"></ts-icon></strong>'})),TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"")):n&&n._checking_at_channel_status&&TS.lazyLoadMembersAndBots()?(TS.utility.contenteditable.clear(TS.client.ui.$msg_input,!0),TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,TS.i18n.t("Sending...","view")()),TS.utility.contenteditable.disable(TS.client.ui.$msg_input)):(TS.utility.contenteditable.enable(TS.client.ui.$msg_input),e||(TS.utility.contenteditable.clear(TS.client.ui.$msg_input,!0),TS.client.msg_input.populateWithLast()),TS.client.msg_input.setPlaceholder())},userGroupUpdated:function(e){if(i&&TS.view.maybeRebuildUserGroupList(),e&&TS.model.previewed_user_group_id===e){var t=TS.user_groups.getUserGroupsById(e);if(t&&-1===t.date_delete)return TS.model.previewed_user_group_id="",void("team"===TS.model.ui_state.flex_name&&$("#back_from_user_group_preview").trigger("click"));TS.client.ui.previewUserGroup(e)}if(TS.client&&TS.client.msg_pane){var n=TS.shared.getActiveModelOb();if(!n||!n.msgs)return;var a="<!subteam^"+e;_.each(n.msgs,function(e){e.text&&-1!==e.text.indexOf(a)&&TS.view.rebuildMsg(e)})}},rebuildUserGroupTab:function(){if(!TS.lazyLoadMembersAndBots()){var e=TS.model.user_groups.filter(function(e){return!e.date_delete}),t=$("#user_groups_list_tab");0===e.length?t.addClass("hidden"):t.removeClass("hidden"),t.find(".usergroup_count").text(e.length)}},maybeRebuildUserGroupList:_.noop,rebuildUserGroupList:function(e){TS.metrics.mark("start_user_groups_flexpane_rebuild"),e||(e=TS.model.user_groups.concat());var t;t=TS.lazyLoadMembersAndBots()?TS.client.ui.user_groups.getUserGroupQuery():TS.members.view.getTeamFilter(),void 0!==t&&null!==t&&t.length?(t=t.toLowerCase(),e=e.filter(function(e){return!e.date_delete&&(-1!==e.handle.indexOf(t)||-1!==e._name_lc.indexOf(t)||e.description&&-1!==e.description.toLowerCase().indexOf(t))})):(t=null,e=e.filter(function(e){return!e.date_delete}));var n=$("#user_groups_list");if(e.length){n.empty();var i=$('<div id="user_groups_list_wrapper">');n.append(i),i.longListView({items:e,approx_item_height:97,preserve_dom_order:!0,scrollable:TS.lazyLoadMembersAndBots()?$("#user_group_list_scroller"):$("#team_list_scroller"),makeElement:function(){return $('<div style="width:100%">')},renderItem:function(e,t){var n=TS.templates.builders.buildUserGroupHTML(t,!0);e.html(n)},calcItemHeight:function(e){var t=e.outerHeight();return t||97}}),"groups"!==TS.model.ui_state.flex_name&&i.longListView("setHidden",!0)}else if(t&&TS.model.user_groups.length){var a={query:t,tab:{label:TS.i18n.t("User Groups","view")()}},s='<div class="no_results top_margin">'+TS.templates.team_list_no_results(a)+"</div>";n.html(s),TS.lazyLoadMembersAndBots()||n.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter("#team_filter","#team_list_scroller")})}else n.html(TS.templates.user_group_tip({is_flexpane:!0}));TS.view.rebuildUserGroupTab(),TS.utility.enableFeatureForUser(1)&&TS.metrics.measureAndClear("user_groups_flexpane_rebuild","start_user_groups_flexpane_rebuild")},showUnSentControlsForMsg:function(e,t,n){if(n&&n.error&&"4"==n.error.code){TS.utility.msgs.handleFailedMsgSend(e.ts,t,!1);var i={text:TS.i18n.t("A Team Owner has restricted posting to the {channel_name} channel.","view")({channel_name:"#*"+t.name+"*"}),ephemeral_type:"general_posting_restricted",slackbot_feels:"sad_surprise"};return TS.client.ui.addOrFlashEphemeralBotMsg(i),TS.utility.contenteditable.value(TS.client.ui.$msg_input,e.text),void TS.view.focusMessageInput()}setTimeout(function(){TS.model.display_unsent_msgs[e.ts]=!0,TS.utility.msgs.isMsgReply(e)?(TS.ui.replies.maybeUpdateConversationWithMessage(t,e),TS.client.threads.maybeRerenderMessage(t,e)):TS.view.rebuildMsg(e)},5e3)},scroll_down_when_msg_from_user_is_added:!1,addMsg:function(e,t){var n=!1,i=TS.shared.getActiveModelOb();e.user==TS.model.user.id&&TS.view.scroll_down_when_msg_from_user_is_added?(TS.view.scroll_down_when_msg_from_user_is_added=!1,n=!0):TS.client.ui.areMsgsScrolledToBottom()&&(n=!0);var a=TS.utility.msgs.getPrevDisplayedMsg(e.ts,i.msgs),s=TS.templates.builders.msgs.buildHTML({msg:e,model_ob:i,prev_msg:a,container_id:"msgs_div",enable_slack_action_links:!0}),r=TS.client.ui.$msgs_div,o=TS.client.ui.$msgs_div.find(".day_msgs").last();TS.interop.datetime.toCalendarDate(e.ts)===o.attr("data-date")?r=o:(s='<div class="day_msgs" data-date="'+TS.interop.datetime.toCalendarDate(e.ts)+'" data-ts="'+e.ts+'">'+s+"</div>",s='<div class="day_container">'+TS.templates.messages_day_divider({ts:e.ts})+s+"</div>"),o=null,r.append(s),r=null;var l=TS.client.msg_pane.getCanonicalDivForMsg(e.ts);TS.model.prefs.animate_new_msgs&&(l.css("opacity","0"),l.transition({opacity:1},200)),TS.utility.makeSureAllLinksHaveTargets(l),e.is_pending||(TS.client.msg_pane.last_in_stream_msg=e,TS.utility.msgs.isMsgHidden(e)||(TS.client.msg_pane.last_rendered_msg=e)),TS.client.msg_pane.assignLastReadMsgDiv(i),n&&TS.client.ui.instaScrollMsgsToBottom(!1);var d=TS.client.ui.isUserAttentionOnChat()&&!TS.client.activeChannelIsHidden()&&t<2;e.user==TS.model.user.id||d?TS.client.msg_pane.checkUnreads():TS.client.ui.checkInlineImgsAndIframes("main"),TS.client.msg_pane.insertUnreadDivider(),TS.attachment_actions.select.decorateNewElements(),TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div)},reClassUnreads:function(e){var t=TS.client.ui.areMsgsScrolledToBottom();TS.client.ui.$msgs_div.children("div.message").each(function(){$(this).data("ts")>e?$(this).addClass("unread"):$(this).removeClass("unread")}),TS.shared.getActiveModelOb().unread_cnt&&TS.client.msg_pane.insertUnreadDivider(),t&&TS.client.ui.instaScrollMsgsToBottom(!1)},rebuildMsg:function(e){if(e){var t=TS.client.msg_pane.getCanonicalDivForMsg(e.ts);if(t.length){var n,i,a,s,r=TS.shared.getActiveModelOb(),o=TS.client.ui.areMsgsScrolledToBottom(),l=!1,d=!1;TS.boot_data.feature_message_replies_inline?TS.utility.msgs.msgHasReplies(e)||TS.ui.thread.isMessageBeingConvertedToThread(r.id,e)?(a=TS.ui.thread.makeInlineThread(r.id,e.thread_ts||e.ts),t.closest("ts-thread").length?n=TS.templates.builders.buildThreadMsgHTML(e,r,a,{inline:!0}):(n=TS.ui.thread.buildThreadHTML(a,{inline:!0,expanded:TS.ui.thread.isThreadExpanded(r.id,e.ts)}),l=TS.ui.thread.isThreadExpanded(r.id,e.ts))):(i=TS.utility.msgs.getPrevDisplayedMsg(e.ts,r.msgs),n=TS.templates.builders.msgs.buildHTML({msg:e,model_ob:r,prev_msg:i,container_id:"msgs_div",enable_slack_action_links:!0}),s=t.closest("ts-thread"),s.length&&s.attr("data-thread-ts")===e.ts&&(d=!0)):(i=TS.utility.msgs.getPrevDisplayedMsg(e.ts,r.msgs),n=TS.templates.builders.msgs.buildHTML({msg:e,model_ob:r,prev_msg:i,container_id:"msgs_div",enable_slack_action_links:!0})),TS.client.msg_pane.cleanMsgDiv(t);var c=t.hasClass("hidden");d?s.replaceWith(n):t.replaceWith(n),t=TS.client.msg_pane.getCanonicalDivForMsg(e.ts),c&&t.addClass("hidden"),l&&TS.ui.thread.renderReplyInput(t.closest("ts-thread"),a),TS.utility.makeSureAllLinksHaveTargets(t),o&&TS.client.ui.instaScrollMsgsToBottom(!0),TS.client.ui.checkInlineImgsAndIframes("main"),TS.attachment_actions.select.decorateNewElements()}}},rebuildMsgsIncludingMember:function(e){var t=TS.shared.getActiveModelOb();t&&_.each(t.msgs,function(t){TS.utility.msgs.messageIncludesMember(e,t)&&(TS.has_pri[u]&&TS.log(u,"memberChangedProfile: Rebuilding msg "+t.ts+" because it includes member "+e.id),TS.view.rebuildMsg(t))})},rebuildMsgCurrentStatusIncludingMember:function(e){var t=TS.shared.getActiveModelOb(),n={member:e,for_message:!0};_.each(t.msgs,function(t){if(TS.utility.msgs.memberSentMessage(e,t)){TS.client.msg_pane.getCanonicalDivForMsg(t.ts).find(".message_current_status").replaceWith(TS.templates.current_status(n))}})},rebuildMsgFile:function(e,t,n){if(e&&t){var i=n?TS.client.msg_pane.getDivForArchiveMsg(e.ts):TS.client.msg_pane.getCanonicalDivForMsg(e.ts);if(i=i.length?i:TS.client.msg_pane.getDivForArchiveMsg(e.ts),!i.length)return TS.warn("Trying to rebuild message file, but invalid message");var a=i.find(".file_container"),s=TS.files.getFileActions(t);if(s.file=t,s.is_message=!0,s.msg_dom_id=i.attr("id"),s.new_window=!s.edit,s.download=!("snippet"===t.mode||"post"===t.mode||"space"===t.mode),$.extend(s,TS.files.getFileTemplateArguments(t)),"post"===t.mode||"space"===t.mode)a.replaceWith(TS.templates.file_post(s));else if("snippet"===t.mode){var r=$(TS.templates.file_snippet(s));r=r.filter(".file_container"),a.replaceWith(r)}else if("email"===t.mode)a.replaceWith(TS.templates.file_email(s));else{if("arugula"!==t.mode)return TS.warn("Trying to rebuild message file, but cannot rebuild "+t.mode);a.replaceWith(TS.templates.file_arugula(s))}TS.utility.makeSureAllLinksHaveTargets(i),TS.client&&TS.ui.utility.updateClosestMonkeyScroller(i)}},showInterstitialAfterChannelOrImShown:function(){var e=TS.channels.getChannelById(TS.model.active_channel_id),t=TS.groups.getGroupById(TS.model.active_group_id),n=!1;e&&e.needs_created_message?TS.model.prefs.no_created_overlays?e.needs_created_message=!1:(n=!0,TS.view.overlay.startWithCreatedChannel(e)):e&&e.needs_invited_message&&TS.shared.isModelObShared(e)?TS.view.overlay.startWithJoinedSharedChannel(e):e&&e.needs_invited_message?TS.model.prefs.no_joined_overlays?e.needs_invited_message=!1:(n=!0,TS.view.overlay.startWithInvitedChannel(e)):e&&e.needs_joined_message?TS.model.prefs.no_joined_overlays?e.needs_joined_message=!1:(n=!0,TS.view.overlay.startWithJoinedChannel(e)):t&&t.needs_invited_message?TS.model.prefs.no_joined_overlays?t.needs_invited_message=!1:(n=!0,TS.view.overlay.startWithInvitedGroup(t)):t&&t.needs_created_message&&(TS.model.prefs.no_created_overlays?t.needs_created_message=!1:(n=!0,TS.view.overlay.startWithCreatedGroup(t))),n||TS.view.overlay.fadeInAndOut()},toggleStarsError:function(e){$("#member_stars_more").toggleClass("hidden",e),$("#member_stars_error").toggleClass("hidden",!e)},rebuildStars:function(e){if(e||"stars"===TS.model.ui_state.flex_name){var t=TS.model.user,n="",i=$("#member_stars_list"),a=$("#member_stars_explanation"),s=$("#stars_scroller"),r=$("#member_stars_more");TS.view.cleanStars(),t.stars&&t.stars.length&&TS.model.user.stars.forEach(function(e){n+=TS.templates.builders.buildStarredItemHTML(e)}),n?(i.html(n),TS.view.member_stars_list_lazyload=i.find(".lazy").lazyload({container:s}),TS.utility.makeSureAllLinksHaveTargets(i),a.addClass("hidden"),TS.stars.has_more?r.css("visibility","visible"):r.css("visibility","hidden")):(i.html(""),a.removeClass("hidden"),r.css("visibility","hidden")),s.trigger("resize")}},cleanStars:function(){TS.view.member_stars_list_lazyload&&TS.view.member_stars_list_lazyload.detachEvents&&(TS.view.member_stars_list_lazyload.detachEvents(),TS.view.member_stars_list_lazyload=null),$("#member_stars_list").empty()},mentionChanged:function(e){TS.warn("mentionChanged:"+e.message.ts);var t=$("#member_mentions").find("#"+TS.templates.makeMsgDomId(e.message.ts));if(!t.length)return TS.view.rebuildMentions();var n=TS.templates.builders.buildMentionHTML(e);if(!n)return TS.view.rebuildMentions();t.replaceWith(n)},mentionRemoved:function(e){TS.warn("mentionRemoved:"+e);var t=$("#member_mentions").find("#"+TS.templates.makeMsgDomId(e));if(t.length){var n=function(){TS.view.rebuildMentions()};t.addClass("delete_mode").slideUp(200,n)}},mentionsFetched:function(){TS.view.rebuildMentions(),$("#member_mentions_more_btn").data("ladda")&&$("#member_mentions_more_btn").data("ladda").stop()},rebuildMentions:function(e){if(e||"mentions"===TS.model.ui_state.flex_name){$("#mentions_spinner").empty(),TS.view.prefs.rebuildMentionOptions();var t=$("#member_mentions_more_btn");void 0===t.data("ladda")&&(t.data("ladda",Ladda.create(document.querySelector("#member_mentions_more_btn"))),t.bind("click.fetchMoreMentions",function(){TS.mentions.fetchMoreMentions(),$(this).data("ladda").start()})),$("#exclude_at_channels").unbind("change.toggle_exclude_at_channels").bind("change.toggle_exclude_at_channels",function(){var e=$(this).is(":checked");TS.mentions.setExcludeAtChannelsPref(!e)}),$("#exclude_at_user_groups").unbind("change.toggle_exclude_at_user_groups").bind("change.toggle_exclude_at_user_groups",function(){var e=$(this).is(":checked");TS.mentions.setExcludeAtUserGroupsPref(!e)});var n=TS.templates.builders.buildMentions();n?($("#member_mentions").html(n),TS.utility.makeSureAllLinksHaveTargets($("#member_mentions")),$("#member_mentions_explanation").addClass("hidden"),TS.mentions.has_more?$("#member_mentions_more").css("visibility","visible"):TS.view.hideMentionsMoreButton()):($("#member_mentions").html(""),$("#member_mentions_explanation").toggleClass("hidden","replies"===TS.mentions.active_tab),$("#member_mentions_more").css("visibility","hidden")),TS.view.resize()}},rebuildMentionsLoading:function(){$("#member_mentions").html(TS.templates.builders.loadingHTML())},hideMentionsMoreButton:function(){$("#member_mentions_more").css("visibility","hidden")},cleanMentions:function(){$("#member_mentions").empty()},mentionsBeingFetched:function(e){e&&$("#mentions_spinner").html(TS.templates.loading_indicator())},loggedIn:function(){i=!0,TS.templates.makeSidebarBehaviorRule(),TS.ui.setThemeClasses(!0);var e=TS.shared.getActiveModelOb();if(!TS.isPartiallyBooted()&&e.is_group?TS.client.ui.rebuildAllButMsgs(!0):(TS.client.ui.rebuildAll(!0),TS.boot_data.feature_initial_scroll_position&&TS.client.msg_pane.setInitialScrollPosition(-1)),TS.useReactMessages()){var t=e.msgs;if(t&&t.length){TS.redux.messages.addMessages(t,!0,!0)}TS.redux.dispatch(TS.interop.redux.features.messagePane.switchToChannel(e.id))}TS.view.focusMessageInput(),new TS.PresenceList(TS.model.user.id),l(),TS.view.buildTeamList(),TS.utility.contenteditable.supportsTexty()||TS.client.msg_input.populateWithLast(),TS.client.ui.rebuildMemberListToggle(),TS.view.members.updateUserDisplayName(),TS.view.members.updateUserCurrentStatus(),TS.view.showProperTeamPaneFiller();var n=TS.boot_data.page_needs_enterprise&&!TS.lazyLoadMembersAndBots(),a={full_profile_filter:!0,is_long_list_view:n,include_bots:!0,include_deleted:!1};TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",a),TS.client.channel_pane.$scroller.css("visibility","visible"),TS.view.showInterstitialAfterChannelOrImShown(),TS.view.prefs.toggleSpellcheck(),TS.members.shouldDisplayRealNames()?$("#col_channels").addClass("real_names"):$("#col_channels").removeClass("real_names"),TS.model.is_iOS||(TS.ui.growls.no_notifications&&"1"!=window.readCookie("no_growl_prompt")?($("#growl_prompt_div").removeClass("hidden"),$("#growl_prompt_a").bind("click",function(){TS.view.overlay.startWithGrowlPromptDisplay()})):TS.ui.growls.shouldShowPermissionButton()&&"denied"!==TS.ui.growls.getPermissionLevel()&&"1"!=window.readCookie("no_growl_prompt")&&($("#growl_prompt_div").removeClass("hidden"),$("#growl_prompt_a").bind("click",function(){TS.view.overlay.startWithGrowlPromptDisplay()}))),TS.model.is_FF&&TS.client.ui.$msgs_scroller_div.removeAttr("tabindex"),TS.boot_data.feature_tinyspeck,(TS.shared.getActiveModelOb().is_channel&&!TS.shared.getActiveModelOb().is_member||TS.ims.isImWithDeletedMember(TS.shared.getActiveModelOb()))&&TS.client.archives.start()},showProperTeamPaneFiller:function(){var e=TS.members.getActiveMembersWithSelfAndSlackbot().length;if(TS.model.user.is_admin&&($("#team_block").removeClass("hidden"),e>4?($("#team_block_admin_invite_few").addClass("hidden"),$("#team_block_admin_invite_many").removeClass("hidden")):($("#team_block_admin_invite_few").removeClass("hidden"),$("#team_block_admin_invite_many").addClass("hidden"))),e>4?$("#team_block_description").addClass("hidden"):($("#team_block").removeClass("hidden"),$("#team_block_description").removeClass("hidden")),TS.model.team.email_domain){var t=TS.model.team.email_domain.split(",");if(1==t.length)$("#team_block_email_domains").html("<b>@"+_.escape(TS.model.team.email_domain)+"</b>");else{var n=_.escape(t.pop()),i=t.join("</b>, <b>@")+"</b> "+TS.i18n.t("or","view")()+" <b>@"+_.escape(n)+"</b>";$("#team_block_email_domains").html("<b>@"+i)}$("#team_block").removeClass("hidden"),$("#team_block_email_on").removeClass("hidden"),$("#team_block_admin_email_off").addClass("hidden")}else $("#team_block_email_on").addClass("hidden"),TS.model.user.is_owner&&($("#team_block").removeClass("hidden"),$("#team_block_admin_email_off").removeClass("hidden"));TS.model.user.profile&&TS.model.user.profile.phone&&TS.model.user.profile.real_name?$("#team_block_fill_prompt").addClass("hidden"):($("#team_block").removeClass("hidden"),$("#team_block_fill_prompt").removeClass("hidden"))},current_unread_status:null,changeUnreadStatus:function(e){TS.view.current_unread_status=e,TS.view.maybeChangeFavIco(),TS.client.ui.checkUnseenChannelsImsGroupsWithUnreads()},maybeChangeFavIco:function(){var e,t=TS.view.ms.current_connection_status,n=TS.view.current_unread_status;e="online"===t?"app_icon_32px_green":"trouble"===t?"app_icon_32px_yellow":"app_icon_32px_red","unreads"===n?e+="_unreads":"mentions"===n&&(e+="_mentions");var i=TS.model.data_urls[e],a=$("#favicon");a.attr("href")!=i&&a.replaceWith('<link id="favicon" rel="shortcut icon" href="'+i+'" sizes="16x16 32x32 48x48" type="image/png" />')},windowUnloaded:function(){(!TS.model.mac_ssb_version||TS.model.mac_ssb_version>=.32)&&($("BODY").addClass("loading"),$("#connection_div").html("").addClass("hidden"),TS.client.msg_pane.topMessagesBannerHidden())},buildMemberPresenceStatusHTML:function(e){var t="";return t+='<span class="'+TS.templates.makeMemberStatusDomClass(e.id)+'">',e.status&&(t+=' - "'+e.status+'"'),t+="</span>"},last_team_list_html:null,large_team_directory_trigger:2e3,rebuildTeamMember:function(e){if((!TS.lazyLoadMembersAndBots()||TS.model.ui_state.flex_visible&&"team"===TS.model.ui_state.flex_name)&&e&&e.id){var t='#team_list .team_list_item[data-member-id="'+e.id+'"]',n=$(t);if(n.length){TS.view.members_list_lazyload&&(TS.view.members_list_lazyload.detachEvents(),TS.view.members_list_lazyload=null),n.replaceWith(TS.templates.team_list_item({member:e})),n=$(t),n.length||TS.error("Unable to find node at selector "+t);var i=$("#team_list_scroller"),a=$("#team_list_members"),s=a.find(".lazy");TS.view.members_list_lazyload=s.lazyload({container:i,ignore_when_hidden_element:a,all_images_same_size:!0}),TS.utility.makeSureAllLinksHaveTargets(n),TS.view.updateTeamListCache()}else TS.view.rebuildTeamList(!0)}},clearTeamListCache:function(){TS.view.last_team_list_html=null},updateTeamListCache:function(){TS.view.last_team_list_html&&(TS.view.last_team_list_html=$("#team_list_members_wrapper").html())},rebuildTeamList:_.noop(),rebuildTeamListThrottled:function(){TS.lazyLoadMembersAndBots()||Promise.resolve().then(function(){TS.view.rebuildTeamListSync()})},rebuildTeamListSync:function(i){if(TS.lazyLoadMembersAndBots()&&!TS.team.isEntireTeamLoaded())throw new Error("Flannel: team list can only be built after the entire team has been loaded");if(i&&(TS.view.last_team_list_html=null),TS.model.ui_state.flex_visible&&"team"===TS.model.ui_state.flex_name){var a,r,o,l,d,c,_,u,m,h,p;if(a="team_list_members",r="team_list_members_wrapper",o="team_list_scroller",c=$("#"+r),_=TS.members.getMembersForUser(),m=$("#team_list_container input.member_filter"),TS.view.large_team_directory_trigger>0&&_.length>TS.view.large_team_directory_trigger&&(u=!0),TS.client&&TS.boot_data.page_needs_enterprise&&!TS.lazyLoadMembersAndBots()&&(h=!0,p=!0),!TS.view.last_team_list_html||!$("#"+a).length){TS.view.cleanTeamList(),TS.view.last_team_list_html||(u&&!h?TS.view.last_team_list_html='<p id="search_or_show_all" class="mini small_top_margin small_left_margin">'+TS.i18n.t('Search, or <a href="#" class="show_all_members">show all members</a>.',"view")()+'</p><div id="'+a+'" class="hidden">'+TS.templates.builders.buildTeamListHTML(_)+"</div>":(TS.view.last_team_list_html='<div id="'+a+'">'+TS.templates.builders.buildTeamListHTML(_,h,p)+"</div>",m=$("#team_list_container input.member_filter"))),c.html(TS.view.last_team_list_html),TS.lazyLoadMembersAndBots()&&TS.metrics.measureAndClear("team_directory_time_to_first_member","team_directory_time_to_first_member");var g=TS.ui.tabs.create($("#team_tabs"));if(h){var f=$("#"+o),S=function(e,t,n,i,a){if(e.length)return e.longListView({items:t,approx_item_height:n,approx_divider_height:i,preserve_dom_order:!0,scrollable:a,makeElement:function(){return $(TS.templates.team_list_item({is_long_list_view:!0}))},makeDivider:function(){return $("<div></div>")},renderItem:function(e,t){e.toggleClass("inactive",t.deleted).data("member-id",t.id).data("item",t),e.html(TS.templates.team_list_item_member_details({member:t,is_long_list_view:!0})),TS.utility.makeSureAllLinksHaveTargets(e)},renderDivider:function(e,t){e.data("item",t).html(TS.templates.team_list_item_divider(t))},calcItemHeight:function(e){var t=e.outerHeight();return t?Math.max(t,n):n},calcDividerHeight:function(e){var t=e.outerHeight();return t||i}})};e=null,t=null,n=null,e=S($("#active_members_list"),[],92,40,f),t=S($("#restricted_members_list"),[],92,40,f),n=S($("#deleted_members_list"),[],92,40,f),t&&t.longListView("setHidden",!0),n&&n.longListView("setHidden",!0),s={},f.off("scroll.tab").on("scroll.tab",function(){s[TS.model.ui_state.tab_name]=f.scrollTop()}),$("#team_tabs").on("click","li.tab",function(){var i,a;e&&(a="active_members"===TS.model.ui_state.tab_name,a&&(i=e),e.longListView("setHidden",!a)),t&&(a="restricted_members"===TS.model.ui_state.tab_name,a&&(i=t),t.longListView("setHidden",!a)),n&&(a="disabled_members"===TS.model.ui_state.tab_name,a&&(i=n),n.longListView("setHidden",!a)),i&&(s[TS.model.ui_state.tab_name]?i.longListView("scrollToPosition",s[TS.model.ui_state.tab_name],!0):i.longListView("scrollToTop",!0))}),l=$("#"+a),l.on("click.toggle_list_item",".team_list_item",TS.members.view.onTeamDirectoryItemClick),TS.client.flex_pane.startLocalTimeInterval(),TS.ui.utility.updateClosestMonkeyScroller(f)}else{if(u){var T=function(){$("#search_or_show_all").remove(),TS.view.large_team_directory_trigger=-1,m.val(""),TS.members.view.clearFilter("#team_filter","#team_list_scroller"),$("#"+a).removeClass("hidden"),TS.view.last_team_list_html=null,TS.view.triggerInitialTeamListLazyLoad()},v=function e(t,n){-1!==TS.view.large_team_directory_trigger?t.length&&n!==_.length||($("#"+a).addClass("hidden"),m.focus()):TS.members.view.team_filter_changed_sig.remove(e)};c.find(".show_all_members").on("click",T),TS.members.view.team_filter_changed_sig.add(v),m.focus()}l=$("#"+a),l.on("click.toggle_list_item",".team_list_item",TS.members.view.onTeamDirectoryItemClick),d=l.find(".lazy"),TS.view.members_list_lazyload&&(TS.view.members_list_lazyload.detachEvents(),TS.view.members_list_lazyload=null),TS.view.members_list_lazyload=d.lazyload({container:$("#"+o),ignore_when_hidden_element:$("#"+a),all_images_same_size:!0}),l.one("remove",function(){TS.view.members_list_lazyload&&(TS.view.members_list_lazyload.detachEvents(),TS.view.members_list_lazyload=null),g&&g.unbind&&(g.unbind(),g=null),l&&(l.empty(),l=null)}),TS.client.flex_pane.startLocalTimeInterval(),TS.utility.makeSureAllLinksHaveTargets(l),TS.view.triggerInitialTeamListLazyLoad(),d=null}}if(TS.view.refilterTeamList(),"user_groups"===TS.model.ui_state.tab_name){var b=$("#user_groups_list_tab a");b.length&&b.trigger("click")}if("restricted_members"===TS.model.ui_state.tab_name){var w=$("#restricted_members_tab a");w.length&&w.trigger("click")}if("disabled_members"===TS.model.ui_state.tab_name){var y=$("#disabled_members_tab a");y.length&&y.trigger("click")}TS.model.ui_state.tab_name||(TS.model.ui_state.tab_name="active_members",TS.storage.storeUIState(TS.model.ui_state))}},refilterTeamList:function(){if(TS.model.ui_state.flex_visible&&"team"===TS.model.ui_state.flex_name){var e=$("#team_list_container input.member_filter"),t=TS.storage.fetchFilterState();"string"!=typeof t&&(t=""),(t||TS.boot_data.page_needs_enterprise&&!TS.lazyLoadMembersAndBots())&&(e.val(t),$("#team_list_container .icon_close").toggleClass("hidden",!t),TS.members.view.filterTeam(t,"#team_filter","#team_list_scroller",!0))}},buildLongListTeamListItems:function(e,t){var n=e.members,i=e.disabled_members,a=e.deleted_bots,s=e.bots,r=e.restricted_members,o=e.ultra_restricted_members,l=e.admin_members,d=n.slice(0);s.length&&(t||d.push({bot:!0,is_divider:!0}),d.push.apply(d,s));var c=[];r.length&&(t||c.push({multi_channel_guest:!0,is_divider:!0}),c.push.apply(c,r)),o.length&&(t||c.push({single_channel_guest:!0,restricted_members:!!r.length,is_divider:!0}),c.push.apply(c,o));var _=i.slice(0);a.length&&(t||_.push({deleted_bot:!0,is_divider:!0}),_.push.apply(_,a));var u=[];return l&&l.length&&(u=l),{active_members_list_items:d,restricted_members_list_items:c,deleted_members_list_items:_,admin_members_list_items:u}},cleanTeamList:function(e){TS.view.members_list_lazyload&&TS.view.members_list_lazyload.detachEvents&&(TS.view.members_list_lazyload.detachEvents(),TS.view.members_list_lazyload=null);var t=$("#team_list_members");t.off("click.toggle_list_item"),t.off("click.member_preview_menu"),e&&t.remove(),t=null},triggerInitialTeamListLazyLoad:function(){TS.ui.utility.updateClosestMonkeyScroller($("#team_list_members")),$("#team_list_scroller").trigger("resize-immediate")},buildTeamList:function(){(!TS.lazyLoadMembersAndBots()||TS.model.ui_state.flex_visible&&"team"===TS.model.ui_state.flex_name)&&TS.view.rebuildTeamList()},maybeFollowLink:function(e){return!TS.utility.isSpaceClickEventSafe(e)||!(!e.metaKey&&!e.ctrlKey)&&!(!$(e.target).closest("a[href]").length||!document.hasFocus())},markAllUnread:function(){function e(e){var t=TS.utility.msgs.getDisplayedMsgs(e.msgs);if(t.length){var n=t[t.length-1];if(n){if(e.is_channel)TS.channels.markReadMsg(e.id,n.ts);else if(e.is_im)TS.ims.markReadMsg(e.id,n.ts);else{if(!e.is_group)return void TS.warn("markIt "+e.id+"????");TS.groups.markReadMsg(e.id,n.ts)}TS.info("markIt "+e.id+" "+n.ts)}}}TS.model.last_reads_set_by_client={},_.forOwn(TS.model.channels,function(t){t.is_archived||t.is_member&&e(t)}),_.forOwn(TS.model.ims,function(t){t.is_open&&e(t)}),_.forOwn(TS.model.groups,function(t){t.is_archived||e(t)}),TS.model.client.reads.length=0,TS.client.markLastReadsWithAPI(),TS.client.msg_pane.clearUnreadDividerAndHideNewMsgsBar(),TS.client.msg_pane.insertUnreadDivider(),TS.client.msg_pane.dont_check_unreads_til_switch=!0},onGroupReferenceClick:function(e,t){var n=TS.groups.getGroupById(t);n&&(n.is_archived&&n.was_archived_this_session,e.preventDefault(),TS.groups.displayGroup({id:n.id}))},onChannelReferenceClick:function(e,t){var n=TS.channels.getChannelById(t);n&&(e.preventDefault(),TS.channels.displayChannel({id:n.id}))},onMemberReferenceClick:function(e,t){var n;(n=TS.interop.utility.looksLikeMemberId(t)?TS.members.getMemberById(t)||TS.members.getMemberByName(t):TS.members.getMemberByName(t))&&TS.menu.member.startWithMember(e,n.id)},onUserGroupReferenceClick:function(e,t){var n=TS.user_groups.getUserGroupsById(t);n&&TS.client.ui.previewUserGroup(n.id)},adjustForWelcomeSlideShow:function(){TS.model.cancelled_welcome_2_this_session||(TS.model.showing_welcome_2=!0,$(".messages_banner").css("visibility","hidden"),TS.view.makeMsgsDivUnscrollable())},msgs_unscrollable:!1,makeMsgsDivUnscrollable:function(){TS.view.msgs_unscrollable=!0,TS.client.ui.$msgs_scroller_div.css("overflow-y","hidden").css("height","100%"),$("#monkey_scroll_wrapper_for_msgs_scroller_div").find(".monkey_scroll_bar").css("visibility","hidden"),TS.client.ui.$msgs_scroller_div.scrollTop(0),TS.client.ui.$msgs_div.css("visibility","hidden"),$("#footer").addClass("hidden")},unAdjustForWelcomeSlideShow:function(e){if(!TS.model.showing_welcome_2)return void TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div);TS.model.showing_welcome_2=!1,$(".messages_banner").css("visibility",""),TS.model.seen_onboarding_this_session&&TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id?$("#messages_unread_status").css("visibility","hidden"):$("#messages_unread_status").css("visibility",""),TS.view.makeMsgsDivScrollable()?(TS.view.resizeManually("ran TS.view.makeMsgsDivScrollable()",!0),e&&TS.client.ui.$msgs_scroller_div.scrollTop(0)):TS.view.resizeManually("NOT ran TS.view.makeMsgsDivScrollable()",!0)},makeMsgsDivScrollable:function(){return!!TS.view.msgs_unscrollable&&(TS.view.msgs_unscrollable=!1,TS.client.ui.$msgs_scroller_div.css("overflow-y","auto").css("height",""),$("#monkey_scroll_wrapper_for_msgs_scroller_div").find(".monkey_scroll_bar").css("visibility",""),TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.$msgs_scroller_div),TS.client.ui.$msgs_div.css("visibility","visible"),$("#footer").removeClass("hidden"),!0)},submit:function(){var e=TS.utility.contenteditable.value(TS.client.ui.$msg_input);return!(!TS.model.ms_connected&&"/wakewake"!==e)&&(TS.client.ui.onSubmit(e),!0)},focusMessageInput:function(){var e=TS.ims.getImById(TS.model.active_im_id),t=TS.shared.getActiveModelOb();if(t){if(e&&TS.members.getMemberById(e.user).deleted)return TS.utility.contenteditable.placeholder(TS.client.ui.$msg_input,"account deactivated"),void TS.utility.contenteditable.disable(TS.client.ui.$msg_input);if(!TS.utility.contenteditable.isDisabled(TS.client.ui.$msg_input)&&TS.client.ui.isUserAttentionOnChat()&&!TS.model.is_iOS){var n=TS.model.last_key_down_e,i=TS.utility.keymap;if((!n||!n.altKey||n.which!=i.down&&n.which!=i.up)&&(TS.utility.contenteditable.focus(TS.client.ui.$msg_input),!TS.model.archive_view_is_showing)){var a=TS.model.input_cursor_positions[t.id];a?(TS.utility.setCursorPosition(TS.client.ui.$msg_input,a.start,a.length),delete TS.model.input_cursor_positions[t.id]):TS.utility.contenteditable.setCursorAtEnd(TS.client.ui.$msg_input)}}}},clearMessageInput:function(){TS.client.msg_input.populate("")},updateTitleBarColor:function(){TS.model.is_our_app&&TSSSB.call("updateTitleBarColor",TS.utility.rgb2hex($("#team_menu").css("background-color")))},teamPlanChanged:function(e){TS.model.team.plan=e.plan,TS.model.can_add_ura=e.can_add_ura},teamProfileChanged:function(){TS.view.refilterTeamList(),TS.view.rebuildPreviewedMember()},rebuildPreviewedMember:function(){TS.model.previewed_member_id&&TS.client.ui.previewMember(TS.model.previewed_member_id)},displayMsgInModelOb:function(e,t){if(e.is_channel?TS.channels.displayChannel({id:e.id}):e.is_mpim?TS.mpims.displayMpim({id:e.id}):e.is_group?TS.groups.displayGroup({id:e.id}):TS.ims.startImById(e.id),e.id==TS.model.active_cid){TS.utility.msgs.getMsg(t,e.msgs)&&!TS.model.archive_view_is_showing?TS.client.ui.scrollMsgsSoMsgIsInView(t,!1,!0):TS.client.archives.start(t)}},flexpaneDisplaySwitched:function(e){var t=TS.model.ui_state.flex_name;if(!t||"team"===e&&"team"!==t)return void TS.view.cleanTeamList(!0);if("team"!==e&&"team"===t)return void TS.view.rebuildTeamListThrottled();if("mentions"===t&&TS.mentions.mentions_needs_fetched){TS.mentions.maybeUpdateMentions(!0)}"files"===t&&TS.client.flex_pane.maybeFetchFileList()},_maybeUpdateOnboarding:function(){TS.model.seen_onboarding_this_session&&(TS.shared.getActiveModelOb().id==TS.model.welcome_model_ob.id?TS.newxp.startOnboarding():TS.newxp.cancelOnboarding())},addReplyMsg:function(e,t){if(TS.ui.thread.isThreadExpanded(e.id,t.thread_ts)){var n=TS.client.ui.$msgs_div.find('ts-thread[data-thread-ts="'+t.thread_ts+'"]');if(n.length){var i=TS.ui.thread.makeInlineThread(e.id,t.thread_ts);TS.ui.thread.updateThreadWithMessage(n,i,t,!0)}}}});var e,t,n,i,a=null,s={},r=!1,o=!0,l=function(){TS.view.ms.maybeChangeConnectionDisplay()},d=function(e){if(TS.utility.contenteditable.isEmpty(TS.client.ui.$msg_input))return void delete TS.model.input_cursor_positions[e];var t=TS.utility.getCursorPosition(TS.client.ui.$msg_input);t&&(TS.model.input_cursor_positions[e]=t)},c=389,u=888}()},3125:function(e,t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){"use strict";TS.registerModule("client.traces",{onStart:function(){TS.client.login_sig.add(i,TS.client.traces,1)},canTrace:function(){return!!(TS.boot_data.feature_perfectrics&&_.get(window,"desktop.stats.startTraceRecord")&&_.get(window,"desktop.stats.stopTraceRecord"))},startTrace:function(n,i){return TS.client.traces.canTrace()?d()?h(t):(t=c(n,i),e=t.delay(l(n)).finally(function(){u()}).catch(_.noop),h(t)):h()},maybeTrace:function(e,n){return TS.client.traces.canTrace()&&m()?d()?h(t):(TS.storage.storeLastTraceTS(),TS.client.traces.startTrace(e,n)):h()},stopTrace:function(){TS.client.traces.canTrace()&&d()&&t.finally(function(){e.cancel()}).catch(_.noop)},test:function(){var n={};return Object.defineProperty(n,"_getTraceIdentifier",{get:function(){return a},set:function(e){a=e}}),Object.defineProperty(n,"_getTraceEndpoint",{get:function(){return s},set:function(e){s=e}}),Object.defineProperty(n,"_getTraceToken",{get:function(){return r},set:function(e){r=e}}),Object.defineProperty(n,"_getSafeTraceMetadata",{get:function(){return o},set:function(e){o=e}}),Object.defineProperty(n,"_getSafeTracePeriod",{get:function(){return l},set:function(e){l=e}}),Object.defineProperty(n,"_traceInFlight",{get:function(){return d},set:function(e){d=e}}),Object.defineProperty(n,"_promiseToStartTrace",{get:function(){return c},set:function(e){c=e}}),Object.defineProperty(n,"_promiseToStopTrace",{get:function(){return u},set:function(e){u=e}}),Object.defineProperty(n,"_longEnoughSinceLastAutomatedTrace",{get:function(){return m},set:function(e){m=e}}),Object.defineProperty(n,"_getExternalPromise",{get:function(){return h},set:function(e){h=e}}),Object.defineProperty(n,"_trace_p",{get:function(){return e},set:function(t){e=t}}),Object.defineProperty(n,"_start_trace_p",{get:function(){return t},set:function(e){t=e}}),n}});var e,t,i=function(){},a=function(){return[_.get(TS.model,"user.team_id")||_.get(TS.boot_data,"team_id"),_.get(TS.model,"user.id")||_.get(TS.boot_data,"user_id"),Date.now(),performance.now()].join("_")},s=function(){return _.get(TS.model,"async_api_url")+"profiling.addTrace"},r=function(){return _.get(TS.model,"api_token")},o=function(e){function t(e,i){_.each(e,function(a,s){s===i?delete e[s]:a===i?e[s]="(redacted)":"object"===(void 0===a?"undefined":n(a))&&t(a,i)})}return t(e,r()),e},l=function(e){return e=parseInt(e,10),_.isNaN(e)?2e4:_.clamp(1e3*e,1e3,6e4)},d=function(){return!!e&&e.isPending()},c=function(e,t){var n=a();return Promise.resolve(window.desktop.stats.startTraceRecord({identifier:n,endpoint:s(),token:r(),metadata:_.assign({},o(t),{identifier:n,duration:l(e)})}))},u=function(){return Promise.resolve(window.desktop.stats.stopTraceRecord())},m=function(){return Date.now()-TS.storage.fetchLastTraceTS()>864e5},h=function(e){return e?new Promise(function(t){e.then(function(e){return t(e)})}):Promise.resolve()}}()},3134:function(e,t){!function(){"use strict";TS.registerModule("client.app_space",{switched_sig:new signals.Signal,switched_away_sig:new signals.Signal,apps_loaded:!1,onStart:function(){e=new TS.PromiseQueue},showAppSpaceView:function(e,t){return!!TS.apps.isAppSpaceEnabled()&&(!TS.model.sorting_mode_is_showing&&(t&&(t=!!t),!0))},destroyAppSpaceView:function(){TS.client.ui.app_space.isAppSpaceViewDOMShowing()&&(t&&t.isPending()&&t.cancel(),t=null,TS.client.ui.app_space.destroyAppSpaceView(),TS.client.app_space.switched_away_sig.dispatch())},maybeReloadAppSpaceView:function(){TS.model.app_space_view_is_showing&&(TS.client.ui.app_space.resetUI(),e.addToQ(a))}});var e,t,n,i,a=function(){return t=TS.api.call("apps.index.categories.apps.list",{app_space_category_id:"Ai01"}),t.then(r).then(function(e){return TS.model.app_space_view_is_showing&&TS.client.ui.app_space.startWithData(e.apps),e}).catch(o)},s=function(){n=null},r=function(e){var t=e.data;return n=t.apps,i=t.total_count,{apps:n,total_apps:i}},o=function(e){TS.error("App Space error during loading:"),TS.error(e);var t=_.get(e,"data.error");t||(t=_.get(e,"message")),t||(t=e),_.isString(t)||(t=JSON.stringify(t)),TS.error(t);var n=_.get(e,"stack");return n&&TS.error(JSON.stringify(n)),TS.console.logError(e,"app_space_view_fatal_error"),s(),TS.client.ui.app_space.displayFatalError(),null}}()},3135:function(e,t){!function(){"use strict";TS.registerModule("client.ui.app_space",{$channel_pane_item:$("#channels_scroller .app_space"),$scroller:$("#app_space_scroller_div"),$loading_msg_container:null,$container:null,valid_sub_views:["messages","about","permissions"],active_view:"messages",screenshots_templates:[],onStart:function(){TS.apps.isAppSpaceEnabled()&&(TS.isSocketManagerEnabled()?TS.interop.SocketManager.connectedSig.add(p):TS.ms.connected_sig.add(p),TS.ims.pre_switched_sig.add(TS.client.ui.app_space.prepareAppSpace,TS.client.ui.app_space))},prepareAppSpace:function(){var e=TS.shared.getActiveModelOb(),t=TS.members.getMemberById(e.user),n=_.get(t,"profile.bot_id"),i=_.get(t,"profile.team");n&&o(n,i)},toggleView:function(e){TS.client.ui.app_space.valid_sub_views.indexOf(e)<0||(TS.client.channel_header.setActiveTab(e),TS.client.ui.app_space.active_view=e,"messages"===e?TS.client.ui.app_space.resetView():"about"===e?m():"permissions"===e&&h())},resetView:function(){TS.client.msg_pane.hideCenterWorkspace(),TS.client.msg_pane.showMessageContainer()},renderAppInformation:function(t,n,i){if(t){TS.client.ui.app_space.active_app=t,TS.client.ui.app_space.app_bot_id=n,TS.client.ui.app_space.app_team_id=i,e=TS.apps.constructTemplateArgsForCardAndProfile(t,n,i);var a;a=t.permissions?TS.apps.promiseToParsePermissionsForApp(t.permissions):Promise.resolve(),a.then(function(t){e.permissions=t,u(),TS.environment.supports_custom_scrollbar||TS.client.ui.app_space.$scroller.monkeyScroll(),TS.client.ui.app_space.active_view&&TS.client.ui.app_space.toggleView(TS.client.ui.app_space.active_view)})}},onButtonClick:function(){var e=$(this),t=e.data("action");"desc_expand"===t?(n.removeClass("app_desc_expand_showing"),setTimeout(function(){n.addClass("app_desc_collapse_showing")},300)):"desc_collapse"===t&&(n.removeClass("app_desc_collapse_showing"),n.addClass("app_desc_expand_showing"))},resetUI:function(){r.empty(),"messages"!==TS.client.ui.app_space.active_view&&(TS.client.ui.app_space.resetView(),TS.client.ui.app_space.active_view="messages"),TS.client.ui.app_space.active_app=null,TS.client.ui.app_space.app_bot_id=null,TS.client.ui.app_space.app_team_id=null,TS.client.ui.app_space.screenshots_templates=[]},openScreenshotModal:function(t){var n=$(t.target),i=n.data("app-space-screenshot");"youtube"===i?i=0:i+=1,TS.ui.fs_modal.start({body_template_html:TS.templates.fs_modal_simple_gallery({items:TS.client.ui.app_space.screenshots_templates,modal_gallery_index:i}),header_html:TS.templates.fs_modal_app_header(e),modal_bg_class:"off_white_bg",modal_gallery:{index:i,total_items:TS.client.ui.app_space.screenshots_templates.length-1},modal_class:"fs_modal_header fs_modal_footer",modal_contents_container_class:"c-modal_gallery",show_go_button:!1,show_cancel_button:!1})},showAppSpaceView:function(){$("#client-ui").addClass("app_space_view_is_showing"),TS.client.ui.app_space.$scroller.addClass("loading"),TS.client.archives.cancel(!0);TS.client.ui.rebuildAllButMsgs(!0),"details"===TS.model.ui_state.flex_name&&TS.client.ui.flex.hideFlex(!0),TS.client.msg_pane.hideNewMsgsBar(!0),TS.client.ui.app_space.$container=$('<div id="app_space_wrapper"></div>'),TS.client.ui.app_space.$container.appendTo(TS.client.ui.app_space.$scroller),TS.environment.supports_custom_scrollbar||TS.client.ui.app_space.$scroller.monkeyScroll(),T(),TS.view.resize_sig.add(T),g(),TS.clog.track("APP_SPACE_VIEW_OPEN",{view_session_index:a}),TS.client.ui.app_space.incrementTrackingSeqId()},startWithData:function(e){if(TS.client.ui.app_space.$scroller.removeClass("loading"),e.length<1)return void TS.client.ui.app_space.displayEmptyState();S(e)},isAppSpaceViewDOMShowing:function(){return $("#client-ui").hasClass("app_space_view_is_showing")},destroyAppSpaceView:function(){TS.client.ui.app_space.resetUI(),TS.client.ui.app_space.$scroller.off("scroll.app_space_view_scroll"),TS.client.ui.app_space.$scroller.empty(),$("#client-ui").removeClass("app_space_view_is_showing"),TS.client.ui.app_space.$container=null,TS.view.resize_sig.remove(T),s||TS.client.ui.app_space.trackAppSpaceViewClosed("OTHER")},displayEmptyState:function(){if(TS.model.app_space_view_is_showing){var e={emoji:new Handlebars.SafeString(TS.emoji.graphicReplace(":zap:",{jumbomoji:!0})),is_empty:!0};TS.client.ui.app_space.displayAlternativeAppSpaceView(e)}},displayFatalError:function(){if(TS.model.app_space_view_is_showing){var e={emoji:new Handlebars.SafeString(TS.emoji.graphicReplace(":tropical_fish:",{jumbomoji:!0})),is_error:!0};TS.client.ui.app_space.displayAlternativeAppSpaceView(e)}},displayAlternativeAppSpaceView:function(e){TS.client.ui.app_space.$scroller.find(".app_space_alternative_view_wrapper").remove(),TS.client.ui.app_space.$scroller.removeClass("loading"),TS.client.ui.app_space.$container.empty().hide(),TS.client.ui.app_space.$scroller.append(TS.templates.app_space_alternative_view(e))},isAlternativeAppSpaceViewShowing:function(){return TS.client.ui.app_space.$scroller.find(".app_space_alternative_view_wrapper").length>0},updateChannelPaneActiveState:function(){TS.client.ui.app_space.$channel_pane_item.toggleClass("active",!!TS.model.app_space_view_is_showing)},incrementTrackingSeqId:function(){a+=1},trackAppSpaceViewClosed:function(e){var t=_.merge(TS.client.ui.app_space.getTrackingData(),{view_exit_event:e});TS.clog.track("APP_SPACE_VIEW_CLOSE",t),s=!0},getTrackingData:function(){return{view_session_elapsed_time:Date.now()-i,view_session_index:a}}});var e,t,n,i,a,s,r=$('[data-js="app_space"]'),o=function(e,t){TS.apps.promiseToGetFullAppProfile(e,t,null,!0).then(function(n){TS.client.ui.app_space.renderAppInformation(n,e,t)})},l=function(){t=$('[data-js="app_space_profile"]'),t.on("click","[data-app-space-screenshot]",TS.client.ui.app_space.openScreenshotModal),t.on("click",'[data-js="app_profile_btn"]',TS.client.ui.app_space.onButtonClick)},d=function(){n=$('[data-js="app_profile_desc"]'),_.get(TS.client.ui.app_space.active_app,"long_desc.length")<250&&n.removeClass("app_desc_expand_showing")},c=function(){e.youtube_id&&TS.client.ui.app_space.screenshots_templates.push(TS.templates.app_youtube_video({youtube_id:e.youtube_id})),e.screenshots&&_.each(e.screenshots,function(e){TS.client.ui.app_space.screenshots_templates.push(TS.templates.app_space_screenshot({image_url:e.image_1600}))})},u=function(){var t=$('[data-js="channel_header_tabs"]'),n=t.find('[data-target="permissions"]');e.show_settings_section&&e.permissions?n.removeClass("hidden"):n.addClass("hidden")},m=function(){r.html(TS.templates.app_space_profile(e)),d(),c(),l(),TS.client.msg_pane.hideMessageContainer(),TS.client.msg_pane.showCenterWorkspace()},h=function(){TS.client.msg_pane.hideMessageContainer(),TS.client.msg_pane.showCenterWorkspace();var t=_.get(e.auth,"created_by");if(t){var n,i,a=TS.members.getMemberById(t);a&&(n=TS.members.getPrefCompliantMemberName(a),i=new Handlebars.SafeString(_.escape(n))),e=_.assign({},e,{permissions:{member_username:_.get(a,"name"),member_id:_.get(a,"id"),member_name:i}})}r.html(TS.templates.app_space_permissions(e))},p=function(){TS.client.ui.app_space.resetUI(),TS.client.ui.app_space.prepareAppSpace()},g=function(){i=Date.now(),a=0,s=!1},f=function(){var e=$("#app_space_wrapper .navigation li");e.on("click",function(t){var n=$(t.target);e.removeClass("active"),n.addClass("active"),$("#app_space_wrapper .content .apps").removeClass("display_flex").addClass("display_none"),n.hasClass("featured_apps_link")?$(".featured_apps").addClass("display_flex"):n.hasClass("your_apps_link")?$(".your_apps").addClass("display_flex"):$(".build_apps").addClass("display_flex")})},S=function(e){$(TS.templates.app_space()).appendTo(TS.client.ui.app_space.$container),f();for(var t,n=0;n<e.length;n+=1)t={app_id:e[n].id,name:e[n].name,category:"Social & Fun",icons:e[n].icons},$(TS.templates.app_space_app_card(t)).appendTo("#app_space_wrapper .your_apps");TS.client.ui.app_space.$container.show()},T=function(){TS.environment.supports_custom_scrollbar||TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.app_space.$scroller)}}()},3159:function(e,t){!function(){"use strict";TS.registerModule("client.quick_promo",{onStart:function(){n=TS.experiment.getGroup("quick_promo_invite_nudge"),TS.client.login_sig.addOnce(s)},test:function(){var e={_showModal:o};return Object.defineProperty(e,"_showModal",{get:function(){return o},set:function(e){o=e}}),e}})}();var n,i,a,s=function(){"show_invite_nudge"!==n&&"show_invite_nudge_contextual"!==n||TS.api.call("promo.show",{team_id:TS.model.team.id,user_id:TS.model.user.id,previous_login:TS.boot_data.last_login_timestamp}).then(function(e){if(e.data&&e.data.ok&&e.data.show_modal){i=e.data.invite_count?e.data.invite_count:0,r();var t=new Image;t.onload=o,t.src=cdn_url+"/9288/img/quick_promo/ill_team@2x.png"}})},r=function(){a="show_invite_nudge_contextual"===n&&i>0?"contextual":"show_invite_nudge_contextual"===n?"contextual_no_invites":"non_contextual"},o=function(){TS.generic_dialog.start({type:"quick_promo",body:TS.templates.quick_promo_invite_nudge({copy_is_contextual_with_invites:"contextual"===a,copy_is_non_contextual:"non_contextual"===a,invite_count:i}),dialog_class:"quick_promo",force_small:!0,show_close_button:!0,show_cancel_button:!0,cancel_button_text:TS.i18n.t("Remind Me Later","quick_promo")(),fullscreen:!1,show_go_button:!0,onGo:l,go_button_text:TS.i18n.t("Invite People","quick_promo")(),onCancel:d}),c()},l=function(){TS.prefs.setPrefByAPI({name:"promo_dismissed",value:!0}),h("invite_people_button")},d=function(){TS.prefs.setPrefByAPI({name:"promo_snoozed",value:Date.now()/1e3}),h("remind_me_later_button")},c=function(){_(),u(),m()},_=function(){$(".c-modal_footer__go--quick_promo").attr("data-action","admin_invites_modal")},u=function(){$(".c-modal_close--quick_promo").one("click",function(){TS.prefs.setPrefByAPI({name:"promo_dismissed",value:!0}),h("exit_button")})},m=function(){$(".modal-backdrop").on("click",function(){h("outside_click")})},h=function(e){TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"invite_nudge",action:"click",ui_element:e},growth:{trigger:a}}})}},3170:function(e,t){!function(){"use strict";TS.registerModule("client.highlights",{updated_sig:new signals.Signal,feedback_submitted_sig:new signals.Signal,last_request_id:null,sli_recaps_debug_group:null,onStart:function(){TS.client&&TS.boot_data.feature_sli_recaps&&(TS.client.login_sig.addOnce(function(){n=_.get(TS.shared.getActiveModelOb(),"id")}),TS.channels.pre_switched_sig.add(o),TS.groups.switched_sig.add(u),TS.mpims.switched_sig.add(u),TS.ims.switched_sig.add(u),TS.client.threads.switched_sig.add(u),TS.client.unread.switched_sig.add(u),TS.channels.history_fetched_sig.add(p),TS.client.unread.marked_group_as_read_sig.add(l),TS.experiment.loadUserAssignments().then(a))},msgIsHighlight:function(t,n){return!!(e[t]&&e[t][n]&&e[t][n].show_recap)},msgIsHighlightUnfurl:function(t,n){return!!(e[t]&&e[t][n]&&e[t][n].is_unfurl)},msgIsLeavingFeedback:function(t,n){return!!(e[t]&&e[t][n]&&e[t][n].is_leaving_feedback)},canShowRecapDebug:function(t,n){return"sli_debug_info"===TS.client.highlights.sli_recaps_debug_group&&e[t]&&e[t][n]},shouldRenderHighlightsUI:function(e,t){return TS.boot_data.feature_sli_recaps_interface&&(TS.client.highlights.msgIsHighlight(e,t)||TS.client.highlights.msgIsLeavingFeedback(e,t))},isMsgBeingRequested:function(e,n){return t[e]&&t[e][n]},getHighlight:function(t,n){return e[t]&&e[t][n]},getHighlightsForChannel:function(t){return e[t]},addHighlights:function(t){var n={};e=_.reduce(t,function(e,t,i){return e[i]=e[i]||{},_.each(t,function(t,a){e[i][a]&&(e[i][a].show_recap||e[i][a].is_leaving_feedback||e[i][a].left_feedback)?(e[i][a].request_id=t.request_id,e[i][a].cached_request_id=t.cached_request_id):(e[i][a]=t,e[i][a].justification=TS.format.formatWithOptions(t.justification||"",void 0,{no_linking:!0}),n[i]=n[i]||{},n[i][a]=e[i][a])}),e},e),_.isEmpty(n)||TS.client.highlights.updated_sig.dispatch(n)},setDefaultFeedbackForHighlight:function(t,n,a,s){if(e[t]&&e[t][n]){e[t][n]=_.assign({},e[t][n],a),"negative"===a.feedback&&(e[t][n].show_recap=!1,e[t][n].is_leaving_feedback=!0);var r={};r[t]={},r[t][n]=e[t][n],TS.client.highlights.feedback_submitted_sig.dispatch(r);var o;o="dismiss"===a.feedback?"dismiss":"default_"+a.feedback,i(e[t][n],_.get(e[t][n],["feedback_options",o,"args"]),s)}},setNegativeFeedbackForHighlight:function(t,n,a,s){if(e[t]&&e[t][n]){e[t][n].is_leaving_feedback=!1,e[t][n].left_feedback=!0;var r={};r[t]={},r[t][n]=e[t][n],TS.client.highlights.feedback_submitted_sig.dispatch(r),i(e[t][n],_.get(e[t][n],["feedback_options","negative",a,"args"]),s)}},getHighlightsForMessages:function(e){if(e.timestamps.length){var t=_.map(e.timestamps,function(e){return{ts:e,is_unread:!0}});return s(e.channel.id,e.timestamps),TS.api.call("highlights.list",{channel:e.channel.id,messages:JSON.stringify(t),channel_open_ts:e.channel_open_ts||TS.interop.datetime.makeTsStamp(e.channel.last_made_active,{padder:"0"}),channel_open_last_read_ts:e.channel.last_read}).then(function(e){TS.client.highlights.last_request_id=e.request_id,TS.client.highlights.addHighlights(e.data.messages)}).catch(function(e){TS.error(e)}).finally(function(){r(e.channel.id,e.timestamps)})}},test:function(){var t={};return Object.defineProperty(t,"_cache",{get:function(){return e},set:function(t){e=t}}),t}});var e={},t={},n=null,i=function(e,t,n){if(t){var i=_.assign({},t,{request_id:e.request_id||TS.client.highlights.last_request_id,source:n});e.cached_request_id&&(i.cached_request_id=e.cached_request_id),TS.api.call("highlights.feedback",i).catch(function(e){TS.error(e)})}},a=function(){TS.client.highlights.sli_recaps_debug_group=TS.experiment.getGroup("sli_recaps_debug")},s=function(e,n){t[e]=t[e]||{},_.each(n,function(n){t[e][n]=!0})},r=function(e,n){_.each(n,function(n){t[e]&&t[e][n]&&delete t[e][n]}),!_.isUndefined(t[e])&&_.isEmpty(t[e])&&delete t[e]},o=function(){var e=TS.shared.getModelObById(n);e&&d(e),n=_.get(TS.shared.getActiveModelOb(),"id"),u()},l=function(e){d(e.model_ob)},d=function(t){if(e[t.id]){var n=parseFloat(t.last_read);_.each(e[t.id],function(e,i){parseFloat(i)<=n&&c(t.id,i)}),_.isEmpty(e[t.id])&&delete e[t.id]}},c=function(t,n){e[t]&&e[t][n]&&delete e[t][n]},u=function(){h={}},m={},h={},p=function(e){e&&!e.is_mpim&&!e.is_im&&e.unread_cnt&&e.id===TS.model.active_channel_id&&(m[e.id]||(m[e.id]=!0,TS.membership.promiseToGetMembershipCounts(e).then(function(t){if(!(t.member_count<5)){var n=TS.utility.msgs.getUnreadMsgTimestampsWithoutHighlights(e);_.each(n,function(e,t){h[t]?delete n[t]:h[t]=!0}),_.isEmpty(n)||TS.client.highlights.getHighlightsForMessages({channel:e,timestamps:_.keys(n)})}}).finally(function(){delete m[e.id]})))}}()},3174:function(e,t){!function(){"use strict";TS.registerModule("client.ui.highlights",{openNegativeFeedbackMenu:function(n,i,a,s){var r=TS.client.highlights.getHighlight(i,a);if(r){var o=$("<ul></ul>");_.each(r.feedback_options.negative,function(e){o.append('<li role="menuitem" data-js="highlights_feedback_item"><a href="#">'+TS.format.formatWithOptions(e.text,"",{no_linking:!0})+"</a></li>")}),TS.menu.startWithList(n,o,{close_on_click:!0,menu_class:"sli_briefing__menu",position_by_click:!0,onClick:function(e){e.preventDefault();var t=$(e.target).parents("li[data-js=highlights_feedback_item]").index();TS.client.highlights.setNegativeFeedbackForHighlight(i,a,t,s)}}),TS.menu.positionAt($(n.target),e,t)}}});var e=0,t=18}()},3658:function(e,t){!function(){"use strict";TS.registerModule("ui.channel_topic_dialog",{onStart:function(){},start:function(){TS.generic_dialog.start({backdrop_click_to_dismiss:!0,body:'<div id="topic_dialog_input_container"></div>\n\t\t\t\t<label for="channel_topic_validation"></label>',dialog_class:"channel_topic_dialog",go_button_text:TS.i18n.t("Done","channel_topic_dialog")(),onShow:e,onGo:t})},test:function(){return{}}});var e=function(){var e=$("#generic_dialog.channel_topic_dialog"),t=e.find("#topic_dialog_input_container"),n=[TS.tabcomplete.channels,TS.tabcomplete.emoji,TS.tabcomplete.members];TS.ui.inline_msg_input.make(t,{aria_label:TS.i18n.t("Add a topic","channel_topic_dialog")(),no_emo:!1,placeholder:TS.i18n.t("Add a topic","channel_topic_dialog")(),onEnter:TS.generic_dialog.go,onEscape:TS.generic_dialog.cancel,completers:n,autocomplete_below_input:!0});var i=t.find(".message_input"),a=TS.shared.getActiveModelOb().topic.value,s=TS.utility.unformatTopicOrPurpose(a);TS.utility.contenteditable.value(i,s),i.attr("data-validation","maxlength=250"),i.attr("data-validation-for","channel_topic_validation"),i.addClass("no_validation_padding"),TS.generic_dialog.div.on("shown",function e(){TS.generic_dialog.div.off("shown",e),TS.utility.contenteditable.focus(i),TS.utility.contenteditable.setCursorAtEnd(i)})},t=function(){var e=$("#topic_dialog_input_container .message_input");if(!TS.ui.validation.validate(e))return!1;var t=TS.utility.contenteditable.value(e),n=TS.shared.getActiveModelOb();n.is_channel?TS.channels.setTopic(n.id,t):n.is_group&&TS.groups.setTopic(n.id,t)}}()},3975:function(e,t){!function(){"use strict";TS.registerModule("ui.card_carousel",{onStart:function(){},start:function(s){if(!s.cards)return void TS.warn("Card carousel requires cards to show.");e=s,t=s.cards,n=0,i=t.length,o(n),e.onShow&&e.onShow();var r=setTimeout(function(){TS.generic_dialog.is_showing&&($(window.document).bind("keydown",a),clearTimeout(r))},100)}});var e,t,n,i,a=function(e){e.which==TS.utility.keymap.enter||e.which==TS.utility.keymap.right?r():e.which==TS.utility.keymap.esc?l():e.which==TS.utility.keymap.left&&0!==n&&s()},s=function(){if(TS.generic_dialog.end(),(n-=1)<0||n>=i)return void l();o(n)},r=function(){if(TS.generic_dialog.end(),(n+=1)<0||n>=i)return void l();o(n)},o=function(e){var a=!1,o=!1;0===e&&(a=!0),n+1===i&&(o=!0);var d={display_card_index:n+1,number_of_cards:i,first_card:a,last_card:o},c={card:t[n],allow_animations:TS.model.prefs.a11y_animations};TS.generic_dialog.start({body:TS.templates.card_carousel(c),body_cls:"c-card_carousel__body",show_go_button:!1,show_cancel_button:!1,dialog_class:"c-card_carousel"});var _=$(".c-card_carousel");$(".c-card_carousel").append(TS.templates.card_carousel_buttons(d)),_.find(".c-card_carousel__btn--left").click(s),_.find(".c-card_carousel__btn--right").click(r),_.find(".c-card_carousel__btn--close").click(l)},l=function(){$(window.document).unbind("keydown",a),e.onEnd&&e.onEnd(),TS.generic_dialog.cancel()}}()},3976:function(e,t,n){n(2406),n(2688),n(2678),n(2679),n(2680),n(2681),n(2682),n(2683),n(2684),n(2685),n(2687),n(2420),n(2414),n(2412),n(2413),n(2408),n(2407),n(2364),n(2417),n(2404),n(2399),n(2396),n(3658),n(2402),n(2405),n(2401),n(2419),n(2403),n(3125),n(2470),n(2336),n(2512),n(523),n(153),n(520),n(544),n(2510),n(2636),n(2615),n(2392),n(2632),n(2548),n(516),n(2653),n(2644),n(2686),n(2621),n(2542),n(2299),n(2300),n(2490),n(2338),n(2630),n(2534),n(2329),n(2547),n(2639),n(2546),n(152),n(2541),n(2395),n(2398),n(2397),n(2544),n(2617),n(2545),n(2635),n(2629),n(156),n(2614),n(2536),n(2622),n(2659),n(2618),n(2297),n(2418),n(2416),n(2626),n(2411),n(2337),n(2339),n(2390),n(2638),n(2409),n(2415),n(2400),n(3134),n(3135),n(2643),n(2540),n(2628),n(2625),n(3159),n(3975),n(3170),e.exports=n(3174)},516:function(e,t,n){n(0)(n(985))},520:function(e,t,n){n(0)(n(989))},523:function(e,t,n){n(0)(n(992))},544:function(e,t,n){n(0)(n(1013))},985:function(e,t){e.exports='/*!\n  * exif-js - JavaScript library for reading EXIF image metadata\n  * https://github.com/jseidelin/exif-js\n  * MIT License | (c) 2008 Jacob Seidelin\n  */\n\n(function() {\n\n    var debug = false;\n\n    var root = this;\n\n    var EXIF = function(obj) {\n        if (obj instanceof EXIF) return obj;\n        if (!(this instanceof EXIF)) return new EXIF(obj);\n        this.EXIFwrapped = obj;\n    };\n\n    if (typeof exports !== \'undefined\') {\n        if (typeof module !== \'undefined\' && module.exports) {\n            exports = module.exports = EXIF;\n        }\n        exports.EXIF = EXIF;\n    } else {\n        root.EXIF = EXIF;\n    }\n\n    var ExifTags = EXIF.Tags = {\n\n        // version tags\n        0x9000 : "ExifVersion",             // EXIF version\n        0xA000 : "FlashpixVersion",         // Flashpix format version\n\n        // colorspace tags\n        0xA001 : "ColorSpace",              // Color space information tag\n\n        // image configuration\n        0xA002 : "PixelXDimension",         // Valid width of meaningful image\n        0xA003 : "PixelYDimension",         // Valid height of meaningful image\n        0x9101 : "ComponentsConfiguration", // Information about channels\n        0x9102 : "CompressedBitsPerPixel",  // Compressed bits per pixel\n\n        // user information\n        0x927C : "MakerNote",               // Any desired information written by the manufacturer\n        0x9286 : "UserComment",             // Comments by user\n\n        // related file\n        0xA004 : "RelatedSoundFile",        // Name of related sound file\n\n        // date and time\n        0x9003 : "DateTimeOriginal",        // Date and time when the original image was generated\n        0x9004 : "DateTimeDigitized",       // Date and time when the image was stored digitally\n        0x9290 : "SubsecTime",              // Fractions of seconds for DateTime\n        0x9291 : "SubsecTimeOriginal",      // Fractions of seconds for DateTimeOriginal\n        0x9292 : "SubsecTimeDigitized",     // Fractions of seconds for DateTimeDigitized\n\n        // picture-taking conditions\n        0x829A : "ExposureTime",            // Exposure time (in seconds)\n        0x829D : "FNumber",                 // F number\n        0x8822 : "ExposureProgram",         // Exposure program\n        0x8824 : "SpectralSensitivity",     // Spectral sensitivity\n        0x8827 : "ISOSpeedRatings",         // ISO speed rating\n        0x8828 : "OECF",                    // Optoelectric conversion factor\n        0x9201 : "ShutterSpeedValue",       // Shutter speed\n        0x9202 : "ApertureValue",           // Lens aperture\n        0x9203 : "BrightnessValue",         // Value of brightness\n        0x9204 : "ExposureBias",            // Exposure bias\n        0x9205 : "MaxApertureValue",        // Smallest F number of lens\n        0x9206 : "SubjectDistance",         // Distance to subject in meters\n        0x9207 : "MeteringMode",            // Metering mode\n        0x9208 : "LightSource",             // Kind of light source\n        0x9209 : "Flash",                   // Flash status\n        0x9214 : "SubjectArea",             // Location and area of main subject\n        0x920A : "FocalLength",             // Focal length of the lens in mm\n        0xA20B : "FlashEnergy",             // Strobe energy in BCPS\n        0xA20C : "SpatialFrequencyResponse",    //\n        0xA20E : "FocalPlaneXResolution",   // Number of pixels in width direction per FocalPlaneResolutionUnit\n        0xA20F : "FocalPlaneYResolution",   // Number of pixels in height direction per FocalPlaneResolutionUnit\n        0xA210 : "FocalPlaneResolutionUnit",    // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution\n        0xA214 : "SubjectLocation",         // Location of subject in image\n        0xA215 : "ExposureIndex",           // Exposure index selected on camera\n        0xA217 : "SensingMethod",           // Image sensor type\n        0xA300 : "FileSource",              // Image source (3 == DSC)\n        0xA301 : "SceneType",               // Scene type (1 == directly photographed)\n        0xA302 : "CFAPattern",              // Color filter array geometric pattern\n        0xA401 : "CustomRendered",          // Special processing\n        0xA402 : "ExposureMode",            // Exposure mode\n        0xA403 : "WhiteBalance",            // 1 = auto white balance, 2 = manual\n        0xA404 : "DigitalZoomRation",       // Digital zoom ratio\n        0xA405 : "FocalLengthIn35mmFilm",   // Equivalent foacl length assuming 35mm film camera (in mm)\n        0xA406 : "SceneCaptureType",        // Type of scene\n        0xA407 : "GainControl",             // Degree of overall image gain adjustment\n        0xA408 : "Contrast",                // Direction of contrast processing applied by camera\n        0xA409 : "Saturation",              // Direction of saturation processing applied by camera\n        0xA40A : "Sharpness",               // Direction of sharpness processing applied by camera\n        0xA40B : "DeviceSettingDescription",    //\n        0xA40C : "SubjectDistanceRange",    // Distance to subject\n\n        // other tags\n        0xA005 : "InteroperabilityIFDPointer",\n        0xA420 : "ImageUniqueID"            // Identifier assigned uniquely to each image\n    };\n\n    var TiffTags = EXIF.TiffTags = {\n        0x0100 : "ImageWidth",\n        0x0101 : "ImageHeight",\n        0x8769 : "ExifIFDPointer",\n        0x8825 : "GPSInfoIFDPointer",\n        0xA005 : "InteroperabilityIFDPointer",\n        0x0102 : "BitsPerSample",\n        0x0103 : "Compression",\n        0x0106 : "PhotometricInterpretation",\n        0x0112 : "Orientation",\n        0x0115 : "SamplesPerPixel",\n        0x011C : "PlanarConfiguration",\n        0x0212 : "YCbCrSubSampling",\n        0x0213 : "YCbCrPositioning",\n        0x011A : "XResolution",\n        0x011B : "YResolution",\n        0x0128 : "ResolutionUnit",\n        0x0111 : "StripOffsets",\n        0x0116 : "RowsPerStrip",\n        0x0117 : "StripByteCounts",\n        0x0201 : "JPEGInterchangeFormat",\n        0x0202 : "JPEGInterchangeFormatLength",\n        0x012D : "TransferFunction",\n        0x013E : "WhitePoint",\n        0x013F : "PrimaryChromaticities",\n        0x0211 : "YCbCrCoefficients",\n        0x0214 : "ReferenceBlackWhite",\n        0x0132 : "DateTime",\n        0x010E : "ImageDescription",\n        0x010F : "Make",\n        0x0110 : "Model",\n        0x0131 : "Software",\n        0x013B : "Artist",\n        0x8298 : "Copyright"\n    };\n\n    var GPSTags = EXIF.GPSTags = {\n        0x0000 : "GPSVersionID",\n        0x0001 : "GPSLatitudeRef",\n        0x0002 : "GPSLatitude",\n        0x0003 : "GPSLongitudeRef",\n        0x0004 : "GPSLongitude",\n        0x0005 : "GPSAltitudeRef",\n        0x0006 : "GPSAltitude",\n        0x0007 : "GPSTimeStamp",\n        0x0008 : "GPSSatellites",\n        0x0009 : "GPSStatus",\n        0x000A : "GPSMeasureMode",\n        0x000B : "GPSDOP",\n        0x000C : "GPSSpeedRef",\n        0x000D : "GPSSpeed",\n        0x000E : "GPSTrackRef",\n        0x000F : "GPSTrack",\n        0x0010 : "GPSImgDirectionRef",\n        0x0011 : "GPSImgDirection",\n        0x0012 : "GPSMapDatum",\n        0x0013 : "GPSDestLatitudeRef",\n        0x0014 : "GPSDestLatitude",\n        0x0015 : "GPSDestLongitudeRef",\n        0x0016 : "GPSDestLongitude",\n        0x0017 : "GPSDestBearingRef",\n        0x0018 : "GPSDestBearing",\n        0x0019 : "GPSDestDistanceRef",\n        0x001A : "GPSDestDistance",\n        0x001B : "GPSProcessingMethod",\n        0x001C : "GPSAreaInformation",\n        0x001D : "GPSDateStamp",\n        0x001E : "GPSDifferential"\n    };\n\n    var StringValues = EXIF.StringValues = {\n        ExposureProgram : {\n            0 : "Not defined",\n            1 : "Manual",\n            2 : "Normal program",\n            3 : "Aperture priority",\n            4 : "Shutter priority",\n            5 : "Creative program",\n            6 : "Action program",\n            7 : "Portrait mode",\n            8 : "Landscape mode"\n        },\n        MeteringMode : {\n            0 : "Unknown",\n            1 : "Average",\n            2 : "CenterWeightedAverage",\n            3 : "Spot",\n            4 : "MultiSpot",\n            5 : "Pattern",\n            6 : "Partial",\n            255 : "Other"\n        },\n        LightSource : {\n            0 : "Unknown",\n            1 : "Daylight",\n            2 : "Fluorescent",\n            3 : "Tungsten (incandescent light)",\n            4 : "Flash",\n            9 : "Fine weather",\n            10 : "Cloudy weather",\n            11 : "Shade",\n            12 : "Daylight fluorescent (D 5700 - 7100K)",\n            13 : "Day white fluorescent (N 4600 - 5400K)",\n            14 : "Cool white fluorescent (W 3900 - 4500K)",\n            15 : "White fluorescent (WW 3200 - 3700K)",\n            17 : "Standard light A",\n            18 : "Standard light B",\n            19 : "Standard light C",\n            20 : "D55",\n            21 : "D65",\n            22 : "D75",\n            23 : "D50",\n            24 : "ISO studio tungsten",\n            255 : "Other"\n        },\n        Flash : {\n            0x0000 : "Flash did not fire",\n            0x0001 : "Flash fired",\n            0x0005 : "Strobe return light not detected",\n            0x0007 : "Strobe return light detected",\n            0x0009 : "Flash fired, compulsory flash mode",\n            0x000D : "Flash fired, compulsory flash mode, return light not detected",\n            0x000F : "Flash fired, compulsory flash mode, return light detected",\n            0x0010 : "Flash did not fire, compulsory flash mode",\n            0x0018 : "Flash did not fire, auto mode",\n            0x0019 : "Flash fired, auto mode",\n            0x001D : "Flash fired, auto mode, return light not detected",\n            0x001F : "Flash fired, auto mode, return light detected",\n            0x0020 : "No flash function",\n            0x0041 : "Flash fired, red-eye reduction mode",\n            0x0045 : "Flash fired, red-eye reduction mode, return light not detected",\n            0x0047 : "Flash fired, red-eye reduction mode, return light detected",\n            0x0049 : "Flash fired, compulsory flash mode, red-eye reduction mode",\n            0x004D : "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",\n            0x004F : "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",\n            0x0059 : "Flash fired, auto mode, red-eye reduction mode",\n            0x005D : "Flash fired, auto mode, return light not detected, red-eye reduction mode",\n            0x005F : "Flash fired, auto mode, return light detected, red-eye reduction mode"\n        },\n        SensingMethod : {\n            1 : "Not defined",\n            2 : "One-chip color area sensor",\n            3 : "Two-chip color area sensor",\n            4 : "Three-chip color area sensor",\n            5 : "Color sequential area sensor",\n            7 : "Trilinear sensor",\n            8 : "Color sequential linear sensor"\n        },\n        SceneCaptureType : {\n            0 : "Standard",\n            1 : "Landscape",\n            2 : "Portrait",\n            3 : "Night scene"\n        },\n        SceneType : {\n            1 : "Directly photographed"\n        },\n        CustomRendered : {\n            0 : "Normal process",\n            1 : "Custom process"\n        },\n        WhiteBalance : {\n            0 : "Auto white balance",\n            1 : "Manual white balance"\n        },\n        GainControl : {\n            0 : "None",\n            1 : "Low gain up",\n            2 : "High gain up",\n            3 : "Low gain down",\n            4 : "High gain down"\n        },\n        Contrast : {\n            0 : "Normal",\n            1 : "Soft",\n            2 : "Hard"\n        },\n        Saturation : {\n            0 : "Normal",\n            1 : "Low saturation",\n            2 : "High saturation"\n        },\n        Sharpness : {\n            0 : "Normal",\n            1 : "Soft",\n            2 : "Hard"\n        },\n        SubjectDistanceRange : {\n            0 : "Unknown",\n            1 : "Macro",\n            2 : "Close view",\n            3 : "Distant view"\n        },\n        FileSource : {\n            3 : "DSC"\n        },\n\n        Components : {\n            0 : "",\n            1 : "Y",\n            2 : "Cb",\n            3 : "Cr",\n            4 : "R",\n            5 : "G",\n            6 : "B"\n        }\n    };\n\n    function addEvent(element, event, handler) {\n        if (element.addEventListener) {\n            element.addEventListener(event, handler, false);\n        } else if (element.attachEvent) {\n            element.attachEvent("on" + event, handler);\n        }\n    }\n\n    function imageHasData(img) {\n        return !!(img.exifdata);\n    }\n\n\n    function base64ToArrayBuffer(base64, contentType) {\n        contentType = contentType || base64.match(/^data\\:([^\\;]+)\\;base64,/mi)[1] || \'\'; // e.g. \'data:image/jpeg;base64,...\' => \'image/jpeg\'\n        base64 = base64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, \'\');\n        var binary = atob(base64);\n        var len = binary.length;\n        var buffer = new ArrayBuffer(len);\n        var view = new Uint8Array(buffer);\n        for (var i = 0; i < len; i++) {\n            view[i] = binary.charCodeAt(i);\n        }\n        return buffer;\n    }\n\n    function objectURLToBlob(url, callback) {\n        var http = new XMLHttpRequest();\n        http.open("GET", url, true);\n        http.responseType = "blob";\n        http.onload = function(e) {\n            if (this.status == 200 || this.status === 0) {\n                callback(this.response);\n            }\n        };\n        http.send();\n    }\n\n    function getImageData(img, callback) {\n        function handleBinaryFile(binFile) {\n            var data = findEXIFinJPEG(binFile);\n            var iptcdata = findIPTCinJPEG(binFile);\n            img.exifdata = data || {};\n            img.iptcdata = iptcdata || {};\n            if (callback) {\n                callback.call(img);\n            }\n        }\n\n        if (img.src) {\n            if (/^data\\:/i.test(img.src)) { // Data URI\n                var arrayBuffer = base64ToArrayBuffer(img.src);\n                handleBinaryFile(arrayBuffer);\n\n            } else if (/^blob\\:/i.test(img.src)) { // Object URL\n                var fileReader = new FileReader();\n                fileReader.onload = function(e) {\n                    handleBinaryFile(e.target.result);\n                };\n                objectURLToBlob(img.src, function (blob) {\n                    fileReader.readAsArrayBuffer(blob);\n                });\n            } else {\n                var http = new XMLHttpRequest();\n                http.onload = function() {\n                    if (this.status == 200 || this.status === 0) {\n                        handleBinaryFile(http.response);\n                    } else {\n                        throw "Could not load image";\n                    }\n                    http = null;\n                };\n                http.open("GET", img.src, true);\n                http.responseType = "arraybuffer";\n                http.send(null);\n            }\n        } else if (window.FileReader && (img instanceof window.Blob || img instanceof window.File)) {\n            var fileReader = new FileReader();\n            fileReader.onload = function(e) {\n                if (debug) console.log("Got file of length " + e.target.result.byteLength);\n                handleBinaryFile(e.target.result);\n            };\n\n            fileReader.readAsArrayBuffer(img);\n        }\n    }\n\n    function findEXIFinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log("Got file of length " + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log("Not a valid JPEG");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength,\n            marker;\n\n        while (offset < length) {\n            if (dataView.getUint8(offset) != 0xFF) {\n                if (debug) console.log("Not a valid marker at offset " + offset + ", found: " + dataView.getUint8(offset));\n                return false; // not a valid marker, something is wrong\n            }\n\n            marker = dataView.getUint8(offset + 1);\n            if (debug) console.log(marker);\n\n            // we could implement handling for other markers here,\n            // but we\'re only looking for 0xFFE1 for EXIF data\n\n            if (marker == 225) {\n                if (debug) console.log("Found 0xFFE1 marker");\n\n                return readEXIFData(dataView, offset + 4, dataView.getUint16(offset + 2) - 2);\n\n                // offset += 2 + file.getShortAt(offset+2, true);\n\n            } else {\n                offset += 2 + dataView.getUint16(offset+2);\n            }\n\n        }\n\n    }\n\n    function findIPTCinJPEG(file) {\n        var dataView = new DataView(file);\n\n        if (debug) console.log("Got file of length " + file.byteLength);\n        if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n            if (debug) console.log("Not a valid JPEG");\n            return false; // not a valid jpeg\n        }\n\n        var offset = 2,\n            length = file.byteLength;\n\n\n        var isFieldSegmentStart = function(dataView, offset){\n            return (\n                dataView.getUint8(offset) === 0x38 &&\n                dataView.getUint8(offset+1) === 0x42 &&\n                dataView.getUint8(offset+2) === 0x49 &&\n                dataView.getUint8(offset+3) === 0x4D &&\n                dataView.getUint8(offset+4) === 0x04 &&\n                dataView.getUint8(offset+5) === 0x04\n            );\n        };\n\n        while (offset < length) {\n\n            if ( isFieldSegmentStart(dataView, offset )){\n\n                // Get the length of the name header (which is padded to an even number of bytes)\n                var nameHeaderLength = dataView.getUint8(offset+7);\n                if(nameHeaderLength % 2 !== 0) nameHeaderLength += 1;\n                // Check for pre photoshop 6 format\n                if(nameHeaderLength === 0) {\n                    // Always 4\n                    nameHeaderLength = 4;\n                }\n\n                var startOffset = offset + 8 + nameHeaderLength;\n                var sectionLength = dataView.getUint16(offset + 6 + nameHeaderLength);\n\n                return readIPTCData(file, startOffset, sectionLength);\n\n                break;\n\n            }\n\n\n            // Not the marker, continue searching\n            offset++;\n\n        }\n\n    }\n    var IptcFieldMap = {\n        0x78 : \'caption\',\n        0x6E : \'credit\',\n        0x19 : \'keywords\',\n        0x37 : \'dateCreated\',\n        0x50 : \'byline\',\n        0x55 : \'bylineTitle\',\n        0x7A : \'captionWriter\',\n        0x69 : \'headline\',\n        0x74 : \'copyright\',\n        0x0F : \'category\'\n    };\n    function readIPTCData(file, startOffset, sectionLength){\n        var dataView = new DataView(file);\n        var data = {};\n        var fieldValue, fieldName, dataSize, segmentType, segmentSize;\n        var segmentStartPos = startOffset;\n        while(segmentStartPos < startOffset+sectionLength) {\n            if(dataView.getUint8(segmentStartPos) === 0x1C && dataView.getUint8(segmentStartPos+1) === 0x02){\n                segmentType = dataView.getUint8(segmentStartPos+2);\n                if(segmentType in IptcFieldMap) {\n                    dataSize = dataView.getInt16(segmentStartPos+3);\n                    segmentSize = dataSize + 5;\n                    fieldName = IptcFieldMap[segmentType];\n                    fieldValue = getStringFromDB(dataView, segmentStartPos+5, dataSize);\n                    // Check if we already stored a value with this name\n                    if(data.hasOwnProperty(fieldName)) {\n                        // Value already stored with this name, create multivalue field\n                        if(data[fieldName] instanceof Array) {\n                            data[fieldName].push(fieldValue);\n                        }\n                        else {\n                            data[fieldName] = [data[fieldName], fieldValue];\n                        }\n                    }\n                    else {\n                        data[fieldName] = fieldValue;\n                    }\n                }\n\n            }\n            segmentStartPos++;\n        }\n        return data;\n    }\n\n\n\n    function readTags(file, tiffStart, dirStart, strings, bigEnd) {\n        var entries = file.getUint16(dirStart, !bigEnd),\n            tags = {},\n            entryOffset, tag,\n            i;\n\n        for (i=0;i<entries;i++) {\n            entryOffset = dirStart + i*12 + 2;\n            tag = strings[file.getUint16(entryOffset, !bigEnd)];\n            if (!tag && debug) console.log("Unknown tag: " + file.getUint16(entryOffset, !bigEnd));\n            tags[tag] = readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd);\n        }\n        return tags;\n    }\n\n\n    function readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd) {\n        var type = file.getUint16(entryOffset+2, !bigEnd),\n            numValues = file.getUint32(entryOffset+4, !bigEnd),\n            valueOffset = file.getUint32(entryOffset+8, !bigEnd) + tiffStart,\n            offset,\n            vals, val, n,\n            numerator, denominator;\n\n        switch (type) {\n            case 1: // byte, 8-bit unsigned int\n            case 7: // undefined, 8-bit byte, value depending on field\n                if (numValues == 1) {\n                    return file.getUint8(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint8(offset + n);\n                    }\n                    return vals;\n                }\n\n            case 2: // ascii, 8-bit byte\n                offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n                return getStringFromDB(file, offset, numValues-1);\n\n            case 3: // short, 16 bit int\n                if (numValues == 1) {\n                    return file.getUint16(entryOffset + 8, !bigEnd);\n                } else {\n                    offset = numValues > 2 ? valueOffset : (entryOffset + 8);\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint16(offset + 2*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 4: // long, 32 bit int\n                if (numValues == 1) {\n                    return file.getUint32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getUint32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 5:    // rational = two long values, first is numerator, second is denominator\n                if (numValues == 1) {\n                    numerator = file.getUint32(valueOffset, !bigEnd);\n                    denominator = file.getUint32(valueOffset+4, !bigEnd);\n                    val = new Number(numerator / denominator);\n                    val.numerator = numerator;\n                    val.denominator = denominator;\n                    return val;\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        numerator = file.getUint32(valueOffset + 8*n, !bigEnd);\n                        denominator = file.getUint32(valueOffset+4 + 8*n, !bigEnd);\n                        vals[n] = new Number(numerator / denominator);\n                        vals[n].numerator = numerator;\n                        vals[n].denominator = denominator;\n                    }\n                    return vals;\n                }\n\n            case 9: // slong, 32 bit signed int\n                if (numValues == 1) {\n                    return file.getInt32(entryOffset + 8, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 4*n, !bigEnd);\n                    }\n                    return vals;\n                }\n\n            case 10: // signed rational, two slongs, first is numerator, second is denominator\n                if (numValues == 1) {\n                    return file.getInt32(valueOffset, !bigEnd) / file.getInt32(valueOffset+4, !bigEnd);\n                } else {\n                    vals = [];\n                    for (n=0;n<numValues;n++) {\n                        vals[n] = file.getInt32(valueOffset + 8*n, !bigEnd) / file.getInt32(valueOffset+4 + 8*n, !bigEnd);\n                    }\n                    return vals;\n                }\n        }\n    }\n\n    function getStringFromDB(buffer, start, length) {\n        var outstr = "";\n        for (n = start; n < start+length; n++) {\n            outstr += String.fromCharCode(buffer.getUint8(n));\n        }\n        return outstr;\n    }\n\n    function readEXIFData(file, start) {\n        if (getStringFromDB(file, start, 4) != "Exif") {\n            if (debug) console.log("Not valid EXIF data! " + getStringFromDB(file, start, 4));\n            return false;\n        }\n\n        var bigEnd,\n            tags, tag,\n            exifData, gpsData,\n            tiffOffset = start + 6;\n\n        // test for TIFF validity and endianness\n        if (file.getUint16(tiffOffset) == 0x4949) {\n            bigEnd = false;\n        } else if (file.getUint16(tiffOffset) == 0x4D4D) {\n            bigEnd = true;\n        } else {\n            if (debug) console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");\n            return false;\n        }\n\n        if (file.getUint16(tiffOffset+2, !bigEnd) != 0x002A) {\n            if (debug) console.log("Not valid TIFF data! (no 0x002A)");\n            return false;\n        }\n\n        var firstIFDOffset = file.getUint32(tiffOffset+4, !bigEnd);\n\n        if (firstIFDOffset < 0x00000008) {\n            if (debug) console.log("Not valid TIFF data! (First offset less than 8)", file.getUint32(tiffOffset+4, !bigEnd));\n            return false;\n        }\n\n        tags = readTags(file, tiffOffset, tiffOffset + firstIFDOffset, TiffTags, bigEnd);\n\n        if (tags.ExifIFDPointer) {\n            exifData = readTags(file, tiffOffset, tiffOffset + tags.ExifIFDPointer, ExifTags, bigEnd);\n            for (tag in exifData) {\n                switch (tag) {\n                    case "LightSource" :\n                    case "Flash" :\n                    case "MeteringMode" :\n                    case "ExposureProgram" :\n                    case "SensingMethod" :\n                    case "SceneCaptureType" :\n                    case "SceneType" :\n                    case "CustomRendered" :\n                    case "WhiteBalance" :\n                    case "GainControl" :\n                    case "Contrast" :\n                    case "Saturation" :\n                    case "Sharpness" :\n                    case "SubjectDistanceRange" :\n                    case "FileSource" :\n                        exifData[tag] = StringValues[tag][exifData[tag]];\n                        break;\n\n                    case "ExifVersion" :\n                    case "FlashpixVersion" :\n                        exifData[tag] = String.fromCharCode(exifData[tag][0], exifData[tag][1], exifData[tag][2], exifData[tag][3]);\n                        break;\n\n                    case "ComponentsConfiguration" :\n                        exifData[tag] =\n                            StringValues.Components[exifData[tag][0]] +\n                            StringValues.Components[exifData[tag][1]] +\n                            StringValues.Components[exifData[tag][2]] +\n                            StringValues.Components[exifData[tag][3]];\n                        break;\n                }\n                tags[tag] = exifData[tag];\n            }\n        }\n\n        if (tags.GPSInfoIFDPointer) {\n            gpsData = readTags(file, tiffOffset, tiffOffset + tags.GPSInfoIFDPointer, GPSTags, bigEnd);\n            for (tag in gpsData) {\n                switch (tag) {\n                    case "GPSVersionID" :\n                        gpsData[tag] = gpsData[tag][0] +\n                            "." + gpsData[tag][1] +\n                            "." + gpsData[tag][2] +\n                            "." + gpsData[tag][3];\n                        break;\n                }\n                tags[tag] = gpsData[tag];\n            }\n        }\n\n        return tags;\n    }\n\n    EXIF.getData = function(img, callback) {\n        if ((img instanceof Image || img instanceof HTMLImageElement) && !img.complete) return false;\n\n        if (!imageHasData(img)) {\n            getImageData(img, callback);\n        } else {\n            if (callback) {\n                callback.call(img);\n            }\n        }\n        return true;\n    }\n\n    EXIF.getTag = function(img, tag) {\n        if (!imageHasData(img)) return;\n        return img.exifdata[tag];\n    }\n\n    EXIF.getAllTags = function(img) {\n        if (!imageHasData(img)) return {};\n        var a,\n            data = img.exifdata,\n            tags = {};\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                tags[a] = data[a];\n            }\n        }\n        return tags;\n    }\n\n    EXIF.pretty = function(img) {\n        if (!imageHasData(img)) return "";\n        var a,\n            data = img.exifdata,\n            strPretty = "";\n        for (a in data) {\n            if (data.hasOwnProperty(a)) {\n                if (typeof data[a] == "object") {\n                    if (data[a] instanceof Number) {\n                        strPretty += a + " : " + data[a] + " [" + data[a].numerator + "/" + data[a].denominator + "]\\r\\n";\n                    } else {\n                        strPretty += a + " : [" + data[a].length + " values]\\r\\n";\n                    }\n                } else {\n                    strPretty += a + " : " + data[a] + "\\r\\n";\n                }\n            }\n        }\n        return strPretty;\n    }\n\n    EXIF.readFromBinaryFile = function(file) {\n        return findEXIFinJPEG(file);\n    }\n\n    if (typeof define === \'function\' && define.amd) {\n        define(\'exif-js\', [], function() {\n            return EXIF;\n        });\n    }\n}.call(this));\n'},989:function(e,t){e.exports="/**\n * Requires JQueryUI,jquery-textrange\n */\n/*jslint regexp: true, todo: true, vars: true, white: true, nomen: true, plusplus: true */\n/*global jQuery, console */\n\n// TODO: This should be abstracted out into a plugin that just does regex based highlighting\n// properly on an input field or text area. Then another one can extend it (or perhaps this\n// one can do it with a certain option flag) to make it take the list of modifiers. That way\n// we can use this plugin to add highlighting to the message input field.\n\n(function($) {\n\n\t\"use strict\";\n\n\tvar UNDERLAY_CLASS = 'underlay';\n\tvar might_be_modifier_regex = /^[^:]+:([^:+]+)?$/i;\n\tvar is_webkit = /webkit/i.test(navigator.userAgent);\n\n\t$.widget('TS.highlighter', {\n\n\t\t// defaults\n\t\toptions: {\n\t\t\tplaceholder_class: 'ghost_text',\n\t\t\tglobal_modifier_highlight_class: 'modifier',\n\t\t\tglobal_modifier_incomplete_highlight_class: 'incomplete',\n\t\t\tglobal_keyword_highlightClass: 'keyword',\n\t\t\t// takes a list of objects in the following format:\n\t\t\t// {\n\t\t\t//   modifier: 'after:',\n\t\t\t//   keyword_testers: [function(str) {return true/false}],\n\t\t\t//   modifierHighlightClass: 'time-mod'\n\t\t\t//   keyword_highlight_class: 'time-mod-keyword'\n\t\t\t// }\n\t\t\tmodifiers: []\n\t\t},\n\n\t\t_ghost_text: '',\n\t\t_ghost_prev_char: '',\n\t\t_$ghost_text: null,\n\t\t_ghost_text_changed_sig: null,\n\n\t\t// init/constructor\n\t\t_create: function() {\n\t\t\tif (!this.element.is('input[type=\"text\"]')) {\n\t\t\t\tthrow this.widgetName + ': Element is not a text input.';\n\t\t\t}\n\n\t\t\tthis._renderUI();\n\n\t\t\t// bind UI\n\t\t\t// keydown for immediacy, keyup to capture pastes and other weirdo things\n\t\t\tthis._on({\n\t\t\t\t'keydown': this._onInputKey,\n\t\t\t\t'keyup': this._onInputKey,\n\t\t\t\t'change': this._onInputChange,\n\t\t\t\t'scroll': this._onScroll,\n\t\t\t\t'focus': this._onFocus,\n\t\t\t\t'blur': this._onBlur,\n\t\t\t\t'mouseenter': this._onMouseEnter,\n\t\t\t\t'mouseleave': this._onMouseLeave\n\t\t\t});\n\n\t\t\tif (_has_scroll_left_bug === null) {\n\t\t\t\t_testHasScrollLeftBug(this.element.parent());\n\t\t\t}\n\n\t\t\tthis._$ghost_text = $('<span>').addClass(this.options.placeholder_class);\n\t\t\tthis._ghost_text_changed_sig = new signals.Signal();\n\t\t\tthis._ghost_text_changed_sig.add(this._onNewGhostText, this);\n\n\t\t\tif (this.element.val().trim()) {\n\t\t\t\tthis._updateUnderlay();\n\t\t\t}\n\t\t},\n\n\t\t_destroy: function() {\n\t\t\t_cancelRAF(this._scroll_raf);\n\t\t\t$(window).unbind('resize.highlighter_resize');\n\t\t\tTS.client.flexpane_display_switched_sig.remove(this._updateSizing);\n\t\t\tthis.element.off('.highlighter_transition');\n\t\t},\n\n\t\t_renderUI: function() {\n\t\t\tvar widget_prefix = this.widgetName + '_';\n\n\t\t\tthis._$underlay = $('<div class=\"' + widget_prefix + UNDERLAY_CLASS + '\"/>');\n\t\t\tthis._$wrapper = this.element.parent();\n\t\t\tthis._$wrapper.append(this._$underlay);\n\t\t\tthis.element.addClass('search_input_highlighted');\n\n\t\t\tthis._updateSizing();\n\n\t\t\t$(window).bind('resize.highlighter_resize', TS.utility.debounce($.proxy(this._updateSizing, this), 500));\n \t\t\tTS.client.flexpane_display_switched_sig.add(this._updateSizing, this);\n \t\t\tvar self = this;\n \t\t\tthis._$underlay.closest('.flex_header').on('transitionend.highlighter_transition webkitTransitionEnd.highlighter_transition MozTransitionEnd.highlighter_transition', function(e) {\n \t\t\t\tself._updateSizing();\n \t\t\t});\t\t\t\n\t\t},\n\n\t\t_onInputKey: function() {\n\t\t\tthis.element.trigger('change');\n\t\t},\n\n\t\t_onInputChange: function() {\n\t\t\t_rAF($.proxy(this._updateUnderlay, this));\n\t\t},\n\n\t\t_onScroll: function() {\n\t\t\t// Unfortunately, only FF & IE trigger scroll events on the input element\n\t\t\t// Keep the underlay at the same scroll position as the element\n\t\t\t_rAF($.proxy(function() {\n\t\t\t\tthis._$underlay.scrollLeft(this.element.scrollLeft());\n\t\t\t}, this));\n\t\t},\n\n\t\t_onFocus: function() {\n\t\t\tthis._has_focus = true;\n\n\t\t\tthis._updateSizing();\n\n\t\t\t// only need this on chrome/safari\n\t\t\tif (is_webkit) {\n\t\t\t\tthis._syncScrollLeft();\n\t\t\t}\n\t\t},\n\n\t\t_onBlur: function() {\n\t\t\tthis._has_focus = false;\n\t\t\tthis._updateSizing();\n\t\t},\n\n\t\t_onMouseEnter: function() {\n\t\t\tthis._mouse_over = true;\n\n\t\t\t// only need this on chrome/safari\n\t\t\tif (is_webkit) {\n\t\t\t\tthis._syncScrollLeft();\n\t\t\t}\n\t\t},\n\n\t\t_onMouseLeave: function() {\n\t\t\tthis._mouse_over = false;\n\t\t},\n\n\t\t_replaceAll: function(txt, regex, newStr) {\n\t\t\tif (regex instanceof RegExp) {\n\t\t\t\treturn txt.replace(regex, newStr);\n\t\t\t}\n\t\t\treturn txt.replace(new RegExp(regex, 'gi'), newStr);\n\t\t},\n\n\n\t\thighlightStr: function(str, allow_breaks) {\n\t\t\tvar words = str.split(' ');\n\n\t\t\t// takes a list of objects in the following format:\n\t\t\t// {\n\t\t\t//   modifier: 'after:',\n\t\t\t//   keyword_testers: [function(str) {return true/false}],\n\t\t\t//   modifierHighlightClass: 'time-mod'\n\t\t\t//   keyword_highlight_class: 'time-mod-keyword'\n\t\t\t// }\n\n\t\t\t// test highlights against each word\n\t\t\twords.forEach(function(word, index) {\n\t\t\t\tif (this._mightBeModifier(word)) {\n\t\t\t\t\tvar colon_index = word.indexOf(':');\n\t\t\t\t\tvar possible_modifier = word.slice(0, colon_index + 1);\n\t\t\t\t\tvar keyword = word.slice(colon_index + 1);\n\t\t\t\t\tvar new_word;\n\n\t\t\t\t\tthis.options.modifiers.some(function(modifierDetails) {\n\t\t\t\t\t\tvar real_modifier = modifierDetails.modifier;\n\t\t\t\t\t\tvar modifier_span;\n\t\t\t\t\t\tvar keyword_span;\n\t\t\t\t\t\tif (possible_modifier.toLowerCase() === real_modifier) {\n\t\t\t\t\t\t\t// Its a valid modifier! Wrap this shiz\n\t\t\t\t\t\t\tvar mod_class = this.options.global_modifier_highlight_class;\n\t\t\t\t\t\t\tvar incomplete_class = this.options.global_modifier_incomplete_highlight_class;\n\t\t\t\t\t\t\tif (modifierDetails.modifierHighlightClass) {\n\t\t\t\t\t\t\t\tmod_class = mod_class + ' ' + modifierDetails.modifierHighlightClass;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnew_word = '';\n\n\t\t\t\t\t\t\t// in the history section of the autocomplete, we allow breaks between the words\n\t\t\t\t\t\t\t// but not between modifiers and keywords\n\t\t\t\t\t\t\t// the wbr is a hint, mainly for firefox, that it should break before the no_wrap span\n\t\t\t\t\t\t\t// otherwise, this happens: https://tinyspeck.slack.com/files/amy/F031PD2EN/qa___tiny_speck_slack.png\n\t\t\t\t\t\t\tif (allow_breaks) new_word += '<wbr/><span class=\"no_wrap\">';\n\n\t\t\t\t\t\t\t// check if keyword is valid\n\t\t\t\t\t\t\tif (keyword) {\n\t\t\t\t\t\t\t\tmodifierDetails.keyword_testers.some(function(format_tester) {\n\t\t\t\t\t\t\t\t\tif (format_tester(keyword)) {\n\t\t\t\t\t\t\t\t\t\tvar keywordClass = this.options.global_keyword_highlightClass;\n\t\t\t\t\t\t\t\t\t\tif (modifierDetails.keyword_highlight_class) {\n\t\t\t\t\t\t\t\t\t\t\tkeywordClass = keywordClass + ' ' + modifierDetails.keyword_highlight_class;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tkeyword_span = '<span class=\"' + keywordClass + '\">' + _htmlEntities(keyword) + '</span>';\n\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}, this);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (keyword_span) {\n\t\t\t\t\t\t\t\t// complete (green)\n\t\t\t\t\t\t\t\tmodifier_span = '<span class=\"' + mod_class + '\">' + _htmlEntities(possible_modifier) + '</span>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// incomplete (yellow)\n\t\t\t\t\t\t\t\tmodifier_span = '<span class=\"' + mod_class + ' ' + incomplete_class + '\">' + _htmlEntities(possible_modifier) + '</span>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tnew_word += modifier_span;\n\n\t\t\t\t\t\t\tif (keyword_span) {\n\t\t\t\t\t\t\t\tnew_word += keyword_span;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tnew_word += _htmlEntities(keyword);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// close the no_wrap span\n\t\t\t\t\t\t\tif (allow_breaks) new_word += '</span>';\n\n\t\t\t\t\t\t\twords[index] = new_word;\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twords[index] = _htmlEntities(word);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this);\n\t\t\t\t} else {\n\t\t\t\t\twords[index] = _htmlEntities(word);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\treturn words.join(' ');\n\t\t},\n\n\t\t_updateUnderlay: function() {\n\t\t\tvar val = this.element.val();\n\t\t\tvar newTxt;\n\t\t\t\n\t\t\tif (this._prevVal === val) return;\n\n\t\t\tnewTxt = this.highlightStr(val);\n\n\t\t\t// Adjust copy to match text area in rendering by working\n\t\t\t// around the way spaces are collapsed in HTML. Maybe a \"pre\"\n\t\t\t// style here could work instead?\n\t\t\tnewTxt = this._replaceAll(newTxt, '\\n', '<br/>');\n\t\t\tnewTxt = this._replaceAll(newTxt, '  ', '  ');\n\n\t\t\t// Might be handy to insert an HTML tag representing the location\n\t\t\t// of the caret here, for use positioning things.\n\t\t\tthis._$underlay.html(newTxt);\n\n\t\t\t// ghost text is the placeholdery text to the right of the cursor\n\t\t\t// it shows you what hitting tab will do\n\t\t\tif (this._ghost_text) {\n\t\t\t\t// the ghost text will be updated on keyUp\n\t\t\t\t// but let's see if we can run ahead of it to reduce flickering\n\t\t\t\tif (this._prevVal && val.length > this._prevVal.length && val.charAt(val.length-1) === this._ghost_text.charAt(0)) {\n\t\t\t\t\t// typed the next letter in the ghost text\n\t\t\t\t\tthis.setGhostText(this._ghost_text.substring(1));\n\n\t\t\t\t} else if (this._prevVal && this._ghost_prev_char && val.length && val.length === (this._prevVal.length - 1) && this._ghost_prev_char === this._prevVal.charAt(this._prevVal.length-1)) {\n\t\t\t\t\t// deleted the last letter, prepend it to the ghost text\n\t\t\t\t\tthis.setGhostText(this._ghost_prev_char + this._ghost_text);\n\n\t\t\t\t} else {\n\t\t\t\t\tthis.setGhostText('');\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._$ghost_text.appendTo(this._$underlay);\n\n\t\t\tthis._prevVal = val;\n\n\t\t\t// Note: the scroll left bug is explained in _testHasScrollLeftBug.\n\t\t\t// Additionally, while Safari doesn't have the scrollLeft bug it also\n\t\t\t// doesn't allow us to determine the zoom level from window.devicePixelRatio\n\t\t\t// like EVERY other browser does. This means we cannot reliably\n\t\t\t// position the underlay across all of the zoom levels. \n\t\t\tif (_has_scroll_left_bug || TS.model.is_safari_desktop) {\n\t\t\t\t// see if the text is long enough to cause scrolling\n\t\t\t\tthis._$underlay.scrollLeft(10000);\n\t\t\t\tvar underlay_scroll_left = this._$underlay.scrollLeft();\n\t\t\t\tif (underlay_scroll_left !== 0) {\n\t\t\t\t\t// yep, hide the highlights :(\n\t\t\t\t\tthis._$underlay.scrollLeft(0);\n\t\t\t\t\tthis._$underlay.addClass('hide_highlights');\n\t\t\t\t} else {\n\t\t\t\t\t// still good\n\t\t\t\t\tthis._$underlay.removeClass('hide_highlights');\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t_mightBeModifier: function(str) {\n\t\t\treturn might_be_modifier_regex.test(str);\n\t\t},\n\n\t\t_syncScrollLeft: function() {\n\t\t\tvar sync = $.proxy(function() {\n\t\t\t\t// Note: as of Safari 10 devicePixelRatio doesn't account for \n\t\t\t\t// the zoom level, so for Safari we just hide the keywords on\n\t\t\t\t// scroll.\n\t\t\t\tvar dprWithZoom = window.devicePixelRatio;\n\t\t\t\tvar dprWithoutZoom = Math.floor(dprWithZoom) > 1 ? 2 : 1;\n\t\t\t\tvar zoomLevel = dprWithZoom / dprWithoutZoom;\n\n\t\t\t\t// Keep the underlay at the same scroll position as the element.\n\t\t\t\t// Need to account for zoom level as scrollLeft will return\n\t\t\t\t// increasingly smaller values when you zoom beyound 100%\n\t\t\t\t// but when setting scroll left the value needs to be set \n\t\t\t\t// according to what it should be at 100%.\t\t\t\n\t\t\t\tvar left = this.element.scrollLeft() * zoomLevel;\n\t\n\t\t\t\tif (left !== this._prev_left) {\n\t\t\t\t\tthis._$underlay.scrollLeft(left);\n\t\t\t\t\t// read it back in case it didn't set\n\t\t\t\t\tthis._prev_left = this._$underlay.scrollLeft();\n\t\t\t\t}\n\n\t\t\t\tif (this._has_focus || this._mouse_over) {\n\t\t\t\t\tthis._scroll_raf = _rAF(sync);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t\t_cancelRAF(this._scroll_raf);\n\t\t\tthis._prev_left = null;\n\t\t\tthis._scroll_raf = _rAF(sync);\n\t\t},\n\n\t\t// search box may change width when the window is resized\n\t\t// padding/margin may change if the page is text-only zoomed\n\t\t// this function is debounced in _create\n\t\t_updateSizing: function(e) {\n\t\t\t// Measure the parent's width vs the <input>'s \n\t\t\t// as the parent's width will be a true representation\n\t\t\t// of the available space, whereas the <input>'s \n\t\t\t// width will only be 50% of the available space \n\t\t\t// on account of the <input> and the underlay both\n\t\t\t// being flex children.\n\t\t\tvar width = this.element.parent().outerWidth();\n\n \t\t\tthis._$underlay.width(width);\n\n\t\t\t// Set left margin to align the underlay with the\n\t\t\t// left edge of the search input as it will allow\n\t\t\t// its text to be vertically aligned to the search\n\t\t\t// input at all font sizes.\n \t\t\tthis._$underlay.css('margin-left', '-' + width + 'px');\n\t\t},\t\t\n\n\t\t_onNewGhostText: function() {\n\t\t\tif (this._ghost_text) {\n\t\t\t\tthis._$ghost_text.text(this._ghost_text);\n\t\t\t} else {\n\t\t\t\t// on chrome, safari and ssb you can't scroll the highlighter as far right as the input. it's off by 1-2px\n\t\t\t\t// add some invisible text so we can scroll a bit further\n\t\t\t\tthis._$ghost_text.html('&nbsp;&nbsp;');\n\t\t\t}\n\t\t},\n\n\t\tsetGhostText: function(text, prev_char) {\n\t\t\tthis._ghost_text = text;\n\t\t\tthis._ghost_prev_char = prev_char;\n\t\t\tthis._ghost_text_changed_sig.dispatch(text);\n\t\t}\n\t});\n\n// private\n\nvar _has_scroll_left_bug = null;\n\nvar _rAF = (function() {\n\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\tvar requestAnimationFrame = window.requestAnimationFrame;\n\tvar x;\n\t\n\tfor (x = 0; x < vendors.length && !requestAnimationFrame; x++) {\n\t\trequestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\n\t}\n\t\n\tif (!requestAnimationFrame) {\n\t\tvar last_time = 0;\n\t\treturn function(callback) {\n\t\t\tvar curr_time = Date.now();\n\t\t\tvar time_to_call = Math.max(0, 16 - (curr_time - last_time));\n\t\t\tvar id = window.setTimeout(function() { \n\t\t\t\tcallback(curr_time + time_to_call);\n\t\t\t}, time_to_call);\n\t\t\tlast_time = curr_time + time_to_call;\n\t\t\treturn id;\n\t\t};\n\t}\n\n\treturn function(fn) {\n\t\treturn requestAnimationFrame.call(window, fn);\n\t};\n})();\n\nvar _cancelRAF = (function() {\n\tvar vendors = ['ms', 'moz', 'webkit', 'o'];\n\tvar cancelAnimationFrame = window.cancelAnimationFrame;\n\tvar x;\n\t\n\tfor (x = 0; x < vendors.length && !cancelAnimationFrame; x++) {\n\t\tcancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];;\n\t}\n\t\n\tif (!cancelAnimationFrame) {\n\t\treturn function(id) {\n\t\t\tclearTimeout(id);\n\t\t};\n\t}\n\n\treturn function(id) {\n\t\tcancelAnimationFrame.call(window, id);\n\t};\n})();\n\n// sooooo this is just _.escape, but I don't think this plugin should be calling TS.*.\nvar _htmlEntities = function(str) {\n\tif (!str) return '';\n\t// replace HTML tags in a string with encoded entities\n\treturn String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n}\n\n// on IE11 and older FFs, you can't get the scrollLeft for an <input type=\"text\">.\n// we need that to keep the highlights in sync as the text gets long.\n// so on browsers with this bug we will hide the highlights when the text gets long enough to scroll.\nvar _testHasScrollLeftBug = function(append_to) {\n\t// white-list some UAs\n\t// chrome, safari, ssb are ok\n\tif (/webkit/i.test(navigator.userAgent)) return;\n\t// IE10 is ok. revisit when IE12 is out\n\tif (/msie/i.test(navigator.userAgent)) return;\n\t// FF24 is bad, FF31+ is good. I haven't tested every version in between.\n\tvar ff_ver = /Firefox\\/(\\d+)\\b/.exec(navigator.userAgent);\n\tif (ff_ver && ff_ver.length === 2) {\n\t\tif (parseInt(ff_ver[1], 10) >= 31) return;\n\t}\n\t// this creates an input, fills it with a lot of text, scrolls it all the way to the \n\t// right and checks if scrollLeft is still 0.\n\tvar $input = $('<input type=\"text\">');\n\t$input.val('MMMMMMMMMMMMMMMMMMMMMMMMMM');\n\t$input.css({position: 'absolute', top: '0', right: '9999px'});\n\t$input.width(50);\n\t$input.appendTo(append_to);\n\t$input.focus().setCursorPosition(10000);\n\t// i hate browsers. on FF you can't get a good reading on this unless you wait for a while.\n\tsetTimeout(function() {\n\t\t$input.focus().setCursorPosition(10000);\n\t\t_has_scroll_left_bug = $input.scrollLeft() === 0;\n\t\t$input.remove();\n\t}, 500);\n}\n\n}(jQuery));\n"},992:function(e,t){e.exports="/**\n * jquery-textrange\n * A jQuery plugin for getting, setting and replacing the selected text in input fields and textareas.\n * See the [README](https://github.com/dwieeb/jquery-textrange/blob/1.x/README.md) for usage and examples.\n *\n * (c) 2012-2014 Daniel Imhoff <dwieeb@gmail.com> - danielimhoff.com\n */\n\n(function(factory) {\n\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(['jquery'], factory);\n\t}\n\telse if (typeof exports === 'object') {\n\t\tfactory(require('jquery'));\n\t}\n\telse {\n\t\tfactory(jQuery);\n\t}\n\n})(function($) {\n\n\tvar browserType,\n\n\ttextrange = {\n\n\t\t/**\n\t\t * $().textrange() or $().textrange('get')\n\t\t *\n\t\t * Retrieves an object containing the start and end location of the text range, the length of the range and the\n\t\t * substring of the range.\n\t\t *\n\t\t * @param (optional) property\n\t\t * @return An object of properties including position, start, end, length, and text or a specific property.\n\t\t */\n\t\tget: function(property) {\n\t\t\treturn _textrange[browserType].get.apply(this, [property]);\n\t\t},\n\n\t\t/**\n\t\t * $().textrange('set')\n\t\t *\n\t\t * Sets the selected text of an object by specifying the start and length of the selection.\n\t\t *\n\t\t * The start and length parameters are identical to PHP's substr() function with the following changes:\n\t\t *  - excluding start will select all the text in the field.\n\t\t *  - passing 0 for length will set the cursor at start. See $().textrange('setcursor')\n\t\t *\n\t\t * @param (optional) start\n\t\t * @param (optional) length\n\t\t *\n\t\t * @see http://php.net/manual/en/function.substr.php\n\t\t */\n\t\tset: function(start, length) {\n\t\t\tvar s = parseInt(start),\n\t\t\t    l = parseInt(length),\n\t\t\t    e;\n\n\t\t\tif (typeof start === 'undefined') {\n\t\t\t\ts = 0;\n\t\t\t}\n\t\t\telse if (start < 0) {\n\t\t\t\ts = this.val().length + s;\n\t\t\t}\n\n\t\t\tif (typeof length === 'undefined') {\n\t\t\t\te = this.val().length;\n\t\t\t}\n\t\t\telse if (length >= 0) {\n\t\t\t\te = s + l;\n\t\t\t}\n\t\t\telse {\n\t\t\t\te = this.val().length + l;\n\t\t\t}\n\n\t\t\t_textrange[browserType].set.apply(this, [s, e]);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * $().textrange('setcursor')\n\t\t *\n\t\t * Sets the cursor at a position of the text field.\n\t\t *\n\t\t * @param position\n\t\t */\n\t\tsetcursor: function(position) {\n\t\t\treturn this.textrange('set', position, 0);\n\t\t},\n\n\t\t/**\n\t\t * $().textrange('replace')\n\t\t * Replaces the selected text in the input field or textarea with text.\n\t\t *\n\t\t * @param text The text to replace the selection with.\n\t\t */\n\t\treplace: function(text) {\n\t\t\t_textrange[browserType].replace.apply(this, [String(text)]);\n\n\t\t\treturn this;\n\t\t},\n\n\t\t/**\n\t\t * Alias for $().textrange('replace')\n\t\t */\n\t\tinsert: function(text) {\n\t\t\treturn this.textrange('replace', text);\n\t\t}\n\t},\n\n\t_textrange = {\n\t\txul: {\n\t\t\tget: function(property) {\n\t\t\t\tvar props = {\n\t\t\t\t\tposition: this[0].selectionStart,\n\t\t\t\t\tstart: this[0].selectionStart,\n\t\t\t\t\tend: this[0].selectionEnd,\n\t\t\t\t\tlength: this[0].selectionEnd - this[0].selectionStart,\n\t\t\t\t\ttext: this.val().substring(this[0].selectionStart, this[0].selectionEnd)\n\t\t\t\t};\n\n\t\t\t\treturn typeof property === 'undefined' ? props : props[property];\n\t\t\t},\n\n\t\t\tset: function(start, end) {\n\t\t\t\tthis[0].selectionStart = start;\n\t\t\t\tthis[0].selectionEnd = end;\n\t\t\t},\n\n\t\t\treplace: function(text) {\n\t\t\t\tvar start = this[0].selectionStart;\n\t\t\t\tvar end = this[0].selectionEnd;\n\t\t\t\tvar val = this.val();\n\t\t\t\tthis.val(val.substring(0, start) + text + val.substring(end, val.length));\n\t\t\t\tthis[0].selectionStart = start;\n\t\t\t\tthis[0].selectionEnd = start + text.length;\n\t\t\t}\n\t\t},\n\n\t\tmsie: {\n\t\t\tget: function(property) {\n\t\t\t\tvar range = document.selection.createRange();\n\n\t\t\t\tif (typeof range === 'undefined') {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tposition: 0,\n\t\t\t\t\t\tstart: 0,\n\t\t\t\t\t\tend: this[0].val().length,\n\t\t\t\t\t\tlength: this[0].val().length,\n\t\t\t\t\t\ttext: this.val()\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tvar rangetext = this[0].createTextRange();\n\t\t\t\tvar rangetextcopy = rangetext.duplicate();\n\n\t\t\t\trangetext.moveToBookmark(range.getBookmark());\n\t\t\t\trangetextcopy.setEndPoint('EndToStart', rangetext);\n\n\t\t\t\tvar props = {\n\t\t\t\t\tposition: rangetextcopy.text.length,\n\t\t\t\t\tstart: rangetextcopy.text.length,\n\t\t\t\t\tend: rangetextcopy.text.length + range.text.length,\n\t\t\t\t\tlength: range.text.length,\n\t\t\t\t\ttext: range.text\n\t\t\t\t};\n\n\t\t\t\treturn typeof property === 'undefined' ? props : props[property];\n\t\t\t},\n\n\t\t\tset: function(start, end) {\n\t\t\t\tvar range = this[0].createTextRange();\n\n\t\t\t\tif (typeof range === 'undefined') {\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\n\t\t\t\tif (typeof start !== 'undefined') {\n\t\t\t\t\trange.moveStart('character', start);\n\t\t\t\t\trange.collapse();\n\t\t\t\t}\n\n\t\t\t\tif (typeof end !== 'undefined') {\n\t\t\t\t\trange.moveEnd('character', end - start);\n\t\t\t\t}\n\n\t\t\t\trange.select();\n\t\t\t},\n\n\t\t\treplace: function(text) {\n\t\t\t\tdocument.selection.createRange().text = text;\n\t\t\t}\n\t\t}\n\t};\n\n\t$.fn.textrange = function(method) {\n\t\tif (typeof this[0] === 'undefined') {\n\t\t\treturn this;\n\t\t}\n\n\t\tif (typeof browserType === 'undefined') {\n\t\t\tbrowserType = 'selectionStart' in this[0] ? 'xul' : document.selection ? 'msie' : 'unknown';\n\t\t}\n\n\t\t// I don't know how to support this browser. :c\n\t\tif (browserType === 'unknown') {\n\t\t\treturn this;\n\t\t}\n\n\t\t// Focus on the element before operating upon it.\n\t\tif (document.activeElement !== this[0]) {\n\t\t\tthis[0].focus();\n\t\t}\n\n\t\tif (typeof method === 'undefined' || typeof method !== 'string') {\n\t\t\treturn textrange.get.apply(this);\n\t\t}\n\t\telse if (typeof textrange[method] === 'function') {\n\t\t\treturn textrange[method].apply(this, Array.prototype.slice.call(arguments, 1));\n\t\t}\n\t\telse {\n\t\t\t$.error(\"Method \" + method + \" does not exist in jQuery.textrange\");\n\t\t}\n\t};\n});\n"}},[3976]);